/* Goo Engine UNOFFICIAL
 * Copyright 2013 Goo Technologies AB
 */
(function(window) {
var requirejs,require,define;!function(W){function D(t){return"[object Function]"===M.call(t)}function E(t){return"[object Array]"===M.call(t)}function t(t,e){if(t){var i;for(i=0;i<t.length&&(!t[i]||!e(t[i],i,t));i+=1);}}function N(t,e){if(t){var i;for(i=t.length-1;i>-1&&(!t[i]||!e(t[i],i,t));i-=1);}}function A(t,e){for(var i in t)if(t.hasOwnProperty(i)&&e(t[i],i))break}function O(t,e,i,o){return e&&A(e,function(e,r){(i||!F.call(t,r))&&(o&&"string"!=typeof e?(t[r]||(t[r]={}),O(t[r],e,i,o)):t[r]=e)}),t}function r(t,e){return function(){return e.apply(t,arguments)}}function X(e){if(!e)return e;var i=W;return t(e.split("."),function(t){i=i[t]}),i}function G(t,e,i,o){return e=Error(e+"\nhttp://requirejs.org/docs/errors.html#"+t),e.requireType=t,e.requireModules=o,i&&(e.originalError=i),e}function ba(){return H&&"interactive"===H.readyState?H:(N(document.getElementsByTagName("script"),function(t){return"interactive"===t.readyState?H=t:void 0}),H)}var g,s,u,y,q,B,H,I,Y,Z,ca=/(\/\*([\s\S]*?)\*\/|([^:]|^)\/\/(.*)$)/gm,da=/[^.]\s*require\s*\(\s*["']([^'"\s]+)["']\s*\)/g,$=/\.js$/,ea=/^\.\//;s=Object.prototype;var M=s.toString,F=s.hasOwnProperty,fa=Array.prototype.splice,v=!("undefined"==typeof window||!navigator||!document),aa=!v&&"undefined"!=typeof importScripts,ga=v&&"PLAYSTATION 3"===navigator.platform?/^complete$/:/^(complete|loaded)$/,R="undefined"!=typeof opera&&"[object Opera]"===opera.toString(),w={},n={},P=[],J=!1;if("undefined"==typeof define){if("undefined"!=typeof requirejs){if(D(requirejs))return;n=requirejs,requirejs=void 0}"undefined"!=typeof require&&!D(require)&&(n=require,require=void 0),g=requirejs=function(t,e,i,o){var r,n="_";return!E(t)&&"string"!=typeof t&&(r=t,E(e)?(t=e,e=i,i=o):t=[]),r&&r.context&&(n=r.context),(o=w[n])||(o=w[n]=g.s.newContext(n)),r&&o.configure(r),o.require(t,e,i)},g.config=function(t){return g(t)},g.nextTick="undefined"!=typeof setTimeout?function(t){setTimeout(t,4)}:function(t){t()},require||(require=g),g.version="2.1.1",g.jsExtRegExp=/^\/|:|\?|\.js$/,g.isBrowser=v,s=g.s={contexts:w,newContext:function(e){function i(t,e,i){var o,r,n,a,s,c,l,h=e&&e.split("/");o=h;var u=M.map,d=u&&u["*"];if(t&&"."===t.charAt(0))if(e){for(o=M.pkgs[e]?h=[e]:h.slice(0,h.length-1),e=t=o.concat(t.split("/")),o=0;e[o];o+=1)if(r=e[o],"."===r)e.splice(o,1),o-=1;else if(".."===r){if(1===o&&(".."===e[2]||".."===e[0]))break;o>0&&(e.splice(o-1,2),o-=2)}o=M.pkgs[e=t[0]],t=t.join("/"),o&&t===e+"/"+o.main&&(t=e)}else 0===t.indexOf("./")&&(t=t.substring(2));if(i&&(h||d)&&u){for(e=t.split("/"),o=e.length;o>0;o-=1){if(n=e.slice(0,o).join("/"),h)for(r=h.length;r>0;r-=1)if((i=u[h.slice(0,r).join("/")])&&(i=i[n])){a=i,s=o;break}if(a)break;!c&&d&&d[n]&&(c=d[n],l=o)}!a&&c&&(a=c,s=l),a&&(e.splice(0,s,a),t=e.join("/"))}return t}function o(e){v&&t(document.getElementsByTagName("script"),function(t){return t.getAttribute("data-requiremodule")===e&&t.getAttribute("data-requirecontext")===_.contextName?(t.parentNode.removeChild(t),!0):void 0})}function n(t){var e=M.paths[t];return e&&E(e)&&e.length>1?(o(t),e.shift(),_.require.undef(t),_.require([t]),!0):void 0}function a(t){var e,i=t?t.indexOf("!"):-1;return i>-1&&(e=t.substring(0,i),t=t.substring(i+1,t.length)),[e,t]}function s(t,e,o,r){var n,s,c=null,l=e?e.name:null,h=t,u=!0,d="";return t||(u=!1,t="_@r"+(k+=1)),t=a(t),c=t[0],t=t[1],c&&(c=i(c,l,r),s=L[c]),t&&(c?d=s&&s.normalize?s.normalize(t,function(t){return i(t,l,r)}):i(t,l,r):(d=i(t,l,r),t=a(d),c=t[0],d=t[1],o=!0,n=_.nameToUrl(d))),o=!c||s||o?"":"_unnormalized"+(B+=1),{prefix:c,name:d,parentMap:e,unnormalized:!!o,url:n,originalName:h,isDefine:u,id:(c?c+"!"+d:d)+o}}function c(t){var e=t.id,i=C[e];return i||(i=C[e]=new _.Module(t)),i}function l(t,e,i){var o=t.id,r=C[o];!F.call(L,o)||r&&!r.defineEmitComplete?c(t).on(e,i):"defined"===e&&i(L[o])}function h(e,i){var o=e.requireModules,r=!1;i?i(e):(t(o,function(t){(t=C[t])&&(t.error=e,t.events.error&&(r=!0,t.emit("error",e)))}),r||g.onError(e))}function u(){P.length&&(fa.apply(I,[I.length-1,0].concat(P)),P=[])}function d(e,i,o){var r=e.map.id;e.error?e.emit("error",e.error):(i[r]=!0,t(e.depMaps,function(t,r){var n=t.id,a=C[n];a&&!e.depMatched[r]&&!o[n]&&(i[n]?(e.defineDep(r,L[n]),e.check()):d(a,i,o))}),o[r]=!0)}function p(){var e,i,r,a,s=(r=1e3*M.waitSeconds)&&_.startTime+r<(new Date).getTime(),c=[],l=[],u=!1,f=!0;if(!x){if(x=!0,A(C,function(t){if(e=t.map,i=e.id,t.enabled&&(e.isDefine||l.push(t),!t.error))if(!t.inited&&s)n(i)?u=a=!0:(c.push(i),o(i));else if(!t.inited&&t.fetched&&e.isDefine&&(u=!0,!e.prefix))return f=!1}),s&&c.length)return r=G("timeout","Load timeout for modules: "+c,null,c),r.contextName=_.contextName,h(r);f&&t(l,function(t){d(t,{},{})}),s&&!a||!u||!v&&!aa||S||(S=setTimeout(function(){S=0,p()},50)),x=!1}}function f(t){c(s(t[0],null,!0)).init(t[1],t[2])}function m(t){var t=t.currentTarget||t.srcElement,e=_.onScriptLoad;return t.detachEvent&&!R?t.detachEvent("onreadystatechange",e):t.removeEventListener("load",e,!1),e=_.onScriptError,t.detachEvent&&!R||t.removeEventListener("error",e,!1),{node:t,id:t&&t.getAttribute("data-requiremodule")}}function y(){var t;for(u();I.length;){if(t=I.shift(),null===t[0])return h(G("mismatch","Mismatched anonymous define() module: "+t[t.length-1]));f(t)}}var x,w,_,b,S,M={waitSeconds:7,baseUrl:"./",paths:{},pkgs:{},shim:{},map:{},config:{}},C={},T={},I=[],L={},N={},k=1,B=1;return b={require:function(t){return t.require?t.require:t.require=_.makeRequire(t.map)},exports:function(t){return t.usingExports=!0,t.map.isDefine?t.exports?t.exports:t.exports=L[t.map.id]={}:void 0},module:function(t){return t.module?t.module:t.module={id:t.map.id,uri:t.map.url,config:function(){return M.config&&M.config[t.map.id]||{}},exports:L[t.map.id]}}},w=function(t){this.events=T[t.id]||{},this.map=t,this.shim=M.shim[t.id],this.depExports=[],this.depMaps=[],this.depMatched=[],this.pluginMaps={},this.depCount=0},w.prototype={init:function(t,e,i,o){o=o||{},this.inited||(this.factory=e,i?this.on("error",i):this.events.error&&(i=r(this,function(t){this.emit("error",t)})),this.depMaps=t&&t.slice(0),this.errback=i,this.inited=!0,this.ignore=o.ignore,o.enabled||this.enabled?this.enable():this.check())},defineDep:function(t,e){this.depMatched[t]||(this.depMatched[t]=!0,this.depCount-=1,this.depExports[t]=e)},fetch:function(){if(!this.fetched){this.fetched=!0,_.startTime=(new Date).getTime();var t=this.map;if(!this.shim)return t.prefix?this.callPlugin():this.load();_.makeRequire(this.map,{enableBuildCallback:!0})(this.shim.deps||[],r(this,function(){return t.prefix?this.callPlugin():this.load()}))}},load:function(){var t=this.map.url;N[t]||(N[t]=!0,_.load(this.map.id,t))},check:function(){if(this.enabled&&!this.enabling){var t,e,i=this.map.id;e=this.depExports;var o=this.exports,r=this.factory;if(this.inited){if(this.error)this.emit("error",this.error);else if(!this.defining){if(this.defining=!0,this.depCount<1&&!this.defined){if(D(r)){if(this.events.error)try{o=_.execCb(i,r,e,o)}catch(n){t=n}else o=_.execCb(i,r,e,o);if(this.map.isDefine&&((e=this.module)&&void 0!==e.exports&&e.exports!==this.exports?o=e.exports:void 0===o&&this.usingExports&&(o=this.exports)),t)return t.requireMap=this.map,t.requireModules=[this.map.id],t.requireType="define",h(this.error=t)}else o=r;this.exports=o,this.map.isDefine&&!this.ignore&&(L[i]=o,g.onResourceLoad)&&g.onResourceLoad(_,this.map,this.depMaps),delete C[i],this.defined=!0}this.defining=!1,this.defined&&!this.defineEmitted&&(this.defineEmitted=!0,this.emit("defined",this.exports),this.defineEmitComplete=!0)}}else this.fetch()}},callPlugin:function(){var t=this.map,e=t.id,o=s(t.prefix);this.depMaps.push(o),l(o,"defined",r(this,function(o){var n,a;a=this.map.name;var u=this.map.parentMap?this.map.parentMap.name:null,d=_.makeRequire(t.parentMap,{enableBuildCallback:!0,skipMap:!0});this.map.unnormalized?(o.normalize&&(a=o.normalize(a,function(t){return i(t,u,!0)})||""),o=s(t.prefix+"!"+a,this.map.parentMap),l(o,"defined",r(this,function(t){this.init([],function(){return t},null,{enabled:!0,ignore:!0})})),(a=C[o.id])&&(this.depMaps.push(o),this.events.error&&a.on("error",r(this,function(t){this.emit("error",t)})),a.enable())):(n=r(this,function(t){this.init([],function(){return t},null,{enabled:!0})}),n.error=r(this,function(t){this.inited=!0,this.error=t,t.requireModules=[e],A(C,function(t){0===t.map.id.indexOf(e+"_unnormalized")&&delete C[t.map.id]}),h(t)}),n.fromText=r(this,function(e,i){var o=t.name,r=s(o),a=J;i&&(e=i),a&&(J=!1),c(r);try{g.exec(e)}catch(l){throw Error("fromText eval for "+o+" failed: "+l)}a&&(J=!0),this.depMaps.push(r),_.completeLoad(o),d([o],n)}),o.load(t.name,d,n,M))})),_.enable(o,this),this.pluginMaps[o.id]=o},enable:function(){this.enabling=this.enabled=!0,t(this.depMaps,r(this,function(t,e){var i,o;if("string"==typeof t){if(t=s(t,this.map.isDefine?this.map:this.map.parentMap,!1,!this.skipMap),this.depMaps[e]=t,i=b[t.id])return this.depExports[e]=i(this),void 0;this.depCount+=1,l(t,"defined",r(this,function(t){this.defineDep(e,t),this.check()})),this.errback&&l(t,"error",this.errback)}i=t.id,o=C[i],!b[i]&&o&&!o.enabled&&_.enable(t,this)})),A(this.pluginMaps,r(this,function(t){var e=C[t.id];e&&!e.enabled&&_.enable(t,this)})),this.enabling=!1,this.check()},on:function(t,e){var i=this.events[t];i||(i=this.events[t]=[]),i.push(e)},emit:function(e,i){t(this.events[e],function(t){t(i)}),"error"===e&&delete this.events[e]}},_={config:M,contextName:e,registry:C,defined:L,urlFetched:N,defQueue:I,Module:w,makeModuleMap:s,nextTick:g.nextTick,configure:function(e){e.baseUrl&&"/"!==e.baseUrl.charAt(e.baseUrl.length-1)&&(e.baseUrl+="/");var i=M.pkgs,o=M.shim,r={paths:!0,config:!0,map:!0};A(e,function(t,e){r[e]?"map"===e?O(M[e],t,!0,!0):O(M[e],t,!0):M[e]=t}),e.shim&&(A(e.shim,function(t,e){E(t)&&(t={deps:t}),t.exports&&!t.exportsFn&&(t.exportsFn=_.makeShimExports(t)),o[e]=t}),M.shim=o),e.packages&&(t(e.packages,function(t){t="string"==typeof t?{name:t}:t,i[t.name]={name:t.name,location:t.location||t.name,main:(t.main||"main").replace(ea,"").replace($,"")}}),M.pkgs=i),A(C,function(t,e){t.inited||t.map.unnormalized||(t.map=s(e))}),(e.deps||e.callback)&&_.require(e.deps||[],e.callback)},makeShimExports:function(t){return function(){var e;return t.init&&(e=t.init.apply(W,arguments)),e||X(t.exports)}},makeRequire:function(t,o){function r(i,n,a){var l,u;return o.enableBuildCallback&&n&&D(n)&&(n.__requireJsBuild=!0),"string"==typeof i?D(n)?h(G("requireargs","Invalid require call"),a):t&&b[i]?b[i](C[t.id]):g.get?g.get(_,i,t):(l=s(i,t,!1,!0),l=l.id,F.call(L,l)?L[l]:h(G("notloaded",'Module name "'+l+'" has not been loaded yet for context: '+e+(t?"":". Use require([])")))):(y(),_.nextTick(function(){y(),u=c(s(null,t)),u.skipMap=o.skipMap,u.init(i,n,a,{enabled:!0}),p()}),r)}return o=o||{},O(r,{isBrowser:v,toUrl:function(e){var o=e.lastIndexOf("."),r=null;return-1!==o&&(r=e.substring(o,e.length),e=e.substring(0,o)),_.nameToUrl(i(e,t&&t.id,!0),r)},defined:function(e){return e=s(e,t,!1,!0).id,F.call(L,e)},specified:function(e){return e=s(e,t,!1,!0).id,F.call(L,e)||F.call(C,e)}}),t||(r.undef=function(e){u();var i=s(e,t,!0),o=C[e];delete L[e],delete N[i.url],delete T[e],o&&(o.events.defined&&(T[e]=o.events),delete C[e])}),r},enable:function(t){C[t.id]&&c(t).enable()},completeLoad:function(t){var e,i,o=M.shim[t]||{},r=o.exports;for(u();I.length;){if(i=I.shift(),null===i[0]){if(i[0]=t,e)break;e=!0}else i[0]===t&&(e=!0);f(i)}if(i=C[t],!e&&!L[t]&&i&&!i.inited){if(!(!M.enforceDefine||r&&X(r)))return n(t)?void 0:h(G("nodefine","No define call for "+t,null,[t]));f([t,o.deps||[],o.exportsFn])}p()},nameToUrl:function(t,e){var i,o,r,n,a,s;if(g.jsExtRegExp.test(t))n=t+(e||"");else{for(i=M.paths,o=M.pkgs,n=t.split("/"),a=n.length;a>0;a-=1){if(s=n.slice(0,a).join("/"),r=o[s],s=i[s]){E(s)&&(s=s[0]),n.splice(0,a,s);break}if(r){i=t===r.name?r.location+"/"+r.main:r.location,n.splice(0,a,i);break}}n=n.join("/"),n+=e||(/\?/.test(n)?"":".js"),n=("/"===n.charAt(0)||n.match(/^[\w\+\.\-]+:/)?"":M.baseUrl)+n}return M.urlArgs?n+((-1===n.indexOf("?")?"?":"&")+M.urlArgs):n},load:function(t,e){g.load(_,t,e)},execCb:function(t,e,i,o){return e.apply(o,i)},onScriptLoad:function(t){("load"===t.type||ga.test((t.currentTarget||t.srcElement).readyState))&&(H=null,t=m(t),_.completeLoad(t.id))},onScriptError:function(t){var e=m(t);return n(e.id)?void 0:h(G("scripterror","Script error",t,[e.id]))}},_.require=_.makeRequire(),_}},g({}),t(["toUrl","undef","defined","specified"],function(t){g[t]=function(){var e=w._;return e.require[t].apply(e,arguments)}}),v&&(u=s.head=document.getElementsByTagName("head")[0],y=document.getElementsByTagName("base")[0])&&(u=s.head=y.parentNode),g.onError=function(t){throw t},g.load=function(t,e,i){var o,r=t&&t.config||{};return v?(o=r.xhtml?document.createElementNS("http://www.w3.org/1999/xhtml","html:script"):document.createElement("script"),o.type=r.scriptType||"text/javascript",o.charset="utf-8",o.async=!0,o.setAttribute("data-requirecontext",t.contextName),o.setAttribute("data-requiremodule",e),!o.attachEvent||o.attachEvent.toString&&o.attachEvent.toString().indexOf("[native code")<0||R?(o.addEventListener("load",t.onScriptLoad,!1),o.addEventListener("error",t.onScriptError,!1)):(J=!0,o.attachEvent("onreadystatechange",t.onScriptLoad)),o.src=i,I=o,y?u.insertBefore(o,y):u.appendChild(o),I=null,o):(aa&&(importScripts(i),t.completeLoad(e)),void 0)},v&&N(document.getElementsByTagName("script"),function(t){return u||(u=t.parentNode),(q=t.getAttribute("data-main"))?(n.baseUrl||(B=q.split("/"),Y=B.pop(),Z=B.length?B.join("/")+"/":"./",n.baseUrl=Z,q=Y),q=q.replace($,""),n.deps=n.deps?n.deps.concat(q):[q],!0):void 0}),define=function(t,e,i){var o,r;"string"!=typeof t&&(i=e,e=t,t=null),E(e)||(i=e,e=[]),!e.length&&D(i)&&i.length&&(i.toString().replace(ca,"").replace(da,function(t,i){e.push(i)}),e=(1===i.length?["require"]:["require","exports","module"]).concat(e)),J&&(o=I||ba())&&(t||(t=o.getAttribute("data-requiremodule")),r=w[o.getAttribute("data-requirecontext")]),(r?r.defQueue:P).push([t,e,i])},define.amd={jQuery:!0},g.exec=function(b){return eval(b)},g(n)}}(this),define("requireLib",function(){}),define("goo/math/MathUtils",[],function(){"use strict";function t(){}return t.DEG_TO_RAD=Math.PI/180,t.RAD_TO_DEG=180/Math.PI,t.HALF_PI=.5*Math.PI,t.TWO_PI=2*Math.PI,t.EPSILON=1e-7,t.radFromDeg=function(e){return e*t.DEG_TO_RAD},t.degFromRad=function(e){return e*t.RAD_TO_DEG},t.lerp=function(t,e,i){return e===i?e:e+(i-e)*t},t.clamp=function(t,e,i){return i>e?e>t?e:t>i?i:t:i>t?i:t>e?e:t},t.moduloPositive=function(t,e){var i=t%e;return i+=0>i?e:0},t.scurve3=function(t){return(-2*t+3)*t*t},t.scurve5=function(t){return((6*t-15)*t+10)*t*t*t},t.sphericalToCartesian=function(t,e,i,o){var r=t*Math.cos(i);o.x=r*Math.cos(e),o.y=t*Math.sin(i),o.z=r*Math.sin(e)},t.cartesianToSpherical=function(t,e,i,o){var r=Math.sqrt(t*t+i*i);o.x=Math.sqrt(t*t+e*e+i*i),o.y=Math.atan2(i,t),o.z=Math.atan2(e,r)},t.getTriangleNormal=function(t,e,i,o,r,n,a,s,c){var l=o-t,h=r-e,u=n-i,d=a-t,p=s-e,f=c-i,m=h*f-u*p,g=u*d-l*f,v=l*p-h*d;return[m,g,v]},t.isPowerOfTwo=function(t){return 0===(t&t-1)},t.nearestHigherPowerOfTwo=function(t){return Math.floor(Math.pow(2,Math.ceil(Math.log(t)/Math.log(2))))},t.closeTo=function(t,e,i){return i="undefined"!=typeof i?i:.001,Math.abs(t-e)<=i},t.sign=function(t){return 0>t?-1:t>0?1:0},t.triangleArea=function(t,e,i){return Math.abs(t.x*e.y+e.x*i.y+i.x*t.y-e.y*i.x-i.y*t.x-t.y*e.x)/2},t.barycentricInterpolation=function(e,i,o,r){var n=t.triangleArea(i,o,r),a=t.triangleArea(e,o,r),s=t.triangleArea(e,i,r),c=n+a+s;if(!c){if(r[0]===e[0]&&r[2]===e[2])return e;if(r[0]===i[0]&&r[2]===i[2])return i;if(r[0]===o[0]&&r[2]===o[2])return o}return r.z=(n*e.z+a*i.z+s*o.z)/c,r},t}),define("goo/math/Vector",["goo/math/MathUtils"],function(t){"use strict";function e(t){this.data=new Float32Array(t||0)}return e.prototype.setupAliases=function(t){for(var e=this,i=0;i<t.length;i++)!function(o){for(var r=0;r<t[o].length;r++)Object.defineProperty(e,t[o][r],{get:function(){return this.data[o]},set:function(t){this.data[o]=t}});Object.defineProperty(e,i,{get:function(){return this.data[o]},set:function(t){this.data[o]=t}})}(i)},e.add=function(t,i,o){var r=t.data||t,n=i.data||i,a=r.length;if(o||(o=new e(a)),n.length!==a||o.data.length!==a)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};for(var s=0;a>s;s++)o.data[s]=r[s]+n[s];return o},e.prototype.add=function(t){return e.add(this,t,this)},e.sub=function(t,i,o){var r=t.data||t,n=i.data||i,a=r.length;if(o||(o=new e(a)),n.length!==a||o.data.length!==a)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};for(var s=0;a>s;s++)o.data[s]=r[s]-n[s];return o},e.prototype.sub=function(t){return e.sub(this,t,this)},e.mul=function(t,i,o){var r=t.data||t,n=i.data||i,a=r.length;if(o||(o=new e(a)),n.length!==a||o.data.length!==a)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};for(var s=0;a>s;s++)o.data[s]=r[s]*n[s];return o},e.prototype.mul=function(t){return e.mul(this,t,this)},e.div=function(t,i,o){var r=t.data||t,n=i.data||i,a=r.length;if(o||(o=new e(a)),n.length!==a||o.data.length!==a)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};for(var s=0;a>s;s++)o.data[s]=r[s]/n[s];return o},e.prototype.div=function(t){return e.div(this,t,this)},e.copy=function(t,i){var o=t.data.length;if(i||(i=new e(o)),i.data.length!==o)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};return i.data.set(t.data),i},e.prototype.copy=function(t){return e.copy(t,this)},e.dot=function(t,e){var i=t.data||t,o=e.data||e,r=i.length;if(o.length!==r)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};for(var n=0,a=0;r>a;a++)n+=i[a]*o[a];return n},e.prototype.dot=function(t){return e.dot(this,t)},e.apply=function(t,i,o){var r=t.rows,n=t.cols,a=i.data.length;if(o||(o=new e(r)),o.data.length!==r||n!==a)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};if(o===i)return e.copy(e.apply(t,i),o);for(var s=0;n>s;s++)for(var c=s*r,l=0;r>l;l++){for(var h=0,u=0;a>u;u++)h+=t.data[u*t.rows+l]*i.data[u];o.data[c+l]=h}return o},e.prototype.apply=function(t){return e.apply(t,this,this)},e.equals=function(e,i){var o=e.data.length;if(o!==i.data.length)return!1;for(var r=0;o>r;r++)if(Math.abs(e.data[r]-i.data[r])>t.EPSILON)return!1;return!0},e.prototype.equals=function(t){return e.equals(this,t)},e.distanceSquared=function(t,i){return e.sub(t,i).lengthSquared()},e.prototype.distanceSquared=function(t){return e.sub(this,t).lengthSquared()},e.distance=function(t,i){return e.sub(t,i).length()},e.prototype.distance=function(t){return e.sub(this,t).length()},e.prototype.lengthSquared=function(){return e.dot(this,this)},e.prototype.length=function(){return Math.sqrt(e.dot(this,this))},e.prototype.scale=function(t){for(var e=this.data.length-1;e>=0;e--)this.data[e]*=t;return this},e.prototype.invert=function(){for(var t=0;t<this.data.length;t++)this.data[t]=0-this.data[t];return this},e.prototype.normalize=function(){var e=this.length(),i=this.data.length;if(e<t.EPSILON)for(var o=0;i>o;o++)this.data[o]=0;else{e=1/e;for(var o=0;i>o;o++)this.data[o]*=e}return this},e.prototype.clone=function(){return e.copy(this)},e.prototype.set=function(){if(1===arguments.length&&"object"==typeof arguments[0])if(arguments[0]instanceof e)this.copy(arguments[0]);else if(arguments[0].length>1)for(var t=0;t<arguments[0].length;t++)this.data[t]=arguments[0][t];else this.set(arguments[0][0]);else for(var t=0;t<arguments.length;t++)this.data[t]=arguments[t];return this},e.prototype.toString=function(){var t="";t+="[";for(var e=0;e<this.data.length;e++)t+=this.data[e],t+=e!==this.data.length-1?", ":"";return t+="]"},e}),define("goo/math/Vector3",["goo/math/Vector"],function(t){"use strict";function e(){t.call(this,3),0!==arguments.length?this.set(arguments):this.setd(0,0,0)}return e.prototype=Object.create(t.prototype),e.prototype.setupAliases([["x","u","r"],["y","v","g"],["z","w","b"]]),e.ZERO=new e(0,0,0),e.ONE=new e(1,1,1),e.UNIT_X=new e(1,0,0),e.UNIT_Y=new e(0,1,0),e.UNIT_Z=new e(0,0,1),e.add=function(t,i,o){"number"==typeof t&&(t=[t,t,t]),"number"==typeof i&&(i=[i,i,i]),o||(o=new e);var r=t.data||t,n=i.data||i;if(3!==r.length||3!==n.length)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};return o.data[0]=r[0]+n[0],o.data[1]=r[1]+n[1],o.data[2]=r[2]+n[2],o},e.addv=function(t,i,o){return o||(o=new e),o.data[0]=t.data[0]+i.data[0],o.data[1]=t.data[1]+i.data[1],o.data[2]=t.data[2]+i.data[2],o},e.prototype.add=function(t){return e.add(this,t,this)},e.sub=function(t,i,o){"number"==typeof t&&(t=[t,t,t]),"number"==typeof i&&(i=[i,i,i]),o||(o=new e);var r=t.data||t,n=i.data||i;if(3!==r.length||3!==n.length)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};return o.data[0]=r[0]-n[0],o.data[1]=r[1]-n[1],o.data[2]=r[2]-n[2],o},e.subv=function(t,i,o){return o||(o=new e),o.data[0]=t.data[0]-i.data[0],o.data[1]=t.data[1]-i.data[1],o.data[2]=t.data[2]-i.data[2],o},e.prototype.sub=function(t){return e.sub(this,t,this)},e.mul=function(t,i,o){"number"==typeof t&&(t=[t,t,t]),"number"==typeof i&&(i=[i,i,i]),o||(o=new e);var r=t.data||t,n=i.data||i;if(3!==r.length||3!==n.length)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};return o.data[0]=r[0]*n[0],o.data[1]=r[1]*n[1],o.data[2]=r[2]*n[2],o},e.prototype.mul=function(t){return e.mul(this,t,this)},e.div=function(t,i,o){"number"==typeof t&&(t=[t,t,t]),"number"==typeof i&&(i=[i,i,i]),o||(o=new e);var r=t.data||t,n=i.data||i;if(3!==r.length||3!==n.length)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};return o.data[0]=r[0]/n[0],o.data[1]=r[1]/n[1],o.data[2]=r[2]/n[2],o},e.prototype.div=function(t){return e.div(this,t,this)},e.dot=function(t,e){"number"==typeof t&&(t=[t,t,t]),"number"==typeof e&&(e=[e,e,e]);var i=t.data||t,o=e.data||e;if(3!==i.length||3!==o.length)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};var r=0;return r+=i[0]*o[0],r+=i[1]*o[1],r+=i[2]*o[2]},e.prototype.dot=function(t){return e.dot(this,t)},e.cross=function(t,i,o){o||(o=new e);var r=t.data||t,n=i.data||i;if(3!==r.length||3!==n.length)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};var a=i.data[2]*t.data[1]-i.data[1]*t.data[2],s=i.data[0]*t.data[2]-i.data[2]*t.data[0],c=i.data[1]*t.data[0]-i.data[0]*t.data[1];return o.data[0]=a,o.data[1]=s,o.data[2]=c,o},e.prototype.cross=function(t){return e.cross(this,t,this)},e.prototype.lerp=function(t,e){return this.data[0]=(1-e)*this.data[0]+e*t.data[0],this.data[1]=(1-e)*this.data[1]+e*t.data[1],this.data[2]=(1-e)*this.data[2]+e*t.data[2],this},e.prototype.setd=function(t,e,i){return this.data[0]=t,this.data[1]=e,this.data[2]=i,this},e.prototype.seta=function(t){return this.data[0]=t[0],this.data[1]=t[1],this.data[2]=t[2],this},e.prototype.setv=function(t){return this.data[0]=t.data[0],this.data[1]=t.data[1],this.data[2]=t.data[2],this},e.prototype.add_d=function(t,e,i){return this.data[0]+=t,this.data[1]+=e,this.data[2]+=i,this},e.prototype.addv=function(t){return this.data[0]+=t.data[0],this.data[1]+=t.data[1],this.data[2]+=t.data[2],this},e.prototype.mulv=function(t){return this.data[0]*=t.data[0],this.data[1]*=t.data[1],this.data[2]*=t.data[2],this},e.prototype.muld=function(t,e,i){return this.data[0]*=t,this.data[1]*=e,this.data[2]*=i,this},e.prototype.subv=function(t){return this.data[0]-=t.data[0],this.data[1]-=t.data[1],this.data[2]-=t.data[2],this},e.prototype.sub_d=function(t,e,i){return this.data[0]-=t,this.data[1]-=e,this.data[2]-=i,this},e.prototype.lengthSquared=function(){return this.data[0]*this.data[0]+this.data[1]*this.data[1]+this.data[2]*this.data[2]},e.distanceSquared=function(t,e){var i=t.data[0]-e.data[0],o=t.data[1]-e.data[1],r=t.data[2]-e.data[2];return i*i+o*o+r*r},e.distance=function(t,i){return Math.sqrt(e.distanceSquared(t,i))},e.prototype.distanceSquared=function(t){return e.distanceSquared(this,t)},e.prototype.distance=function(t){return e.distance(this,t)},e}),define("goo/math/Matrix",["goo/math/MathUtils"],function(t){"use strict";function e(t,e){this.rows=t||0,this.cols=e||0,this.data=new Float32Array(this.rows*this.cols)}return e.prototype.setupAliases=function(t){for(var e=this,i=0;i<t.length;i++)!function(o){for(var r=0;r<t[o].length;r++)Object.defineProperty(e,t[o][r],{get:function(){return this.data[o]},set:function(t){this.data[o]=t}});Object.defineProperty(e,i,{get:function(){return this.data[o]},set:function(t){this.data[o]=t}})}(i)},e.add=function(t,i,o){var r=t.rows,n=t.cols;if(o||(o=new e(r,n)),i instanceof e){if(i.rows!==r||i.cols!==n||o.rows!==r||o.cols!==n)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};for(var a=0;a<t.data.length;a++)o.data[a]=t.data[a]+i.data[a]}else{if(o.rows!==r||o.cols!==n)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};for(var a=0;a<t.data.length;a++)o.data[a]=t.data[a]+i}return o},e.prototype.add=function(t){return e.add(this,t,this)},e.sub=function(t,i,o){var r=t.rows,n=t.cols;if(o||(o=new e(r,n)),i instanceof e){if(i.rows!==r||i.cols!==n||o.rows!==r||o.cols!==n)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};for(var a=0;a<t.data.length;a++)o.data[a]=t.data[a]-i.data[a]}else{if(o.rows!==r||o.cols!==n)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};for(var a=0;a<t.data.length;a++)o.data[a]=t.data[a]-i}return o},e.prototype.sub=function(t){return e.sub(this,t,this)},e.mul=function(t,i,o){var r=t.rows,n=t.cols;if(o||(o=new e(r,n)),i instanceof e){if(i.rows!==r||i.cols!==n||o.rows!==r||o.cols!==n)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};for(var a=0;a<t.data.length;a++)o.data[a]=t.data[a]*i.data[a]}else{if(o.rows!==r||o.cols!==n)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};for(var a=0;a<t.data.length;a++)o.data[a]=t.data[a]*i}return o},e.prototype.mul=function(t){return e.mul(this,t,this)},e.div=function(t,i,o){var r=t.rows,n=t.cols;if(o||(o=new e(r,n)),i instanceof e){if(i.rows!==r||i.cols!==n||o.rows!==r||o.cols!==n)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};for(var a=0;a<t.data.length;a++)o.data[a]=t.data[a]/i.data[a]}else{if(o.rows!==r||o.cols!==n)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};i=1/i;for(var a=0;a<t.data.length;a++)o.data[a]=t.data[a]*i}return o},e.prototype.div=function(t){return e.div(this,t,this)},e.combine=function(t,i,o){var r=t.rows,n=i.cols,a=t.cols=i.rows;if(o||(o=new e(r,n)),t.cols!==a||i.rows!==a||o.rows!==r||o.cols!==n)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};if(o===t||o===i)return e.copy(e.combine(t,i),o);for(var s=0;n>s;s++)for(var c=s*r,l=0;r>l;l++){for(var h=0,u=0;a>u;u++)h+=t.data[u*t.rows+l]*i.data[s*i.rows+u];o.data[c+l]=h}return o},e.prototype.combine=function(t){return e.combine(this,t,this)},e.transpose=function(t,i){var o=t.cols,r=t.rows;if(i||(i=new e(o,r)),i.rows!==o||i.cols!==r)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};if(i===t)return e.copy(e.transpose(t),i);for(var n=0;r>n;n++)for(var a=n*o,s=0;o>s;s++)i.data[a+s]=t.data[s*r+n];return i},e.prototype.transpose=function(){return e.transpose(this,this)},e.copy=function(t,i){var o=t.rows,r=t.cols;if(i||(i=new e(o,r)),i.rows!==o||i.cols!==r)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};return i.data.set(t.data),i},e.prototype.copy=function(t){return e.copy(t,this)},e.equals=function(e,i){if(e.rows!==i.rows||e.cols!==i.cols)return!1;for(var o=0;o<e.data.length;o++)if(Math.abs(e.data[o]-i.data[o])>t.EPSILON)return!1;return!0},e.prototype.equals=function(t){return e.equals(this,t)},e.prototype.isOrthogonal=function(){for(var e=0;e<this.cols;e++)for(var i=e+1;i<this.cols;i++){for(var o=e*this.rows,r=i*this.rows,n=0,a=0;a<this.rows;a++)n+=this.data[o+a]*this.data[r+a];if(Math.abs(n)>t.EPSILON)return!1}return!0},e.prototype.isNormal=function(){for(var e=0;e<this.cols;e++){for(var i=e*this.rows,o=0,r=0;r<this.rows;r++)o+=this.data[i+r]*this.data[i+r];if(Math.abs(o-1)>t.EPSILON)return!1}return!0},e.prototype.isOrthonormal=function(){return this.isOrthogonal()&&this.isNormal()},e.prototype.clone=function(){return e.copy(this)},e.prototype.set=function(){if(1===arguments.length&&"object"==typeof arguments[0])if(arguments[0]instanceof e)this.copy(arguments[0]);else for(var t=0;t<arguments[0].length;t++)this.data[t]=arguments[0][t];else for(var t=0;t<arguments.length;t++)this.data[t]=arguments[t];return this},e.prototype.toString=function(){for(var t="",e=0;e<this.cols;e++){var i=e*this.rows;t+="[";for(var o=0;o<this.rows;o++)t+=this.data[i+o],t+=o!==this.rows-1?", ":"";t+=e!==this.cols-1?"], ":"]"}return t},e}),define("goo/math/Matrix3x3",["goo/math/MathUtils","goo/math/Matrix","goo/math/Vector3"],function(t,e,i){"use strict";function o(){e.call(this,3,3),0===arguments.length?this.setIdentity():this.set(arguments),this._tempX=new i,this._tempY=new i,this._tempZ=new i}return o.prototype=Object.create(e.prototype),o.prototype.setupAliases([["e00"],["e10"],["e20"],["e01"],["e11"],["e21"],["e02"],["e12"],["e22"]]),o.IDENTITY=new o(1,0,0,0,1,0,0,0,1),o.add=function(t,e,i){i||(i=new o);var r=i.data,n=t.data;if(e instanceof o){var a=e.data;r[0]=n[0]+a[0],r[1]=n[1]+a[1],r[2]=n[2]+a[2],r[3]=n[3]+a[3],r[4]=n[4]+a[4],r[5]=n[5]+a[5],r[6]=n[6]+a[6],r[7]=n[7]+a[7],r[8]=n[8]+a[8]}else r[0]=n[0]+e,r[1]=n[1]+e,r[2]=n[2]+e,r[3]=n[3]+e,r[4]=n[4]+e,r[5]=n[5]+e,r[6]=n[6]+e,r[7]=n[7]+e,r[8]=n[8]+e;return i},o.prototype.add=function(t){return o.add(this,t,this)},o.sub=function(t,e,i){i||(i=new o);var r=i.data,n=t.data;if(e instanceof o){var a=e.data;r[0]=n[0]-a[0],r[1]=n[1]-a[1],r[2]=n[2]-a[2],r[3]=n[3]-a[3],r[4]=n[4]-a[4],r[5]=n[5]-a[5],r[6]=n[6]-a[6],r[7]=n[7]-a[7],r[8]=n[8]-a[8]}else r[0]=n[0]-e,r[1]=n[1]-e,r[2]=n[2]-e,r[3]=n[3]-e,r[4]=n[4]-e,r[5]=n[5]-e,r[6]=n[6]-e,r[7]=n[7]-e,r[8]=n[8]-e;return i},o.prototype.sub=function(t){return o.sub(this,t,this)},o.mul=function(t,e,i){i||(i=new o);var r=i.data,n=t.data;if(e instanceof o){var a=e.data;r[0]=n[0]*a[0],r[1]=n[1]*a[1],r[2]=n[2]*a[2],r[3]=n[3]*a[3],r[4]=n[4]*a[4],r[5]=n[5]*a[5],r[6]=n[6]*a[6],r[7]=n[7]*a[7],r[8]=n[8]*a[8]}else r[0]=n[0]*e,r[1]=n[1]*e,r[2]=n[2]*e,r[3]=n[3]*e,r[4]=n[4]*e,r[5]=n[5]*e,r[6]=n[6]*e,r[7]=n[7]*e,r[8]=n[8]*e;return i},o.prototype.mul=function(t){return o.mul(this,t,this)},o.div=function(t,e,i){i||(i=new o);var r=i.data,n=t.data;if(e instanceof o){var a=e.data;r[0]=n[0]/a[0],r[1]=n[1]/a[1],r[2]=n[2]/a[2],r[3]=n[3]/a[3],r[4]=n[4]/a[4],r[5]=n[5]/a[5],r[6]=n[6]/a[6],r[7]=n[7]/a[7],r[8]=n[8]/a[8]}else r[0]=n[0]/e,r[1]=n[1]/e,r[2]=n[2]/e,r[3]=n[3]/e,r[4]=n[4]/e,r[5]=n[5]/e,r[6]=n[6]/e,r[7]=n[7]/e,r[8]=n[8]/e;return i},o.prototype.div=function(t){return o.div(this,t,this)},o.combine=function(t,e,i){i||(i=new o);var r=t.data,n=r[0],a=r[3],s=r[6],c=r[1],l=r[4],h=r[7],u=r[2],d=r[5],p=r[8],f=e.data,m=f[0],g=f[3],v=f[6],y=f[1],x=f[4],w=f[7],_=f[2],b=f[5],S=f[8],M=i.data;return M[0]=n*m+a*y+s*_,M[3]=n*g+a*x+s*b,M[6]=n*v+a*w+s*S,M[1]=c*m+l*y+h*_,M[4]=c*g+l*x+h*b,M[7]=c*v+l*w+h*S,M[2]=u*m+d*y+p*_,M[5]=u*g+d*x+p*b,M[8]=u*v+d*w+p*S,i},o.prototype.combine=function(t){return o.combine(this,t,this)},o.transpose=function(t,e){e||(e=new o);var i=t.data,r=e.data;if(e===t){var n=i[3],a=i[6],s=i[7];return r[3]=i[1],r[6]=i[2],r[7]=i[5],r[1]=n,r[2]=a,r[5]=s,e}return r[0]=i[0],r[1]=i[3],r[2]=i[6],r[3]=i[1],r[4]=i[4],r[5]=i[7],r[6]=i[2],r[7]=i[5],r[8]=i[8],e},o.prototype.transpose=function(){return o.transpose(this,this)},o.invert=function(i,r){if(r||(r=new o),r===i)return e.copy(o.invert(i),r);var n=i.determinant();if(Math.abs(n)<t.EPSILON)throw{name:"Singular Matrix",message:"The matrix is singular and cannot be inverted."};
n=1/n;var a=r.data,s=i.data;return a[0]=(s[4]*s[8]-s[7]*s[5])*n,a[1]=(s[7]*s[2]-s[1]*s[8])*n,a[2]=(s[1]*s[5]-s[4]*s[2])*n,a[3]=(s[6]*s[5]-s[3]*s[8])*n,a[4]=(s[0]*s[8]-s[6]*s[2])*n,a[5]=(s[3]*s[2]-s[0]*s[5])*n,a[6]=(s[3]*s[7]-s[6]*s[4])*n,a[7]=(s[6]*s[1]-s[0]*s[7])*n,a[8]=(s[0]*s[4]-s[3]*s[1])*n,r},o.prototype.invert=function(){return o.invert(this,this)},o.prototype.isOrthogonal=function(){var e=this.data,i=e[0]*e[3]+e[1]*e[4]+e[2]*e[5];return Math.abs(i)>t.EPSILON?!1:(i=e[0]*e[6]+e[1]*e[7]+e[2]*e[8],Math.abs(i)>t.EPSILON?!1:(i=e[3]*e[6]+e[4]*e[7]+e[5]*e[8],Math.abs(i)>t.EPSILON?!1:!0))},o.prototype.isNormal=function(){var e=this.data,i=e[0]*e[0]+e[1]*e[1]+e[2]*e[2];return Math.abs(i-1)>t.EPSILON?!1:(i=e[3]*e[3]+e[4]*e[4]+e[5]*e[5],Math.abs(i-1)>t.EPSILON?!1:(i=e[6]*e[6]+e[7]*e[7]+e[8]*e[8],Math.abs(i-1)>t.EPSILON?!1:!0))},o.prototype.isOrthonormal=function(){return this.isOrthogonal()&&this.isNormal()},o.prototype.determinant=function(){var t=this.data;return t[0]*(t[4]*t[8]-t[7]*t[5])-t[3]*(t[1]*t[8]-t[7]*t[2])+t[6]*(t[1]*t[5]-t[4]*t[2])},o.prototype.setIdentity=function(){var t=this.data;return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,this},o.prototype.applyPost=function(t){var e=t.data,i=this.data,o=e[0],r=e[1],n=e[2];return e[0]=i[0]*o+i[3]*r+i[6]*n,e[1]=i[1]*o+i[4]*r+i[7]*n,e[2]=i[2]*o+i[5]*r+i[8]*n,t},o.prototype.applyPre=function(t){var e=t.data,i=this.data,o=e[0],r=e[1],n=e[2];return e[0]=i[0]*o+i[1]*r+i[2]*n,e[1]=i[3]*o+i[4]*r+i[5]*n,e[2]=i[6]*o+i[7]*r+i[8]*n,t},o.prototype.multiplyDiagonalPost=function(t,e){var i=t.data[0],o=t.data[1],r=t.data[2],n=this.data,a=e.data;return a[0]=i*n[0],a[1]=i*n[1],a[2]=i*n[2],a[3]=o*n[3],a[4]=o*n[4],a[5]=o*n[5],a[6]=r*n[6],a[7]=r*n[7],a[8]=r*n[8],e},o.prototype.fromAngles=function(t,e,i){var o=Math.cos(t),r=Math.sin(t),n=Math.cos(e),a=Math.sin(e),s=Math.cos(i),c=Math.sin(i),l=this.data;return l[0]=n*s,l[3]=a*r-n*c*o,l[6]=n*c*r+a*o,l[1]=c,l[4]=s*o,l[7]=-s*r,l[2]=-a*s,l[5]=a*c*o+n*r,l[8]=-a*c*r+n*o,this},o.prototype.rotateX=function(t,e){e=e||this;var i=this.data,o=e.data,r=Math.sin(t),n=Math.cos(t),a=i[3],s=i[4],c=i[5],l=i[6],h=i[7],u=i[8];return i!==o&&(o[0]=i[0],o[1]=i[1],o[2]=i[2]),o[3]=a*n+l*r,o[4]=s*n+h*r,o[5]=c*n+u*r,o[6]=l*n-a*r,o[7]=h*n-s*r,o[8]=u*n-c*r,o},o.prototype.rotateY=function(t,e){e=e||this;var i=this.data,o=e.data,r=Math.sin(t),n=Math.cos(t),a=i[0],s=i[1],c=i[2],l=i[6],h=i[7],u=i[8];return i!==o&&(o[3]=i[3],o[4]=i[4],o[5]=i[5]),o[0]=a*n-l*r,o[1]=s*n-h*r,o[2]=c*n-u*r,o[6]=a*r+l*n,o[7]=s*r+h*n,o[8]=c*r+u*n,o},o.prototype.rotateZ=function(t,e){e=e||this;var i=this.data,o=e.data,r=Math.sin(t),n=Math.cos(t),a=i[0],s=i[1],c=i[2],l=i[3],h=i[4],u=i[5];return i!==o&&(o[6]=i[6],o[7]=i[7],o[8]=i[8]),o[0]=a*n+l*r,o[1]=s*n+h*r,o[2]=c*n+u*r,o[3]=l*n-a*r,o[4]=h*n-s*r,o[5]=u*n-c*r,o},o.prototype.toAngles=function(e){var o=e;o||(o=new i);var r=this.data,n=o.data;return r[3]>1-t.EPSILON?(n[1]=Math.atan2(r[2],r[8]),n[2]=Math.PI/2,n[0]=0):r[3]<-1+t.EPSILON?(n[1]=Math.atan2(r[2],r[8]),n[2]=-Math.PI/2,n[0]=0):(n[1]=Math.atan2(-r[2],r[0]),n[0]=Math.atan2(-r[7],r[4]),n[2]=Math.asin(r[1])),o},o.prototype.fromAngleNormalAxis=function(t,e,i,o){var r=Math.cos(t),n=Math.sin(t),a=1-r,s=e*e,c=i*i,l=o*o,h=e*i*a,u=e*o*a,d=i*o*a,p=e*n,f=i*n,m=o*n,g=this.data;return g[0]=s*a+r,g[3]=h-m,g[6]=u+f,g[1]=h+m,g[4]=c*a+r,g[7]=d-p,g[2]=u-f,g[5]=d+p,g[8]=l*a+r,this},o.prototype.lookAt=function(t,e){var o=this._tempX,r=this._tempY,n=this._tempZ;n.setv(t).normalize(),o.setv(e).cross(n).normalize(),o.equals(i.ZERO)&&(0!==n.data[0]?o.setd(n.data[1],-n.data[0],0):o.setd(0,n.data[2],-n.data[1])),r.setv(n).cross(o);var a=this.data;return a[0]=o.data[0],a[1]=o.data[1],a[2]=o.data[2],a[3]=r.data[0],a[4]=r.data[1],a[5]=r.data[2],a[6]=n.data[0],a[7]=n.data[1],a[8]=n.data[2],this},o.prototype.copyQuaternion=function(t){return t.toRotationMatrix(this)},o.prototype.copy=function(t){var e=this.data,i=t.data;return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],this},o.prototype.clone=function(){var t=this.data;return new o(t[0],t[1],t[2],t[3],t[4],t[5],t[4],t[5],t[6])},o}),define("goo/math/Matrix4x4",["goo/math/MathUtils","goo/math/Matrix"],function(t,e){"use strict";function i(){e.call(this,4,4),0===arguments.length?this.setIdentity():this.set(arguments)}return i.prototype=Object.create(e.prototype),i.prototype.setupAliases([["e00"],["e10"],["e20"],["e30"],["e01"],["e11"],["e21"],["e31"],["e02"],["e12"],["e22"],["e32"],["e03"],["e13"],["e23"],["e33"]]),i.IDENTITY=new i(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),i.add=function(t,e,o){return o||(o=new i),e instanceof i?(o.e00=t.e00+e.e00,o.e10=t.e10+e.e10,o.e20=t.e20+e.e20,o.e30=t.e30+e.e30,o.e01=t.e01+e.e01,o.e11=t.e11+e.e11,o.e21=t.e21+e.e21,o.e31=t.e31+e.e31,o.e02=t.e02+e.e02,o.e12=t.e12+e.e12,o.e22=t.e22+e.e22,o.e32=t.e32+e.e32,o.e03=t.e03+e.e03,o.e13=t.e13+e.e13,o.e23=t.e23+e.e23,o.e33=t.e33+e.e33):(o.e00=t.e00+e,o.e10=t.e10+e,o.e20=t.e20+e,o.e30=t.e30+e,o.e01=t.e01+e,o.e11=t.e11+e,o.e21=t.e21+e,o.e31=t.e31+e,o.e02=t.e02+e,o.e12=t.e12+e,o.e22=t.e22+e,o.e32=t.e32+e,o.e03=t.e03+e,o.e13=t.e13+e,o.e23=t.e23+e,o.e33=t.e33+e),o},i.prototype.add=function(t){return i.add(this,t,this)},i.sub=function(t,e,o){return o||(o=new i),e instanceof i?(o.e00=t.e00-e.e00,o.e10=t.e10-e.e10,o.e20=t.e20-e.e20,o.e30=t.e30-e.e30,o.e01=t.e01-e.e01,o.e11=t.e11-e.e11,o.e21=t.e21-e.e21,o.e31=t.e31-e.e31,o.e02=t.e02-e.e02,o.e12=t.e12-e.e12,o.e22=t.e22-e.e22,o.e32=t.e32-e.e32,o.e03=t.e03-e.e03,o.e13=t.e13-e.e13,o.e23=t.e23-e.e23,o.e33=t.e33-e.e33):(o.e00=t.e00-e,o.e10=t.e10-e,o.e20=t.e20-e,o.e30=t.e30-e,o.e01=t.e01-e,o.e11=t.e11-e,o.e21=t.e21-e,o.e31=t.e31-e,o.e02=t.e02-e,o.e12=t.e12-e,o.e22=t.e22-e,o.e32=t.e32-e,o.e03=t.e03-e,o.e13=t.e13-e,o.e23=t.e23-e,o.e33=t.e33-e),o},i.prototype.sub=function(t){return i.sub(this,t,this)},i.mul=function(t,e,o){return o||(o=new i),e instanceof i?(o.e00=t.e00*e.e00,o.e10=t.e10*e.e10,o.e20=t.e20*e.e20,o.e30=t.e30*e.e30,o.e01=t.e01*e.e01,o.e11=t.e11*e.e11,o.e21=t.e21*e.e21,o.e31=t.e31*e.e31,o.e02=t.e02*e.e02,o.e12=t.e12*e.e12,o.e22=t.e22*e.e22,o.e32=t.e32*e.e32,o.e03=t.e03*e.e03,o.e13=t.e13*e.e13,o.e23=t.e23*e.e23,o.e33=t.e33*e.e33):(o.e00=t.e00*e,o.e10=t.e10*e,o.e20=t.e20*e,o.e30=t.e30*e,o.e01=t.e01*e,o.e11=t.e11*e,o.e21=t.e21*e,o.e31=t.e31*e,o.e02=t.e02*e,o.e12=t.e12*e,o.e22=t.e22*e,o.e32=t.e32*e,o.e03=t.e03*e,o.e13=t.e13*e,o.e23=t.e23*e,o.e33=t.e33*e),o},i.prototype.mul=function(t){return i.mul(this,t,this)},i.div=function(t,e,o){return o||(o=new i),e instanceof i?(o.e00=t.e00/e.e00,o.e10=t.e10/e.e10,o.e20=t.e20/e.e20,o.e30=t.e30/e.e30,o.e01=t.e01/e.e01,o.e11=t.e11/e.e11,o.e21=t.e21/e.e21,o.e31=t.e31/e.e31,o.e02=t.e02/e.e02,o.e12=t.e12/e.e12,o.e22=t.e22/e.e22,o.e32=t.e32/e.e32,o.e03=t.e03/e.e03,o.e13=t.e13/e.e13,o.e23=t.e23/e.e23,o.e33=t.e33/e.e33):(e=1/e,o.e00=t.e00*e,o.e10=t.e10*e,o.e20=t.e20*e,o.e30=t.e30*e,o.e01=t.e01*e,o.e11=t.e11*e,o.e21=t.e21*e,o.e31=t.e31*e,o.e02=t.e02*e,o.e12=t.e12*e,o.e22=t.e22*e,o.e32=t.e32*e,o.e03=t.e03*e,o.e13=t.e13*e,o.e23=t.e23*e,o.e33=t.e33*e),o},i.prototype.div=function(t){return i.div(this,t,this)},i.combine=function(t,e,o){o||(o=new i);var r=t.data,n=r[0],a=r[4],s=r[8],c=r[12],l=r[1],h=r[5],u=r[9],d=r[13],p=r[2],f=r[6],m=r[10],g=r[14],v=r[3],y=r[7],x=r[11],w=r[15],_=e.data,b=_[0],S=_[4],M=_[8],C=_[12],T=_[1],E=_[5],P=_[9],D=_[13],I=_[2],A=_[6],R=_[10],O=_[14],L=_[3],N=_[7],k=_[11],F=_[15],B=o.data;return B[0]=n*b+a*T+s*I+c*L,B[4]=n*S+a*E+s*A+c*N,B[8]=n*M+a*P+s*R+c*k,B[12]=n*C+a*D+s*O+c*F,B[1]=l*b+h*T+u*I+d*L,B[5]=l*S+h*E+u*A+d*N,B[9]=l*M+h*P+u*R+d*k,B[13]=l*C+h*D+u*O+d*F,B[2]=p*b+f*T+m*I+g*L,B[6]=p*S+f*E+m*A+g*N,B[10]=p*M+f*P+m*R+g*k,B[14]=p*C+f*D+m*O+g*F,B[3]=v*b+y*T+x*I+w*L,B[7]=v*S+y*E+x*A+w*N,B[11]=v*M+y*P+x*R+w*k,B[15]=v*C+y*D+x*O+w*F,o},i.prototype.combine=function(t){return i.combine(this,t,this)},i.transpose=function(t,e){e||(e=new i);var o=t.data,r=e.data;if(e===t){var n=o[4],a=o[8],s=o[12],c=o[9],l=o[13],h=o[14];return r[4]=o[1],r[8]=o[2],r[12]=o[3],r[9]=o[6],r[13]=o[7],r[14]=o[11],r[1]=n,r[2]=a,r[3]=s,r[6]=c,r[7]=l,r[11]=h,e}return r[0]=o[0],r[1]=o[4],r[2]=o[8],r[3]=o[12],r[4]=o[1],r[5]=o[5],r[6]=o[9],r[7]=o[13],r[8]=o[2],r[9]=o[6],r[10]=o[10],r[11]=o[14],r[12]=o[3],r[13]=o[7],r[14]=o[11],r[15]=o[15],e},i.prototype.transpose=function(){return i.transpose(this,this)},i.invert=function(o,r){if(r||(r=new i),r===o)return e.copy(i.invert(o),r);var n=o.determinant();if(Math.abs(n)<t.EPSILON)return r;var a=o.data,s=r.data;return n=1/n,s[0]=(a[5]*(a[10]*a[15]-a[14]*a[11])-a[9]*(a[6]*a[15]-a[14]*a[7])+a[13]*(a[6]*a[11]-a[10]*a[7]))*n,s[1]=(a[1]*(a[14]*a[11]-a[10]*a[15])-a[9]*(a[14]*a[3]-a[2]*a[15])+a[13]*(a[10]*a[3]-a[2]*a[11]))*n,s[2]=(a[1]*(a[6]*a[15]-a[14]*a[7])-a[5]*(a[2]*a[15]-a[14]*a[3])+a[13]*(a[2]*a[7]-a[6]*a[3]))*n,s[3]=(a[1]*(a[10]*a[7]-a[6]*a[11])-a[5]*(a[10]*a[3]-a[2]*a[11])+a[9]*(a[6]*a[3]-a[2]*a[7]))*n,s[4]=(a[4]*(a[14]*a[11]-a[10]*a[15])-a[8]*(a[14]*a[7]-a[6]*a[15])+a[12]*(a[10]*a[7]-a[6]*a[11]))*n,s[5]=(a[0]*(a[10]*a[15]-a[14]*a[11])-a[8]*(a[2]*a[15]-a[14]*a[3])+a[12]*(a[2]*a[11]-a[10]*a[3]))*n,s[6]=(a[0]*(a[14]*a[7]-a[6]*a[15])-a[4]*(a[14]*a[3]-a[2]*a[15])+a[12]*(a[6]*a[3]-a[2]*a[7]))*n,s[7]=(a[0]*(a[6]*a[11]-a[10]*a[7])-a[4]*(a[2]*a[11]-a[10]*a[3])+a[8]*(a[2]*a[7]-a[6]*a[3]))*n,s[8]=(a[4]*(a[9]*a[15]-a[13]*a[11])-a[8]*(a[5]*a[15]-a[13]*a[7])+a[12]*(a[5]*a[11]-a[9]*a[7]))*n,s[9]=(a[0]*(a[13]*a[11]-a[9]*a[15])-a[8]*(a[13]*a[3]-a[1]*a[15])+a[12]*(a[9]*a[3]-a[1]*a[11]))*n,s[10]=(a[0]*(a[5]*a[15]-a[13]*a[7])-a[4]*(a[1]*a[15]-a[13]*a[3])+a[12]*(a[1]*a[7]-a[5]*a[3]))*n,s[11]=(a[0]*(a[9]*a[7]-a[5]*a[11])-a[4]*(a[9]*a[3]-a[1]*a[11])+a[8]*(a[5]*a[3]-a[1]*a[7]))*n,s[12]=(a[4]*(a[13]*a[10]-a[9]*a[14])-a[8]*(a[13]*a[6]-a[5]*a[14])+a[12]*(a[9]*a[6]-a[5]*a[10]))*n,s[13]=(a[0]*(a[9]*a[14]-a[13]*a[10])-a[8]*(a[1]*a[14]-a[13]*a[2])+a[12]*(a[1]*a[10]-a[9]*a[2]))*n,s[14]=(a[0]*(a[13]*a[6]-a[5]*a[14])-a[4]*(a[13]*a[2]-a[1]*a[14])+a[12]*(a[5]*a[2]-a[1]*a[6]))*n,s[15]=(a[0]*(a[5]*a[10]-a[9]*a[6])-a[4]*(a[1]*a[10]-a[9]*a[2])+a[8]*(a[1]*a[6]-a[5]*a[2]))*n,r},i.prototype.invert=function(){return i.invert(this,this)},i.prototype.isOrthogonal=function(){var e;return e=this.e00*this.e01+this.e10*this.e11+this.e20*this.e21+this.e30*this.e31,Math.abs(e)>t.EPSILON?!1:(e=this.e00*this.e02+this.e10*this.e12+this.e20*this.e22+this.e30*this.e32,Math.abs(e)>t.EPSILON?!1:(e=this.e00*this.e03+this.e10*this.e13+this.e20*this.e23+this.e30*this.e33,Math.abs(e)>t.EPSILON?!1:(e=this.e01*this.e02+this.e11*this.e12+this.e21*this.e22+this.e31*this.e32,Math.abs(e)>t.EPSILON?!1:(e=this.e01*this.e03+this.e11*this.e13+this.e21*this.e23+this.e31*this.e33,Math.abs(e)>t.EPSILON?!1:(e=this.e02*this.e03+this.e12*this.e13+this.e22*this.e23+this.e32*this.e33,Math.abs(e)>t.EPSILON?!1:!0)))))},i.prototype.isNormal=function(){var e;return e=this.e00*this.e00+this.e10*this.e10+this.e20*this.e20+this.e30*this.e30,Math.abs(e-1)>t.EPSILON?!1:(e=this.e01*this.e01+this.e11*this.e11+this.e21*this.e21+this.e31*this.e31,Math.abs(e-1)>t.EPSILON?!1:(e=this.e02*this.e02+this.e12*this.e12+this.e22*this.e22+this.e32*this.e32,Math.abs(e-1)>t.EPSILON?!1:(e=this.e03*this.e03+this.e13*this.e13+this.e23*this.e23+this.e33*this.e33,Math.abs(e-1)>t.EPSILON?!1:!0)))},i.prototype.isOrthonormal=function(){return this.isOrthogonal()&&this.isNormal()},i.prototype.determinant=function(){var t=this.data,e=t[5]*t[10]*t[15]+t[9]*t[14]*t[7]+t[13]*t[6]*t[11]-t[13]*t[10]*t[7]-t[9]*t[6]*t[15]-t[5]*t[14]*t[11],i=t[1]*t[10]*t[15]+t[9]*t[14]*t[3]+t[13]*t[2]*t[11]-t[13]*t[10]*t[3]-t[9]*t[2]*t[15]-t[1]*t[14]*t[11],o=t[1]*t[6]*t[15]+t[5]*t[14]*t[3]+t[13]*t[2]*t[7]-t[13]*t[6]*t[3]-t[5]*t[2]*t[15]-t[1]*t[14]*t[7],r=t[1]*t[6]*t[11]+t[5]*t[10]*t[3]+t[9]*t[2]*t[7]-t[9]*t[6]*t[3]-t[5]*t[2]*t[11]-t[1]*t[10]*t[7];return t[0]*e-t[4]*i+t[8]*o-t[12]*r},i.prototype.setIdentity=function(){var t=this.data;return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this},i.prototype.setRotationFromVector=function(t){var e=Math.sin(t.x),i=Math.cos(t.x),o=Math.sin(t.y),r=Math.cos(t.y),n=Math.sin(t.z),a=Math.cos(t.z);return this.e00=a*r,this.e10=n*r,this.e20=0-o,this.e01=a*o*e-n*i,this.e11=n*o*e+a*i,this.e21=r*e,this.e02=a*o*i+n*e,this.e12=n*o*i-a*e,this.e22=r*i,this},i.prototype.setRotationFromQuaternion=function(t){var e=t.lengthSquared();e=e>0?2/e:0;var i=t.x*e,o=t.y*e,r=t.z*e,n=t.w*i,a=t.w*o,s=t.w*r,c=t.x*i,l=t.x*o,h=t.x*r,u=t.y*o,d=t.y*r,p=t.z*r;return this.e00=1-u-p,this.e10=l+s,this.e20=h-a,this.e01=l-s,this.e11=1-c-p,this.e21=d+n,this.e02=h+a,this.e12=d-n,this.e22=1-c-u,this},i.prototype.setTranslation=function(t){return this.e03=t.x,this.e13=t.y,this.e23=t.z,this},i.prototype.getTranslation=function(t){return t.x=this.data[12],t.y=this.data[13],t.z=this.data[14],this},i.prototype.getScale=function(t){var e=Math.sqrt(t.setd(this.data[0],this.data[4],this.data[8]).lengthSquared()),i=Math.sqrt(t.setd(this.data[1],this.data[5],this.data[9]).lengthSquared()),o=Math.sqrt(t.setd(this.data[2],this.data[6],this.data[10]).lengthSquared());return t.x=e,t.y=i,t.z=o,this},i.prototype.setScale=function(t){return this.e00*=t.x,this.e10*=t.y,this.e20*=t.z,this.e01*=t.x,this.e11*=t.y,this.e21*=t.z,this.e02*=t.x,this.e12*=t.y,this.e22*=t.z,this},i.prototype.applyPre=function(t){var e=t.data[0],i=t.data[1],o=t.data[2],r=t.data[3],n=this.data;return t.data[0]=n[0]*e+n[1]*i+n[2]*o+n[3]*r,t.data[1]=n[4]*e+n[5]*i+n[6]*o+n[7]*r,t.data[2]=n[8]*e+n[9]*i+n[10]*o+n[11]*r,t.data[3]=n[12]*e+n[13]*i+n[14]*o+n[15]*r,t},i.prototype.applyPost=function(t){var e=t.data[0],i=t.data[1],o=t.data[2],r=t.data[3],n=this.data;return t.data[0]=n[0]*e+n[4]*i+n[8]*o+n[12]*r,t.data[1]=n[1]*e+n[5]*i+n[9]*o+n[13]*r,t.data[2]=n[2]*e+n[6]*i+n[10]*o+n[14]*r,t.data[3]=n[3]*e+n[7]*i+n[11]*o+n[15]*r,t},i.prototype.applyPostPoint=function(t){var e=t.data[0],i=t.data[1],o=t.data[2],r=this.data;return t.data[0]=r[0]*e+r[4]*i+r[8]*o+r[12],t.data[1]=r[1]*e+r[5]*i+r[9]*o+r[13],t.data[2]=r[2]*e+r[6]*i+r[10]*o+r[14],t},i.prototype.applyPostVector=function(t){var e=t.x,i=t.y,o=t.z,r=this.data;return t.x=r[0]*e+r[4]*i+r[8]*o,t.y=r[1]*e+r[5]*i+r[9]*o,t.z=r[2]*e+r[6]*i+r[10]*o,t},i.prototype.copy=function(t){var e=this.data,i=t.data;return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],e[9]=i[9],e[10]=i[10],e[11]=i[11],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15],this},i.prototype.clone=function(){var t=this.data;return new i(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15])},i}),define("goo/math/Transform",["goo/math/Vector3","goo/math/Matrix3x3","goo/math/Matrix4x4"],function(t,e,i){"use strict";function o(){this.matrix=new i,this.translation=new t,this.rotation=new e,this.scale=new t(1,1,1),this.tmpVec=new t,this.tmpVec2=new t,this.tmpMat1=new e}return o.combine=function(t,i,r){if(t.scale.data[0]!==t.scale.data[1]||t.scale.data[0]!==t.scale.data[2])throw{name:"NonUniformScaleException",message:"Non-uniform scaling in left hand transform, cannot resolve combined transform"};r=r||new o;var n=r.tmpVec;n.setv(i.translation),t.rotation.applyPost(n),n.mulv(t.scale),n.addv(t.translation);var a=r.tmpVec2;a.setv(i.scale),a.mulv(t.scale);var s=r.tmpMat1;return e.combine(t.rotation,i.rotation,s),r.rotation.copy(s),r.scale.setv(a),r.translation.setv(n),r},o.prototype.combine=function(t){return o.combine(this,t,this)},o.prototype.multiply=function(t,o){i.combine(t.matrix,o.matrix,this.matrix),this.tmpMat1.data.set(t.rotation.data),this.rotation.data.set(o.rotation.data),e.combine(this.tmpMat1,this.rotation,this.rotation),this.translation.setv(o.translation),this.translation.mulv(t.scale),this.tmpMat1.applyPost(this.translation).addv(t.translation),this.scale.setv(t.scale).mulv(o.scale)},o.prototype.setIdentity=function(){this.matrix.setIdentity(),this.translation.setv(t.ZERO),this.rotation.setIdentity(),this.scale.setv(t.ONE)},o.prototype.applyForward=function(t,e){return e.setv(t),this.matrix.applyPostPoint(e),e},o.prototype.applyForwardVector=function(t,e){return e.copy(t),e.set(e.x*this.scale.x,e.y*this.scale.y,e.z*this.scale.z),this.rotation.applyPost(e),e},o.prototype.update=function(){var t=this.matrix.data,e=this.rotation.data,i=this.scale.data,o=this.translation.data;t[0]=i[0]*e[0],t[1]=i[0]*e[1],t[2]=i[0]*e[2],t[3]=0,t[4]=i[1]*e[3],t[5]=i[1]*e[4],t[6]=i[1]*e[5],t[7]=0,t[8]=i[2]*e[6],t[9]=i[2]*e[7],t[10]=i[2]*e[8],t[11]=0,t[12]=o[0],t[13]=o[1],t[14]=o[2],t[15]=1},o.prototype.copy=function(t){this.matrix.copy(t.matrix),this.translation.setv(t.translation),this.rotation.copy(t.rotation),this.scale.setv(t.scale)},o.prototype.setRotationXYZ=function(t,e,i){this.rotation.fromAngles(t,e,i)},o.prototype.lookAt=function(t,e){this.tmpVec.setv(this.translation).subv(t).normalize(),this.rotation.lookAt(this.tmpVec,e)},o.prototype.invert=function(t){var e=t;e||(e=new o),e.matrix.copy(this.matrix),e.matrix.invert();var i=e.rotation.copy(this.rotation);return i.multiplyDiagonalPost(this.scale,i).invert(),e.translation.copy(this.translation),e.rotation.applyPost(e.translation).invert(),e},o.prototype.toString=function(){return""+this.matrix},o}),define("goo/entities/components/Component",[],function(){"use strict";function t(){this.enabled=!0,this.installedAPI={}}return t.prototype.applyAPI=function(t){this.installedAPI||(this.installedAPI={});var e=this.api;for(var i in e)"undefined"==typeof t[i]?(t[i]=e[i],this.installedAPI[i]=!0):console.warn("Could not install method "+i+" of "+this.type+" as it is already taken")},t.prototype.removeAPI=function(t){var e=this.installedAPI;for(var i in e)delete t[i]},t}),define("goo/entities/components/TransformComponent",["goo/math/Transform","goo/math/Vector3","goo/entities/components/Component"],function(t,e,i){"use strict";function o(){this.type="TransformComponent",this.entity=null,this.parent=null,this.children=[],this.transform=new t,this.worldTransform=new t,this._dirty=!0,this._updated=!1,this.api={setTranslation:this.setTranslation.bind(this),setScale:this.setScale.bind(this),addTranslation:this.addTranslation.bind(this),setRotation:this.setRotation.bind(this),lookAt:this.lookAt.bind(this)}}return o.type="TransformComponent",o.prototype=Object.create(i.prototype),o.prototype.constructor=o,o.prototype.setTranslation=function(){return this.transform.translation.set(arguments),this._dirty=!0,this},o.prototype.setScale=function(){return this.transform.scale.set(arguments),this._dirty=!0,this},o.prototype.addTranslation=function(){return 3===arguments.length?this.transform.translation.add(arguments):this.transform.translation.add(arguments[0]),this._dirty=!0,this},o.prototype.setRotation=function(){if(1===arguments.length&&"object"==typeof arguments[0]){var t=arguments[0];t instanceof e?this.transform.rotation.fromAngles(t.x,t.y,t.z):3===t.length&&this.transform.rotation.fromAngles(t[0],t[1],t[2])}else this.transform.rotation.fromAngles(arguments[0],arguments[1],arguments[2]);return this._dirty=!0,this},o.prototype.lookAt=function(t,e){return this.transform.lookAt(t,e),this._dirty=!0,this},o.prototype.setUpdated=function(){this._dirty=!0},o.prototype.attached=function(t){this.entity=t},o.prototype.detached=function(){this.entity=void 0},o.prototype.attachChild=function(t,e){for(var i=this;i;){if(i===t)return console.warn("attachChild: An object can't be added as a descendant of itself."),void 0;i=i.parent}t.parent&&t.parent.detachChild(t),e&&(t.updateTransform(),this.updateTransform(),this.updateWorldTransform(),t.transform.multiply(this.worldTransform.invert(),t.transform)),t.parent=this,this.children.push(t)},o.prototype.detachChild=function(t,e){if(t===this)return console.warn("attachChild: An object can't be removed from itself."),void 0;e&&t.transform.copy(t.worldTransform);var i=this.children.indexOf(t);-1!==i&&(t.parent=null,this.children.splice(i,1))},o.prototype.updateTransform=function(){this.transform.update()},o.prototype.updateWorldTransform=function(){this.parent?this.worldTransform.multiply(this.parent.worldTransform,this.transform):this.worldTransform.copy(this.transform),this._dirty=!1,this._updated=!0},o.applyOnEntity=function(t,e){if(Array.isArray(t)&&3===t.length){var i=new o;return i.transform.translation.setd(t[0],t[1],t[2]),e.setComponent(i),!0}},o}),define("goo/renderer/bounds/BoundingVolume",["goo/math/Vector3"],function(t){"use strict";function e(e){this.center=new t,void 0!==e&&this.center.setv(e),this.min=new t(1/0,1/0,1/0),this.max=new t(-1/0,-1/0,-1/0)}return e.Outside=0,e.Inside=1,e.Intersects=2,e}),define("goo/renderer/BufferData",[],function(){"use strict";function t(t,e){this.data=t,this.target=e,this.glBuffer=null,this._dataUsage="StaticDraw",this._dataNeedsRefresh=!1}return t.prototype.setDataUsage=function(t){this._dataUsage=t},t.prototype.setDataNeedsRefresh=function(){this._dataNeedsRefresh=!0},t}),define("goo/renderer/Util",[],function(){"use strict";function t(){}return t.getByteSize=function(t){switch(t){case"Byte":return 1;case"UnsignedByte":return 1;case"Short":return 2;case"UnsignedShort":return 2;case"Int":return 4;case"HalfFloat":return 2;case"Float":return 4;case"Double":return 8;default:throw"Unknown type: "+t}},t.checkGLError=function(t){for(var e=t.getError(),i=!1;e!==t.NO_ERROR;){if(i=!0,e===t.INVALID_ENUM)console.error("An unacceptable value is specified for an enumerated argument. The offending command is ignored and has no other side effect than to set the error flag.");else if(e===t.INVALID_VALUE)console.error("A numeric argument is out of range. The offending command is ignored and has no other side effect than to set the error flag.");else if(e===t.INVALID_OPERATION)console.error("The specified operation is not allowed in the current state. The offending command is ignored and has no other side effect than to set the error flag.");else if(e===t.FRAMEBUFFER_COMPLETE)console.error("The command is trying to render to or read from the framebuffer while the currently bound framebuffer is not framebuffer complete (i.e. the return value from glCheckFramebufferStatus is not GL_FRAMEBUFFER_COMPLETE). The offending command is ignored and has no other side effect than to set the error flag.");else if(e===t.OUT_OF_MEMORY)throw"There is not enough memory left to execute the command. The state of the GL is undefined, except for the state of the error flags, after this error is recorded.";e=t.getError()}if(i)throw"Stopping due to error"},t.isPowerOfTwo=function(t){return 0===(t&t-1)},t.nearestPowerOfTwo=function(t){return Math.pow(2,Math.ceil(Math.log(t)/Math.log(2)))},t.clone=function(e){if(null===e||"object"!=typeof e)return e;if(e instanceof Uint8Array)return e;if(e instanceof Date){var i=new Date;return i.setTime(e.getTime()),i}if(e instanceof Array){for(var i=[],o=0,r=e.length;r>o;++o)i[o]=t.clone(e[o]);return i}if(e instanceof Object){var i={};for(var n in e)e.hasOwnProperty(n)&&(i[n]=t.clone(e[n]));return i}throw new Error("Unable to copy obj! Its type isn't supported.")},t}),define("goo/renderer/BufferUtils",[],function(){"use strict";function t(){}function e(){var e=["Trident","MSIE","Firefox","Safari","Chrome","Opera"],i=navigator.userAgent,o=e.length-1;for(o;o>-1&&-1===i.indexOf(e[o]);o--);t.browserType=e[o]}return t.createIndexBuffer=function(e,i){var o;if(256>i)o="Trident"===t.browserType?new Uint16Array(e):new Uint8Array(e);else{if(!(65536>i))throw new Error("Maximum number of vertices is 65535. Got: "+i);o=new Uint16Array(e)}return o},e(),t}),define("goo/math/Vector2",["goo/math/Vector"],function(t){"use strict";function e(){t.call(this,2),0!==arguments.length?this.set(arguments):this.setd(0,0)}return e.prototype=Object.create(t.prototype),e.prototype.setupAliases([["x","u","s"],["y","v","t"]]),e.ZERO=new e(0,0),e.ONE=new e(1,1),e.UNIT_X=new e(1,0),e.UNIT_Y=new e(0,1),e.add=function(t,i,o){"number"==typeof t&&(t=[t,t]),"number"==typeof i&&(i=[i,i]),o||(o=new e);var r=t.data||t,n=i.data||i;if(2!==r.length||2!==n.length)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};return o.data[0]=r[0]+n[0],o.data[1]=r[1]+n[1],o},e.prototype.add=function(t){return e.add(this,t,this)},e.sub=function(t,i,o){"number"==typeof t&&(t=[t,t]),"number"==typeof i&&(i=[i,i]),o||(o=new e);var r=t.data||t,n=i.data||i;if(2!==r.length||2!==n.length)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};return o.data[0]=r[0]-n[0],o.data[1]=r[1]-n[1],o},e.prototype.sub=function(t){return e.sub(this,t,this)},e.mul=function(t,i,o){"number"==typeof t&&(t=[t,t]),"number"==typeof i&&(i=[i,i]),o||(o=new e);var r=t.data||t,n=i.data||i;if(2!==r.length||2!==n.length)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};return o.data[0]=r[0]*n[0],o.data[1]=r[1]*n[1],o},e.prototype.mul=function(t){return e.mul(this,t,this)},e.div=function(t,i,o){"number"==typeof t&&(t=[t,t]),"number"==typeof i&&(i=[i,i]),o||(o=new e);var r=t.data||t,n=i.data||i;if(2!==r.length||2!==n.length)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};return o.data[0]=r[0]/n[0],o.data[1]=r[1]/n[1],o},e.prototype.div=function(t){return e.div(this,t,this)},e.dot=function(t,e){"number"==typeof t&&(t=[t,t]),"number"==typeof e&&(e=[e,e]);var i=t.data||t,o=e.data||e;if(2!==i.length||2!==o.length)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};var r=0;return r+=i[0]*o[0],r+=i[1]*o[1]},e.prototype.dot=function(t){return e.dot(this,t)},e.prototype.setd=function(t,e){return this.data[0]=t,this.data[1]=e,this},e.prototype.seta=function(t){return this.data[0]=t[0],this.data[1]=t[1],this},e.prototype.setv=function(t){return this.data[0]=t.data[0],this.data[1]=t.data[1],this},e}),define("goo/math/Vector4",["goo/math/Vector"],function(t){"use strict";function e(){t.call(this,4),0!==arguments.length?this.set(arguments):this.setd(0,0,0,0)}return e.prototype=Object.create(t.prototype),e.prototype.setupAliases([["x","r"],["y","g"],["z","b"],["w","a"]]),e.ZERO=new e(0,0,0,0),e.ONE=new e(1,1,1,1),e.UNIT_X=new e(1,0,0,0),e.UNIT_Y=new e(0,1,0,0),e.UNIT_Z=new e(0,0,1,0),e.UNIT_W=new e(0,0,0,1),e.add=function(t,i,o){"number"==typeof t&&(t=[t,t,t,t]),"number"==typeof i&&(i=[i,i,i,i]),o||(o=new e);var r=t.data||t,n=i.data||i;if(4!==r.length||4!==n.length)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};return o.data[0]=r[0]+n[0],o.data[1]=r[1]+n[1],o.data[2]=r[2]+n[2],o.data[3]=r[3]+n[3],o},e.prototype.add=function(t){return e.add(this,t,this)},e.sub=function(t,i,o){"number"==typeof t&&(t=[t,t,t,t]),"number"==typeof i&&(i=[i,i,i,i]),o||(o=new e);var r=t.data||t,n=i.data||i;if(4!==r.length||4!==n.length)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};return o.data[0]=r[0]-n[0],o.data[1]=r[1]-n[1],o.data[2]=r[2]-n[2],o.data[3]=r[3]-n[3],o},e.prototype.sub=function(t){return e.sub(this,t,this)},e.mul=function(t,i,o){"number"==typeof t&&(t=[t,t,t,t]),"number"==typeof i&&(i=[i,i,i,i]),o||(o=new e);var r=t.data||t,n=i.data||i;if(4!==r.length||4!==n.length)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};return o.data[0]=r[0]*n[0],o.data[1]=r[1]*n[1],o.data[2]=r[2]*n[2],o.data[3]=r[3]*n[3],o},e.prototype.mul=function(t){return e.mul(this,t,this)},e.div=function(t,i,o){"number"==typeof t&&(t=[t,t,t,t]),"number"==typeof i&&(i=[i,i,i,i]),o||(o=new e);var r=t.data||t,n=i.data||i;if(4!==r.length||4!==n.length)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};return o.data[0]=r[0]/n[0],o.data[1]=r[1]/n[1],o.data[2]=r[2]/n[2],o.data[3]=r[3]/n[3],o},e.prototype.div=function(t){return e.div(this,t,this)},e.dot=function(t,e){"number"==typeof t&&(t=[t,t,t,t]),"number"==typeof e&&(e=[e,e,e,e]);var i=t.data||t,o=e.data||e;if(4!==i.length||4!==o.length)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};var r=0;return r+=i[0]*o[0],r+=i[1]*o[1],r+=i[2]*o[2],r+=i[3]*o[3]},e.prototype.dot=function(t){return e.dot(this,t)},e.prototype.lerp=function(t,e){return this.x=(1-e)*this.x+e*t.x,this.y=(1-e)*this.y+e*t.y,this.z=(1-e)*this.z+e*t.z,this.w=(1-e)*this.w+e*t.w,this},e.prototype.setd=function(t,e,i,o){return this.data[0]=t,this.data[1]=e,this.data[2]=i,this.data[3]=o,this},e.prototype.seta=function(t){return this.data[0]=t[0],this.data[1]=t[1],this.data[2]=t[2],this.data[3]=t[3],this},e.prototype.setv=function(t){return this.data[0]=t.data[0],this.data[1]=t.data[1],this.data[2]=t.data[2],this.data[3]=t.data[3],this},e}),define("goo/renderer/MeshData",["goo/renderer/BufferData","goo/renderer/Util","goo/renderer/BufferUtils","goo/math/Vector2","goo/math/Vector3","goo/math/Vector4"],function(t,e,i,o,r,n){"use strict";function a(t,e,i){this.attributeMap=t,this.vertexCount=void 0!==e?e:0,this.indexCount=void 0!==i?i:0,this.primitiveCounts=[0],this.vertexData=null,this.indexData=null,this.dataViews={},this.indexLengths=null,this.indexModes=["Triangles"],this.type=a.MESH,this.rebuildData(this.vertexCount,this.indexCount)}function s(t){for(var i={},o=0;o<t.length;o++){var r=t[o];if(void 0===p[r])throw"No default attribute named: "+r;i[r]=e.clone(p[r])}return i}var c=window.Uint8ClampedArray;a.MESH=0,a.SKINMESH=1,a.prototype.rebuildData=function(t,e,i){var o={},r=null;if(i){for(var n in this.attributeMap){var a=this.dataViews[n];a&&(o[n]=a)}this.indexData&&(r=this.indexData.data)}if(this.rebuildVertexData(t),this.rebuildIndexData(e),i){for(var n in this.attributeMap){var s=o[n];if(s){var a=this.dataViews[n];a.set(s)}}o={},r&&this.indexData.data.set(r)}},a.prototype.rebuildVertexData=function(i){if(isNaN(i)||(this.vertexCount=i,this._vertexCountStore=this.vertexCount),this.vertexCount>0){var o=0;for(var r in this.attributeMap){var n=this.attributeMap[r];o+=e.getByteSize(n.type)*n.count}this.vertexData=new t(new ArrayBuffer(o*this.vertexCount),"ArrayBuffer"),this.generateAttributeData()}},a.prototype.rebuildIndexData=function(e){if(void 0!==e&&(this.indexCount=e),this.indexCount>0){var o=i.createIndexBuffer(this.indexCount,this.vertexCount);this.indexData=new t(o,"ElementArrayBuffer")}},a.prototype.setVertexDataUpdated=function(){this.vertexData._dataNeedsRefresh=!0},a.prototype.getSectionCount=function(){return this.indexLengths?this.indexLengths.length:1},a.prototype.getPrimitiveCount=function(t){return t>=0&&t<this.primitiveCounts.length?this.primitiveCounts[t]:0},a.prototype.getPrimitiveVertices=function(t,e,i){var o=this.getPrimitiveCount(e);if(t>=o||0>t)throw new Error("Invalid primitiveIndex '"+t+"'.  Count is "+o);var n=this.indexModes[e],s=a.getVertexCount(n),c=i;(!c||c.length<s)&&(c=[]);for(var l=this.getAttributeBuffer(a.POSITION),h=0;s>h;h++)if(c[h]||(c[h]=new r),this.getIndexBuffer()){var u=this.getIndexBuffer()[this.getVertexIndex(t,h,e)];c[h].x=l[3*u+0],c[h].y=l[3*u+1],c[h].z=l[3*u+2]}else{var u=this.getVertexIndex(t,h,e);c[h].x=l[3*u+0],c[h].y=l[3*u+1],c[h].z=l[3*u+2]}return c},a.prototype.getVertexIndex=function(t,e,i){for(var o=0,r=0;i>r;r++)o+=this.indexLengths[r];switch(this.indexModes[i]){case"Triangles":o+=3*t+e;break;case"TriangleStrip":o+=t+e;break;case"TriangleFan":o+=0===e?0:t+e;break;case"Points":o+=t;break;case"Lines":o+=2*t+e;break;case"LineStrip":case"LineLoop":o+=t+e;break;default:return a.logger.warning("unimplemented index mode: "+this.indexModes[i]),-1}return o},a.prototype.getTotalPrimitiveCount=function(){for(var t=0,e=0,i=this.primitiveCounts.length;i>e;e++)t+=this.primitiveCounts[e];return t},a.prototype.updatePrimitiveCounts=function(){var t=this.indexData?this.indexData.data.length:this.vertexCount,e=this.getSectionCount();this.primitiveCounts.length!==e&&(this.primitiveCounts=[]);for(var i=0;e>i;i++){var o=this.indexLengths?this.indexLengths[i]:t,r=a.getPrimitiveCount(this.indexModes[i],o);this.primitiveCounts[i]=r}},a.getPrimitiveCount=function(t,e){switch(t){case"Triangles":return e/3;case"TriangleFan":case"TriangleStrip":return e-2;case"Lines":return e/2;case"LineStrip":return e-1;case"LineLoop":return e;case"Points":return e
}throw new Error("unimplemented index mode: "+t)},a.getVertexCount=function(t){switch(t){case"Triangles":case"TriangleFan":case"TriangleStrip":return 3;case"Lines":case"LineStrip":case"LineLoop":return 2;case"Points":return 1}throw new Error("unimplemented index mode: "+t)};var l={Byte:Int8Array,UnsignedByte:Uint8Array,UnsignedByteClamped:c,Short:Int16Array,UnsignedShort:Uint16Array,Int:Int32Array,UnsignedInt:Uint32Array,Float:Float32Array};a.prototype.generateAttributeData=function(){var t,i=this.vertexData.data,o=0;for(var r in this.attributeMap){var n=this.attributeMap[r];n.offset=o;var a=this.vertexCount*n.count;o+=a*e.getByteSize(n.type);var s=l[n.type];if(!s)throw"Unsupported DataType: "+n.type;t=new s(i,n.offset,a),this.dataViews[r]=t}},a.prototype.makeInterleavedData=function(){var i=0,o=0;for(var r in this.attributeMap){var n=this.attributeMap[r];n.offset=i,i+=n.count*e.getByteSize(n.type)}var a=new t(new ArrayBuffer(i*this.vertexCount),this.vertexData.target);a._dataUsage=this.vertexData._dataUsage,a._dataNeedsRefresh=!0;var s=new DataView(a.data);for(var r in this.attributeMap){var c=this.dataViews[r],n=this.attributeMap[r];n.stride=i;for(var o=n.offset,l=n.count,h=e.getByteSize(n.type),u=this.getDataMethod(n.type),d=s[u],p=0;p<this.vertexCount;p++)for(var f=0;l>f;f++)d.apply(s,[o+i*p+f*h,c[p*l+f],!0])}this.vertexData=a},a.prototype.getDataMethod=function(t){switch(t){case"Byte":return"setInt8";case"UnsignedByte":return"setUInt8";case"Short":return"setInt16";case"UnsignedShort":return"setUInt16";case"Int":return"setInt32";case"HalfFloat":return"setInt16";case"Float":return"setFloat32"}},a.prototype.getAttributeBuffer=function(t){return this.dataViews[t]},a.prototype.getIndexData=function(){return this.indexData},a.prototype.getIndexBuffer=function(){return null!==this.indexData?this.indexData.data:null},a.prototype.getIndexLengths=function(){return this.indexLengths},a.prototype.getIndexModes=function(){return this.indexModes},a.prototype.resetVertexCount=function(){this.vertexCount=this.vertexCountStore},a.prototype.applyTransform=function(t,e){var i=new r,o=this.getAttributeBuffer(t),n=o.length;if(t===a.POSITION)for(var s=0;n>s;s+=3)i.setd(o[s+0],o[s+1],o[s+2]),e.matrix.applyPostPoint(i),o[s+0]=i[0],o[s+1]=i[1],o[s+2]=i[2];else if(t===a.NORMAL)for(var s=0;n>s;s+=3)i.setd(o[s+0],o[s+1],o[s+2]),e.rotation.applyPost(i),o[s+0]=i[0],o[s+1]=i[1],o[s+2]=i[2];else if(t===a.TANGENT)for(var s=0;n>s;s+=3)i.setd(o[s+0],o[s+1],o[s+2]),e.rotation.applyPost(i),o[s+0]=i[0],o[s+1]=i[1],o[s+2]=i[2];return this},a.prototype.applyFunction=function(t,e){var i,a,s=this.getAttributeBuffer(t),c=s.length,l=this.attributeMap[t].count;switch(l){case 1:for(var h=0;c>h;h++)s[h]=e(s[h]);break;case 2:i=new o;for(var h=0;c>h;h+=2)i.setd(s[h+0],s[h+1]),a=e(i),s[h+0]=a[0],s[h+1]=a[1];break;case 3:i=new r;for(var h=0;c>h;h+=3)i.setd(s[h+0],s[h+1],s[h+2]),a=e(i),s[h+0]=a[0],s[h+1]=a[1],s[h+2]=a[2];break;case 4:i=new n;for(var h=0;c>h;h+=4)i.setd(s[h+0],s[h+1],s[h+2],s[h+3]),a=e(i),s[h+0]=a[0],s[h+1]=a[1],s[h+2]=a[2],s[h+3]=a[3]}return this},a.prototype.getNormalsMeshData=function(t){if(void 0!==this.getAttributeBuffer("POSITION")&&void 0!==this.getAttributeBuffer("NORMAL")){t=void 0!==t?t:1;for(var e=[],i=[],o=this.dataViews.POSITION.length/3,r=0;o>r;r++)e.push(this.dataViews.POSITION[3*r+0],this.dataViews.POSITION[3*r+1],this.dataViews.POSITION[3*r+2],this.dataViews.POSITION[3*r+0]+this.dataViews.NORMAL[3*r+0]*t,this.dataViews.POSITION[3*r+1]+this.dataViews.NORMAL[3*r+1]*t,this.dataViews.POSITION[3*r+2]+this.dataViews.NORMAL[3*r+2]*t);for(var r=0;2*o>r;r+=2)i.push(r,r+1);var n=new a(a.defaultMap([a.POSITION]),e.length,i.length);return n.getAttributeBuffer(a.POSITION).set(e),n.getIndexBuffer().set(i),n.indexModes[0]="Lines",n}},a.prototype.buildWireframeData=function(){var t=e.clone(this.attributeMap),i=new a(t,this.vertexCount,0);i.indexModes[0]="Lines";var o=this.getIndexBuffer(),r=[],n=0;this.updatePrimitiveCounts();for(var s=0;s<this.getSectionCount();s++)for(var c=this.indexModes[s],l=this.getPrimitiveCount(s),h=0;l>h;h++)switch(c){case"Triangles":case"TriangleFan":case"TriangleStrip":var u=o[this.getVertexIndex(h,0,s)],d=o[this.getVertexIndex(h,1,s)],p=o[this.getVertexIndex(h,2,s)];r[n+0]=u,r[n+1]=d,r[n+2]=d,r[n+3]=p,r[n+4]=p,r[n+5]=u,n+=6;break;case"Lines":case"LineStrip":var u=o[this.getVertexIndex(h,0,s)],d=o[this.getVertexIndex(h,1,s)];r[n+0]=u,r[n+1]=d,n+=2;break;case"LineLoop":var u=o[this.getVertexIndex(h,0,s)],d=o[this.getVertexIndex(h,1,s)];h===l-1&&(d=o[this.getVertexIndex(0,0,s)]),r[n+0]=u,r[n+1]=d,n+=2;break;case"Points":}if(n>0){i.rebuildIndexData(n);for(var f in t)i.getAttributeBuffer(f).set(this.getAttributeBuffer(f));i.getIndexBuffer().set(r)}return i.paletteMap=this.paletteMap,i.weightsPerVertex=this.weightsPerVertex,i};var h=new r,u=new r,d=new r;a.prototype.buildFlatMeshData=function(){var t=[],i=this.getIndexBuffer();if(null===i)return console.debug("No indices, probably a point mesh"),this;if(i.length>65535)return console.warn("Mesh too big, cannot build flat mesh data"),this;var o=e.clone(this.attributeMap),r={};for(var n in o)r[n]={oldBuffer:this.getAttributeBuffer(n),values:[]};var s=0;this.updatePrimitiveCounts();for(var c=0;c<this.getSectionCount();c++)for(var l=this.indexModes[c],p=this.getPrimitiveCount(c),f=!1,m=0;p>m;m++)switch(l){case"TriangleStrip":f=1===m%2?!0:!1;case"Triangles":case"TriangleFan":var g=i[this.getVertexIndex(m,0,c)],v=i[this.getVertexIndex(m,1,c)],y=i[this.getVertexIndex(m,2,c)];if(f){var x=y;y=v,v=x}for(var n in r)if(n!==a.NORMAL){for(var w=o[n].count,_=0;w>_;_++)r[n].values[s*w+_]=r[n].oldBuffer[g*w+_],r[n].values[(s+1)*w+_]=r[n].oldBuffer[v*w+_],r[n].values[(s+2)*w+_]=r[n].oldBuffer[y*w+_];n===a.POSITION&&(h.setd(r[n].values[3*s],r[n].values[3*s+1],r[n].values[3*s+2]),u.setd(r[n].values[3*(s+1)],r[n].values[3*(s+1)+1],r[n].values[3*(s+1)+2]),d.setd(r[n].values[3*(s+2)],r[n].values[3*(s+2)+1],r[n].values[3*(s+2)+2]),u.subv(h),d.subv(h),u.cross(d).normalize(),r[a.NORMAL]&&(r[a.NORMAL].values[3*s]=u.data[0],r[a.NORMAL].values[3*s+1]=u.data[1],r[a.NORMAL].values[3*s+2]=u.data[2],r[a.NORMAL].values[3*(s+1)]=u.data[0],r[a.NORMAL].values[3*(s+1)+1]=u.data[1],r[a.NORMAL].values[3*(s+1)+2]=u.data[2],r[a.NORMAL].values[3*(s+2)]=u.data[0],r[a.NORMAL].values[3*(s+2)+1]=u.data[1],r[a.NORMAL].values[3*(s+2)+2]=u.data[2]))}t.push(t.length),t.push(t.length),t.push(t.length),s+=3}if(0===t.length)return console.warn("Could not build flat data"),this;var b=new a(o,t.length,t.length);for(var n in r)b.getAttributeBuffer(n).set(r[n].values);return b.getIndexBuffer().set(t),b.paletteMap=this.paletteMap,b.weightPerVertex=this.weightsPerVertex,b},a.POSITION="POSITION",a.NORMAL="NORMAL",a.COLOR="COLOR",a.TANGENT="TANGENT",a.TEXCOORD0="TEXCOORD0",a.TEXCOORD1="TEXCOORD1",a.TEXCOORD2="TEXCOORD2",a.TEXCOORD3="TEXCOORD3",a.WEIGHTS="WEIGHTS",a.JOINTIDS="JOINTIDS",a.createAttribute=function(t,e,i){return{count:t,type:e,stride:0,offset:0,normalized:void 0!==i?i:!1}};var p={POSITION:a.createAttribute(3,"Float"),NORMAL:a.createAttribute(3,"Float"),COLOR:a.createAttribute(4,"Float"),TANGENT:a.createAttribute(4,"Float"),TEXCOORD0:a.createAttribute(2,"Float"),TEXCOORD1:a.createAttribute(2,"Float"),TEXCOORD2:a.createAttribute(2,"Float"),TEXCOORD3:a.createAttribute(2,"Float"),WEIGHTS:a.createAttribute(4,"Float"),JOINTIDS:a.createAttribute(4,"Float")};return a.defaultMap=function(t){return void 0===t?s(Object.keys(p)):s(t)},a}),define("goo/renderer/bounds/BoundingSphere",["goo/math/Vector3","goo/math/MathUtils","goo/renderer/bounds/BoundingVolume","goo/renderer/MeshData"],function(t,e,i,o){"use strict";function r(e,o){i.call(this,e),this.radius=void 0!==o?o:1,this.vec=new t}return r.prototype=Object.create(i.prototype),r.prototype.constructor=r,r.prototype.computeFromPoints=function(t){var e=this.min,i=this.max,o=this.vec;e.setd(1/0,1/0,1/0),i.setd(-1/0,-1/0,-1/0);for(var r,n,a,s=0;s<t.length;s+=3)r=t[s+0],n=t[s+1],a=t[s+2],e.x=r<e.x?r:e.x,e.y=n<e.y?n:e.y,e.z=a<e.z?a:e.z,i.x=r>i.x?r:i.x,i.y=n>i.y?n:i.y,i.z=a>i.z?a:i.z;for(var c,l=i.addv(e).div(2),h=0,s=0;s<t.length;s+=3)o.setd(t[s],t[s+1],t[s+2]),c=o.subv(l).lengthSquared(),c>h&&(h=c);this.radius=Math.sqrt(h),this.center.setv(l)},r.prototype.computeFromPrimitives=function(e,i,r,n,a){if(!(0>=a-n)){for(var s=[],c=[],l=o.getVertexCount(e.indexModes[i]),h=0,u=n;a>u;u++){c=e.getPrimitiveVertices(r[u],i,c);for(var d=0;l>d;d++)s[h++]=(new t).set(c[d])}this.averagePoints(s)}},r.prototype.averagePoints=function(e){this.center.set(e[0]);for(var i=1;i<e.length;i++)this.center.add(e[i]);var o=1/e.length;this.center.mul(o);for(var r=0,i=0;i<e.length;i++){var n=t.sub(e[i],this.center,this.vec),a=n.lengthSquared();a>r&&(r=a)}this.radius=Math.sqrt(r)+1e-5},r.prototype.transform=function(t,e){null===e&&(e=new r),t.applyForward(this.center,e.center);var i=t.scale;return e.radius=Math.abs(this._maxAxis(i)*this.radius),e},r.prototype.whichSide=function(t){var e=t.normal.data,o=this.center.data,r=e[0]*o[0]+e[1]*o[1]+e[2]*o[2]-t.constant;return r<-this.radius?i.Inside:r>this.radius?i.Outside:i.Intersects},r.prototype._pseudoDistance=function(t,e){return t.normal.x*e.x+t.normal.y*e.y+t.normal.z*e.z-t.constant},r.prototype._maxAxis=function(t){return Math.max(Math.abs(t.x),Math.max(Math.abs(t.y),Math.abs(t.z)))},r.prototype.toString=function(){var t=Math.round(10*this.center.x)/10,e=Math.round(10*this.center.y)/10,i=Math.round(10*this.center.z)/10,o=Math.round(10*this.radius)/10;return"["+t+","+e+","+i+"]"+" - "+o},r.prototype.intersects=function(t){return t.intersectsSphere(this)},r.prototype.intersectsBoundingBox=function(t){t.min.x=t.center.x-t.xExtent,t.min.y=t.center.y-t.yExtent,t.min.z=t.center.z-t.zExtent,t.max.x=t.center.x+t.xExtent,t.max.y=t.center.y+t.yExtent,t.max.z=t.center.z+t.zExtent;var e=Math.pow(this.radius,2),i=0;return this.center.x<t.min.x?i+=Math.pow(this.center.x-t.min.x,2):this.center.x>t.max.x&&(i+=Math.pow(this.center.x-t.max.x,2)),this.center.y<t.min.y?i+=Math.pow(this.center.y-t.min.y,2):this.center.y>t.max.y&&(i+=Math.pow(this.center.y-t.max.y,2)),this.center.z<t.min.z?i+=Math.pow(this.center.z-t.min.z,2):this.center.z>t.max.z&&(i+=Math.pow(this.center.z-t.max.z,2)),e>=i},r.prototype.intersectsSphere=function(t){var e=this.vec.setv(this.center).subv(t.center),i=this.radius+t.radius;return e.dot(e)<=i*i},r.prototype.intersectsRay=function(e){if(!this.center)return!1;var i=(new t).copy(e.origin).sub(this.center),o=i.dot(i)-this.radius*this.radius;if(0>=o)return!0;var r=e.direction.dot(i);return r>=0?!1:r*r>=o},r.prototype.intersectsRayWhere=function(e){var i,o,r,n=(new t).copy(e.origin).sub(this.center),a=n.dot(n)-this.radius*this.radius;if(0>=a){i=e.direction.dot(n),o=i*i-a,r=Math.sqrt(o);var s=[r-i],c=[(new t).copy(e.direction).mul(s[0]).add(e.origin)];return{distances:s,points:c}}if(i=e.direction.dot(n),i>=0)return null;if(o=i*i-a,0>o)return null;if(o>=1e-5){r=Math.sqrt(o);var s=[-i-r,-i+r],c=[(new t).copy(e.direction).mul(s[0]).add(e.origin),(new t).copy(e.direction).mul(s[1]).add(e.origin)];return{distances:s,points:c}}var s=[-i],c=[(new t).copy(e.direction).mul(s[0]).add(e.origin)];return{distances:s,points:c}},r.prototype.merge=function(t){if(t instanceof r)return this.mergeSphere(t.center,t.radius,this);var e=this.vec.setd(t.xExtent,t.yExtent,t.zExtent).length();return this.mergeSphere(t.center,e,this)},r.prototype.mergeSphere=function(t,i,o){o||(o=new r);var n=this.vec.setv(t).subv(this.center),a=n.lengthSquared(),s=i-this.radius,c=s*s;if(c>=a)return 0>=s?(o.center.setv(this.center),o.radius=this.radius,o):(o.center.setv(t),o.radius=i,o);var l=Math.sqrt(a),h=o.center;if(l>e.EPSILON){var u=(l+s)/(2*l);h.addv(n.mul(u))}return o.radius=.5*(l+this.radius+i),o},r.prototype.clone=function(t){return t&&t instanceof r?(t.center.setv(this.center),t.radius=this.radius,t):new r(this.center,this.radius)},r}),define("goo/renderer/bounds/BoundingBox",["goo/math/Vector3","goo/renderer/bounds/BoundingVolume","goo/renderer/bounds/BoundingSphere","goo/math/MathUtils"],function(t,e,i,o){"use strict";function r(i,o,r,n){e.call(this,i),this.xExtent=void 0!==o?o:1,this.yExtent=void 0!==r?r:1,this.zExtent=void 0!==n?n:1,this._compVect1=new t,this._compVect2=new t,this.vec=new t,this.corners=[];for(var a=0;8>a;a++)this.corners.push(new t)}return r.prototype=Object.create(e.prototype),r.prototype.constructor=r,r.prototype.computeFromPoints=function(t){var e=this.min,i=this.max,o=this.vec;e.setd(1/0,1/0,1/0),i.setd(-1/0,-1/0,-1/0);for(var r,n,a,s=0;s<t.length;s+=3)r=t[s+0],n=t[s+1],a=t[s+2],e.x=r<e.x?r:e.x,e.y=n<e.y?n:e.y,e.z=a<e.z?a:e.z,i.x=r>i.x?r:i.x,i.y=n>i.y?n:i.y,i.z=a>i.z?a:i.z;o.setv(i).subv(e).div(2),this.xExtent=o.x,this.yExtent=o.y,this.zExtent=o.z,this.center.setv(i).addv(e).div(2)},r.prototype.computeFromPrimitives=function(t,e,i,o,n){if(!(0>=n-o)){for(var a=this._compVect1.set(1/0,1/0,1/0),s=this._compVect2.set(-1/0,-1/0,-1/0),c=[],l=o;n>l;l++){c=t.getPrimitiveVertices(i[l],e,c);for(var h=0;h<c.length;h++)r.checkMinMax(a,s,c[h])}this.center.copy(a.add(s)),this.center.mul(.5),this.xExtent=s.x-this.center.x,this.yExtent=s.y-this.center.y,this.zExtent=s.z-this.center.z}},r.checkMinMax=function(t,e,i){i.x<t.x&&(t.x=i.x),i.x>e.x&&(e.x=i.x),i.y<t.y&&(t.y=i.y),i.y>e.y&&(e.y=i.y),i.z<t.z&&(t.z=i.z),i.z>e.z&&(e.z=i.z)},r.prototype.transform=function(t,e){null===e&&(e=new r);var i=this.corners;this.getCorners(i);for(var o=0;o<i.length;o++)t.matrix.applyPostPoint(i[o]);for(var n=i[0].data[0],a=i[0].data[1],s=i[0].data[2],c=n,l=a,h=s,o=1;o<i.length;o++){var u=i[o].data[0],d=i[o].data[1],p=i[o].data[2];n=Math.min(n,u),a=Math.min(a,d),s=Math.min(s,p),c=Math.max(c,u),l=Math.max(l,d),h=Math.max(h,p)}var f=.5*(c+n),m=.5*(l+a),g=.5*(h+s);return e.center.setd(f,m,g),e.xExtent=c-f,e.yExtent=l-m,e.zExtent=h-g,e},r.prototype.getCorners=function(e){if(!e||8!==e.length){e=[];for(var i=0;i<e.length;i++)e.push(new t)}return e[0].setd(this.center.data[0]+this.xExtent,this.center.data[1]+this.yExtent,this.center.data[2]+this.zExtent),e[1].setd(this.center.data[0]+this.xExtent,this.center.data[1]+this.yExtent,this.center.data[2]-this.zExtent),e[2].setd(this.center.data[0]+this.xExtent,this.center.data[1]-this.yExtent,this.center.data[2]+this.zExtent),e[3].setd(this.center.data[0]+this.xExtent,this.center.data[1]-this.yExtent,this.center.data[2]-this.zExtent),e[4].setd(this.center.data[0]-this.xExtent,this.center.data[1]+this.yExtent,this.center.data[2]+this.zExtent),e[5].setd(this.center.data[0]-this.xExtent,this.center.data[1]+this.yExtent,this.center.data[2]-this.zExtent),e[6].setd(this.center.data[0]-this.xExtent,this.center.data[1]-this.yExtent,this.center.data[2]+this.zExtent),e[7].setd(this.center.data[0]-this.xExtent,this.center.data[1]-this.yExtent,this.center.data[2]-this.zExtent),e},r.prototype.whichSide=function(t){var i=t.normal.data,o=this.center.data,r=Math.abs(this.xExtent*i[0])+Math.abs(this.yExtent*i[1])+Math.abs(this.zExtent*i[2]),n=i[0]*o[0]+i[1]*o[1]+i[2]*o[2]-t.constant;return-r>n?e.Inside:n>r?e.Outside:e.Intersects},r.prototype._pseudoDistance=function(t,e){var i=t.normal.data,o=e.data;return i[0]*o[0]+i[1]*o[1]+i[2]*o[2]-t.constant},r.prototype._maxAxis=function(t){return Math.max(Math.abs(t.x),Math.max(Math.abs(t.y),Math.abs(t.z)))},r.prototype.toString=function(){var t=Math.round(10*this.center.x)/10,e=Math.round(10*this.center.y)/10,i=Math.round(10*this.center.z)/10;return"["+t+","+e+","+i+"]"+" - "+"["+this.xExtent+","+this.yExtent+","+this.zExtent+"]"},r.prototype.intersects=function(t){return t.intersectsBoundingBox(this)},r.prototype.intersectsBoundingBox=function(t){return this.center.x+this.xExtent<t.center.x-t.xExtent||this.center.x-this.xExtent>t.center.x+t.xExtent?!1:this.center.y+this.yExtent<t.center.y-t.yExtent||this.center.y-this.yExtent>t.center.y+t.yExtent?!1:this.center.z+this.zExtent<t.center.z-t.zExtent||this.center.z-this.zExtent>t.center.z+t.zExtent?!1:!0},r.prototype.intersectsSphere=function(t){this.min.x=this.center.x-this.xExtent,this.min.y=this.center.y-this.yExtent,this.min.z=this.center.z-this.zExtent,this.max.x=this.center.x+this.xExtent,this.max.y=this.center.y+this.yExtent,this.max.z=this.center.z+this.zExtent;var e=Math.pow(t.radius,2),i=0;return t.center.x<this.min.x?i+=Math.pow(t.center.x-this.min.x,2):t.center.x>this.max.x&&(i+=Math.pow(t.center.x-this.max.x,2)),t.center.y<this.min.y?i+=Math.pow(t.center.y-this.min.y,2):t.center.y>this.max.y&&(i+=Math.pow(t.center.y-this.max.y,2)),t.center.z<this.min.z?i+=Math.pow(t.center.z-this.min.z,2):t.center.z>this.max.z&&(i+=Math.pow(t.center.z-this.max.z,2)),e>=i},r.prototype.testStaticAABBAABB=function(e,i){var o=this,r=e,n={mtvDistance:1e10,mtvAxis:new t};return this.testAxisStatic(t.UNIT_X,o.center.x-o.xExtent,o.center.x+o.xExtent,r.center.x-r.xExtent,r.center.x+r.xExtent,n)?this.testAxisStatic(t.UNIT_Y,o.center.y-o.yExtent,o.center.y+o.yExtent,r.center.y-r.yExtent,r.center.y+r.yExtent,n)?this.testAxisStatic(t.UNIT_Z,o.center.z-o.zExtent,o.center.z+o.zExtent,r.center.z-r.zExtent,r.center.z+r.zExtent,n)?(i&&(i.isIntersecting=!0,i.normal=n.mtvAxis,i.penetration=1.001*Math.sqrt(n.mtvDistance)),!0):!1:!1:!1},r.prototype.testAxisStatic=function(e,i,o,r,n,a){var s=t.dot(e,e);if(1e-6>s)return!0;var c=n-i,l=o-r;if(0>=c||0>=l)return!1;var h=l>c?c:-l,u=(new t).copy(e).mul(h/s),d=t.dot(u,u);return d<a.mtvDistance&&(a.mtvDistance=d,a.mtvAxis=e),!0},r.prototype.intersectsRay=function(t){if(isNaN(this.center.x)||isNaN(this.center.y)||isNaN(this.center.z))return!1;var e=this._compVect1.setv(t.origin).subv(this.center),i=t.direction,n=[0,1/0],a=this.xExtent;a<o.ZERO_TOLERANCE&&a>=0&&(a=o.ZERO_TOLERANCE);var s=this.yExtent;s<o.ZERO_TOLERANCE&&s>=0&&(s=o.ZERO_TOLERANCE);var c=this.zExtent;c<o.ZERO_TOLERANCE&&c>=0&&(c=o.ZERO_TOLERANCE);var l=r.clip(i.data[0],-e.data[0]-a,n)&&r.clip(-i.data[0],e.data[0]-a,n)&&r.clip(i.data[1],-e.data[1]-s,n)&&r.clip(-i.data[1],e.data[1]-s,n)&&r.clip(i.data[2],-e.data[2]-c,n)&&r.clip(-i.data[2],e.data[2]-c,n);return!l||0===n[0]&&1/0===n[1]?!1:!0},r.prototype.intersectsRayWhere=function(e){if(isNaN(this.center.x)||isNaN(this.center.y)||isNaN(this.center.z))return null;var i=t.sub(e.origin,this.center,this._compVect1),n=e.direction,a=[0,1/0],s=this.xExtent;s<o.ZERO_TOLERANCE&&s>=0&&(s=o.ZERO_TOLERANCE);var c=this.yExtent;c<o.ZERO_TOLERANCE&&c>=0&&(c=o.ZERO_TOLERANCE);var l=this.zExtent;l<o.ZERO_TOLERANCE&&l>=0&&(l=o.ZERO_TOLERANCE);var h=r.clip(n.x,-i.x-s,a)&&r.clip(-n.x,i.x-s,a)&&r.clip(n.y,-i.y-c,a)&&r.clip(-n.y,i.y-c,a)&&r.clip(n.z,-i.z-l,a)&&r.clip(-n.z,i.z-l,a);if(h&&(0!==a[0]||1/0!==a[1])){if(a[1]>a[0]){var u=a,d=[new t(e.direction).mul(u[0]).add(e.origin),new t(e.direction).mul(u[1]).add(e.origin)];return{distances:u,points:d}}var u=[a[0]],d=[new t(e.direction).mul(u[0]).add(e.origin)];return{distances:u,points:d}}return null},r.clip=function(t,e,i){return t>0?e>t*i[1]?!1:(e>t*i[0]&&(i[0]=e/t),!0):0>t?e>t*i[0]?!1:(e>t*i[1]&&(i[1]=e/t),!0):0>=e},r.prototype.merge=function(t){return t instanceof r?this.mergeBox(t.center,t.xExtent,t.yExtent,t.zExtent,this):t instanceof i?this.mergeBox(t.center,t.radius,t.radius,t.radius,this):this},r.prototype.mergeBox=function(t,e,i,o,n){n||(n=new r);var a=this._compVect1,s=this._compVect2;return a.x=this.center.x-this.xExtent,a.x>t.x-e&&(a.x=t.x-e),a.y=this.center.y-this.yExtent,a.y>t.y-i&&(a.y=t.y-i),a.z=this.center.z-this.zExtent,a.z>t.z-o&&(a.z=t.z-o),s.x=this.center.x+this.xExtent,s.x<t.x+e&&(s.x=t.x+e),s.y=this.center.y+this.yExtent,s.y<t.y+i&&(s.y=t.y+i),s.z=this.center.z+this.zExtent,s.z<t.z+o&&(s.z=t.z+o),n.center.set(s).addv(a).muld(.5,.5,.5),n.xExtent=s.x-n.center.x,n.yExtent=s.y-n.center.y,n.zExtent=s.z-n.center.z,n},r.prototype.clone=function(t){return t&&t instanceof r?(t.center.setv(this.center),t.xExtent=this.xExtent,t.yExtent=this.yExtent,t.zExtent=this.zExtent,t):new r(this.center,this.xExtent,this.yExtent,this.zExtent)},r}),define("goo/entities/components/MeshDataComponent",["goo/renderer/bounds/BoundingBox","goo/entities/components/Component","goo/renderer/MeshData"],function(t,e,i){"use strict";function o(e){this.type="MeshDataComponent",this.meshData=e,this.modelBound=new t,this.autoCompute=!0,this.currentPose=null}return o.type="MeshDataComponent",o.prototype=Object.create(e.prototype),o.prototype.constructor=o,o.prototype.setModelBound=function(t,e){this.modelBound=t,this.autoCompute=e},o.prototype.computeBoundFromPoints=function(){if(this.autoCompute&&null!==this.modelBound){var t=this.meshData.getAttributeBuffer("POSITION");void 0!==t&&(this.modelBound.computeFromPoints(t),this.autoCompute=!1)}},o.applyOnEntity=function(t,e){if(t instanceof i){var r=new o(t);return e.setComponent(r),!0}},o}),define("goo/renderer/ShaderCall",[],function(){"use strict";function t(t,e,i){if(this.context=t,this.location=e,this.location.value=void 0,i)switch(i){case"float":this.call=this.uniform1f;break;case"bool":case"int":case"integer":case"sampler2D":case"sampler3D":case"samplerCube":this.call=this.uniform1i;break;case"floatarray":this.call=this.uniform1fv;break;case"intarray":case"samplerArray":this.call=this.uniform1iv;break;case"vec2":this.call=this.uniform2fv;break;case"vec3":this.call=this.uniform3fv;break;case"vec4":this.call=this.uniform4fv;break;case"mat2":this.call=this.uniformMatrix2fv;break;case"mat3":this.call=this.uniformMatrix3fv;break;case"mat4":this.call=this.uniformMatrix4fv;break;default:throw"Uniform type not handled: "+i}}function e(t,e,i){if(0>i)return!1;for(;i--;)if(t[i]!==e[i])return!1;return!0}function i(t,e){for(var i=t.length;i--;)if(t[i]!==e[i])return!1;return!0}return t.prototype.uniform1f=function(t){var e=this.location.value;e!==t&&(this.context.uniform1f(this.location,t),this.location.value=t)},t.prototype.uniform1fv=function(t){var e=this.location.value;void 0!==e&&i(t,e)||(this.context.uniform1fv(this.location,t),this.location.value=t.slice())},t.prototype.uniform1i=function(t){var e=this.location.value;e!==t&&(this.context.uniform1i(this.location,t),this.location.value=t)},t.prototype.uniform1iv=function(t){var e=this.location.value;void 0!==e&&i(t,e)||(this.context.uniform1iv(this.location,t),this.location.value=t.slice())},t.prototype.uniform2f=function(t,e){var i=this.location.value;(void 0===i||2!==i.length||i[0]!==t||i[1]!==e)&&(this.context.uniform2f(this.location,t,e),this.location.value=[t,e])},t.prototype.uniform2fv=function(t){var e=this.location.value;if(void 0!==e){if(i(t,e))return}else e=this.location.value=new Float64Array(t.length);this.context.uniform2fv(this.location,t);for(var o=t.length;o--;)e[o]=t[o]},t.prototype.uniform2i=function(t,e){var i=this.location.value;(void 0===i||2!==i.length||i[0]!==t||i[1]!==e)&&(this.context.uniform2i(this.location,t,e),this.location.value=[t,e])},t.prototype.uniform2iv=function(t){var e=this.location.value;void 0!==e&&i(t,e)||(this.context.uniform2iv(this.location,t),this.location.value=t.slice())},t.prototype.uniform3f=function(t,e,i){var o=this.location.value;(void 0===o||3!==o.length||o[0]!==t||o[1]!==e||o[2]!==i)&&(this.context.uniform3f(this.location,t,e,i),this.location.value=[t,e,i])},t.prototype.uniform3fv=function(t){var e=this.location.value;if(void 0!==e){if(i(t,e))return}else e=this.location.value=new Float64Array(t.length);this.context.uniform3fv(this.location,t);for(var o=t.length;o--;)e[o]=t[o]},t.prototype.uniform3i=function(t,e,i){var o=this.location.value;(void 0===o||3!==o.length||o[0]!==t||o[1]!==e||o[2]!==i)&&(this.context.uniform3i(this.location,t,e,i),this.location.value=[t,e,i])},t.prototype.uniform3iv=function(t){var e=this.location.value;void 0!==e&&i(t,e)||(this.context.uniform3iv(this.location,t),this.location.value=t.slice())},t.prototype.uniform4f=function(t,e,i,o){var r=this.location.value;(void 0===r||4!==r.length||r[0]!==t||r[1]!==e||r[2]!==i||r[3]!==o)&&(this.context.uniform4f(this.location,t,e,i,o),this.location.value=[t,e,i,o])},t.prototype.uniform4fv=function(t){var e=this.location.value;if(void 0!==e){if(i(t,e))return}else e=this.location.value=new Float64Array(t.length);this.context.uniform4fv(this.location,t);for(var o=t.length;o--;)e[o]=t[o]},t.prototype.uniform4i=function(t,e,i,o){var r=this.location.value;(void 0===r||4!==r.length||r[0]!==t||r[1]!==e||r[2]!==i||r[3]!==o)&&(this.context.uniform4i(this.location,t,e,i,o),this.location.value=[t,e,i,o])},t.prototype.uniform4iv=function(t){var e=this.location.value;void 0!==e&&i(t,e)||(this.context.uniform4iv(this.location,t),this.location.value=t.slice())},t.prototype.uniformMatrix2fv=function(t,i){if(i=i===!0,!t.data)return this.context.uniformMatrix2fv(this.location,i,t),void 0;var o=this.location.value;if(void 0!==o){var r=e(o.data,t.data,4);if(r)return;o.copy(t)}else this.location.value=t.clone();this.context.uniformMatrix2fv(this.location,i,t.data)},t.prototype.uniformMatrix3fv=function(t,i){if(i=i===!0,!t.data)return this.context.uniformMatrix3fv(this.location,i,t),void 0;var o=this.location.value;if(void 0!==o){var r=e(o.data,t.data,9);if(r)return;o.copy(t)}else this.location.value=t.clone();this.context.uniformMatrix3fv(this.location,i,t.data)},t.prototype.uniformMatrix4fv=function(t,o){if(o=o===!0,t.data){var r=this.location.value;if(void 0!==r){var n=e(r.data,t.data,16);if(n)return;r.copy(t)}else this.location.value=t.clone();this.context.uniformMatrix4fv(this.location,o,t.data)}else{var a=t,r=this.location.value;if(void 0!==r){if(i(a,r))return}else r=this.location.value=new Float64Array(a.length);this.context.uniformMatrix4fv(this.location,o,a);for(var s=a.length;s--;)r[s]=a[s]}},t}),define("goo/entities/Entity",["goo/entities/components/Component"],function(t){"use strict";function e(t,i){this._world=t,this._components=[],Object.defineProperty(this,"id",{value:e.entityCount++,writable:!1}),this.name=void 0!==i?i:"Entity_"+this.id,this.skip=!1,this.hidden=!1}function i(t){return t.charAt(0).toLowerCase()+t.substr(1)}return e.prototype.set=function(){for(var e=0;e<arguments.length;e++){var i=arguments[e];if(i instanceof t)this.setComponent(i);else for(var o=this._world._components,r=0;r<o.length;r++){var n=o[r],a=n.applyOnEntity(i,this);if(a)break}}return this},e.prototype.addToWorld=function(t){return this._world.addEntity(this,t),this},e.prototype.removeFromWorld=function(t){return this._world.removeEntity(this,t),this},e.prototype.setComponent=function(t){return this.hasComponent(t.type)?void 0:(this._components.push(t),this[i(t.type)]=t,t.attached&&t.attached(this),t.applyAPI(this),this._world.entityManager.containsEntity(this)&&this._world.changedEntity(this,t,"addedComponent"),this)},e.prototype.hasComponent=function(t){var e=i(t),o=this[e];return!!o&&this._components.indexOf(o)>-1},e.prototype.getComponent=function(t){var e=i(t);return this.hasComponent(t)?this[e]:void 0},e.prototype.clearComponent=function(t){var e=i(t),o=this[e];if(o&&this._components.indexOf(o)>-1){o.detached&&o.detached(this),o.removeAPI(this);var r=this._components.indexOf(o);this._components.splice(r,1),delete this[e],this._world.entityManager.containsEntity(this)&&this._world.changedEntity(this,o,"removedComponent")}return this},e.prototype.toString=function(){return this.name},e.entityCount=0,e}),define("goo/entities/managers/Manager",[],function(){"use strict";function t(){}return t}),define("goo/entities/managers/EntityManager",["goo/entities/managers/Manager"],function(t){"use strict";function e(){this.type="EntityManager",this._entitiesById=[],this._entityCount=0}return e.prototype=Object.create(t.prototype),e.prototype.added=function(t){this.containsEntity(t)||(this._entitiesById[t.id]=t,this._entityCount++)},e.prototype.removed=function(t){this.containsEntity(t)&&(delete this._entitiesById[t.id],this._entityCount--)},e.prototype.containsEntity=function(t){return void 0!==this._entitiesById[t.id]},e.prototype.getEntityById=function(t){return this._entitiesById[t]},e.prototype.getEntityByName=function(t){for(var e in this._entitiesById){var i=this._entitiesById[e];if(i.name===t)return i}},e.prototype.size=function(){return this._entityCount},e.prototype.getEntities=function(){var t=[];for(var e in this._entitiesById)t.push(this._entitiesById[e]);return t},e.prototype.getTopEntities=function(){var t=[];for(var e in this._entitiesById){var i=this._entitiesById[e];i.transformComponent?i.transformComponent.parent||t.push(i):t.push(i)}return t},e}),define("goo/entities/systems/System",[],function(){"use strict";function t(t,e){this.type=t,this.interests=e,this._activeEntities=[],this.passive=!1,this.priority=0}function e(t){return t.charAt(0).toLowerCase()+t.substr(1)}return t.prototype.added=function(t){this._check(t)},t.prototype.changed=function(t){this._check(t)},t.prototype.removed=function(t){var e=this._activeEntities.indexOf(t);-1!==e&&(this._activeEntities.splice(e,1),this.deleted&&this.deleted(t))},t.prototype._check=function(t){if(!this.interests||0!==this.interests.length){var i=null===this.interests;if(!i&&this.interests.length<=t._components.length){i=!0;for(var o=0;o<this.interests.length;o++){var r=e(this.interests[o]);if(!t[r]){i=!1;break}}}var n=this._activeEntities.indexOf(t);i&&-1===n?(this._activeEntities.push(t),this.inserted&&this.inserted(t)):i||-1===n||(this._activeEntities.splice(n,1),this.deleted&&this.deleted(t))}},t.prototype._process=function(t){this.process&&this.process(this._activeEntities,t)},t}),define("goo/entities/World",["goo/entities/Entity","goo/entities/managers/EntityManager","goo/entities/components/TransformComponent","goo/entities/managers/Manager","goo/entities/systems/System","goo/entities/components/Component"],function(t,e,i,o,r,n){"use strict";function a(t){this.gooRunner=t,this._managers=[],this._systems=[],this._addedEntities=[],this._changedEntities=[],this._removedEntities=[],this.entityManager=new e,this.setManager(this.entityManager),this.time=0,this.tpf=1,this._components=[]}return a.time=0,a.tpf=1,a.prototype.add=function(){for(var e=0;e<arguments.length;e++){var i=arguments[e];i instanceof t?this.addEntity(i):i instanceof o?this.setManager(i):i instanceof r?this.setSystem(i):i instanceof n&&this.registerComponent(i)}return this},a.prototype.registerComponent=function(t){return-1===this._components.indexOf(t)&&this._components.push(t),this},a.prototype.setManager=function(t){return this._managers.push(t),this},a.prototype.getManager=function(t){for(var e=0;e<this._managers.length;e++){var i=this._managers[e];if(i.type===t)return i}},a.prototype.setSystem=function(t){for(var e=t.priority,i=0;i<this._systems.length&&!(this._systems[i].priority>e);i++);return this._systems.splice(i,0,t),this},a.prototype.getSystem=function(t){for(var e=0;e<this._systems.length;e++){var i=this._systems[e];if(i.type===t)return i}},a.prototype.createEntity=function(){for(var e=new t(this),o=0;o<arguments.length;o++)"string"==typeof arguments[o]?e.name=arguments[o]:e.set(arguments[o]);return e.transformComponent||e.setComponent(new i),e},a.prototype.getEntities=function(){return this.entityManager.getEntities()},a.prototype.addEntity=function(t,e){if(-1===this._addedEntities.indexOf(t)&&this._addedEntities.push(t),t.transformComponent&&(void 0===e||e===!0))for(var i=t.transformComponent.children,o=0;o<i.length;o++)this.addEntity(i[o].entity,e);return this},a.prototype.removeEntity=function(t,e){-1===this._removedEntities.indexOf(t)&&this._removedEntities.push(t);var i=t.transformComponent;if(i.parent&&(i.parent.detachChild(i),i.parent=null),e===!1){for(var o=i.children,r=0;r<o.length;r++)o[r].parent=null;i.children=[]}else for(var o=i.children,r=0;r<o.length;r++)this._recursiveRemoval(o[r].entity,e);return this},a.prototype._recursiveRemoval=function(t,e){if(-1===this._removedEntities.indexOf(t)&&this._removedEntities.push(t),t.transformComponent&&(void 0===e||e===!0))for(var i=t.transformComponent.children,o=0;o<i.length;o++)this._recursiveRemoval(i[o].entity,e)},a.prototype.changedEntity=function(t,e,i){var o={entity:t};void 0!==e&&(o.component=e),void 0!==i&&(o.eventType=i),this._changedEntities.push(o)},a.prototype.process=function(){this._check(this._addedEntities,function(t,e){if(t.added&&t.added(e),t.addedComponent)for(var i=0;i<e._components.length;i++)t.addedComponent(e,e._components[i])
}),this._check(this._changedEntities,function(t,e){t.changed&&t.changed(e.entity),void 0!==e.eventType&&t[e.eventType]&&t[e.eventType](e.entity,e.component)}),this._check(this._removedEntities,function(t,e){if(t.removed&&t.removed(e),t.removedComponent)for(var i=0;i<e._components.length;i++)t.removedComponent(e,e._components[i])});for(var t=0;t<this._systems.length;t++){var e=this._systems[t];e.passive||e._process(this.tpf)}},a.prototype._check=function(t,e){for(var i=0;i<t.length;i++){for(var o=t[i],r=0;r<this._managers.length;r++){var n=this._managers[r];e(n,o)}for(var a=0;a<this._systems.length;a++){var s=this._systems[a];e(s,o)}}t.length=0},a}),define("goo/renderer/RenderQueue",["goo/math/Vector3"],function(t){"use strict";function e(){var e=this,i=new t;this.opaqueSorter=function(t,o){var r=t.meshRendererComponent.materials[0],n=o.meshRendererComponent.materials[0];if(null===r||null===n)return 0;if(r===n){var a=t.meshRendererComponent.worldBound,s=o.meshRendererComponent.worldBound;if(null===a||null===s)return 0;var c=i.setv(e.camera.translation).subv(a.center).lengthSquared(),l=i.setv(e.camera.translation).subv(s.center).lengthSquared();return c-l}var h=r.shader,u=n.shader;if(null===h||null===u)return 0;if(h._id===u._id){var a=t.meshRendererComponent.worldBound,s=o.meshRendererComponent.worldBound;if(null===a||null===s)return 0;var c=i.setv(e.camera.translation).subv(a.center).lengthSquared(),l=i.setv(e.camera.translation).subv(s.center).lengthSquared();return c-l}return h._id-u._id},this.transparentSorter=function(t,o){var r=t.meshRendererComponent.worldBound,n=o.meshRendererComponent.worldBound,a=i.setv(e.camera.translation).subv(r.center).lengthSquared(),s=i.setv(e.camera.translation).subv(n.center).lengthSquared();return s-a},this.bucketSorter=function(t,e){return t-e}}return e.prototype.sort=function(t,i){var o=0;this.camera=i;for(var r={},n=[],a=0;a<t.length;a++){var s=t[a],c=s.meshRendererComponent;if(c&&0!==c.materials.length){var l=c.materials[0].getRenderQueue(),h=r[l];h||(h=[],r[l]=h,n.push(l)),h.push(s)}else t[o]=s,o++}n.length>1&&n.sort(this.bucketSorter);for(var u=0;u<n.length;u++){var d=n[u],h=r[d];d<e.TRANSPARENT?h.sort(this.opaqueSorter):h.sort(this.transparentSorter);for(var a=0;a<h.length;a++)t[o]=h[a],o++}},e.BACKGROUND=0,e.OPAQUE=1e3,e.TRANSPARENT=2e3,e.OVERLAY=3e3,e}),define("goo/renderer/Shader",["goo/renderer/ShaderCall","goo/math/Matrix4x4","goo/entities/World","goo/renderer/RenderQueue","goo/renderer/Util"],function(t,e,i,o,r){"use strict";function n(t,e){if(!e.vshader||!e.fshader)throw new Error("Missing shader sources for shader: "+t);this.originalShaderDefinition=e,this.shaderDefinition=e,this.name=t,this.origVertexSource=e.vshader,this.origFragmentSource=e.fshader,this.vertexSource="function"==typeof this.origVertexSource?this.origVertexSource():this.origVertexSource,this.fragmentSource="function"==typeof this.origFragmentSource?this.origFragmentSource():this.origFragmentSource,this.shaderProgram=null,this.attributeMapping={},this.attributeIndexMapping={},this.uniformMapping={},this.uniformCallMapping={},this.textureSlots=[],this.textureSlotsNaming={},this.currentCallbacks={},this.overridePrecision=e.precision||null,this.processors=e.processors,this.builder=e.builder,this.defines=e.defines,this.attributes=e.attributes||{},this.uniforms=e.uniforms||{},this.renderQueue=o.OPAQUE,this._id=n.id++,this.errorOnce=!1}function a(t){var o=new e,r=new e;t[n.PROJECTION_MATRIX]=function(t,e){var i=e.camera.getProjectionMatrix();t.uniformMatrix4fv(i)},t[n.VIEW_MATRIX]=function(t,e){var i=e.camera.getViewMatrix();t.uniformMatrix4fv(i)},t[n.WORLD_MATRIX]=function(t,e){var i=void 0!==e.transform?e.transform.matrix:o;t.uniformMatrix4fv(i)},t[n.NORMAL_MATRIX]=function(t,i){var n=void 0!==i.transform?i.transform.matrix:o;e.invert(n,r),e.transpose(r,r),t.uniformMatrix4fv(r)},t[n.VIEW_INVERSE_MATRIX]=function(t,e){var i=e.camera.getViewInverseMatrix();t.uniformMatrix4fv(i)},t[n.VIEW_PROJECTION_MATRIX]=function(t,e){var i=e.camera.getViewProjectionMatrix();t.uniformMatrix4fv(i)},t[n.VIEW_PROJECTION_INVERSE_MATRIX]=function(t,e){var i=e.camera.getViewProjectionInverseMatrix();t.uniformMatrix4fv(i)};for(var a=0;16>a;a++)t[n["TEXTURE"+a]]=function(t){return function(e){e.uniform1i(t)}}(a);for(var a=0;8>a;a++)t[n["LIGHT"+a]]=function(t){return function(e,i){var o=i.lights[t];void 0!==o?e.uniform3f(o.translation.data[0],o.translation.data[1],o.translation.data[2]):e.uniform3f(-20,20,20)}}(a);t[n.LIGHTCOUNT]=function(t,e){t.uniform1i(e.lights.length)},t[n.CAMERA]=function(t,e){var i=e.camera.translation;t.uniform3f(i.data[0],i.data[1],i.data[2])},t[n.NEAR_PLANE]=function(t,e){t.uniform1f(e.camera.near)},t[n.FAR_PLANE]=function(t,e){t.uniform1f(e.camera.far)},t[n.MAIN_NEAR_PLANE]=function(t,e){t.uniform1f(e.mainCamera.near)},t[n.MAIN_FAR_PLANE]=function(t,e){t.uniform1f(e.mainCamera.far)},t[n.MAIN_DEPTH_SCALE]=function(t,e){t.uniform1f(1/(e.mainCamera.far-e.mainCamera.near))},t[n.AMBIENT]=function(t,e){var i=void 0!==e.material.materialState?e.material.materialState.ambient:n.DEFAULT_AMBIENT;t.uniform4fv(i)},t[n.EMISSIVE]=function(t,e){var i=void 0!==e.material.materialState?e.material.materialState.emissive:n.DEFAULT_EMISSIVE;t.uniform4fv(i)},t[n.DIFFUSE]=function(t,e){var i=void 0!==e.material.materialState?e.material.materialState.diffuse:n.DEFAULT_DIFFUSE;t.uniform4fv(i)},t[n.SPECULAR]=function(t,e){var i=void 0!==e.material.materialState?e.material.materialState.specular:n.DEFAULT_SPECULAR;t.uniform4fv(i)},t[n.SPECULAR_POWER]=function(t,e){var i=void 0!==e.material.materialState?e.material.materialState.shininess:n.DEFAULT_SHININESS;i=Math.max(i,1),t.uniform1f(i)},t[n.TIME]=function(t){t.uniform1f(i.time)},t[n.TPF]=function(t){t.uniform1f(i.tpf)},t[n.RESOLUTION]=function(t,e){t.uniform2f(e.renderer.viewportWidth,e.renderer.viewportHeight)}}var s=window.WebGLRenderingContext;n.id=0,n.prototype.clone=function(){return new n(this.name,r.clone({precision:this.precision,processors:this.processors,builder:this.builder,defines:this.defines,attributes:this.attributes,uniforms:this.uniforms,vshader:this.origVertexSource,fshader:this.origFragmentSource}))},n.prototype.cloneOriginal=function(){return new n(this.name,this.originalShaderDefinition)};var c=/\b(attribute|uniform)\s+(float|int|bool|vec2|vec3|vec4|mat3|mat4|sampler2D|sampler3D|samplerCube)\s+(\w+)(\s*\[\s*\w+\s*\])*;/g;n.prototype.apply=function(t,e){var i=e.context,o=e.rendererRecord;null===this.shaderProgram&&(this._investigateShaders(),this.addDefines(this.defines),this.addPrecision(this.overridePrecision||e.shaderPrecision),this.compile(e));var r=!1;if(o.usedProgram!==this.shaderProgram&&(i.useProgram(this.shaderProgram),o.usedProgram=this.shaderProgram,r=!0),this.attributes){var n=t.meshData.attributeMap;for(var a in this.attributes){var s=n[this.attributes[a]];if(s){var c=this.attributeIndexMapping[a];void 0!==c&&(r&&e.context.enableVertexAttribArray(c),e.bindVertexAttribute(c,s))}}}this._bindUniforms(t)},n.prototype._bindUniforms=function(t){if(this.uniforms)try{this.textureIndex=0;for(var e=Object.keys(this.uniforms),i=0,o=e.length;o>i;i++)this._bindUniform(e[i],t);this.errorOnce=!1}catch(r){this.errorOnce===!1&&(console.error(r.stack),this.errorOnce=!0)}},n.prototype._bindUniform=function(t,e){var i=this.uniformCallMapping[t];if(void 0!==i){var o=void 0!==e.material.uniforms[t]?e.material.uniforms[t]:this.uniforms[t];if("string"==typeof o){var r=this.currentCallbacks[t];if(r)r(i,e);else{var n=this.textureSlotsNaming[t];if(void 0!==n){var a=e.material.getTexture(n.mapping);if(a instanceof Array){var s=[];n.index=[];for(var c=0;c<a.length;c++)n.index.push(this.textureIndex),s.push(this.textureIndex++);i.call(s)}else n.index=this.textureIndex,i.call(this.textureIndex++)}}}else{var l="function"==typeof o?o(e):o;i.call(l)}}},n.prototype.rebuild=function(){this.shaderProgram=null,this.attributeMapping={},this.attributeIndexMapping={},this.uniformMapping={},this.uniformCallMapping={},this.currentCallbacks={},this.vertexSource="function"==typeof this.origVertexSource?this.origVertexSource():this.origVertexSource,this.fragmentSource="function"==typeof this.origFragmentSource?this.origFragmentSource():this.origFragmentSource},n.prototype._investigateShaders=function(){this.textureSlots=[],this.textureSlotsNaming={},n.investigateShader(this.vertexSource,this),n.investigateShader(this.fragmentSource,this)},n.investigateShader=function(t,e){c.lastIndex=0;for(var i=c.exec(t);null!==i;){var o={format:i[2]},r=i[1],n=i[3],a=i[4];if(a&&("float"===o.format?o.format="floatarray":"int"===o.format?o.format="intarray":0===o.format.indexOf("sampler")&&(o.format="samplerArray")),"attribute"===r)e.attributeMapping[n]=o;else{if(0===o.format.indexOf("sampler")){var s={format:o.format,name:n,mapping:e.uniforms[n],index:e.textureSlots.length};e.textureSlots.push(s),e.textureSlotsNaming[s.name]=s}e.uniformMapping[n]=o}i=c.exec(t)}},n.prototype.compile=function(e){var i=e.context,o=this._getShader(i,s.VERTEX_SHADER,this.vertexSource),r=this._getShader(i,s.FRAGMENT_SHADER,this.fragmentSource);(null===o||null===r)&&console.error("Shader error - no shaders"),this.shaderProgram=i.createProgram();var n=i.getError();(null===this.shaderProgram||n!==s.NO_ERROR)&&console.error("Shader error: "+n+" [shader: "+this.name+"]"),i.attachShader(this.shaderProgram,o),i.attachShader(this.shaderProgram,r),i.linkProgram(this.shaderProgram),i.getProgramParameter(this.shaderProgram,s.LINK_STATUS)||console.error("Could not initialise shaders: "+i.getProgramInfoLog(this.shaderProgram));for(var a in this.attributeMapping){var c=i.getAttribLocation(this.shaderProgram,a);-1!==c&&(this.attributeIndexMapping[a]=c)}for(var a in this.uniformMapping){var l=i.getUniformLocation(this.shaderProgram,a);if(null!==l)this.uniformCallMapping[a]=new t(i,l,this.uniformMapping[a].format);else for(var h=this.textureSlots.length,u=0;h>u;u++){var d=this.textureSlots[u];if(d.name===a){for(this.textureSlots.splice(u,1),delete this.textureSlotsNaming[d.name];h-1>u;u++)this.textureSlots[u].index--;break}}}if(this.uniforms){if(this.uniforms.$link){for(var p=this.uniforms.$link instanceof Array?this.uniforms.$link:[this.uniforms.$link],u=0;u<p.length;u++){var f=p[u];for(var a in f)this.uniforms[a]=f[a]}delete this.uniforms.$link}for(var m in this.uniforms){var g=this.uniforms[m];this.defaultCallbacks[g]&&(this.currentCallbacks[m]=this.defaultCallbacks[g])}}};var l=/\b\d+:(\d+):\s(.+)\b/g,h=/\((\d+),\s*\d+\):\s(.+)/g;n.prototype._getShader=function(t,e,i){var o=t.createShader(e);if(t.shaderSource(o,i),t.compileShader(o),!t.getShaderParameter(o,s.COMPILE_STATUS)){var r=t.getShaderInfoLog(o),n=e===s.VERTEX_SHADER?"VertexShader":"FragmentShader";l.lastIndex=0;var a=l.exec(r);if(null===a&&(a=h.exec(r)),null!==a)for(;null!==a;){var c=i.split("\n"),u=a[1],d=a[2];console.error("Error in "+n+" - ["+this.name+"]["+this._id+"] at line "+u+":"),console.error("	Error: "+d),console.error("	Source: "+c[u-1]),a=l.exec(r)}else console.error("Error in "+n+" - ["+this.name+"]["+this._id+"] "+r);return null}return o};var u=/\bprecision\s+(lowp|mediump|highp)\s+(float|int);/g;n.prototype.addPrecision=function(t){u.lastIndex=0;var e=u.exec(this.vertexSource);null===e&&(this.vertexSource="precision "+t+" float;"+"\n"+this.vertexSource),u.lastIndex=0;var i=u.exec(this.fragmentSource);null===i&&(this.fragmentSource="precision "+t+" float;"+"\n"+this.fragmentSource)},n.prototype.addDefines=function(t){if(t){var e=this.generateDefines(t);this.vertexSource=e+"\n"+this.vertexSource,this.fragmentSource=e+"\n"+this.fragmentSource}},n.prototype.generateDefines=function(t){var e=[];for(var i in t){var o=t[i];if(o!==!1){var r="#define "+i+" "+o;e.push(r)}}return e.join("\n")},n.prototype.getShaderDefinition=function(){return{vshader:this.vertexSource,fshader:this.fragmentSource,defines:this.defines,attributes:this.attributes,uniforms:this.uniforms}},n.prototype.toString=function(){return this.name},n.PROJECTION_MATRIX="PROJECTION_MATRIX",n.VIEW_MATRIX="VIEW_MATRIX",n.VIEW_INVERSE_MATRIX="VIEW_INVERSE_MATRIX",n.VIEW_PROJECTION_MATRIX="VIEW_PROJECTION_MATRIX",n.VIEW_PROJECTION_INVERSE_MATRIX="VIEW_PROJECTION_INVERSE_MATRIX",n.WORLD_MATRIX="WORLD_MATRIX",n.NORMAL_MATRIX="NORMAL_MATRIX";for(var d=0;8>d;d++)n["LIGHT"+d]="LIGHT"+d;return n.CAMERA="CAMERA",n.AMBIENT="AMBIENT",n.EMISSIVE="EMISSIVE",n.DIFFUSE="DIFFUSE",n.SPECULAR="SPECULAR",n.SPECULAR_POWER="SPECULAR_POWER",n.NEAR_PLANE="NEAR_PLANE",n.FAR_PLANE="FAR_PLANE",n.MAIN_NEAR_PLANE="NEAR_PLANE",n.MAIN_FAR_PLANE="FAR_PLANE",n.MAIN_DEPTH_SCALE="DEPTH_SCALE",n.TIME="TIME",n.TPF="TPF",n.RESOLUTION="RESOLUTION",n.DIFFUSE_MAP="DIFFUSE_MAP",n.NORMAL_MAP="NORMAL_MAP",n.SPECULAR_MAP="SPECULAR_MAP",n.LIGHT_MAP="LIGHT_MAP",n.SHADOW_MAP="SHADOW_MAP",n.AO_MAP="AO_MAP",n.EMISSIVE_MAP="EMISSIVE_MAP",n.DEPTH_MAP="DEPTH_MAP",n.DEFAULT_AMBIENT=[.1,.1,.1,1],n.DEFAULT_EMISSIVE=[0,0,0,0],n.DEFAULT_DIFFUSE=[.8,.8,.8,1],n.DEFAULT_SPECULAR=[.6,.6,.6,1],n.DEFAULT_SHININESS=64,n.prototype.defaultCallbacks={},a(n.prototype.defaultCallbacks),n}),define("goo/renderer/Material",["goo/renderer/Shader"],function(t){"use strict";function e(e){this.name=e,this.shader=null,this.uniforms={},this._textureMaps={},this.materialState={ambient:t.DEFAULT_AMBIENT,diffuse:t.DEFAULT_DIFFUSE,emissive:t.DEFAULT_EMISSIVE,specular:t.DEFAULT_SPECULAR,shininess:t.DEFAULT_SHININESS},this.cullState={enabled:!0,cullFace:"Back",frontFace:"CCW"},this.blendState={blending:"NoBlending",blendEquation:"AddEquation",blendSrc:"SrcAlphaFactor",blendDst:"OneMinusSrcAlphaFactor"},this.depthState={enabled:!0,write:!0},this.offsetState={enabled:!1,factor:1,units:1},this.dualTransparency=!1,this.wireframe=!1,this.flat=!1,this.renderQueue=null}return e.prototype.setTexture=function(t,e){this._textureMaps[t]=e},e.prototype.getTexture=function(t){return this._textureMaps[t]},e.prototype.removeTexture=function(t){delete this._textureMaps[t]},e.prototype.getTextures=function(){var t=[];for(var e in this._textureMaps)t.push(this._textureMaps[e]);return t},e.prototype.getTextureEntries=function(){return this._textureMaps},e.prototype.getRenderQueue=function(){return null!==this.renderQueue?this.renderQueue:null!==this.shader?this.shader.renderQueue:1e3},e.prototype.setRenderQueue=function(t){this.renderQueue=t},e.store=[],e.hash=[],e.createShader=function(i,o){var r=e.store.indexOf(i);if(-1!==r)return e.hash[r];var n=new t(o||null,i);return null===n.name&&(n.name="DefaultShader"+n._id),e.store.push(i),e.hash.push(n),n},e.clearShaderCache=function(){e.store.length=0,e.hash.length=0},e.createMaterial=function(t,i){var o=new e(i||"DefaultMaterial");return o.shader=e.createShader(t),o},e.createEmptyMaterial=function(t,i){var o=new e(i||"Empty Material");return o.empty(),o.shader=t?e.createShader(t):void 0,o},e.prototype.empty=function(){this.cullState={},this.blendState={},this.depthState={},this.offsetState={},this.wireframe=void 0,this.renderQueue=void 0,this.flat=void 0,this._textureMaps={},this.shader=void 0,this.uniforms={}},e}),define("goo/entities/components/MeshRendererComponent",["goo/entities/components/Component","goo/renderer/Material"],function(t,e){"use strict";function i(){this.type="MeshRendererComponent",this.materials=[],this.worldBound=null,this.cullMode="Dynamic",this.castShadows=!0,this.receiveShadows=!0,this.isPickable=!0,this.isReflectable=!0,this.hidden=!1}return i.prototype=Object.create(t.prototype),i.prototype.updateBounds=function(t,e){this.worldBound=t.transform(e,this.worldBound)},i.applyOnEntity=function(t,o){if(t instanceof e){var r=new i;return r.materials.push(t),o.setComponent(r),!0}},i}),define("goo/util/Handy",[],function(){"use strict";function t(){}return t.deepFreeze=function(e){var i,o;Object.freeze(e);for(o in e)i=e[o],e.hasOwnProperty(o)&&"object"==typeof i&&!Object.isFrozen(i)&&t.deepFreeze(i)},t.defineProperty=function(t,e,i,o){var r=i;Object.defineProperty(t,e,{get:function(){return r},set:function(t){r=t,o(r)},configurable:!0,enumerable:!0})},t.addListener=function(t,e,i,o){var r=t[e];Object.defineProperty(t,e,{get:function(){return i&&i(),r},set:function(t){r=t,o&&o(r)},configurable:!0,enumerable:!0})},t}),define("goo/math/Plane",["goo/math/Vector3"],function(t){"use strict";function e(e,i){this.normal=void 0!==e?new t(e):new t(t.UNIT_Y),this.constant=isNaN(i)?0:i}e.XZ=new e(t.UNIT_Y,0),e.XY=new e(t.UNIT_Z,0),e.YZ=new e(t.UNIT_X,0),e.prototype.pseudoDistance=function(t){return this.normal.dot(t)-this.constant},e.prototype.setPlanePoints=function(t,e,i){return this.normal.set(e).sub(t),this.normal.cross([i.x-t.x,i.y-t.y,i.z-t.z]).normalize(),this.constant=this.normal.dot(t),this},e.prototype.reflectVector=function(e,i){var o=i;null===o&&(o=new t);var r=2*this.normal.dot(e);return o.set(e).sub([this.normal.x*r,this.normal.y*r,this.normal.z*r]),o};var i=new t;return e.prototype.rayIntersect=function(e,o){o=o||new t;var r=e.direction.dot(this.normal);if(Math.abs(r)<1e-8)return console.warn("Ray parallell with plane"),null;var n=this.constant,a=i.set(this.normal).muld(n,n,n).subv(e.origin).dot(this.normal),s=a/r;return o.setv(e.direction).muld(s,s,s).addv(e.origin)},e}),define("goo/math/Ray",["goo/math/Vector3","goo/math/MathUtils"],function(t,e){"use strict";function i(e,i){this.origin=e||new t,this.direction=i||(new t).copy(t.UNIT_Z),this.calcVec1=new t,this.calcVec2=new t,this.calcVec3=new t,this.calcVec4=new t}return i.prototype.intersects=function(t,e,i){return 3===t.length?this.intersectsTriangle(t[0],t[1],t[2],e,i):4===t.length?this.intersectsTriangle(t[0],t[1],t[2],e,i)||this.intersectsTriangle(t[0],t[2],t[3],e,i):!1},i.prototype.intersectsTriangle=function(i,o,r,n,a){var s,c=this.calcVec1.set(this.origin).sub(i),l=this.calcVec2.set(o).sub(i),h=this.calcVec3.set(r).sub(i),u=this.calcVec4.set(l).cross(h),d=this.direction.dot(u);if(d>e.EPSILON)s=1;else{if(!(d<-e.EPSILON))return!1;s=-1,d=-d}var p=s*this.direction.dot(t.cross(c,h,h)),f=!1;if(p>=0){var m=s*this.direction.dot(l.cross(c));if(m>=0&&d>=p+m){var g=-s*c.dot(u);if(g>=0){if(!a)return!0;var v=1/d,y=g*v;if(n){var x=p*v,w=m*v;a.setd(y,x,w)}else a.setv(this.origin).add_d(this.direction.x*y,this.direction.y*y,this.direction.z*y);f=!0}}}return f},i.prototype.getDistanceToPrimitive=function(t){var e=this.calcVec1;return this.intersects(t,!1,e)?this.origin.distance(e.x,e.y,e.z):1/0},i.prototype.intersectsPlane=function(t,e){var i=t.normal,o=i.dot(this.direction);if(Math.abs(o)<1e-5)return!1;var r=-i.dot(this.origin)+t.constant,n=r/o;return 1e-5>n?!1:(null!==e&&e.set(this.direction).multiplyLocal(n).addLocal(this.origin),!0)},i.prototype.distanceSquared=function(t,e){var i=this.calcVec1;i.set(t).subtractLocal(this.origin);var o=this.direction.dot(i);return o>0?(i.set(this.direction).multiplyLocal(o),i.addLocal(this.origin)):i.set(this.origin),null!==e&&e.set(i),t.subtract(i,i),i.lengthSquared()},i}),define("goo/renderer/Camera",["goo/util/Handy","goo/math/Vector3","goo/math/Vector4","goo/math/Matrix4x4","goo/math/Plane","goo/math/MathUtils","goo/math/Ray","goo/renderer/bounds/BoundingBox","goo/renderer/bounds/BoundingSphere","goo/renderer/bounds/BoundingVolume"],function(t,e,i,o,r,n,a,s,c,l){"use strict";function h(n,a,s,c){n="undefined"!=typeof n?n:45,a="undefined"!=typeof a?a:1,s="undefined"!=typeof s?s:1,c="undefined"!=typeof c?c:1e3,this.translation=new e(0,0,0),this._left=new e(-1,0,0),this._up=new e(0,1,0),this._direction=new e(0,0,-1),t.defineProperty(this,"this._depthRangeNear",0,function(){this._depthRangeDirty=!0}),t.defineProperty(this,"this._depthRangeFar",1,function(){this._depthRangeDirty=!0}),this._depthRangeDirty=!0,this._frustumNear=1,this._frustumFar=2,this._frustumLeft=-.5,this._frustumRight=.5,this._frustumTop=.5,this._frustumBottom=-.5,this._coeffLeft=[],this._coeffRight=[],this._coeffBottom=[],this._coeffTop=[],this._viewPortLeft=0,this._viewPortRight=1,this._viewPortTop=1,this._viewPortBottom=0,this._planeQuantity=6,this._worldPlane=[];for(var l=0;l<h.FRUSTUM_PLANES;l++)this._worldPlane[l]=new r;this._newDirection=new e,this.projectionMode=h.Perspective,this.lockedRatio=!1,this.aspect=a,this._updateMVMatrix=!0,this._updateInverseMVMatrix=!0,this._updatePMatrix=!0,this._updateMVPMatrix=!0,this._updateInverseMVPMatrix=!0,this.modelView=new o,this.modelViewInverse=new o,this.projection=new o,this.modelViewProjection=new o,this.modelViewProjectionInverse=new o,this._depthRangeDirty=!0,this._viewPortDirty=!0,this._planeState=0,this._clipPlane=new i,this._qCalc=new i,this._corners=[];for(var l=0;8>l;l++)this._corners.push(new e);this._extents=new e,this.vNearPlaneCenter=new e,this.vFarPlaneCenter=new e,this.direction=new e,this.left=new e,this.up=new e,this.planeNormal=new e,this.changedProperties=!0,this.setFrustumPerspective(n,a,s,c),this.onFrameChange()}h.LEFT_PLANE=0,h.RIGHT_PLANE=1,h.BOTTOM_PLANE=2,h.TOP_PLANE=3,h.FAR_PLANE=4,h.NEAR_PLANE=5,h.FRUSTUM_PLANES=6,h.Perspective=0,h.Parallel=1,h.Custom=2,h.Outside=0,h.Inside=1,h.Intersects=2,h.prototype.normalize=function(){this._left.normalize(),this._up.normalize(),this._direction.normalize(),this.onFrameChange()},h.prototype.setProjectionMode=function(t){this.projectionMode=t,this.update()},h.prototype.setFrustumPerspective=function(t,e,i,o){if(void 0!==t&&null!==t&&(this.fov=t),void 0!==e&&null!==e&&(this.aspect=e),void 0!==i&&null!==i&&(this.near=i),void 0!==o&&null!==o&&(this.far=o),void 0!==this.fov){var r=Math.tan(.5*this.fov*n.DEG_TO_RAD)*this.near,a=r*this.aspect;this._frustumLeft=-a,this._frustumRight=a,this._frustumBottom=-r,this._frustumTop=r,this._frustumNear=this.near,this._frustumFar=this.far,this.onFrustumChange()}},h.prototype.setFrustum=function(t,e,i,o,r,n,a){void 0!==t&&null!==t&&(this.near=t),void 0!==e&&null!==e&&(this.far=e),void 0!==i&&null!==i&&(this.left=i),void 0!==o&&null!==o&&(this.right=o),void 0!==r&&null!==r&&(this.top=r),void 0!==n&&null!==n&&(this.bottom=n),void 0!==a&&null!==a&&(this.aspect=a),this._frustumNear=this.near,this._frustumFar=this.far,this._frustumLeft=this.left*this.aspect,this._frustumRight=this.right*this.aspect,this._frustumTop=this.top,this._frustumBottom=this.bottom,this.onFrustumChange()},h.prototype.copy=function(t){this.translation.setv(t.translation),this._left.setv(t._left),this._up.setv(t._up),this._direction.setv(t._direction),this.fov=t.fov,this.aspect=t.aspect,this.near=t.near,this.far=t.far,this._frustumLeft=t._frustumLeft,this._frustumRight=t._frustumRight,this._frustumBottom=t._frustumBottom,this._frustumTop=t._frustumTop,this._frustumNear=t._frustumNear,this._frustumFar=t._frustumFar,this.projectionMode=t.projectionMode,this._depthRangeDirty=!0,this.onFrustumChange(),this.onFrameChange()},h.prototype.setFrame=function(t,e,i,o){this._left.copy(e),this._up.copy(i),this._direction.copy(o),this.translation.copy(t),this.onFrameChange()},h.prototype.lookAt=function(t,i){this._newDirection.copy(t).sub(this.translation).normalize(),this._newDirection.equals(this._direction)||(this._direction.copy(this._newDirection),this._up.copy(i).normalize(),this._up.equals(e.ZERO)&&this._up.copy(e.UNIT_Y),this._left.copy(this._up).cross(this._direction).normalize(),this._left.equals(e.ZERO)&&(0!==this._direction.x?this._left.set(this._direction.y,-this._direction.x,0):this._left.set(0,this._direction.z,-this._direction.y)),this._up.copy(this._direction).cross(this._left).normalize(),this.onFrameChange())},h.prototype.makeDirty=function(){this._depthRangeDirty=!0,this._viewPortDirty=!0},h.prototype.update=function(){this._depthRangeDirty=!0,this.onFrustumChange(),this.onFrameChange()},h.prototype.setViewPort=function(){console.warn("Camera.setViewPort() not implemented.")},h.prototype.contains=function(t){if(!t)return h.Inside;for(var e=h.Inside,i=h.FRUSTUM_PLANES-1;i>=0;i--)switch(t.whichSide(this._worldPlane[i])){case l.Inside:return h.Outside;case l.Outside:break;case l.Intersects:e=h.Intersects}return e},h.prototype.onFrustumChange=function(){if(this.projectionMode===h.Perspective){var t=this._frustumNear*this._frustumNear,e=this._frustumLeft*this._frustumLeft,i=this._frustumRight*this._frustumRight,o=this._frustumBottom*this._frustumBottom,r=this._frustumTop*this._frustumTop,n=1/Math.sqrt(t+e);this._coeffLeft[0]=this._frustumNear*n,this._coeffLeft[1]=-this._frustumLeft*n,n=1/Math.sqrt(t+i),this._coeffRight[0]=-this._frustumNear*n,this._coeffRight[1]=this._frustumRight*n,n=1/Math.sqrt(t+o),this._coeffBottom[0]=this._frustumNear*n,this._coeffBottom[1]=-this._frustumBottom*n,n=1/Math.sqrt(t+r),this._coeffTop[0]=-this._frustumNear*n,this._coeffTop[1]=this._frustumTop*n}else this.projectionMode===h.Parallel&&(this._frustumRight>this._frustumLeft?(this._coeffLeft[0]=-1,this._coeffLeft[1]=0,this._coeffRight[0]=1,this._coeffRight[1]=0):(this._coeffLeft[0]=1,this._coeffLeft[1]=0,this._coeffRight[0]=-1,this._coeffRight[1]=0),this._frustumTop>this._frustumBottom?(this._coeffBottom[0]=-1,this._coeffBottom[1]=0,this._coeffTop[0]=1,this._coeffTop[1]=0):(this._coeffBottom[0]=1,this._coeffBottom[1]=0,this._coeffTop[0]=-1,this._coeffTop[1]=0));this._updatePMatrix=!0,this._updateMVPMatrix=!0,this._updateInverseMVMatrix=!0,this._updateInverseMVPMatrix=!0,this.changedProperties=!0},h.prototype.onFrameChange=function(){var t=this._direction.dot(this.translation),e=this.planeNormal;e.x=this._left.x*this._coeffLeft[0],e.y=this._left.y*this._coeffLeft[0],e.z=this._left.z*this._coeffLeft[0],e.add([this._direction.x*this._coeffLeft[1],this._direction.y*this._coeffLeft[1],this._direction.z*this._coeffLeft[1]]),this._worldPlane[h.LEFT_PLANE].normal.copy(e),this._worldPlane[h.LEFT_PLANE].constant=this.translation.dot(e),e.x=this._left.x*this._coeffRight[0],e.y=this._left.y*this._coeffRight[0],e.z=this._left.z*this._coeffRight[0],e.add([this._direction.x*this._coeffRight[1],this._direction.y*this._coeffRight[1],this._direction.z*this._coeffRight[1]]),this._worldPlane[h.RIGHT_PLANE].normal.copy(e),this._worldPlane[h.RIGHT_PLANE].constant=this.translation.dot(e),e.x=this._up.x*this._coeffBottom[0],e.y=this._up.y*this._coeffBottom[0],e.z=this._up.z*this._coeffBottom[0],e.add([this._direction.x*this._coeffBottom[1],this._direction.y*this._coeffBottom[1],this._direction.z*this._coeffBottom[1]]),this._worldPlane[h.BOTTOM_PLANE].normal.copy(e),this._worldPlane[h.BOTTOM_PLANE].constant=this.translation.dot(e),e.x=this._up.x*this._coeffTop[0],e.y=this._up.y*this._coeffTop[0],e.z=this._up.z*this._coeffTop[0],e.add([this._direction.x*this._coeffTop[1],this._direction.y*this._coeffTop[1],this._direction.z*this._coeffTop[1]]),this._worldPlane[h.TOP_PLANE].normal.copy(e),this._worldPlane[h.TOP_PLANE].constant=this.translation.dot(e),this.projectionMode===h.Parallel&&(this._frustumRight>this._frustumLeft?(this._worldPlane[h.LEFT_PLANE].constant=this._worldPlane[h.LEFT_PLANE].contant+this._frustumLeft,this._worldPlane[h.RIGHT_PLANE].constant=this._worldPlane[h.RIGHT_PLANE].contant-this._frustumRight):(this._worldPlane[h.LEFT_PLANE].constant=this._worldPlane[h.LEFT_PLANE].contant-this._frustumLeft,this._worldPlane[h.RIGHT_PLANE].constant=this._worldPlane[h.RIGHT_PLANE].contant+this._frustumRight),this._frustumBottom>this._frustumTop?(this._worldPlane[h.TOP_PLANE].constant=this._worldPlane[h.TOP_PLANE].contant+this._frustumTop,this._worldPlane[h.BOTTOM_PLANE].constant=this._worldPlane[h.BOTTOM_PLANE].contant-this._frustumBottom):(this._worldPlane[h.TOP_PLANE].constant=this._worldPlane[h.TOP_PLANE].contant-this._frustumTop,this._worldPlane[h.BOTTOM_PLANE].constant=this._worldPlane[h.BOTTOM_PLANE].contant+this._frustumBottom)),e.copy(this._direction).invert(),this._worldPlane[h.FAR_PLANE].normal.copy(e),this._worldPlane[h.FAR_PLANE].constant=-(t+this._frustumFar),this._worldPlane[h.NEAR_PLANE].normal.copy(this._direction),this._worldPlane[h.NEAR_PLANE].constant=t+this._frustumNear,this._updateMVMatrix=!0,this._updateMVPMatrix=!0,this._updateInverseMVMatrix=!0,this._updateInverseMVPMatrix=!0},h.prototype.updateProjectionMatrix=function(){if(this.projectionMode===h.Parallel){this.projection.setIdentity();var t=this.projection.data;t[0]=2/(this._frustumRight-this._frustumLeft),t[5]=2/(this._frustumTop-this._frustumBottom),t[10]=-2/(this._frustumFar-this._frustumNear),t[12]=-(this._frustumRight+this._frustumLeft)/(this._frustumRight-this._frustumLeft),t[13]=-(this._frustumTop+this._frustumBottom)/(this._frustumTop-this._frustumBottom),t[14]=-(this._frustumFar+this._frustumNear)/(this._frustumFar-this._frustumNear)}else if(this.projectionMode===h.Perspective){this.projection.setIdentity();var t=this.projection.data;t[0]=2*this._frustumNear/(this._frustumRight-this._frustumLeft),t[5]=2*this._frustumNear/(this._frustumTop-this._frustumBottom),t[8]=(this._frustumRight+this._frustumLeft)/(this._frustumRight-this._frustumLeft),t[9]=(this._frustumTop+this._frustumBottom)/(this._frustumTop-this._frustumBottom),t[10]=-(this._frustumFar+this._frustumNear)/(this._frustumFar-this._frustumNear),t[11]=-1,t[14]=-(2*this._frustumFar*this._frustumNear)/(this._frustumFar-this._frustumNear),t[15]=-0}},h.prototype.updateModelViewMatrix=function(){this.modelView.setIdentity();var t=this.modelView.data;t[0]=-this._left.x,t[4]=-this._left.y,t[8]=-this._left.z,t[1]=this._up.x,t[5]=this._up.y,t[9]=this._up.z,t[2]=-this._direction.x,t[6]=-this._direction.y,t[10]=-this._direction.z,t[12]=this._left.dot(this.translation),t[13]=-this._up.dot(this.translation),t[14]=this._direction.dot(this.translation)},h.prototype.getPickRay=function(t,i,o,r,n){n||(n=new a);var s=new e,c=new e;return this.getWorldCoordinates(t,r-i,o,r,0,s),this.getWorldCoordinates(t,r-i,o,r,.3,c).sub(s).normalize(),n.origin.copy(s),n.direction.copy(c),n},h.prototype.getWorldCoordinates=function(t,o,r,n,a,s){s||(s=new e),this.checkInverseModelViewProjection();var c=new i;return c.set(2*((t/r-this._viewPortLeft)/(this._viewPortRight-this._viewPortLeft))-1,2*((o/n-this._viewPortBottom)/(this._viewPortTop-this._viewPortBottom))-1,2*a-1,1),this.modelViewProjectionInverse.applyPost(c),c.mul(1/c.w),s.x=c.x,s.y=c.y,s.z=c.z,s},h.prototype.getScreenCoordinates=function(t,e,i,o){return o=this.getNormalizedDeviceCoordinates(t,o),o.x=(o.x+1)*(this._viewPortRight-this._viewPortLeft)/2*e,o.y=(o.y+1)*(this._viewPortTop-this._viewPortBottom)/2*i,o.z=(o.z+1)/2,o},h.prototype.getFrustumCoordinates=function(t,e){return e=this.getNormalizedDeviceCoordinates(t,e),e.x=(e.x+1)*(this._frustumRight-this._frustumLeft)/2+this._frustumLeft,e.y=(e.y+1)*(this._frustumTop-this._frustumBottom)/2+this._frustumBottom,e.z=(e.z+1)*(this._frustumFar-this._frustumNear)/2+this._frustumNear,e},h.prototype.getNormalizedDeviceCoordinates=function(t,o){o||(o=new e),this.checkModelViewProjection();var r=new i;return r.set(t.x,t.y,t.z,1),this.modelViewProjection.applyPost(r),r.mul(1/r.w),o.x=r.x,o.y=r.y,o.z=r.z,o},h.prototype.checkModelView=function(){this._updateMVMatrix&&(this.updateModelViewMatrix(),this._updateMVMatrix=!1)},h.prototype.checkProjection=function(){this._updatePMatrix&&(this.updateProjectionMatrix(),this._updatePMatrix=!1)},h.prototype.checkModelViewProjection=function(){this._updateMVPMatrix&&(this.checkModelView(),this.checkProjection(),this.modelViewProjection.copy(this.getProjectionMatrix()).combine(this.getViewMatrix()),this._updateMVPMatrix=!1)},h.prototype.checkInverseModelView=function(){this._updateInverseMVMatrix&&(this.checkModelView(),o.invert(this.modelView,this.modelViewInverse),this._updateInverseMVMatrix=!1)},h.prototype.checkInverseModelViewProjection=function(){this._updateInverseMVPMatrix&&(this.checkModelViewProjection(),o.invert(this.modelViewProjection,this.modelViewProjectionInverse),this._updateInverseMVPMatrix=!1)},h.prototype.getViewMatrix=function(){return this.checkModelView(),this.modelView},h.prototype.getProjectionMatrix=function(){return this.checkProjection(),this.projection},h.prototype.getViewProjectionMatrix=function(){return this.checkModelViewProjection(),this.modelViewProjection},h.prototype.getViewInverseMatrix=function(){return this.checkInverseModelView(),this.modelViewInverse
},h.prototype.getViewProjectionInverseMatrix=function(){return this.checkInverseModelViewProjection(),this.modelViewProjectionInverse},h.prototype.pack=function(t){for(var e=t.center,o=this._corners,r=this._extents,n=0;n<o.length;n++)o[n].set(e);t instanceof s?r.setd(t.xExtent,t.yExtent,t.zExtent):t instanceof c&&r.setd(t.radius,t.radius,t.radius),o[0].add_d(r.x,r.y,r.z),o[1].add_d(r.x,-r.y,r.z),o[2].add_d(r.x,r.y,-r.z),o[3].add_d(r.x,-r.y,-r.z),o[4].add_d(-r.x,r.y,r.z),o[5].add_d(-r.x,-r.y,r.z),o[6].add_d(-r.x,r.y,-r.z),o[7].add_d(-r.x,-r.y,-r.z);for(var a=this.getViewMatrix(),l=Number.MAX_VALUE,h=-Number.MAX_VALUE,u=new i,n=0;n<o.length;n++)u.setd(o[n].x,o[n].y,o[n].z,1),a.applyPre(u),l=Math.min(-u.z,l),h=Math.max(-u.z,h);l=Math.min(Math.max(this._frustumNear,l),this._frustumFar),h=Math.max(l,Math.min(this._frustumFar,h));var d=l/this._frustumNear;this._frustumLeft=this._frustumLeft*d,this._frustumRight=this._frustumRight*d,this._frustumTop=this._frustumTop*d,this._frustumBottom=this._frustumBottom*d,this._frustumNear=l,this._frustumFar=h},h.prototype.calculateFrustumCorners=function(t,e){t=void 0!==t?t:this._frustumNear,e=void 0!==e?e:this._frustumFar;var i=.5*(this._frustumTop-this._frustumBottom)*t/this._frustumNear,o=.5*(this._frustumRight-this._frustumLeft)*t/this._frustumNear,r=.5*(this._frustumTop-this._frustumBottom)*e/this._frustumNear,n=.5*(this._frustumRight-this._frustumLeft)*e/this._frustumNear;this.projectionMode===h.Parallel&&(i=.5*(this._frustumTop-this._frustumBottom),o=.5*(this._frustumRight-this._frustumLeft),r=.5*(this._frustumTop-this._frustumBottom),n=.5*(this._frustumRight-this._frustumLeft));var a=this.vNearPlaneCenter,s=this.vFarPlaneCenter,c=this.direction,l=this.left,u=this.up;return c.setv(this._direction).mul(t),a.setv(this.translation).addv(c),c.setv(this._direction).mul(e),s.setv(this.translation).addv(c),l.setv(this._left).mul(o),u.setv(this._up).mul(i),this._corners[0].setv(a).subv(l).subv(u),this._corners[1].setv(a).addv(l).subv(u),this._corners[2].setv(a).addv(l).addv(u),this._corners[3].setv(a).subv(l).addv(u),l.setv(this._left).mul(n),u.setv(this._up).mul(r),this._corners[4].setv(s).subv(l).subv(u),this._corners[5].setv(s).addv(l).subv(u),this._corners[6].setv(s).addv(l).addv(u),this._corners[7].setv(s).subv(l).addv(u),this._corners};var u=function(t){return t>0?1:0>t?-1:0};return h.prototype.setToObliqueMatrix=function(t,e){e=e||0;var o=this._clipPlane.setv(t);this.getViewMatrix().applyPost(o),o.w=this.translation.y*t.y+e,this._updatePMatrix=!0;var r=this.getProjectionMatrix();this._qCalc.setd((u(o.x)+r[8])/r[0],(u(o.y)+r[9])/r[5],-1,(1+r[10])/r[14]),o.mul(2/i.dot(o,this._qCalc)),r[2]=o.x,r[6]=o.y,r[10]=o.z+1,r[14]=o.w,this._updateMVPMatrix=!0,this._updateInverseMVPMatrix=!0},h}),define("goo/entities/components/CameraComponent",["goo/entities/components/Component","goo/math/Vector3","goo/renderer/Camera"],function(t,e,i){"use strict";function o(t){this.type="CameraComponent",this.camera=t,this.leftVec=new e(-1,0,0),this.upVec=new e(0,1,0),this.dirVec=new e(0,0,-1)}return o.type="CameraComponent",o.prototype=Object.create(t.prototype),o.prototype.constructor=o,o.prototype.setUpVector=function(t){0===t?(this.leftVec.setd(0,-1,0),this.upVec.setd(1,0,0),this.dirVec.setd(0,0,-1)):2===t?(this.leftVec.setd(-1,0,0),this.upVec.setd(0,0,1),this.dirVec.setd(0,-1,0)):(this.leftVec.setd(-1,0,0),this.upVec.setd(0,1,0),this.dirVec.setd(0,0,-1))},o.prototype.updateCamera=function(t){this.camera._left.setv(this.leftVec),t.matrix.applyPostVector(this.camera._left),this.camera._up.setv(this.upVec),t.matrix.applyPostVector(this.camera._up),this.camera._direction.setv(this.dirVec),t.matrix.applyPostVector(this.camera._direction),t.matrix.getTranslation(this.camera.translation),this.camera.update()},o.applyOnEntity=function(t,e){if(t instanceof i){var r=new o(t);return e.setComponent(r),!0}},o}),define("goo/renderer/light/Light",["goo/math/Vector3"],function(t){"use strict";function e(){this.translation=new t,this.color=new t(1,1,1),this.intensity=1,this.specularIntensity=1,this.shadowCaster=!1,this.lightCookie=null,this.shadowSettings={size:100,near:1,far:1e3,resolution:[512,512],upVector:t.UNIT_Y,darkness:0,shadowType:"VSM"},this.changedProperties=!1,this.changedColor=!1}return e}),define("goo/entities/components/LightComponent",["goo/entities/components/Component","goo/renderer/light/Light"],function(t,e){"use strict";function i(t){this.type="LightComponent",this.light=t,this.hidden=!1}return i.prototype=Object.create(t.prototype),i.prototype.updateLight=function(t){this.light.update(t)},i.applyOnEntity=function(t,o){if(t instanceof e){var r=new i(t);return o.setComponent(r),!0}},i}),define("goo/entities/components/ScriptComponent",["goo/entities/components/Component"],function(t){"use strict";function e(t){this.type="ScriptComponent",this.scripts=t instanceof Array?t:t?[t]:[]}return e.prototype=Object.create(t.prototype),e.prototype.run=function(t,e,i){for(var o,r=0,n=this.scripts.length;n>r;r++)o=this.scripts[r],o&&o.run&&(void 0===o.enabled||o.enabled)&&o.run(t,e,i)},e.applyOnEntity=function(t,i){if(t instanceof Function||t.run instanceof Function){var o;return i.scriptComponent?o=i.scriptComponent:(o=new e,i.setComponent(o)),o.scripts.push(t.run instanceof Function?t:{run:t}),!0}},e}),define("goo/entities/components/CSSTransformComponent",["goo/entities/components/Component"],function(t){"use strict";function e(e,i){t.call(this),this.type="CSSTransformComponent",this.domElement=e,this.scale=1,this.faceCamera="undefined"==typeof i?!1:i}return e.prototype=Object.create(t.prototype),e}),define("goo/animation/state/AbstractState",[],function(){"use strict";function t(){this._globalStartTime=0,this.onFinished=null}return t.prototype.update=function(){},t.prototype.postUpdate=function(){},t.prototype.getCurrentSourceData=function(){},t.prototype.resetClips=function(t){this._globalStartTime=t},t.prototype.shiftClipTime=function(t){this._globalStartTime+=t},t}),define("goo/animation/state/SteadyState",["goo/animation/state/AbstractState"],function(t){"use strict";function e(e){t.call(this),this._name=e,this._transitions={},this._sourceTree=null}return e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.prototype.update=function(t){this._sourceTree.setTime(t)||this.onFinished&&this.onFinished()},e.prototype.getCurrentSourceData=function(){return this._sourceTree.getSourceData()},e.prototype.resetClips=function(e){t.prototype.resetClips.call(this,e),this._sourceTree.resetClips(e)},e.prototype.shiftClipTime=function(e){t.prototype.shiftClipTime.call(this,e),this._sourceTree.shiftClipTime(e)},e.prototype.setTimeScale=function(t){this._sourceTree.setTimeScale(t)},e.prototype.clone=function(){var t=new e(this._name);for(var i in this._transitions)t._transitions[i]=this._transitions[i];return t._sourceTree=this._sourceTree.clone(),t},e}),define("goo/animation/layer/AnimationLayer",["goo/animation/state/SteadyState","goo/entities/World"],function(t,e){"use strict";function i(t){this._name=t,this._steadyStates={},this._currentState=null,this._layerBlender=null,this._transitions={},this._transitionStates={}}return i.BASE_LAYER_NAME="-BASE_LAYER-",i.prototype.getStates=function(){return Object.keys(this._steadyStates)},i.prototype.getTransitions=function(){var t;if(t=this._currentState?Object.keys(this._currentState._transitions):[],this._transitions)for(var e in this._transitions)-1===t.indexOf(e)&&t.push(e);return t.sort(),t},i.prototype.update=function(t){this._currentState&&this._currentState.update(t||e.time)},i.prototype.postUpdate=function(){this._currentState&&this._currentState.postUpdate()},i.prototype.transitionTo=function(i,o){o=o||e.time;var r,n=this._currentState;if(this._steadyStates[i]===n)return!1;if(n&&n._transitions&&(r=n._transitions[i]||n._transitions["*"]),!r&&this._transitions&&(r=this._transitions[i]||this._transitions["*"]),n instanceof t&&r){var a=this._transitionStates[r.type];return this._doTransition(a,n,this._steadyStates[i],r,o),!0}if(!n&&(r=this._transitions[i])){var a=this._transitionStates[r.type];if(a)return this._doTransition(a,null,this._steadyStates[i],r,o),!0}return!1},i.prototype._doTransition=function(t,e,i,o,r){if(e){t._sourceState=e;var n=o.timeWindow||[-1,-1];if(!t.isValid(n,r))return console.warn("State not in allowed time window"),void 0;e.onFinished=null}t._targetState=i,t.readFromConfig(o),t.resetClips(r),this.setCurrentState(t)},i.prototype.setCurrentState=function(t,i,o){o=o||e.time,this._currentState=t,t&&(i&&t.resetClips(o),t.onFinished=function(){this.setCurrentState(t._targetState||null),this.update()}.bind(this))},i.prototype.getCurrentState=function(){return this._currentState},i.prototype.setCurrentStateByName=function(t,e,i){if(t){var o=this._steadyStates[t];if(o)return this.setCurrentState(o,e,i),!0;console.warn("unable to find SteadyState named: "+t)}return!1},i.prototype.getCurrentSourceData=function(){return this._layerBlender?this._layerBlender.getBlendedSourceData():this._currentState?this._currentState.getCurrentSourceData():null},i.prototype.updateLayerBlending=function(t){this._layerBlender&&(this._layerBlender._layerA=t,this._layerBlender._layerB=this)},i.prototype.clearCurrentState=function(){this.setCurrentState(null)},i.prototype.resetClips=function(t){this._currentState&&this._currentState.resetClips(t||e.time)},i.prototype.shiftClipTime=function(t){this._currentState&&this._currentState.shiftClipTime(t||0)},i.prototype.setTimeScale=function(t){this._currentState&&this._currentState.setTimeScale(t)},i.prototype.clone=function(){var t=new i(this._name);for(var e in this._steadyStates)t._steadyStates[e]=this._steadyStates[e].clone(),this._steadyStates[e]===this._currentState&&(t._currentState=t._steadyStates[e]);for(var e in this._transitions)t._transitions[e]=this._transitions[e];for(var e in this._transitionStates)t._transitionStates[e]=new this._transitionStates[e].constructor;return t},i}),define("goo/math/Quaternion",["goo/math/Vector","goo/math/Vector3","goo/math/Matrix3x3","goo/math/MathUtils"],function(t,e,i,o){"use strict";function r(){t.call(this,4),0!==arguments.length?this.set(arguments):this.setd(0,0,0,1)}return r.prototype=Object.create(t.prototype),r.prototype.setupAliases([["x"],["y"],["z"],["w"]]),r.IDENTITY=new r(0,0,0,1),r.ALLOWED_DEVIANCE=1e-8,r.add=function(t,e,i){return i||(i=new r),i.data[0]=t.data[0]+e.data[0],i.data[1]=t.data[1]+e.data[1],i.data[2]=t.data[2]+e.data[2],i.data[3]=t.data[3]+e.data[3],i},r.sub=function(t,e,i){return i||(i=new r),i.data[0]=t.data[0]-e.data[0],i.data[1]=t.data[1]-e.data[1],i.data[2]=t.data[2]-e.data[2],i.data[3]=t.data[3]-e.data[3],i},r.mul=function(t,e,i){return i||(i=new r),i.data[0]=t.data[0]*e.data[0],i.data[1]=t.data[1]*e.data[1],i.data[2]=t.data[2]*e.data[2],i.data[3]=t.data[3]*e.data[3],i},r.mul2=function(t,e,i){var o=t.data[0],r=t.data[1],n=t.data[2],a=t.data[3],s=e.data[0],c=e.data[1],l=e.data[2],h=e.data[3];return i.data[0]=o*h+a*s+r*l-n*c,i.data[1]=r*h+a*c+n*s-o*l,i.data[2]=n*h+a*l+o*c-r*s,i.data[3]=a*h-o*s-r*c-n*l,i},r.div=function(t,e,i){i||(i=new r);var o=!0;return i.data[0]=(o&=e.data[0]<0||e.data[0]>0)?t.data[0]/e.data[0]:0,i.data[1]=(o&=e.data[1]<0||e.data[1]>0)?t.data[1]/e.data[1]:0,i.data[2]=(o&=e.data[2]<0||e.data[2]>0)?t.data[2]/e.data[2]:0,i.data[3]=(o&=e.data[3]<0||e.data[3]>0)?t.data[3]/e.data[3]:0,o===!1&&console.warn("[Quaternion.div] Attempted to divide by zero!"),i},r.scalarAdd=function(t,e,i){return i||(i=new r),i.data[0]=t.data[0]+e,i.data[1]=t.data[1]+e,i.data[2]=t.data[2]+e,i.data[3]=t.data[3]+e,i},r.scalarSub=function(t,e,i){return i||(i=new r),i.data[0]=t.data[0]-e,i.data[1]=t.data[1]-e,i.data[2]=t.data[2]-e,i.data[3]=t.data[3]-e,i},r.scalarMul=function(t,e,i){return i||(i=new r),i.data[0]=t.data[0]*e,i.data[1]=t.data[1]*e,i.data[2]=t.data[2]*e,i.data[3]=t.data[3]*e,i},r.scalarDiv=function(t,e,i){i||(i=new r);var o=!0;return e=(o&=0>e||e>0)?1/e:0,i.data[0]=t.data[0]*e,i.data[1]=t.data[1]*e,i.data[2]=t.data[2]*e,i.data[3]=t.data[3]*e,o===!1&&console.warn("[Quaternion.scalarDiv] Attempted to divide by zero!"),i},r.slerp=function(t,e,i,o){if(0===i)return o.setv(t);if(1===i)return o.setv(e);if(t.equals(e))return o.setv(t);var r=t.dot(e);o.setv(e),0>r&&(o.negate(),r=-r);var n=1-i,a=i;if(1-r>.1){var s=Math.acos(r),c=1/Math.sin(s);n=Math.sin((1-i)*s)*c,a=Math.sin(i*s)*c}var l=n*t.data[0]+a*o.data[0],h=n*t.data[1]+a*o.data[1],u=n*t.data[2]+a*o.data[2],d=n*t.data[3]+a*o.data[3];return o.setd(l,h,u,d),o},r.prototype.negate=function(){return this.data[0]*=-1,this.data[1]*=-1,this.data[2]*=-1,this.data[3]*=-1,this},r.prototype.dot=function(t){var e=this.data,i=t.data||t,o=0;return o+=e[0]*i[0],o+=e[1]*i[1],o+=e[2]*i[2],o+=e[3]*i[3]},r.prototype.add=function(t){return r.add(this,t,this)},r.prototype.sub=function(t){return r.sub(this,t,this)},r.prototype.mul=function(t){return r.mul(this,t,this)},r.prototype.div=function(t){return r.div(this,t,this)},r.prototype.scalarAdd=function(t){return r.scalarAdd(this,t,this)},r.prototype.scalarSub=function(t){return r.scalarSub(this,t,this)},r.prototype.scalarMul=function(t){return r.scalarMul(this,t,this)},r.prototype.scalarDiv=function(t){return r.scalarDiv(this,t,this)},r.prototype.slerp=function(t,e){var i=(new r).copy(t);return r.slerp(this,t,e,i),this.copy(i),this},r.prototype.fromRotationMatrix=function(t){var e,i,o,r,n=t.e00+t.e11+t.e22;if(n>=0){var a=Math.sqrt(n+1);r=.5*a,a=.5/a,e=(t.e21-t.e12)*a,i=(t.e02-t.e20)*a,o=(t.e10-t.e01)*a}else if(t.e00>t.e11&&t.e00>t.e22){var a=Math.sqrt(1+t.e00-t.e11-t.e22);e=.5*a,a=.5/a,i=(t.e10+t.e01)*a,o=(t.e02+t.e20)*a,r=(t.e21-t.e12)*a}else if(t.e11>t.e22){var a=Math.sqrt(1+t.e11-t.e00-t.e22);i=.5*a,a=.5/a,e=(t.e10+t.e01)*a,o=(t.e21+t.e12)*a,r=(t.e02-t.e20)*a}else{var a=Math.sqrt(1+t.e22-t.e00-t.e11);o=.5*a,a=.5/a,e=(t.e02+t.e20)*a,i=(t.e21+t.e12)*a,r=(t.e10-t.e01)*a}return this.set(e,i,o,r)},r.prototype.toRotationMatrix=function(t){var e=t;e||(e=new i);var o=this.magnitudeSquared(),r=o>0?2/o:0,n=this.data,a=n[0]*r,s=n[1]*r,c=n[2]*r,l=n[0]*a,h=n[0]*s,u=n[0]*c,d=n[3]*a,p=n[1]*s,f=n[1]*c,m=n[3]*s,g=n[2]*c,v=n[3]*c,y=e.data;return y[0]=1-(p+g),y[1]=h+v,y[2]=u-m,y[3]=h-v,y[4]=1-(l+g),y[5]=f+d,y[6]=u+m,y[7]=f-d,y[8]=1-(l+p),e},r.prototype.fromVectorToVector=function(t,i){var n=t,a=i,s=n.length()*a.length();if(Math.abs(s)>o.EPSILON){var c=new e,l=n.dot(a)/s,h=Math.acos(Math.max(-1,Math.min(l,1)));if(n.cross(a,c),0>l&&c.length()<o.EPSILON){var u;u=Math.abs(n.x)>Math.abs(n.y)?Math.abs(n.x)>Math.abs(n.z)?0:2:Math.abs(n.y)>Math.abs(n.z)?1:2,c.setValue(u,-n[(u+1)%3]),c.setValue((u+1)%3,n[u]),c.setValue((u+2)%3,0)}return this.fromAngleAxis(h,c)}return this.set(r.IDENTITY)},r.prototype.normalize=function(){var t=1/this.magnitude(),e=this.x*t,i=this.y*t,o=this.z*t,r=this.w*t;return this.set(e,i,o,r)},r.prototype.magnitude=function(){var t=this.data[0]*this.data[0]+this.data[1]*this.data[1]+this.data[2]*this.data[2]+this.data[3]*this.data[3];return 1===t?1:Math.sqrt(t)},r.prototype.magnitudeSquared=function(){return this.data[0]*this.data[0]+this.data[1]*this.data[1]+this.data[2]*this.data[2]+this.data[3]*this.data[3]},r.prototype.fromAngleAxis=function(t,i){var o=new e(i).normalize();return this.fromAngleNormalAxis(t,o)},r.prototype.fromAngleNormalAxis=function(t,i){if(i.equals(e.ZERO))return this.set(r.IDENTITY);var n=.5*t,a=o.sin(n),s=o.cos(n),c=a*i.getX(),l=a*i.getY(),h=a*i.getZ();return this.set(c,l,h,s)},r.prototype.toAngleAxis=function(t){var e,i=this.x*this.x+this.y*this.y+this.z*this.z;if(Math.abs(i)<=r.ALLOWED_DEVIANCE)e=0,null!==t&&(t.x=1,t.y=0,t.z=0);else if(e=2*Math.acos(this.w),null!==t){var o=1/Math.sqrt(i);t.x=this.x*o,t.y=this.y*o,t.z=this.z*o}return e},r.prototype.equals=function(t){return this===t?!0:!t instanceof r?!1:Math.abs(this.data[0]-t.data[0])<r.ALLOWED_DEVIANCE&&Math.abs(this.data[1]-t.data[1])<r.ALLOWED_DEVIANCE&&Math.abs(this.data[2]-t.data[2])<r.ALLOWED_DEVIANCE&&Math.abs(this.data[3]-t.data[3])<r.ALLOWED_DEVIANCE},r.prototype.setd=function(t,e,i,o){return this.data[0]=t,this.data[1]=e,this.data[2]=i,this.data[3]=o,this},r.prototype.seta=function(t){return this.data[0]=t[0],this.data[1]=t[1],this.data[2]=t[2],this.data[3]=t[3],this},r.prototype.setv=function(t){return this.data[0]=t.data[0],this.data[1]=t.data[1],this.data[2]=t.data[2],this.data[3]=t.data[3],this},r}),define("goo/animation/clip/TransformData",["goo/math/Quaternion","goo/math/Vector3"],function(t,e){"use strict";function i(i){this._rotation=(new t).copy(i?i._rotation:t.IDENTITY),this._scale=(new e).copy(i?i._scale:e.ONE),this._translation=(new e).copy(i?i._translation:e.ZERO)}return i.prototype.applyTo=function(t){t.setIdentity(),t.rotation.copyQuaternion(this._rotation),t.scale.setv(this._scale),t.translation.setv(this._translation),t.update()},i.prototype.set=function(t){this._rotation.copy(t._rotation),this._scale.copy(t._scale),this._translation.copy(t._translation)},i.prototype.blend=function(e,o,r){var n=r?r:new i;return n._translation.setv(this._translation).lerp(e._translation,o),n._scale.setv(this._scale).lerp(e._scale,o),t.slerp(this._rotation,e._rotation,o,n._rotation),n},i}),define("goo/animation/clip/JointData",["goo/animation/clip/TransformData"],function(t){"use strict";function e(e){t.call(this,e),this._jointIndex=e?e._jointIndex:0}return e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.prototype.set=function(e){t.prototype.set.call(this,e),this._jointIndex=e._jointIndex},e.prototype.blend=function(i,o,r){var n=r;return n?n instanceof e&&(n._jointIndex=this._jointIndex):(n=new e,n._jointIndex=this._jointIndex),t.prototype.blend.call(this,i,o,n)},e.prototype.clone=function(){return new e(this)},e}),define("goo/animation/clip/TriggerData",[],function(){"use strict";function t(){this._currentTriggers=[],this._currentIndex=-1,this.armed=!1}return t.prototype.arm=function(t,e){if(null===e||0===e.length)this._currentTriggers.length=0,this.armed=!1;else if(t!==this._currentIndex){this._currentTriggers.length=0;for(var i=0,o=e.length;o>i;i++)e[i]&&""!==e[i]&&this._currentTriggers.push(e[i]);this.armed=!0}this._currentIndex=t},t}),define("goo/entities/components/AnimationComponent",["goo/entities/components/Component","goo/entities/World","goo/animation/layer/AnimationLayer","goo/animation/clip/JointData","goo/animation/clip/TransformData","goo/animation/clip/TriggerData"],function(t,e,i,o,r,n){"use strict";function a(t){this.type="AnimationComponent",this.layers=[],this.floats={},this._updateRate=1/60,this._lastUpdate=0,this._triggerCallbacks={};var e=new i(i.BASE_LAYER_NAME);this.layers.push(e),this._skeletonPose=t,this.paused=!1,this.lastTimeOfPause=null}return a.prototype=Object.create(t.prototype),a.prototype.transitionTo=function(t,e){return this.layers[0].transitionTo(t)?!0:e?this.layers[0].setCurrentStateByName(t):!1},a.prototype.getStates=function(){return this.layers[0].getStates()},a.prototype.getCurrentState=function(){return this.layers[0].getCurrentState()},a.prototype.getTransitions=function(){return this.layers[0].getTransitions()},a.prototype.update=function(t){if(!this.paused){if(t=t||e.time,0!==this._updateRate){if(t>this._lastUpdate&&t-this._lastUpdate<this._updateRate)return;this._lastUpdate=t-(t-this._lastUpdate)%this._updateRate}for(var i=0,o=this.layers.length;o>i;i++)this.layers[i].update(t)}},a.prototype.apply=function(t){var e=this.getCurrentSourceData(),i=this._skeletonPose;if(e){for(var a in e){var s=e[a];if(s instanceof o)i&&s._jointIndex>=0&&s.applyTo(i._localTransforms[s._jointIndex]);else if(s instanceof r)t&&(s.applyTo(t.transform),t.updateTransform(),this._updateWorldTransform(t));else if(s instanceof n){if(s.armed){for(var c=0,l=s._currentTriggers.length;l>c;c++){var h=this._triggerCallbacks[s._currentTriggers[c]];if(h&&h.length)for(var u=0,d=h.length;d>u;u++)h[u]()}s.armed=!1}}else s instanceof Array&&(this.floats[a]=s[0])}i&&i.updateTransforms()}},a.prototype._updateWorldTransform=function(t){t.updateWorldTransform();for(var e=0;e<t.children.length;e++)this._updateWorldTransform(t.children[e])},a.prototype.postUpdate=function(){for(var t=0,e=this.layers.length;e>t;t++)this.layers[t].postUpdate()},a.prototype.getCurrentSourceData=function(){if(0===this.layers.length)return[];var t=this.layers.length-1;this.layers[0]._layerBlender=null;for(var e=0;t>e;e++)this.layers[e+1].updateLayerBlending(this.layers[e]);return this.layers[t].getCurrentSourceData()},a.prototype.addLayer=function(t,e){isNaN(e)?this.layers.push(t):this.layers.splice(e,0,t)},a.prototype.resetClips=function(t){for(var e=0;e<this.layers.length;e++)this.layers[e].resetClips(t)},a.prototype.shiftClipTime=function(t){for(var e=0;e<this.layers.length;e++)this.layers[e].shiftClipTime(t)},a.prototype.setTimeScale=function(t){for(var e=0;e<this.layers.length;e++)this.layers[e].setTimeScale(t)},a.prototype.pause=function(){this.paused||(this.lastTimeOfPause=e.time,this.paused=!0)},a.prototype.stop=function(){this._skeletonPose&&this._skeletonPose.setToBindPose(),this.paused=!0,this.lastTimeOfPause=-1},a.prototype.resume=function(){this.paused&&(-1===this.lastTimeOfPause?this.resetClips():this.shiftClipTime(e.time-this.lastTimeOfPause)),this.paused=!1},a.prototype.clone=function(){var t=new a;return t.layers=this.layers.map(function(t){return t.clone()}),t},a}),define("goo/entities/EntityUtils",["goo/entities/components/TransformComponent","goo/entities/components/MeshDataComponent","goo/entities/components/MeshRendererComponent","goo/entities/components/CameraComponent","goo/entities/components/LightComponent","goo/entities/components/ScriptComponent","goo/renderer/Camera","goo/renderer/light/Light","goo/renderer/Material","goo/renderer/MeshData","goo/renderer/bounds/BoundingBox","goo/math/Transform","goo/entities/components/CSSTransformComponent","goo/entities/components/AnimationComponent"],function(t,e,i,o,r,n,a,s,c,l,h,u,d,p){"use strict";function f(){}function m(t,e){e.skeletonMap=e.skeletonMap||{originals:[],clones:[]};var i,o=e.skeletonMap.originals.indexOf(t);return-1===o?(i=t.clone(),e.skeletonMap.originals.push(t),e.skeletonMap.clones.push(i)):i=e.skeletonMap.clones[o],i}function g(o,r,n){for(var a=o.createEntity(r.name),s=0;s<r._components.length;s++){var c=r._components[s];if(c instanceof t)a.transformComponent.transform.copy(c.transform);else if(c instanceof e){var l=new e(c.meshData);l.modelBound=new c.modelBound.constructor,c.currentPose&&(l.currentPose=m(c.currentPose,n)),a.setComponent(l)}else if(c instanceof i){for(var h=new i,u=0;u<c.materials.length;u++)h.materials.push(c.materials[u]);a.setComponent(h)}else if(c instanceof p){var d=c.clone();d._skeletonPose=m(c._skeletonPose,n),a.setComponent(d)}else a.setComponent(c)}for(var u=0;u<r.transformComponent.children.length;u++){var f=r.transformComponent.children[u],v=g(o,f.entity,n);a.transformComponent.attachChild(v.transformComponent)}return n.callback&&n.callback(a),a}return f.clone=function(t,e,i){return i=i||{},i.shareData=i.shareData||!0,i.shareMaterial=i.shareMaterial||!0,i.cloneHierarchy=i.cloneHierarchy||!0,g(t,e,i)},f.traverse=function(t,e,i){if(i=void 0!==i?i:0,e(t,i)!==!1)for(var o=0;o<t.transformComponent.children.length;o++){var r=t.transformComponent.children[o];f.traverse(r.entity,e,i+1)}},f.getRoot=function(t){for(;t.transformComponent.parent;)t=t.transformComponent.parent.entity;return t},f.updateWorldTransform=function(t){t.updateWorldTransform();for(var e=0;e<t.children.length;e++)f.updateWorldTransform(t.children[e])},f.show=function(t){t.hidden=!1;for(var e=t;e.transformComponent.parent;)if(e=e.transformComponent.parent.entity,e.hidden)return t.meshRendererComponent&&(t.meshRendererComponent.hidden=!0),void 0;f.traverse(t,function(t){return t.hidden?!1:(t.meshRendererComponent&&(t.meshRendererComponent.hidden=t.hidden),t.lightComponent&&(t.lightComponent.hidden=t.hidden),void 0)})},f.hide=function(t){t.hidden=!0,f.traverse(t,function(t){t.meshRendererComponent&&(t.meshRendererComponent.hidden=!0),t.lightComponent&&(t.lightComponent.hidden=!0)})},f.createTypicalEntity=function(t){for(var h=t.createEntity(),d=1;d<arguments.length;d++){var p=arguments[d];if(p instanceof l){var f=new e(p);if(h.setComponent(f),!h.hasComponent("MeshRendererComponent")){var m=new i;h.setComponent(m)}}else if(p instanceof c){if(!h.hasComponent("MeshRendererComponent")){var m=new i;h.setComponent(m)}h.meshRendererComponent.materials.push(p)}else if(p instanceof s){var g=new r(p);h.setComponent(g)}else if(p instanceof a){var v=new o(p);h.setComponent(v)}else p instanceof u?h.transformComponent.transform=p:"string"==typeof p?h.name=p:Array.isArray(p)&&3===p.length?h.transformComponent.transform.translation.setd(p[0],p[1],p[2]):"function"==typeof p.run&&(h.hasComponent("ScriptComponent")||h.setComponent(new n),h.scriptComponent.scripts.push(p))}return h},f.createDOMEntity=function(t,e){var i=t.createEntity();return i.setComponent(new d(e)),i},f.getChildren=function(t){return t.transformComponent.children.map(function(t){return t.entity})},f.getTotalBoundingBox=function(t){var e=new h,i=!0;if(f.traverse(t,function(t){if(t.meshRendererComponent)if(i){var o=t.meshRendererComponent.worldBound;o instanceof h?o.clone(e):(e.center.setv(o.center),e.xExtent=e.yExtent=e.zExtent=o.radius),i=!1}else e.merge(t.meshRendererComponent.worldBound)}),i){var o=t.transformComponent.worldTransform.translation;e=new h(o.clone(),.001,.001,.001)}return e},f}),define("goo/addons/ammo/calculateTriangleMeshShape",[],function(){"use strict";var t=window.Ammo;return function(e,i){i=i||[1,1,1];for(var o=4,r=!0,n=r?4:2,a=r?"i32":"i16",s=e.meshDataComponent.meshData,c=s.dataViews.POSITION,l=t.allocate(o*c.length,"float",t.ALLOC_NORMAL),h=0,u=c.length;u>h;h++)t.setValue(l+h*o,i[h%3]*c[h],"float");for(var d=s.indexData.data,p=t.allocate(n*d.length,a,t.ALLOC_NORMAL),h=0,u=d.length;u>h;h++)t.setValue(p+h*n,d[h],a);var f=new t.btIndexedMesh;f.set_m_numTriangles(s.indexCount/3),f.set_m_triangleIndexBase(p),f.set_m_triangleIndexStride(3*n),f.set_m_numVertices(s.vertexCount),f.set_m_vertexBase(l),f.set_m_vertexStride(3*o);var m=new t.btTriangleIndexVertexArray;return m.addIndexedMesh(f,2),new t.btBvhTriangleMeshShape(m,!0,!0)}}),define("goo/util/Enum",[],function(){"use strict";function t(t,e){return Object.getOwnPropertyNames(e).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(e,i))}),t}function e(e,i){this.name=e,i&&t(this,i),Object.freeze(this)}function i(t){1===arguments.length&&null!==t&&"object"==typeof t?Object.keys(t).forEach(function(i){this[i]=new e(i,t[i])},this):Array.prototype.forEach.call(arguments,function(t){this[t]=new e(t)},this),Object.freeze(this)}return e.prototype=Object.create(null),e.prototype.constructor=e,e.prototype.toString=function(){return"|"+this.name+"|"},Object.freeze(e.prototype),i.prototype.symbols=function(){return Object.keys(this).map(function(t){return this[t]},this)},i.prototype.contains=function(t){return!t instanceof e?!1:this[t.name]===t},i}),define("goo/shapes/Box",["goo/renderer/MeshData","goo/util/Enum"],function(t,e){"use strict";function i(e,o,r,n,a,s){if(1===arguments.length&&arguments[0]instanceof Object){var c=arguments[0];e=c.width,o=c.height,r=c.length,n=c.tileX,a=c.tileY,s=c.textureMode}this.xExtent=void 0!==e?.5*e:.5,this.yExtent=void 0!==o?.5*o:.5,this.zExtent=void 0!==r?.5*r:.5,this.tileX=n||1,this.tileY=a||1,"string"==typeof s&&(s=i.TextureModes[s]),this.textureMode=void 0!==s?s:i.TextureModes.Uniform;var l=t.defaultMap([t.POSITION,t.NORMAL,t.TEXCOORD0]);t.call(this,l,24,36),this.rebuild()}return i.prototype=Object.create(t.prototype),i.prototype.rebuild=function(){function e(t){for(var e=0;e<t.length;e++){var i=3*t[e];h.push(l[i]),h.push(l[i+1]),h.push(l[i+2])}}function o(){for(var t=0;t<u.length/3;t++)for(var e=0;4>e;e++){var i=3*t;d.push(u[i]),d.push(u[i+1]),d.push(u[i+2])}}var r=this.xExtent,n=this.yExtent,a=this.zExtent,s=this.tileX,c=this.tileY,l=[-r,-n,-a,r,-n,-a,r,n,-a,-r,n,-a,r,-n,a,-r,-n,a,r,n,a,-r,n,a],h=[];e([0,1,2,3,1,4,6,2,4,5,7,6,5,0,3,7,2,6,7,3,0,5,4,1]),this.getAttributeBuffer(t.POSITION).set(h);var u=[0,0,-1,1,0,0,0,0,1,-1,0,0,0,1,0,0,-1,0],d=[];o(),this.getAttributeBuffer(t.NORMAL).set(d);var p=[];if(this.textureMode===i.TextureModes.Uniform)for(var f=0;6>f;f++)p.push(s),p.push(0),p.push(0),p.push(0),p.push(0),p.push(c),p.push(s),p.push(c);else p.push(1,1/3,.75,1/3,.75,2/3,1,2/3),p.push(.75,1/3,.5,1/3,.5,2/3,.75,2/3),p.push(.5,1/3,.25,1/3,.25,2/3,.5,2/3),p.push(.25,1/3,0,1/3,0,2/3,.25,2/3),p.push(.5,1,.5,2/3,.25,2/3,.25,1),p.push(.25,0,.25,1/3,.5,1/3,.5,0);return this.getAttributeBuffer(t.TEXCOORD0).set(p),this.getIndexBuffer().set([2,1,0,3,2,0,6,5,4,7,6,4,10,9,8,11,10,8,14,13,12,15,14,12,18,17,16,19,18,16,22,21,20,23,22,20]),this},i.TextureModes=new e("Uniform","Unfolded"),i}),define("goo/shapes/Quad",["goo/renderer/MeshData"],function(t){"use strict";function e(e,i,o,r){if(1===arguments.length&&arguments[0]instanceof Object){var n=arguments[0];e=n.width,i=n.height,o=n.tileX,r=n.tileY}this.xExtent=void 0!==e?.5*e:.5,this.yExtent=void 0!==i?.5*i:.5,this.tileX=o||1,this.tileY=r||1;var a=t.defaultMap([t.POSITION,t.NORMAL,t.TEXCOORD0]);t.call(this,a,4,6),this.rebuild()}return e.prototype=Object.create(t.prototype),e.prototype.rebuild=function(){var e=this.xExtent,i=this.yExtent,o=this.tileX,r=this.tileY;return this.getAttributeBuffer(t.POSITION).set([-e,-i,0,-e,i,0,e,i,0,e,-i,0]),this.getAttributeBuffer(t.NORMAL).set([0,0,1,0,0,1,0,0,1,0,0,1]),this.getAttributeBuffer(t.TEXCOORD0).set([0,0,0,r,o,r,o,0]),this.getIndexBuffer().set([0,3,1,1,3,2]),this},e}),define("goo/shapes/Sphere",["goo/renderer/MeshData","goo/util/Enum","goo/math/Vector3","goo/math/MathUtils"],function(t,e,i,o){"use strict";function r(e,i,o,n){if(1===arguments.length&&arguments[0]instanceof Object){var a=arguments[0];e=a.zSamples,i=a.radialSamples,o=a.radius,n=a.textureMode}this.zSamples=(void 0!==e?e:8)+1,this.radialSamples=void 0!==i?i:8,this.radius=void 0!==o?o:.5,"string"==typeof n&&(n=r.TextureModes[n]),this.textureMode=void 0!==n?n:r.TextureModes.Polar,this.viewInside=!1;var s=t.defaultMap([t.POSITION,t.NORMAL,t.TEXCOORD0]),c=this.textureMode===r.TextureModes.Chromeball?this.zSamples+1:this.zSamples;this._useSharedPoleVertices=this.textureMode!==r.TextureModes.Projected&&this.textureMode!==r.TextureModes.Linear;var l=this._useSharedPoleVertices?2:0,h=(c-l)*(this.radialSamples+1)+l,u=6*(c-2)*this.radialSamples;t.call(this,s,h,u),this.rebuild()}function n(t,e,i){t[3*i+0]=t[3*e+0],t[3*i+1]=t[3*e+1],t[3*i+2]=t[3*e+2]}return r.prototype=Object.create(t.prototype),r.prototype.rebuild=function(){for(var e=this.getAttributeBuffer(t.POSITION),a=this.getAttributeBuffer(t.NORMAL),s=this.getAttributeBuffer(t.TEXCOORD0),c=this.getIndexBuffer(),l=1/this.radialSamples,h=2/(this.zSamples-1),u=[],d=[],p=0;p<this.radialSamples;p++){var f=o.TWO_PI*l*p;d[p]=Math.cos(f),u[p]=Math.sin(f)}u[this.radialSamples]=u[0],d[this.radialSamples]=d[0];var m=0,g=this.zSamples;this._useSharedPoleVertices&&(m=1,g=this.zSamples-1);for(var v=0,y=new i,x=new i,w=new i,_=m;g>_;_++){var b=o.HALF_PI*(-1+h*_),S=Math.sin(b),M=this.radius*S,C=x.set(0,0,0);C.z+=M;for(var T,E=Math.sqrt(Math.abs(this.radius*this.radius-M*M)),P=v,p=0;p<this.radialSamples;p++){var D=p*l,I=w.set(d[p],u[p],0);i.mul(I,E,y),e[3*v+0]=C.x+y.x,e[3*v+1]=C.y+y.y,e[3*v+2]=C.z+y.z,T=y.set(e[3*v+0],e[3*v+1],e[3*v+2]),T.normalize(),this.viewInside?(a[3*v+0]=-T.x,a[3*v+1]=-T.y,a[3*v+2]=-T.z):(a[3*v+0]=T.x,a[3*v+1]=T.y,a[3*v+2]=T.z);var A=0;if(this._useSharedPoleVertices||_!==m&&_!==g-1||(A=.5*l),this.textureMode===r.TextureModes.Linear)s[2*v+0]=D+A,s[2*v+1]=.5*(S+1);else if(this.textureMode===r.TextureModes.Projected)s[2*v+0]=D+A,s[2*v+1]=(o.HALF_PI+Math.asin(S))/Math.PI;else if(this.textureMode===r.TextureModes.Polar){var R=(o.HALF_PI-Math.abs(b))/Math.PI,O=R*d[p]+.5,L=R*u[p]+.5;s[2*v+0]=O,s[2*v+1]=L}else if(this.textureMode===r.TextureModes.Chromeball){var R=Math.sin((o.HALF_PI+b)/2);R/=2;var O=R*d[p]+.5,L=R*u[p]+.5;s[2*v+0]=O,s[2*v+1]=L
}v++}if(n(e,P,v),n(a,P,v),this.textureMode===r.TextureModes.Linear)s[2*v+0]=1,s[2*v+1]=.5*(S+1);else if(this.textureMode===r.TextureModes.Projected)s[2*v+0]=1,s[2*v+1]=(o.HALF_PI+Math.asin(S))/Math.PI;else if(this.textureMode===r.TextureModes.Polar){var R=(o.HALF_PI-Math.abs(b))/Math.PI;s[2*v+0]=R+.5,s[2*v+1]=.5}else if(this.textureMode===r.TextureModes.Chromeball){var R=Math.sin((o.HALF_PI+b)/2);R/=2,s[2*v+0]=R+.5,s[2*v+1]=.5}v++}if(this.textureMode===r.TextureModes.Chromeball){for(var N=o.HALF_PI-.001,k=this.radius*Math.sin(N),F=Math.sqrt(Math.abs(this.radius*this.radius-k*k)),P=v,p=0;p<this.radialSamples;p++){e[3*v+0]=F*d[p],e[3*v+1]=F*u[p],e[3*v+2]=k;var T=y.set(e[3*v+0],e[3*v+1],e[3*v+2]);T.normalize(),this.viewInside?(a[3*v+0]=-T.x,a[3*v+1]=-T.y,a[3*v+2]=-T.z):(a[3*v+0]=T.x,a[3*v+1]=T.y,a[3*v+2]=T.z);var R=Math.sin((o.HALF_PI+N)/2);R/=2;var O=R*d[p]+.5,L=R*u[p]+.5;s[2*v+0]=O,s[2*v+1]=L,v++}n(e,P,v),n(a,P,v);var R=Math.sin((o.HALF_PI+N)/2);R/=2,s[2*v+0]=R+.5,s[2*v+1]=.5,v++}this._useSharedPoleVertices&&(e[3*v+0]=0,e[3*v+1]=0,e[3*v+2]=-this.radius,this.viewInside?(a[3*v+0]=0,a[3*v+1]=0,a[3*v+2]=1):(a[3*v+0]=0,a[3*v+1]=0,a[3*v+2]=-1),this.textureMode===r.TextureModes.Polar||this.textureMode===r.TextureModes.Chromeball?(s[2*v+0]=.5,s[2*v+1]=.5):(s[2*v+0]=.5,s[2*v+1]=0),v++,e[3*v+0]=0,e[3*v+1]=0,e[3*v+2]=this.radius,this.viewInside?(a[3*v+0]=0,a[3*v+1]=0,a[3*v+2]=-1):(a[3*v+0]=0,a[3*v+1]=0,a[3*v+2]=1),this.textureMode===r.TextureModes.Polar?(s[2*v+0]=.5,s[2*v+1]=.5):this.textureMode===r.TextureModes.Chromeball?(s[2*v+0]=1,s[2*v+1]=-.5):(s[2*v+0]=.5,s[2*v+1]=1));var B=0,U=this.textureMode===r.TextureModes.Chromeball?this.zSamples+1:this.zSamples,z=0;this._useSharedPoleVertices||(z=this.radialSamples+1);for(var _=0;U-3>_;_++){var V=z,j=V+1;z+=this.radialSamples+1;for(var X=z,H=X+1,v=0;v<this.radialSamples;v++)this.viewInside?(c[B++]=V++,c[B++]=X,c[B++]=j,c[B++]=j++,c[B++]=X++,c[B++]=H++):(c[B++]=V++,c[B++]=j,c[B++]=X,c[B++]=j++,c[B++]=H++,c[B++]=X++)}for(var v=0;v<this.radialSamples;v++){var V,j,X;this._useSharedPoleVertices?(V=v,j=this.vertexCount-2,X=v+1):(V=v,j=v+this.radialSamples+2,X=v+this.radialSamples+1),this.viewInside?(c[B++]=V,c[B++]=X,c[B++]=j):(c[B++]=V,c[B++]=j,c[B++]=X)}for(var W=(g-m-1)*(this.radialSamples+1),v=0;v<this.radialSamples;v++){var V,j,X;this._useSharedPoleVertices?(V=v+W,j=v+1+W,X=this.vertexCount-1):(V=v+W-this.radialSamples-1,j=v+W-this.radialSamples,X=v+W),this.viewInside?(c[B++]=V,c[B++]=X,c[B++]=j):(c[B++]=V,c[B++]=j,c[B++]=X)}return this},r.TextureModes=new e("Linear","Projected","Polar","Chromeball"),r}),define("goo/shapes/Cylinder",["goo/renderer/MeshData"],function(t){"use strict";function e(e,i){if(1===arguments.length&&arguments[0]instanceof Object){var o=arguments[0];e=o.radialSamples,i=o.radius}this.radialSamples=e||8,this.radius=i||1;var r=t.defaultMap([t.POSITION,t.NORMAL,t.TEXCOORD0]);t.call(this,r,4*this.radialSamples+2+2,12*this.radialSamples),this.indexModes=["Triangles"],this.rebuild()}return e.prototype=Object.create(t.prototype),e.prototype.rebuild=function(){for(var e=[],i=[],o=[],r=[],n=2*Math.PI/this.radialSamples,a=1/this.radialSamples,s=4*this.radialSamples+2+2-1,c=0,l=0,h=0;c<this.radialSamples;c++,l+=n,h+=a){var u=Math.cos(l),d=Math.sin(l),p=u*this.radius,f=d*this.radius;e.push(p,f,.5,p,f,-.5,p,f,.5,p,f,-.5),i.push(0,0,1,0,0,-1,u,d,0,u,d,0),o.push(u/4+.25,d/4+.75,u/4+.25,d/4+.25,.5,h,1,h)}e.push(this.radius,0,.5,this.radius,0,-.5),i.push(1,0,0,1,0,0),o.push(.5,1,1,1);for(var c=0;c<this.radialSamples-1;c++)r.push(s,4*c+0,4*c+4,4*c+1,s-1,4*c+5,4*c+4+2,4*c+2,4*c+4+3,4*c+2,4*c+3,4*c+4+3);return r.push(s,4*c+0,0,4*c+1,s-1,1,4*c+4,4*c+2,4*c+5,4*c+2,4*c+3,4*c+5),e.push(0,0,-.5,0,0,.5),i.push(0,0,-.5,0,0,.5),o.push(.25,.25,.25,.75),this.getAttributeBuffer(t.POSITION).set(e),this.getAttributeBuffer(t.NORMAL).set(i),this.getAttributeBuffer(t.TEXCOORD0).set(o),this.getIndexBuffer().set(r),this},e}),define("goo/shapes/Torus",["goo/renderer/MeshData","goo/math/Vector3","goo/math/MathUtils"],function(t,e,i){"use strict";function o(e,i,o,r){if(1===arguments.length&&arguments[0]instanceof Object){var n=arguments[0];e=n.circleSamples,i=n.radialSamples,o=n.tubeRadius,r=n.centerRadius}this._circleSamples=void 0!==e?e:8,this._radialSamples=void 0!==i?i:8,this._tubeRadius=void 0!==o?o:1,this._centerRadius=void 0!==r?r:2,this.viewInside=!1;var a=t.defaultMap([t.POSITION,t.NORMAL,t.TEXCOORD0]),s=(this._circleSamples+1)*(this._radialSamples+1),c=6*this._circleSamples*this._radialSamples;t.call(this,a,s,c),this.rebuild()}function r(t,e,i){t[3*i+0]=t[3*e+0],t[3*i+1]=t[3*e+1],t[3*i+2]=t[3*e+2]}function n(t,e,i){t[2*i+0]=t[2*e+0],t[2*i+1]=t[2*e+1]}return o.prototype=Object.create(t.prototype),o.prototype.rebuild=function(){for(var o=this.getAttributeBuffer(t.POSITION),a=this.getAttributeBuffer(t.NORMAL),s=this.getAttributeBuffer(t.TEXCOORD0),c=this.getIndexBuffer(),l=1/this._circleSamples,h=1/this._radialSamples,u=0,d=new e,p=new e,f=new e,m=0;m<this._circleSamples;m++){var g=m*l,v=i.TWO_PI*g,y=Math.cos(v),x=Math.sin(v);d.set(y,x,0),e.mul(d,this._centerRadius,p);for(var w=u,_=0;_<this._radialSamples;_++){var b=_*h,S=i.TWO_PI*b,M=Math.cos(S),C=Math.sin(S);f.copy(d).mul(M),f.z=f.z+C,f.normalize(),this.viewInside?(a[3*u+0]=-f.x,a[3*u+1]=-f.y,a[3*u+2]=-f.z):(a[3*u+0]=f.x,a[3*u+1]=f.y,a[3*u+2]=f.z),f.mul(this._tubeRadius).add(p),o[3*u+0]=f.x,o[3*u+1]=f.y,o[3*u+2]=f.z,s[2*u+0]=b,s[2*u+1]=g,u++}r(o,w,u),r(a,w,u),s[2*u+0]=1,s[2*u+1]=g,u++}for(var T=0;T<=this._radialSamples;T++,u++)r(o,T,u),r(a,T,u),n(s,T,u),s[2*u+1]=1;for(var E=0,P=0,m=0;m<this._circleSamples;m++){var D=P,I=D+1;P+=this._radialSamples+1;var A=P,R=A+1;for(u=0;u<this._radialSamples;u++)this.viewInside?(c[E++]=D++,c[E++]=I,c[E++]=A,c[E++]=I++,c[E++]=R++,c[E++]=A++):(c[E++]=D++,c[E++]=A,c[E++]=I,c[E++]=I++,c[E++]=A++,c[E++]=R++)}return this},o}),define("goo/shapes/ShapeCreator",["goo/shapes/Box","goo/shapes/Quad","goo/shapes/Sphere","goo/shapes/Cylinder","goo/shapes/Torus"],function(t,e,i,o,r){"use strict";function n(){}return n.createQuad=function(t,i,o,r){return new e(t,i,o,r)},n.createBox=function(e,i,o,r,n){return new t(e,i,o,r,n)},n.createSphere=function(t,e,o,r){return new i(t,e,o,r)},n.createCylinder=function(t,e,i){return new o(t,e,i)},n.createTorus=function(t,e,i,o){return new r(t,e,i,o)},n}),define("goo/renderer/shaders/ShaderFragment",[],function(){"use strict";function t(){}return t.noisecommon=["vec4 mod289(vec4 x) {","  return x - floor(x * (1.0 / 289.0)) * 289.0;","}","vec3 mod289(vec3 x) {","  return x - floor(x * (1.0 / 289.0)) * 289.0;","}","vec2 mod289(vec2 x) {","  return x - floor(x * (1.0 / 289.0)) * 289.0;","}","vec3 permute(vec3 x) {","  return mod289(((x*34.0)+1.0)*x);","}","vec4 permute(vec4 x) {","  return mod289(((x*34.0)+1.0)*x);","}"].join("\n"),t.noise2d=[t.noisecommon,"float snoise(vec2 v)","  {","  const vec4 C = vec4(0.211324865405187,  // (3.0-sqrt(3.0))/6.0","                      0.366025403784439,  // 0.5*(sqrt(3.0)-1.0)","                     -0.577350269189626,  // -1.0 + 2.0 * C.x","                      0.024390243902439); // 1.0 / 41.0","  vec2 i  = floor(v + dot(v, C.yy) );","  vec2 x0 = v -   i + dot(i, C.xx);","  vec2 i1;","  //i1.x = step( x0.y, x0.x ); // x0.x > x0.y ? 1.0 : 0.0","  //i1.y = 1.0 - i1.x;","  i1 = (x0.x > x0.y) ? vec2(1.0, 0.0) : vec2(0.0, 1.0);","  // x0 = x0 - 0.0 + 0.0 * C.xx ;","  // x1 = x0 - i1 + 1.0 * C.xx ;","  // x2 = x0 - 1.0 + 2.0 * C.xx ;","  vec4 x12 = x0.xyxy + C.xxzz;","  x12.xy -= i1;","  i = mod289(i); // Avoid truncation effects in permutation","  vec3 p = permute( permute( i.y + vec3(0.0, i1.y, 1.0 ))","		+ i.x + vec3(0.0, i1.x, 1.0 ));","  vec3 m = max(0.5 - vec3(dot(x0,x0), dot(x12.xy,x12.xy), dot(x12.zw,x12.zw)), 0.0);","  m = m*m ;","  m = m*m ;","  vec3 x = 2.0 * fract(p * C.www) - 1.0;","  vec3 h = abs(x) - 0.5;","  vec3 ox = floor(x + 0.5);","  vec3 a0 = x - ox;","  m *= 1.79284291400159 - 0.85373472095314 * ( a0*a0 + h*h );","  vec3 g;","  g.x  = a0.x  * x0.x  + h.x  * x0.y;","  g.yz = a0.yz * x12.xz + h.yz * x12.yw;","  return 130.0 * dot(m, g);","}"].join("\n"),t.noise3d=[t.noisecommon,"vec4 taylorInvSqrt(vec4 r) {","	return 1.79284291400159 - 0.85373472095314 * r;","}","float snoise(vec3 v) {","	const vec2  C = vec2(1.0/6.0, 1.0/3.0) ;","	const vec4  D = vec4(0.0, 0.5, 1.0, 2.0);","	vec3 i  = floor(v + dot(v, C.yyy) );","	vec3 x0 =   v - i + dot(i, C.xxx) ;","	vec3 g = step(x0.yzx, x0.xyz);","	vec3 l = 1.0 - g;","	vec3 i1 = min( g.xyz, l.zxy );","	vec3 i2 = max( g.xyz, l.zxy );","	vec3 x1 = x0 - i1 + C.xxx;","	vec3 x2 = x0 - i2 + C.yyy; // 2.0*C.x = 1/3 = C.y","	vec3 x3 = x0 - D.yyy;      // -1.0+3.0*C.x = -0.5 = -D.y","	i = mod289(i); ","	vec4 p = permute( permute( permute( ","         i.z + vec4(0.0, i1.z, i2.z, 1.0 ))","       + i.y + vec4(0.0, i1.y, i2.y, 1.0 )) ","       + i.x + vec4(0.0, i1.x, i2.x, 1.0 ));","	float n_ = 0.142857142857; // 1.0/7.0","	vec3  ns = n_ * D.wyz - D.xzx;","	vec4 j = p - 49.0 * floor(p * ns.z * ns.z);  //  mod(p,7*7)","	vec4 x_ = floor(j * ns.z);","	vec4 y_ = floor(j - 7.0 * x_ );    // mod(j,N)","	vec4 x = x_ *ns.x + ns.yyyy;","	vec4 y = y_ *ns.x + ns.yyyy;","	vec4 h = 1.0 - abs(x) - abs(y);","	vec4 b0 = vec4( x.xy, y.xy );","	vec4 b1 = vec4( x.zw, y.zw );","	vec4 s0 = floor(b0)*2.0 + 1.0;","	vec4 s1 = floor(b1)*2.0 + 1.0;","	vec4 sh = -step(h, vec4(0.0));","	vec4 a0 = b0.xzyw + s0.xzyw*sh.xxyy ;","	vec4 a1 = b1.xzyw + s1.xzyw*sh.zzww ;","	vec3 p0 = vec3(a0.xy,h.x);","	vec3 p1 = vec3(a0.zw,h.y);","	vec3 p2 = vec3(a1.xy,h.z);","	vec3 p3 = vec3(a1.zw,h.w);","	vec4 norm = taylorInvSqrt(vec4(dot(p0,p0), dot(p1,p1), dot(p2, p2), dot(p3,p3)));","	p0 *= norm.x;","	p1 *= norm.y;","	p2 *= norm.z;","	p3 *= norm.w;","	vec4 m = max(0.6 - vec4(dot(x0,x0), dot(x1,x1), dot(x2,x2), dot(x3,x3)), 0.0);","	m = m * m;","	return 42.0 * dot( m*m, vec4( dot(p0,x0), dot(p1,x1), dot(p2,x2), dot(p3,x3) ) );","}"].join("\n"),t.methods={packDepth:["vec4 packDepth( const in float depth ) {","	const vec4 bit_shift = vec4( 256.0 * 256.0 * 256.0, 256.0 * 256.0, 256.0, 1.0 );","	const vec4 bit_mask  = vec4( 0.0, 1.0 / 256.0, 1.0 / 256.0, 1.0 / 256.0 );","	vec4 res = fract( depth * bit_shift );","	res -= res.xxyz * bit_mask;","	return res;","}"].join("\n"),unpackDepth:["float unpackDepth( const in vec4 rgba_depth ) {","	const vec4 bit_shift = vec4( 1.0 / ( 256.0 * 256.0 * 256.0 ), 1.0 / ( 256.0 * 256.0 ), 1.0 / 256.0, 1.0 );","	float depth = dot( rgba_depth, bit_shift );","	return depth;","}"].join("\n"),packDepth16:["vec2 packDepth16( const in float depth ) {","	const vec2 bias = vec2(1.0 / 255.0, 0.0);","	vec2 res = vec2(depth, fract(depth * 255.0));","	return res - (res.yy * bias);","}"].join("\n"),unpackDepth16:["float unpackDepth16( const in vec2 rg_depth ) {","	return rg_depth.x + (rg_depth.y / 255.0);","}"].join("\n"),hsv:["vec3 rgb2hsv(vec3 c) {","vec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);","vec4 p = mix(vec4(c.bg, K.wz), vec4(c.gb, K.xy), step(c.b, c.g));","vec4 q = mix(vec4(p.xyw, c.r), vec4(c.r, p.yzx), step(p.x, c.r));","float d = q.x - min(q.w, q.y);","float e = 1.0e-10;","return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), d / (q.x + e), q.x);","}","vec3 hsv2rgb(vec3 c){","vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);","vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);","return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);","}"].join("\n")},t}),define("goo/renderer/light/PointLight",["goo/renderer/light/Light"],function(t){"use strict";function e(){t.call(this),this.range=1e3}return e.prototype=Object.create(t.prototype),e.prototype.update=function(t){t.matrix.getTranslation(this.translation)},e}),define("goo/renderer/light/DirectionalLight",["goo/math/Vector3","goo/renderer/light/Light"],function(t,e){"use strict";function i(){e.call(this),this.direction=new t}return i.prototype=Object.create(e.prototype),i.prototype.update=function(t){t.matrix.getTranslation(this.translation),this.direction.setd(0,0,-1),t.matrix.applyPostVector(this.direction)},i}),define("goo/renderer/light/SpotLight",["goo/math/Vector3","goo/renderer/light/Light"],function(t,e){"use strict";function i(){e.call(this),this.direction=new t,this.range=1e3,this.angle=45,this.penumbra=null,this.exponent=16}return i.prototype=Object.create(e.prototype),i.prototype.update=function(t){t.matrix.getTranslation(this.translation),this.direction.setd(0,0,-1),t.matrix.applyPostVector(this.direction)},i}),define("goo/renderer/Texture",["goo/math/Vector2"],function(t){"use strict";function e(e,i,o,r){this.glTexture=null,i=i||{},this.wrapS=i.wrapS||"Repeat",this.wrapT=i.wrapT||"Repeat",this.magFilter=i.magFilter||"Bilinear",this.minFilter=i.minFilter||"Trilinear",this.anisotropy=void 0!==i.anisotropy?i.anisotropy:1,this.format=i.format||"RGBA",this.type=i.type||"UnsignedByte",this.variant="2D",this.offset=new t(i.offset||[0,0]),this.repeat=new t(i.repeat||[1,1]),this.generateMipmaps=void 0!==i.generateMipmaps?i.generateMipmaps:!0,this.premultiplyAlpha=void 0!==i.premultiplyAlpha?i.premultiplyAlpha:!1,this.unpackAlignment=void 0!==i.unpackAlignment?i.unpackAlignment:1,this.flipY=void 0!==i.flipY?i.flipY:!0,this.hasBorder=!1,this.needsUpdate=!1,this.updateCallback=null,this.readyCallback=null,e&&this.setImage(e,i,o,r)}return e.prototype.checkDataReady=function(){return this.image&&(this.image.dataReady||this.image instanceof HTMLImageElement)||null!==this.readyCallback&&this.readyCallback()},e.prototype.checkNeedsUpdate=function(){return this.needsUpdate||null!==this.updateCallback&&this.updateCallback()},e.prototype.setNeedsUpdate=function(){this.needsUpdate=!0},e.prototype.setImage=function(t,e,i,o){this.image=t;var r=t instanceof Array?t[0]:t;if(r instanceof Uint8Array||r instanceof Uint8ClampedArray||r instanceof Uint16Array||r instanceof Float32Array){if(i=i||t.width,o=o||t.height,void 0===i||void 0===o)throw"Data textures need width and height";this.image={data:t},this.image.width=i,this.image.height=o,this.image.isData=!0,this.image.dataReady=!0,r instanceof Uint8Array||r instanceof Uint8ClampedArray?e.type="UnsignedByte":r instanceof Uint16Array&&(e.type="UnsignedShort4444")}else t instanceof Array&&(this.image={data:t});this.setNeedsUpdate()},e.CUBE_FACES=["PositiveX","NegativeX","PositiveY","NegativeY","PositiveZ","NegativeZ"],e}),define("goo/util/TangentGenerator",["goo/math/Vector2","goo/math/Vector3","goo/renderer/MeshData"],function(t,e,i){"use strict";function o(){}return o.addTangentBuffer=function(o,r){function n(e){for(var i=[],o=0;o<e.length;o+=2)i.push(new t(e[o+0],e[o+1]));return i}function a(t){for(var i=[],o=0;o<t.length;o+=3)i.push(new e(t[o+0],t[o+1],t[o+2]));return i}r=r||0;var s=o.getAttributeBuffer(i.POSITION);if(s){var c=o.getAttributeBuffer(i.NORMAL);if(c){var l=o.getAttributeBuffer("TEXCOORD"+r);if(l||0===r||(l=o.getAttributeBuffer(i.TEXCOORD0)),l){var h=o.getIndexBuffer();if(h){for(var u=o.vertexCount,d=o.indexCount/3,p=[],f=[],m=0;u>m;m++)p[m]=new e,f[m]=new e;for(var g=a(s),v=a(c),y=n(l),x=0;d>x;x++){var w=h[3*x],_=h[3*x+1],b=h[3*x+2],S=g[w],M=g[_],C=g[b],T=y[w],E=y[_],P=y[b],D=M.x-S.x,I=C.x-S.x,A=M.y-S.y,R=C.y-S.y,O=M.z-S.z,L=C.z-S.z,N=E.x-T.x,k=P.x-T.x,F=E.y-T.y,B=P.y-T.y,U=1/(N*B-k*F);if(isFinite(U)!==!1){var z=new e((B*D-F*I)*U,(B*A-F*R)*U,(B*O-F*L)*U),V=new e((N*I-k*D)*U,(N*R-k*A)*U,(N*L-k*O)*U);p[w].add(z),p[_].add(z),p[b].add(z),f[w].add(V),f[_].add(V),f[b].add(V)}}o.attributeMap[i.TANGENT]=i.createAttribute(4,"Float"),o.rebuildData(o.vertexCount,o.indexCount,!0);for(var j=o.getAttributeBuffer(i.TANGENT),X=new e,H=new e,x=0;u>x;x++){var W=v[x],G=p[x],Y=W.dot(G);X.copy(G).sub(H.copy(W).mul(Y)).normalize(),j[4*x+0]=X.x,j[4*x+1]=X.y,j[4*x+2]=X.z,Y=X.copy(W).cross(G).dot(f[x]);var q=0>Y?-1:1;j[4*x+3]=q}return j}}}}},o}),define("goo/renderer/shaders/ShaderBuilder",["goo/renderer/MeshData","goo/renderer/light/PointLight","goo/renderer/light/DirectionalLight","goo/renderer/light/SpotLight","goo/renderer/Texture","goo/math/MathUtils","goo/util/TangentGenerator"],function(t,e,i,o,r,n,a){"use strict";function s(){}var c=new i;return c.translation.setd(10,10,10),c.direction.setd(1,1,1).normalize(),s.defaultLight=c,s.SKYBOX=null,s.SKYSPHERE=null,s.ENVIRONMENT_TYPE=0,s.GLOBAL_AMBIENT=[0,0,0],s.USE_FOG=!1,s.FOG_SETTINGS=[0,1e4],s.FOG_COLOR=[1,1,1],s.uber={processor:function(e,i){var o=i.meshData.attributeMap,r=i.material,n=r._textureMaps;e.defines=e.defines||{},s.SKYBOX&&r.uniforms.reflectivity>0?r.setTexture("ENVIRONMENT_CUBE",s.SKYBOX):r.getTexture("ENVIRONMENT_CUBE")&&r.removeTexture("ENVIRONMENT_CUBE"),s.SKYSPHERE&&r.uniforms.reflectivity>0?(r.setTexture("ENVIRONMENT_SPHERE",s.SKYSPHERE),e.defines.ENVIRONMENT_TYPE=s.ENVIRONMENT_TYPE):r.getTexture("ENVIRONMENT_SPHERE")&&r.removeTexture("ENVIRONMENT_SPHERE");for(var c in o)e.defines[c]||(e.defines[c]=!0);for(var l in n)if(void 0!==n[l]&&null!==n[l]&&"SHADOW_MAP"!==l&&(e.defines[l]||(e.defines[l]=!0),"DIFFUSE_MAP"===l)){var h=n[l].offset,u=n[l].repeat;e.uniforms.offsetRepeat=e.uniforms.offsetRepeat||[0,0,1,1],e.uniforms.offsetRepeat[0]=h.x,e.uniforms.offsetRepeat[1]=h.y,e.uniforms.offsetRepeat[2]=u.x,e.uniforms.offsetRepeat[3]=u.y}for(var c in e.defines)"MAX_POINT_LIGHTS"!==c&&"MAX_DIRECTIONAL_LIGHTS"!==c&&"MAX_SPOT_LIGHTS"!==c&&"SHADOW_TYPE"!==c&&"JOINT_COUNT"!==c&&"WEIGHTS"!==c&&"PHYSICALLY_BASED_SHADING"!==c&&"ENVIRONMENT_TYPE"!==c&&"WRAP_AROUND"!==c&&(o[c]||n[c]||delete e.defines[c]);i.material.uniforms.discardThreshold>=0?e.defines.DISCARD=!0:delete e.defines.DISCARD,s.USE_FOG?(e.defines.FOG=!0,e.uniforms.fogSettings=s.FOG_SETTINGS,e.uniforms.fogColor=s.FOG_COLOR):delete e.defines.FOG,e.defines.SKIP_SPECULAR=!0,e.defines.NORMAL&&e.defines.NORMAL_MAP&&!i.meshData.getAttributeBuffer(t.TANGENT)&&a.addTangentBuffer(i.meshData)}},s.light={processor:function(t,a){t.uniforms.materialAmbient=t.uniforms.materialAmbient||"AMBIENT",t.uniforms.materialEmissive=t.uniforms.materialEmissive||"EMISSIVE",t.uniforms.materialDiffuse=t.uniforms.materialDiffuse||"DIFFUSE",t.uniforms.materialSpecular=t.uniforms.materialSpecular||"SPECULAR",t.uniforms.materialSpecularPower=t.uniforms.materialSpecularPower||"SPECULAR_POWER",t.uniforms.globalAmbient=s.GLOBAL_AMBIENT,t.defines=t.defines||{};for(var c=a.lights,l=[],h=0;h<c.length;h++){var u=c[h];u instanceof e?(t.uniforms["pointLight"+h]=[u.translation.data[0],u.translation.data[1],u.translation.data[2],u.range],t.uniforms["pointLightColor"+h]=[u.color.data[0]*u.intensity,u.color.data[1]*u.intensity,u.color.data[2]*u.intensity,u.specularIntensity],l.push("P")):u instanceof i?(t.uniforms["directionalLightDirection"+h]=[u.direction.data[0],u.direction.data[1],u.direction.data[2]],t.uniforms["directionalLightColor"+h]=[u.color.data[0]*u.intensity,u.color.data[1]*u.intensity,u.color.data[2]*u.intensity,u.specularIntensity],l.push("D")):u instanceof o&&(t.uniforms["spotLight"+h]=[u.translation.data[0],u.translation.data[1],u.translation.data[2],u.range],t.uniforms["spotLightColor"+h]=[u.color.data[0]*u.intensity,u.color.data[1]*u.intensity,u.color.data[2]*u.intensity,u.specularIntensity],t.uniforms["spotLightDirection"+h]=[u.direction.data[0],u.direction.data[1],u.direction.data[2]],t.uniforms["spotLightAngle"+h]=Math.cos(u.angle*n.DEG_TO_RAD/2),t.uniforms["spotLightPenumbra"+h]=void 0!==u.penumbra?Math.sin(u.penumbra*n.DEG_TO_RAD/4):0,l.push("S"));var d=u.lightCookie instanceof r;if((d||u.shadowCaster&&a.renderable.meshRendererComponent&&a.renderable.meshRendererComponent.receiveShadows)&&u.shadowSettings.shadowData){var p=u.shadowSettings.shadowData;u.shadowCaster&&(t.uniforms["shadowMaps"+h]="SHADOW_MAP"+h,a.material.setTexture("SHADOW_MAP"+h,p.shadowResult)),d?(t.uniforms["lightCookie"+h]="LIGHT_COOKIE"+h,a.material.setTexture("LIGHT_COOKIE"+h,u.lightCookie),l.push("C"),t.defines.COOKIE=!0):t.defines.COOKIE=!1;for(var f=p.lightCamera.getViewProjectionMatrix().data,m=t.uniforms["shadowLightMatrices"+h]=t.uniforms["shadowLightMatrices"+h]||[],g=0;16>g;g++)m[g]=f[g];if(u.shadowCaster){var v=p.lightCamera.translation.data,y=t.uniforms["shadowLightPositions"+h]=t.uniforms["shadowLightPositions"+h]||[];if(y[0]=v[0],y[1]=v[1],y[2]=v[2],t.uniforms["cameraScales"+h]=1/(p.lightCamera.far-p.lightCamera.near),t.uniforms["shadowDarkness"+h]=u.shadowSettings.darkness,"PCF"===u.shadowSettings.shadowType){var x=t.uniforms["shadowMapSizes"+h]=t.uniforms["shadowMapSizes"+h]||[];x[0]=u.shadowSettings.resolution[0],x[1]=u.shadowSettings.resolution[1]}l.push("H","PCF"===u.shadowSettings.shadowType?1:"VSM"===u.shadowSettings.shadowType?2:0)}}}t.defines.LIGHT=l.join("")},builder:function(t,n){var a=[],c=[],l=[],h=[];a.push("const mat4 ScaleMatrix = mat4(0.5, 0.0, 0.0, 0.0, 0.0, 0.5, 0.0, 0.0, 0.0, 0.0, 0.5, 0.0, 0.5, 0.5, 0.5, 1.0);"),l.push("uniform vec4 materialAmbient;","uniform vec4 materialEmissive;","uniform vec4 materialDiffuse;","uniform vec4 materialSpecular;","uniform float materialSpecularPower;","uniform vec3 globalAmbient;","float ChebychevInequality(in vec2 moments, in float t) {","if ( t <= moments.x ) return 1.0;","float variance = moments.y - (moments.x * moments.x);","variance = max(variance, 0.02);","float d = t - moments.x;","return variance / (variance + d * d);","}"),h.push("#if defined(SPECULAR_MAP) && defined(TEXCOORD0)","float specularStrength = texture2D(specularMap, texCoord0).x;","#else","float specularStrength = 1.0;","#endif","vec3 totalDiffuse = vec3(0.0);","vec3 totalSpecular = vec3(0.0);");for(var u=n.lights,d=0;d<u.length;d++){var p=u[d];h.push("{","float shadow = 1.0;");var f=p.lightCookie instanceof r;(p.shadowCaster||f)&&(a.push("uniform mat4 shadowLightMatrices"+d+";","varying vec4 shadowLightDepths"+d+";"),c.push("shadowLightDepths"+d+" = ScaleMatrix * shadowLightMatrices"+d+" * worldPos;"),p.shadowCaster&&l.push("uniform sampler2D shadowMaps"+d+";","uniform vec3 shadowLightPositions"+d+";","uniform float cameraScales"+d+";","uniform float shadowDarkness"+d+";"),f&&l.push("uniform sampler2D lightCookie"+d+";"),l.push("varying vec4 shadowLightDepths"+d+";"),p.shadowCaster&&"PCF"===p.shadowSettings.shadowType&&l.push("uniform vec2 shadowMapSizes"+d+";"),h.push("vec3 depth = shadowLightDepths"+d+".xyz / shadowLightDepths"+d+".w;"),p.shadowCaster&&(h.push("depth.z = length(vWorldPos.xyz - shadowLightPositions"+d+") * cameraScales"+d+";","if (depth.x >= 0.0 && depth.x <= 1.0 && depth.y >= 0.0 && depth.y <= 1.0 && shadowLightDepths"+d+".z >= 0.0 && depth.z <= 1.0) {"),"PCF"===p.shadowSettings.shadowType?h.push("depth.z *= 0.96;","float shadowPcf = 0.0;","const float shadowDelta = 1.0 / 9.0;","float xPixelOffset = 1.0 / shadowMapSizes"+d+".x;","float yPixelOffset = 1.0 / shadowMapSizes"+d+".y;","float dx0 = -1.25 * xPixelOffset;","float dy0 = -1.25 * yPixelOffset;","float dx1 = 1.25 * xPixelOffset;","float dy1 = 1.25 * yPixelOffset;","float fDepth = 0.0;","fDepth = texture2D(shadowMaps"+d+", depth.xy + vec2(dx0, dy0)).r;","if (fDepth < depth.z) shadowPcf += shadowDelta;","fDepth = texture2D(shadowMaps"+d+", depth.xy + vec2(0.0, dy0)).r;","if (fDepth < depth.z) shadowPcf += shadowDelta;","fDepth = texture2D(shadowMaps"+d+", depth.xy + vec2(dx1, dy0)).r;","if (fDepth < depth.z) shadowPcf += shadowDelta;","fDepth = texture2D(shadowMaps"+d+", depth.xy + vec2(dx0, 0.0)).r;","if (fDepth < depth.z) shadowPcf += shadowDelta;","fDepth =  texture2D(shadowMaps"+d+", depth.xy).r;","if (fDepth < depth.z) shadowPcf += shadowDelta;","fDepth = texture2D(shadowMaps"+d+", depth.xy + vec2(dx1, 0.0)).r;","if (fDepth < depth.z) shadowPcf += shadowDelta;","fDepth = texture2D(shadowMaps"+d+", depth.xy + vec2(dx0, dy1)).r;","if (fDepth < depth.z) shadowPcf += shadowDelta;","fDepth = texture2D(shadowMaps"+d+", depth.xy + vec2(0.0, dy1)).r;","if (fDepth < depth.z) shadowPcf += shadowDelta;","fDepth = texture2D(shadowMaps"+d+", depth.xy + vec2(dx1, dy1)).r;","if (fDepth < depth.z) shadowPcf += shadowDelta;","shadow = (1.0 - shadowPcf) * (1.0 - shadowDarkness"+d+") + shadowDarkness"+d+";"):"VSM"===p.shadowSettings.shadowType?h.push("vec4 texel = texture2D(shadowMaps"+d+", depth.xy);","vec2 moments = vec2(texel.x, texel.y);","shadow = ChebychevInequality(moments, depth.z);","shadow = pow(shadow, 8.0 - shadowDarkness"+d+" * 8.0);"):h.push("depth.z *= 0.96;","float shadowDepth = texture2D(shadowMaps"+d+", depth.xy).x;","if ( depth.z > shadowDepth ) shadow = shadowDarkness"+d+";"),h.push("}","shadow = clamp(shadow, 0.0, 1.0);"))),p instanceof e?(l.push("uniform vec4 pointLight"+d+";","uniform vec4 pointLightColor"+d+";"),h.push("vec3 lVector = normalize(pointLight"+d+".xyz - vWorldPos.xyz);","float lDistance = 1.0 - min((length(pointLight"+d+".xyz - vWorldPos.xyz) / pointLight"+d+".w), 1.0);","float dotProduct = dot(N, lVector);","#ifdef WRAP_AROUND","float pointDiffuseWeightFull = max(dotProduct, 0.0);","float pointDiffuseWeightHalf = max(0.5 * dotProduct + 0.5, 0.0);","float wrapRGB = 1.0;","vec3 pointDiffuseWeight = mix(vec3(pointDiffuseWeightFull), vec3(pointDiffuseWeightHalf), wrapRGB);","#else","float pointDiffuseWeight = max(dotProduct, 0.0);","#endif","totalDiffuse += materialDiffuse.rgb * pointLightColor"+d+".rgb * pointDiffuseWeight * lDistance * shadow;","vec3 pointHalfVector = normalize(lVector + normalize(viewPosition));","float pointDotNormalHalf = max(dot(N, pointHalfVector), 0.0);","float pointSpecularWeight = pointLightColor"+d+".a * specularStrength * max(pow(pointDotNormalHalf, materialSpecularPower), 0.0);","#ifdef PHYSICALLY_BASED_SHADING","float specularNormalization = (materialSpecularPower + 2.0001 ) / 8.0;","vec3 schlick = materialSpecular.rgb + vec3(1.0 - materialSpecular.rgb) * pow(1.0 - dot(lVector, pointHalfVector), 5.0);","totalSpecular += schlick * pointLightColor"+d+".rgb * pointSpecularWeight * pointDiffuseWeight * lDistance * specularNormalization * shadow;","#else","totalSpecular += materialSpecular.rgb * pointLightColor"+d+".rgb * pointSpecularWeight * pointDiffuseWeight * lDistance * shadow;","#endif")):p instanceof i?(l.push("uniform vec4 directionalLightColor"+d+";","uniform vec3 directionalLightDirection"+d+";"),h.push("vec4 lDirection = vec4(-directionalLightDirection"+d+", 0.0);","vec3 dirVector = normalize(lDirection.xyz);","float dotProduct = dot(N, dirVector);","#ifdef WRAP_AROUND","float dirDiffuseWeightFull = max(dotProduct, 0.0);","float dirDiffuseWeightHalf = max(0.5 * dotProduct + 0.5, 0.0);","float wrapRGB = 1.0;","vec3 dirDiffuseWeight = mix(vec3(dirDiffuseWeightFull), vec3(dirDiffuseWeightHalf), wrapRGB);","#else","float dirDiffuseWeight = max(dotProduct, 0.0);","#endif","vec3 cookie = vec3(1.0);"),f&&h.push("cookie = texture2D(lightCookie"+d+", depth.xy).rgb;"),h.push("totalDiffuse += materialDiffuse.rgb * directionalLightColor"+d+".rgb * dirDiffuseWeight * shadow * cookie;","vec3 dirHalfVector = normalize(dirVector + normalize(viewPosition));","float dirDotNormalHalf = max(dot(N, dirHalfVector), 0.0);","float dirSpecularWeight = directionalLightColor"+d+".a * specularStrength * max(pow(dirDotNormalHalf, materialSpecularPower), 0.0);","#ifdef PHYSICALLY_BASED_SHADING","float specularNormalization = (materialSpecularPower + 2.0001) / 8.0;","vec3 schlick = materialSpecular.rgb + vec3(1.0 - materialSpecular.rgb) * pow(1.0 - dot(dirVector, dirHalfVector), 5.0);","totalSpecular += schlick * directionalLightColor"+d+".rgb * dirSpecularWeight * dirDiffuseWeight * specularNormalization * shadow * cookie;","#else","totalSpecular += materialSpecular.rgb * directionalLightColor"+d+".rgb * dirSpecularWeight * dirDiffuseWeight * shadow * cookie;","#endif")):p instanceof o&&(l.push("uniform vec4 spotLightColor"+d+";","uniform vec4 spotLight"+d+";","uniform vec3 spotLightDirection"+d+";","uniform float spotLightAngle"+d+";","uniform float spotLightPenumbra"+d+";"),h.push("vec3 lVector = normalize(spotLight"+d+".xyz - vWorldPos.xyz);","float lDistance = 1.0 - min((length(spotLight"+d+".xyz - vWorldPos.xyz) / spotLight"+d+".w), 1.0);","float spotEffect = dot(normalize(-spotLightDirection"+d+"), lVector);","if (spotEffect > spotLightAngle"+d+") {","if (spotLightPenumbra"+d+" > 0.0) {","spotEffect = (spotEffect - spotLightAngle"+d+") / spotLightPenumbra"+d+";","spotEffect = clamp(spotEffect, 0.0, 1.0);","} else {","spotEffect = 1.0;","}","float dotProduct = dot(N, lVector);","#ifdef WRAP_AROUND","float spotDiffuseWeightFull = max(dotProduct, 0.0);","float spotDiffuseWeightHalf = max(0.5 * dotProduct + 0.5, 0.0);","float wrapRGB = 1.0;","vec3 spotDiffuseWeight = mix(vec3(spotDiffuseWeightFull), vec3(spotDiffuseWeightHalf), wrapRGB);","#else","float spotDiffuseWeight = max(dotProduct, 0.0);","#endif","vec3 cookie = vec3(1.0);"),f&&h.push("cookie = texture2D(lightCookie"+d+", depth.xy).rgb;"),h.push("totalDiffuse += materialDiffuse.rgb * spotLightColor"+d+".rgb * spotDiffuseWeight * lDistance * spotEffect * shadow * cookie;","vec3 spotHalfVector = normalize(lVector + normalize(viewPosition));","float spotDotNormalHalf = max(dot(N, spotHalfVector), 0.0);","float spotSpecularWeight = spotLightColor"+d+".a * specularStrength * max(pow(spotDotNormalHalf, materialSpecularPower), 0.0);","#ifdef PHYSICALLY_BASED_SHADING","float specularNormalization = (materialSpecularPower + 2.0001) / 8.0;","vec3 schlick = materialSpecular.rgb + vec3(1.0 - materialSpecular.rgb) * pow(1.0 - dot(lVector, spotHalfVector), 5.0);","totalSpecular += schlick * spotLightColor"+d+".rgb * spotSpecularWeight * spotDiffuseWeight * lDistance * specularNormalization * spotEffect * shadow * cookie;","#else","totalSpecular += materialSpecular.rgb * spotLightColor"+d+".rgb * spotSpecularWeight * spotDiffuseWeight * lDistance * spotEffect * shadow * cookie;","#endif","}")),h.push("}")}h.push("#if defined(EMISSIVE_MAP) && defined(TEXCOORD0)","vec3 emissive = vec3(0.0);","#else","vec3 emissive = materialEmissive.rgb;","#endif","#ifdef SKIP_SPECULAR","final_color.xyz = final_color.xyz * (emissive + totalDiffuse + globalAmbient + materialAmbient.rgb);","#else","final_color.xyz = final_color.xyz * (emissive + totalDiffuse + globalAmbient + materialAmbient.rgb) + totalSpecular;","#endif","#if defined(EMISSIVE_MAP) && defined(TEXCOORD0)","final_color.rgb += texture2D(emissiveMap, texCoord0).rgb * materialEmissive.rgb;","#endif"),s.light.prevertex=a.join("\n"),s.light.vertex=c.join("\n"),s.light.prefragment=l.join("\n"),s.light.fragment=h.join("\n")}},s.animation={processor:function(t,e){var i=e.currentPose;t.defines=t.defines||{},i?(t.uniforms.jointPalette||(t.uniforms.jointPalette=s.animation.jointPalette),t.defines.JOINT_COUNT=Math.max(3*e.meshData.paletteMap.length,80)):delete t.defines.JOINT_COUNT},jointPalette:function(t){var e=t.meshData,i=t.currentPose;if(i){var o=i._matrixPalette,r=e.store;r||(r=new Float32Array(12*e.paletteMap.length),e.store=r);for(var n,a=0;a<e.paletteMap.length;a++){n=o[e.paletteMap[a]];for(var c=0;12>c;c++)r[12*a+c]=n.data[s.animation.order[c]]}return r}},order:[0,4,8,12,1,5,9,13,2,6,10,14],prevertex:["#ifdef JOINTIDS","attribute vec4 vertexJointIDs;","#endif","#ifdef WEIGHTS","attribute vec4 vertexWeights;","#endif","#ifdef JOINT_COUNT","uniform vec4 jointPalette[JOINT_COUNT];","#endif"].join("\n"),vertex:["#if defined(JOINT_COUNT) && defined(WEIGHTS) && defined(JOINTIDS)","int x = 3*int(vertexJointIDs.x);","int y = 3*int(vertexJointIDs.y);","int z = 3*int(vertexJointIDs.z);","int w = 3*int(vertexJointIDs.w);","mat4 mat = mat4(0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0);","mat += mat4(","	jointPalette[x+0].x, jointPalette[x+1].x, jointPalette[x+2].x, 0,","	jointPalette[x+0].y, jointPalette[x+1].y, jointPalette[x+2].y, 0,","	jointPalette[x+0].z, jointPalette[x+1].z, jointPalette[x+2].z, 0,","	jointPalette[x+0].w, jointPalette[x+1].w, jointPalette[x+2].w, 1",") * vertexWeights.x;","mat += mat4(","	jointPalette[y+0].x, jointPalette[y+1].x, jointPalette[y+2].x, 0,","	jointPalette[y+0].y, jointPalette[y+1].y, jointPalette[y+2].y, 0,","	jointPalette[y+0].z, jointPalette[y+1].z, jointPalette[y+2].z, 0,","	jointPalette[y+0].w, jointPalette[y+1].w, jointPalette[y+2].w, 1",") * vertexWeights.y;","mat += mat4(","	jointPalette[z+0].x, jointPalette[z+1].x, jointPalette[z+2].x, 0,","	jointPalette[z+0].y, jointPalette[z+1].y, jointPalette[z+2].y, 0,","	jointPalette[z+0].z, jointPalette[z+1].z, jointPalette[z+2].z, 0,","	jointPalette[z+0].w, jointPalette[z+1].w, jointPalette[z+2].w, 1",") * vertexWeights.z;","mat += mat4(","	jointPalette[w+0].x, jointPalette[w+1].x, jointPalette[w+2].x, 0,","	jointPalette[w+0].y, jointPalette[w+1].y, jointPalette[w+2].y, 0,","	jointPalette[w+0].z, jointPalette[w+1].z, jointPalette[w+2].z, 0,","	jointPalette[w+0].w, jointPalette[w+1].w, jointPalette[w+2].w, 1",") * vertexWeights.w;","wMatrix = wMatrix * mat / mat[3][3];","#ifdef NORMAL","nMatrix = nMatrix * mat / mat[3][3];","#endif","#endif"].join("\n")},s
}),define("goo/renderer/shaders/ShaderLib",["goo/renderer/MeshData","goo/renderer/Shader","goo/renderer/shaders/ShaderFragment","goo/renderer/shaders/ShaderBuilder","goo/renderer/Util","goo/entities/World"],function(t,e,i,o,r,n){"use strict";function a(){}return a.uber={processors:[o.uber.processor,o.light.processor,o.animation.processor],attributes:{vertexPosition:t.POSITION,vertexNormal:t.NORMAL,vertexTangent:t.TANGENT,vertexColor:t.COLOR,vertexUV0:t.TEXCOORD0,vertexUV1:t.TEXCOORD1,vertexJointIDs:t.JOINTIDS,vertexWeights:t.WEIGHTS},uniforms:{viewProjectionMatrix:e.VIEW_PROJECTION_MATRIX,worldMatrix:e.WORLD_MATRIX,normalMatrix:e.NORMAL_MATRIX,cameraPosition:e.CAMERA,diffuseMap:e.DIFFUSE_MAP,offsetRepeat:[0,0,1,1],normalMap:e.NORMAL_MAP,normalMultiplier:1,specularMap:e.SPECULAR_MAP,emissiveMap:e.EMISSIVE_MAP,aoMap:e.AO_MAP,lightMap:e.LIGHT_MAP,environmentCube:"ENVIRONMENT_CUBE",environmentSphere:"ENVIRONMENT_SPHERE",reflectionMap:"REFLECTION_MAP",transparencyMap:"TRANSPARENCY_MAP",opacity:1,reflectivity:0,fresnel:0,discardThreshold:-.01,fogSettings:[0,1e4],fogColor:[1,1,1],shadowDarkness:.5},builder:function(t,e){o.light.builder(t,e)},vshader:function(){return["attribute vec3 vertexPosition;","#ifdef NORMAL","attribute vec3 vertexNormal;","#endif","#ifdef TANGENT","attribute vec4 vertexTangent;","#endif","#ifdef COLOR","attribute vec4 vertexColor;","#endif","#ifdef TEXCOORD0","attribute vec2 vertexUV0;","uniform vec4 offsetRepeat;","varying vec2 texCoord0;","#endif","#ifdef TEXCOORD1","attribute vec2 vertexUV1;","varying vec2 texCoord1;","#endif","uniform mat4 viewProjectionMatrix;","uniform mat4 worldMatrix;","uniform mat4 normalMatrix;","uniform vec3 cameraPosition;","varying vec3 vWorldPos;","varying vec3 viewPosition;","#ifdef NORMAL","varying vec3 normal;","#endif","#ifdef TANGENT","varying vec3 binormal;","varying vec3 tangent;","#endif","#ifdef COLOR","varying vec4 color;","#endif",o.light.prevertex,o.animation.prevertex,"void main(void) {","mat4 wMatrix = worldMatrix;","#ifdef NORMAL","mat4 nMatrix = normalMatrix;","#endif",o.animation.vertex,"vec4 worldPos = wMatrix * vec4(vertexPosition, 1.0);","vWorldPos = worldPos.xyz;","gl_Position = viewProjectionMatrix * worldPos;","viewPosition = cameraPosition - worldPos.xyz;","#ifdef NORMAL","	normal = normalize((nMatrix * vec4(vertexNormal, 0.0)).xyz);","#endif","#ifdef TANGENT","	tangent = normalize((nMatrix * vec4(vertexTangent.xyz, 0.0)).xyz);","	binormal = cross(normal, tangent) * vec3(vertexTangent.w);","#endif","#ifdef COLOR","	color = vertexColor;","#endif","#ifdef TEXCOORD0","	texCoord0 = vertexUV0 * offsetRepeat.zw + offsetRepeat.xy;","#endif","#ifdef TEXCOORD1","	texCoord1 = vertexUV1;","#endif",o.light.vertex,"}"].join("\n")},fshader:function(){return["#ifdef DIFFUSE_MAP","uniform sampler2D diffuseMap;","#endif","#ifdef NORMAL_MAP","uniform sampler2D normalMap;","uniform float normalMultiplier;","#endif","#ifdef SPECULAR_MAP","uniform sampler2D specularMap;","#endif","#ifdef EMISSIVE_MAP","uniform sampler2D emissiveMap;","#endif","#ifdef AO_MAP","uniform sampler2D aoMap;","#endif","#ifdef LIGHT_MAP","uniform sampler2D lightMap;","#endif","#ifdef TRANSPARENCY_MAP","uniform sampler2D transparencyMap;","#endif","#if defined(ENVIRONMENT_CUBE) || defined(ENVIRONMENT_SPHERE)","#ifdef ENVIRONMENT_CUBE","uniform samplerCube environmentCube;","#else","uniform sampler2D environmentSphere;","#endif","uniform float reflectivity;","uniform float fresnel;","#ifdef REFLECTION_MAP","uniform sampler2D reflectionMap;","#endif","#endif","uniform float opacity;","#ifdef DISCARD","uniform float discardThreshold;","#endif","#ifdef FOG","uniform vec2 fogSettings;","uniform vec3 fogColor;","#endif","varying vec3 vWorldPos;","varying vec3 viewPosition;","#ifdef NORMAL","varying vec3 normal;","#endif","#ifdef TANGENT","varying vec3 binormal;","varying vec3 tangent;","#endif","#ifdef COLOR","varying vec4 color;","#endif","#ifdef TEXCOORD0","varying vec2 texCoord0;","#endif","#ifdef TEXCOORD1","varying vec2 texCoord1; //Use for lightmap","#endif",o.light.prefragment,"void main(void)","{","vec4 final_color = vec4(1.0);","#if defined(DIFFUSE_MAP) && defined(TEXCOORD0)","final_color *= texture2D(diffuseMap, texCoord0);","#endif","#ifdef COLOR","final_color *= color;","#endif","#if defined(TRANSPARENCY_MAP) && defined(TEXCOORD0)","final_color.a = texture2D(transparencyMap, texCoord0).a;","#endif","final_color.a *= opacity;","#ifdef DISCARD","if (final_color.a < discardThreshold) discard;","#endif","#ifdef AO_MAP","#ifdef TEXCOORD1","final_color.rgb *= texture2D(aoMap, texCoord1).rgb;","#elif defined(TEXCOORD0)","final_color.rgb *= texture2D(aoMap, texCoord0).rgb;","#endif","#endif","#ifdef LIGHT_MAP","#ifdef TEXCOORD1","final_color.rgb *= texture2D(lightMap, texCoord1).rgb * 2.0 - 0.5;","#elif defined(TEXCOORD0)","final_color.rgb *= texture2D(lightMap, texCoord0).rgb * 2.0 - 0.5;","#endif","#else","vec3 N = vec3(0.0, 1.0, 0.0);","#if defined(NORMAL)","N = normalize(normal);","#endif","#if defined(TANGENT) && defined(NORMAL_MAP) && defined(TEXCOORD0)","mat3 tangentToWorld = mat3(tangent, binormal, normal);","vec3 tangentNormal = texture2D(normalMap, texCoord0).xyz * vec3(2.0) - vec3(1.0);","tangentNormal.xy *= normalMultiplier;","vec3 worldNormal = (tangentToWorld * tangentNormal);","N = normalize(worldNormal);","#endif",o.light.fragment,"#endif","#if defined(ENVIRONMENT_CUBE) || defined(ENVIRONMENT_SPHERE)","vec3 reflectionVector = reflect(viewPosition, N);","reflectionVector.yz = -reflectionVector.yz;","#ifdef ENVIRONMENT_CUBE","vec4 environment = textureCube(environmentCube, reflectionVector);","#else","reflectionVector = -reflectionVector;","float m = 4.0 * sqrt(reflectionVector.x*reflectionVector.x + reflectionVector.y*reflectionVector.y + (reflectionVector.z+1.0)*(reflectionVector.z+1.0));","vec4 environment = texture2D(environmentSphere, (reflectionVector.xy / m) + 0.5);","#endif","float reflectionAmount = reflectivity;","#if defined(REFLECTION_MAP) && defined(TEXCOORD0)","reflectionAmount *= texture2D(reflectionMap, texCoord0).r;","#endif","float fresnelVal = pow(1.0 - abs(dot(normalize(viewPosition), N)), fresnel * 4.0);","reflectionAmount *= fresnelVal;","final_color = mix(final_color, environment, reflectionAmount);","#endif","#ifndef LIGHT_MAP","final_color.rgb += totalSpecular;","final_color.a += min(length(totalSpecular), 1.0);","#endif","#ifdef FOG","float d = pow(smoothstep(fogSettings.x, fogSettings.y, length(viewPosition)), 1.0);","final_color.rgb = mix(final_color.rgb, fogColor, d);","#endif","gl_FragColor = final_color;","}"].join("\n")}},a.screenCopy={attributes:{vertexPosition:t.POSITION,vertexUV0:t.TEXCOORD0},uniforms:{diffuseMap:e.DIFFUSE_MAP},vshader:["attribute vec3 vertexPosition;","attribute vec2 vertexUV0;","varying vec2 texCoord0;","void main(void) {","	texCoord0 = vertexUV0;","	gl_Position = vec4(vertexPosition, 1.0);","}"].join("\n"),fshader:["uniform sampler2D diffuseMap;","varying vec2 texCoord0;","void main(void)","{","	gl_FragColor = texture2D(diffuseMap, texCoord0);","}"].join("\n")},a.copy={attributes:{vertexPosition:t.POSITION,vertexUV0:t.TEXCOORD0},uniforms:{viewProjectionMatrix:e.VIEW_PROJECTION_MATRIX,worldMatrix:e.WORLD_MATRIX,opacity:1,diffuseMap:e.DIFFUSE_MAP},vshader:["attribute vec3 vertexPosition;","attribute vec2 vertexUV0;","uniform mat4 viewProjectionMatrix;","uniform mat4 worldMatrix;","varying vec2 texCoord0;","void main(void) {","	texCoord0 = vertexUV0;","	gl_Position = viewProjectionMatrix * worldMatrix * vec4(vertexPosition, 1.0);","}"].join("\n"),fshader:["uniform sampler2D diffuseMap;","uniform float opacity;","varying vec2 texCoord0;","void main(void)","{","	gl_FragColor = vec4(texture2D(diffuseMap, texCoord0).rgb, opacity);","}"].join("\n")},a.copyPure={attributes:{vertexPosition:t.POSITION,vertexUV0:t.TEXCOORD0},uniforms:{viewProjectionMatrix:e.VIEW_PROJECTION_MATRIX,worldMatrix:e.WORLD_MATRIX,opacity:1,diffuseMap:e.DIFFUSE_MAP},vshader:["attribute vec3 vertexPosition;","attribute vec2 vertexUV0;","uniform mat4 viewProjectionMatrix;","uniform mat4 worldMatrix;","varying vec2 texCoord0;","void main(void) {","	texCoord0 = vertexUV0;","	gl_Position = viewProjectionMatrix * worldMatrix * vec4(vertexPosition, 1.0);","}"].join("\n"),fshader:["uniform sampler2D diffuseMap;","uniform float opacity;","varying vec2 texCoord0;","void main(void)","{","	vec4 col = texture2D(diffuseMap, texCoord0);","	gl_FragColor = vec4(col.rgb, col.a * opacity);","}"].join("\n")},a.simple={attributes:{vertexPosition:t.POSITION},uniforms:{viewProjectionMatrix:e.VIEW_PROJECTION_MATRIX,worldMatrix:e.WORLD_MATRIX},vshader:["attribute vec3 vertexPosition;","uniform mat4 viewProjectionMatrix;","uniform mat4 worldMatrix;","void main(void) {","	gl_Position = viewProjectionMatrix * worldMatrix * vec4(vertexPosition, 1.0);","}"].join("\n"),fshader:["void main(void)","{","	gl_FragColor = vec4(1.0);","}"].join("\n")},a.simpleColored={attributes:{vertexPosition:t.POSITION},uniforms:{viewProjectionMatrix:e.VIEW_PROJECTION_MATRIX,worldMatrix:e.WORLD_MATRIX,color:[1,1,1],opacity:1},vshader:["attribute vec3 vertexPosition;","uniform mat4 viewProjectionMatrix;","uniform mat4 worldMatrix;","void main(void) {","	gl_Position = viewProjectionMatrix * worldMatrix * vec4(vertexPosition, 1.0);","}"].join("\n"),fshader:["uniform vec3 color;","uniform float opacity;","void main(void)","{","	if (opacity == 0.0) {","		discard;","	}","	gl_FragColor = vec4(color, opacity);","}"].join("\n")},a.simpleLit={processors:[o.light.processor],defines:{NORMAL:!0},attributes:{vertexPosition:t.POSITION,vertexNormal:t.NORMAL},uniforms:{viewProjectionMatrix:e.VIEW_PROJECTION_MATRIX,worldMatrix:e.WORLD_MATRIX,cameraPosition:e.CAMERA,opacity:1},builder:function(t,e){o.light.builder(t,e)},vshader:function(){return["attribute vec3 vertexPosition;","attribute vec3 vertexNormal;","uniform mat4 viewProjectionMatrix;","uniform mat4 worldMatrix;","uniform vec3 cameraPosition;",o.light.prevertex,"varying vec3 normal;","varying vec3 vWorldPos;","varying vec3 viewPosition;","void main(void) {","	vec4 worldPos = worldMatrix * vec4(vertexPosition, 1.0);","	vWorldPos = worldPos.xyz;","	gl_Position = viewProjectionMatrix * worldPos;",o.light.vertex,"	normal = (worldMatrix * vec4(vertexNormal, 0.0)).xyz;","	viewPosition = cameraPosition - worldPos.xyz;","}"].join("\n")},fshader:function(){return["#ifdef SPECULAR_MAP","uniform sampler2D specularMap;","#ifdef TEXCOORD0","varying vec2 texCoord0;","#endif","#endif","uniform float opacity;",o.light.prefragment,"#ifdef NORMAL","varying vec3 normal;","#endif","varying vec3 vWorldPos;","varying vec3 viewPosition;","void main(void)","{"," if (opacity == 0.0) {","	discard;"," }"," #ifdef NORMAL","	vec3 N = normalize(normal);"," #else"," vec3 N = vec3(0,0,1);"," #endif","	vec4 final_color = vec4(1.0);",o.light.fragment,"	final_color.a = opacity;","	gl_FragColor = final_color;","}"].join("\n")}},a.billboard={attributes:{vertexPosition:t.POSITION,vertexUV0:t.TEXCOORD0},uniforms:{viewProjectionMatrix:e.VIEW_PROJECTION_MATRIX,projectionMatrix:e.PROJECTION_MATRIX,viewMatrix:e.VIEW_MATRIX,worldMatrix:e.WORLD_MATRIX,diffuseMap:e.DIFFUSE_MAP},vshader:["attribute vec3 vertexPosition;","attribute vec2 vertexUV0;","uniform mat4 viewProjectionMatrix;","uniform mat4 worldMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","varying vec2 texCoord0;","void main(void) {","	texCoord0 = vertexUV0;","	gl_Position = viewProjectionMatrix * worldMatrix * vec4(0.0, 0.0, 0.0, 1.0) + projectionMatrix * vec4(vertexPosition.x, vertexPosition.y, 0.0, 0.0);","}"].join("\n"),fshader:["uniform sampler2D diffuseMap;","varying vec2 texCoord0;","void main(void)","{","	gl_FragColor = texture2D(diffuseMap, texCoord0);","}"].join("\n")},a.textured={defines:{TEXCOORD0:!0,DIFFUSE_MAP:!0},attributes:{vertexPosition:t.POSITION,vertexUV0:t.TEXCOORD0},uniforms:{viewProjectionMatrix:e.VIEW_PROJECTION_MATRIX,worldMatrix:e.WORLD_MATRIX,diffuseMap:e.DIFFUSE_MAP},vshader:["attribute vec3 vertexPosition;","attribute vec2 vertexUV0;","uniform mat4 viewProjectionMatrix;","uniform mat4 worldMatrix;","varying vec2 texCoord0;","void main(void) {","	texCoord0 = vertexUV0;","	gl_Position = viewProjectionMatrix * worldMatrix * vec4(vertexPosition, 1.0);","}"].join("\n"),fshader:["#if defined(TEXCOORD0) && defined(DIFFUSE_MAP)","uniform sampler2D diffuseMap;","varying vec2 texCoord0;","#endif","void main(void)","{"," #if defined(TEXCOORD0) && defined(DIFFUSE_MAP)","	gl_FragColor = texture2D(diffuseMap, texCoord0);"," #else"," gl_FragColor = vec4(1.0);"," #endif","}"].join("\n")},a.texturedLit={processors:[o.light.processor],attributes:{vertexPosition:t.POSITION,vertexNormal:t.NORMAL,vertexUV0:t.TEXCOORD0},uniforms:{viewProjectionMatrix:e.VIEW_PROJECTION_MATRIX,worldMatrix:e.WORLD_MATRIX,cameraPosition:e.CAMERA,diffuseMap:e.DIFFUSE_MAP},builder:function(t,e){o.light.builder(t,e)},vshader:function(){return["attribute vec3 vertexPosition;","attribute vec3 vertexNormal;","attribute vec2 vertexUV0;","uniform mat4 viewProjectionMatrix;","uniform mat4 worldMatrix;","uniform vec3 cameraPosition;",o.light.prevertex,"varying vec3 normal;","varying vec3 vWorldPos;","varying vec3 viewPosition;","varying vec2 texCoord0;","void main(void) {","	vec4 worldPos = worldMatrix * vec4(vertexPosition, 1.0);"," vWorldPos = worldPos.xyz;","	gl_Position = viewProjectionMatrix * worldPos;",o.light.vertex,"	normal = (worldMatrix * vec4(vertexNormal, 0.0)).xyz;","	texCoord0 = vertexUV0;","	viewPosition = cameraPosition - worldPos.xyz;","}"].join("\n")},fshader:function(){return["uniform sampler2D diffuseMap;",o.light.prefragment,"varying vec3 normal;","varying vec3 vWorldPos;","varying vec3 viewPosition;","varying vec2 texCoord0;","void main(void)","{","	vec3 N = normalize(normal);","	vec4 final_color = texture2D(diffuseMap, texCoord0);",o.light.fragment,"	gl_FragColor = final_color;","}"].join("\n")}},a.convolution={defines:{KERNEL_SIZE_FLOAT:"25.0",KERNEL_SIZE_INT:"25"},attributes:{position:t.POSITION,uv:t.TEXCOORD0},uniforms:{viewMatrix:e.VIEW_MATRIX,projectionMatrix:e.PROJECTION_MATRIX,worldMatrix:e.WORLD_MATRIX,tDiffuse:e.DIFFUSE_MAP,uImageIncrement:[.001953125,0],cKernel:[],size:1},vshader:["attribute vec3 position;","attribute vec2 uv;","uniform mat4 viewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 worldMatrix;","uniform float size;","uniform vec2 uImageIncrement;","varying vec2 vUv;","void main() {","	vUv = uv - ( ( KERNEL_SIZE_FLOAT - 1.0 ) / 2.0 ) * size * uImageIncrement;","	gl_Position = projectionMatrix * viewMatrix * worldMatrix * vec4( position, 1.0 );","}"].join("\n"),fshader:["uniform float cKernel[ KERNEL_SIZE_INT ];","uniform sampler2D tDiffuse;","uniform vec2 uImageIncrement;","uniform float size;","varying vec2 vUv;","void main() {","	vec2 imageCoord = vUv;","	vec4 sum = vec4( 0.0 );","	for( int i = 0; i < KERNEL_SIZE_INT; i ++ ) {","		sum += texture2D( tDiffuse, imageCoord ) * cKernel[ i ];","		imageCoord += uImageIncrement * size;","	}","	gl_FragColor = sum;","}"].join("\n"),buildKernel:function(t){function e(t,e){return Math.exp(-(t*t)/(2*e*e))}var i,o,r,n,a=25,s=2*Math.ceil(3*t)+1;for(s>a&&(s=a),n=.5*(s-1),o=new Array(s),r=0,i=0;s>i;++i)o[i]=e(i-n,t),r+=o[i];for(i=0;s>i;++i)o[i]/=r;return o}},a.showDepth={attributes:{vertexPosition:t.POSITION},uniforms:{viewMatrix:e.VIEW_MATRIX,projectionMatrix:e.PROJECTION_MATRIX,worldMatrix:e.WORLD_MATRIX,near:e.NEAR_PLANE,far:e.FAR_PLANE},vshader:["attribute vec3 vertexPosition;","uniform mat4 viewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 worldMatrix;","void main(void) {","	gl_Position = projectionMatrix * viewMatrix * worldMatrix * vec4(vertexPosition, 1.0);","}"].join("\n"),fshader:["uniform float near;","uniform float far;","void main(void)","{","	float depth = gl_FragCoord.z / gl_FragCoord.w;","	float d = 1.0 - smoothstep( near, far, depth );","	gl_FragColor = vec4(d);","}"].join("\n")},a.showNormals={defines:{NORMAL:!0},attributes:{vertexPosition:t.POSITION,vertexNormal:t.NORMAL},uniforms:{viewMatrix:e.VIEW_MATRIX,projectionMatrix:e.PROJECTION_MATRIX,viewProjectionMatrix:e.VIEW_PROJECTION_MATRIX,worldMatrix:e.WORLD_MATRIX,opacity:1},vshader:["attribute vec3 vertexPosition;","attribute vec3 vertexNormal;","uniform mat4 viewProjectionMatrix;","uniform mat4 worldMatrix;","varying vec3 normal;","void main() {","normal = vec3(worldMatrix * vec4(vertexNormal, 0.0));","gl_Position = viewProjectionMatrix * worldMatrix * vec4(vertexPosition, 1.0);","}"].join("\n"),fshader:["uniform float opacity;","#ifdef NORMAL","varying vec3 normal;","#else","vec3 normal = vec3(0,0,1);","#endif","void main() {","gl_FragColor = vec4( 0.5 * normalize( normal ) + 0.5, opacity );","}"].join("\n")},a.bokehShader={attributes:{position:t.POSITION,uv:t.TEXCOORD0},uniforms:{viewMatrix:e.VIEW_MATRIX,projectionMatrix:e.PROJECTION_MATRIX,worldMatrix:e.WORLD_MATRIX,tColor:e.DIFFUSE_MAP,tDepth:e.DEPTH_MAP,focus:1,aspect:1,aperture:.025,maxblur:1},vshader:["attribute vec3 position;","attribute vec2 uv;","uniform mat4 viewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 worldMatrix;","varying vec2 vUv;","void main() {","	vUv = uv;","	gl_Position = projectionMatrix * viewMatrix * worldMatrix * vec4( position, 1.0 );","}"].join("\n"),fshader:["varying vec2 vUv;","uniform sampler2D tColor;","uniform sampler2D tDepth;","uniform float maxblur;","uniform float aperture;","uniform float focus;","uniform float aspect;","void main() {","vec2 aspectcorrect = vec2( 1.0, aspect );","vec4 depth1 = texture2D( tDepth, vUv );","float factor = depth1.x - focus;","vec2 dofblur = vec2 ( clamp( factor * aperture, -maxblur, maxblur ) );","vec2 dofblur9 = dofblur * 0.9;","vec2 dofblur7 = dofblur * 0.7;","vec2 dofblur4 = dofblur * 0.4;","vec4 col = vec4( 0.0 );","col += texture2D( tColor, vUv.xy );","col += texture2D( tColor, vUv.xy + ( vec2(  0.0,   0.4  ) * aspectcorrect ) * dofblur );","col += texture2D( tColor, vUv.xy + ( vec2(  0.15,  0.37 ) * aspectcorrect ) * dofblur );","col += texture2D( tColor, vUv.xy + ( vec2(  0.29,  0.29 ) * aspectcorrect ) * dofblur );","col += texture2D( tColor, vUv.xy + ( vec2( -0.37,  0.15 ) * aspectcorrect ) * dofblur );","col += texture2D( tColor, vUv.xy + ( vec2(  0.40,  0.0  ) * aspectcorrect ) * dofblur );","col += texture2D( tColor, vUv.xy + ( vec2(  0.37, -0.15 ) * aspectcorrect ) * dofblur );","col += texture2D( tColor, vUv.xy + ( vec2(  0.29, -0.29 ) * aspectcorrect ) * dofblur );","col += texture2D( tColor, vUv.xy + ( vec2( -0.15, -0.37 ) * aspectcorrect ) * dofblur );","col += texture2D( tColor, vUv.xy + ( vec2(  0.0,  -0.4  ) * aspectcorrect ) * dofblur );","col += texture2D( tColor, vUv.xy + ( vec2( -0.15,  0.37 ) * aspectcorrect ) * dofblur );","col += texture2D( tColor, vUv.xy + ( vec2( -0.29,  0.29 ) * aspectcorrect ) * dofblur );","col += texture2D( tColor, vUv.xy + ( vec2(  0.37,  0.15 ) * aspectcorrect ) * dofblur );","col += texture2D( tColor, vUv.xy + ( vec2( -0.4,   0.0  ) * aspectcorrect ) * dofblur );","col += texture2D( tColor, vUv.xy + ( vec2( -0.37, -0.15 ) * aspectcorrect ) * dofblur );","col += texture2D( tColor, vUv.xy + ( vec2( -0.29, -0.29 ) * aspectcorrect ) * dofblur );","col += texture2D( tColor, vUv.xy + ( vec2(  0.15, -0.37 ) * aspectcorrect ) * dofblur );","col += texture2D( tColor, vUv.xy + ( vec2(  0.15,  0.37 ) * aspectcorrect ) * dofblur9 );","col += texture2D( tColor, vUv.xy + ( vec2( -0.37,  0.15 ) * aspectcorrect ) * dofblur9 );","col += texture2D( tColor, vUv.xy + ( vec2(  0.37, -0.15 ) * aspectcorrect ) * dofblur9 );","col += texture2D( tColor, vUv.xy + ( vec2( -0.15, -0.37 ) * aspectcorrect ) * dofblur9 );","col += texture2D( tColor, vUv.xy + ( vec2( -0.15,  0.37 ) * aspectcorrect ) * dofblur9 );","col += texture2D( tColor, vUv.xy + ( vec2(  0.37,  0.15 ) * aspectcorrect ) * dofblur9 );","col += texture2D( tColor, vUv.xy + ( vec2( -0.37, -0.15 ) * aspectcorrect ) * dofblur9 );","col += texture2D( tColor, vUv.xy + ( vec2(  0.15, -0.37 ) * aspectcorrect ) * dofblur9 );","col += texture2D( tColor, vUv.xy + ( vec2(  0.29,  0.29 ) * aspectcorrect ) * dofblur7 );","col += texture2D( tColor, vUv.xy + ( vec2(  0.40,  0.0  ) * aspectcorrect ) * dofblur7 );","col += texture2D( tColor, vUv.xy + ( vec2(  0.29, -0.29 ) * aspectcorrect ) * dofblur7 );","col += texture2D( tColor, vUv.xy + ( vec2(  0.0,  -0.4  ) * aspectcorrect ) * dofblur7 );","col += texture2D( tColor, vUv.xy + ( vec2( -0.29,  0.29 ) * aspectcorrect ) * dofblur7 );","col += texture2D( tColor, vUv.xy + ( vec2( -0.4,   0.0  ) * aspectcorrect ) * dofblur7 );","col += texture2D( tColor, vUv.xy + ( vec2( -0.29, -0.29 ) * aspectcorrect ) * dofblur7 );","col += texture2D( tColor, vUv.xy + ( vec2(  0.0,   0.4  ) * aspectcorrect ) * dofblur7 );","col += texture2D( tColor, vUv.xy + ( vec2(  0.29,  0.29 ) * aspectcorrect ) * dofblur4 );","col += texture2D( tColor, vUv.xy + ( vec2(  0.4,   0.0  ) * aspectcorrect ) * dofblur4 );","col += texture2D( tColor, vUv.xy + ( vec2(  0.29, -0.29 ) * aspectcorrect ) * dofblur4 );","col += texture2D( tColor, vUv.xy + ( vec2(  0.0,  -0.4  ) * aspectcorrect ) * dofblur4 );","col += texture2D( tColor, vUv.xy + ( vec2( -0.29,  0.29 ) * aspectcorrect ) * dofblur4 );","col += texture2D( tColor, vUv.xy + ( vec2( -0.4,   0.0  ) * aspectcorrect ) * dofblur4 );","col += texture2D( tColor, vUv.xy + ( vec2( -0.29, -0.29 ) * aspectcorrect ) * dofblur4 );","col += texture2D( tColor, vUv.xy + ( vec2(  0.0,   0.4  ) * aspectcorrect ) * dofblur4 );","gl_FragColor = col / 41.0;","gl_FragColor.a = 1.0;","}"].join("\n")},a.particles={attributes:{vertexPosition:t.POSITION,vertexColor:t.COLOR,vertexUV0:t.TEXCOORD0},uniforms:{viewProjectionMatrix:e.VIEW_PROJECTION_MATRIX,worldMatrix:e.WORLD_MATRIX,diffuseMap:e.DIFFUSE_MAP},vshader:["attribute vec3 vertexPosition;","attribute vec4 vertexColor;","attribute vec2 vertexUV0;","uniform mat4 viewProjectionMatrix;","uniform mat4 worldMatrix;","varying vec2 texCoord0;","varying vec4 color;","void main(void) {","    texCoord0 = vertexUV0;","    color = vertexColor;","	 gl_Position = viewProjectionMatrix * worldMatrix * vec4(vertexPosition, 1.0);","}"].join("\n"),fshader:["uniform sampler2D diffuseMap;","varying vec2 texCoord0;","varying vec4 color;","void main(void)","{","	vec4 texCol = texture2D(diffuseMap, texCoord0);","   if (color.a == 0.0 || texCol.a == 0.0) discard;","	else gl_FragColor = texCol * color;","}"].join("\n")},a.sepia={attributes:{vertexPosition:t.POSITION,vertexUV0:t.TEXCOORD0},uniforms:{viewMatrix:e.VIEW_MATRIX,projectionMatrix:e.PROJECTION_MATRIX,worldMatrix:e.WORLD_MATRIX,tDiffuse:e.DIFFUSE_MAP,amount:1},vshader:["attribute vec3 vertexPosition;","attribute vec2 vertexUV0;","uniform mat4 viewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 worldMatrix;","varying vec2 vUv;","void main() {","vUv = vertexUV0;","gl_Position = projectionMatrix * viewMatrix * worldMatrix * vec4( vertexPosition, 1.0 );","}"].join("\n"),fshader:["uniform float amount;","uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","vec4 color = texture2D( tDiffuse, vUv );","vec3 c = color.rgb;","color.r = dot( c, vec3( 1.0 - 0.607 * amount, 0.769 * amount, 0.189 * amount ) );","color.g = dot( c, vec3( 0.349 * amount, 1.0 - 0.314 * amount, 0.168 * amount ) );","color.b = dot( c, vec3( 0.272 * amount, 0.534 * amount, 1.0 - 0.869 * amount ) );","gl_FragColor = vec4( min( vec3( 1.0 ), color.rgb ), color.a );","}"].join("\n")},a.dotscreen={attributes:{vertexPosition:t.POSITION,vertexUV0:t.TEXCOORD0},uniforms:{viewMatrix:e.VIEW_MATRIX,projectionMatrix:e.PROJECTION_MATRIX,worldMatrix:e.WORLD_MATRIX,tDiffuse:e.DIFFUSE_MAP,tSize:[256,256],center:[.5,.5],angle:1.57,scale:1},vshader:["attribute vec3 vertexPosition;","attribute vec2 vertexUV0;","uniform mat4 viewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 worldMatrix;","varying vec2 vUv;","void main() {","vUv = vertexUV0;","gl_Position = projectionMatrix * viewMatrix * worldMatrix * vec4( vertexPosition, 1.0 );","}"].join("\n"),fshader:["uniform vec2 center;","uniform float angle;","uniform float scale;","uniform vec2 tSize;","uniform sampler2D tDiffuse;","varying vec2 vUv;","float pattern() {","float s = sin( angle ), c = cos( angle );","vec2 tex = vUv * tSize - center;","vec2 point = vec2( c * tex.x - s * tex.y, s * tex.x + c * tex.y ) * scale;","return ( sin( point.x ) * sin( point.y ) ) * 4.0;","}","void main() {","vec4 color = texture2D( tDiffuse, vUv );","float average = ( color.r + color.g + color.b ) / 3.0;","gl_FragColor = vec4( color.rgb * vec3( average * 10.0 - 5.0 + pattern() ), color.a );","}"].join("\n")},a.vignette={attributes:{vertexPosition:t.POSITION,vertexUV0:t.TEXCOORD0},uniforms:{viewMatrix:e.VIEW_MATRIX,projectionMatrix:e.PROJECTION_MATRIX,worldMatrix:e.WORLD_MATRIX,tDiffuse:e.DIFFUSE_MAP,offset:1,darkness:1.5},vshader:["attribute vec3 vertexPosition;","attribute vec2 vertexUV0;","uniform mat4 viewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 worldMatrix;","varying vec2 vUv;","void main() {","vUv = vertexUV0;","gl_Position = projectionMatrix * viewMatrix * worldMatrix * vec4( vertexPosition, 1.0 );","}"].join("\n"),fshader:["uniform float offset;","uniform float darkness;","uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","vec4 texel = texture2D( tDiffuse, vUv );","vec2 uv = ( vUv - vec2( 0.5 ) ) * vec2( offset );","gl_FragColor = vec4( mix( texel.rgb, vec3( 1.0 - darkness ), dot( uv, uv ) ), texel.a );","}"].join("\n")},a.film={attributes:a.copy.attributes,uniforms:{tDiffuse:e.DIFFUSE_MAP,time:function(){return n.time},nIntensity:.5,sIntensity:.5,sCount:1024,grayscale:0,$link:a.copy.uniforms},vshader:a.copy.vshader,fshader:["uniform float time;","uniform bool grayscale;","uniform float nIntensity;","uniform float sIntensity;","uniform float sCount;","uniform sampler2D tDiffuse;","varying vec2 texCoord0;","void main() {","	vec4 cTextureScreen = texture2D( tDiffuse, texCoord0 );","	float x = texCoord0.x * texCoord0.y * time * 1000.0;","	x = mod( x, 13.0 ) * mod( x, 123.0 );","	float dx = mod( x, 0.01 );","	vec3 cResult = cTextureScreen.rgb + cTextureScreen.rgb * clamp( 0.1 + dx * 100.0, 0.0, 1.0 );","	vec2 sc = vec2( sin( texCoord0.y * sCount ), cos( texCoord0.y * sCount ) );","	cResult += cTextureScreen.rgb * vec3( sc.x, sc.y, sc.x ) * sIntensity;","	cResult = cTextureScreen.rgb + nIntensity * ( cResult - cTextureScreen.rgb );","	if( grayscale ) {","		cResult = vec3( cResult.r * 0.3 + cResult.g * 0.59 + cResult.b * 0.11 );","	}","	gl_FragColor = vec4( cResult, cTextureScreen.a );","}"].join("\n")},a.noise={attributes:a.copy.attributes,uniforms:{tDiffuse:e.DIFFUSE_MAP,time:function(){return n.time},nIntensity:.5,grayscale:0,$link:a.copy.uniforms},vshader:a.copy.vshader,fshader:["uniform float time;","uniform bool grayscale;","uniform float nIntensity;","uniform sampler2D tDiffuse;","varying vec2 texCoord0;","void main() {","	vec4 cTextureScreen = texture2D( tDiffuse, texCoord0 );","	float x = texCoord0.x * texCoord0.y * time * 1000.0;","	vec3 cResult;","	if ( !grayscale ) {","	float y = fract(sin(dot(vec2(mod( x + 20.0, 87.0 ), mod( x + 150.0, 23.0 )), vec2(12.9898,78.233))) * 43758.5453);","	float z = fract(sin(dot(vec2(mod( x + 30.0, 19.0 ), mod( x + 200.0, 103.0 )), vec2(12.9898,78.233))) * 43758.5453);","	x = fract(sin(dot(vec2(mod( x, 13.0 ), mod( x + 50.0, 123.0 )), vec2(12.9898,78.233))) * 43758.5453);","	cResult = vec3(x, y, z);","	} else {","	x = fract(sin(dot(vec2(mod( x, 13.0 ), mod( x + 50.0, 123.0 )), vec2(12.9898,78.233))) * 43758.5453);","	cResult = vec3(x);","	}","	gl_FragColor = vec4( mix(cTextureScreen.rgb, cResult, nIntensity), cTextureScreen.a );","}"].join("\n")},a.bleachbypass={attributes:{vertexPosition:t.POSITION,vertexUV0:t.TEXCOORD0},uniforms:{viewMatrix:e.VIEW_MATRIX,projectionMatrix:e.PROJECTION_MATRIX,worldMatrix:e.WORLD_MATRIX,tDiffuse:e.DIFFUSE_MAP,opacity:1},vshader:["attribute vec3 vertexPosition;","attribute vec2 vertexUV0;","uniform mat4 viewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 worldMatrix;","varying vec2 vUv;","void main() {","vUv = vertexUV0;","gl_Position = projectionMatrix * viewMatrix * worldMatrix * vec4( vertexPosition, 1.0 );","}"].join("\n"),fshader:["uniform float opacity;","uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","vec4 base = texture2D( tDiffuse, vUv );","vec3 lumCoeff = vec3( 0.25, 0.65, 0.1 );","float lum = dot( lumCoeff, base.rgb );","vec3 blend = vec3( lum );","float L = min( 1.0, max( 0.0, 10.0 * ( lum - 0.45 ) ) );","vec3 result1 = 2.0 * base.rgb * blend;","vec3 result2 = 1.0 - 2.0 * ( 1.0 - blend ) * ( 1.0 - base.rgb );","vec3 newColor = mix( result1, result2, L );","float A2 = opacity * base.a;","vec3 mixRGB = A2 * newColor.rgb;","mixRGB += ( ( 1.0 - A2 ) * base.rgb );","gl_FragColor = vec4( mixRGB, base.a );","}"].join("\n")},a.horizontalTiltShift={attributes:{vertexPosition:t.POSITION,vertexUV0:t.TEXCOORD0},uniforms:{viewMatrix:e.VIEW_MATRIX,projectionMatrix:e.PROJECTION_MATRIX,worldMatrix:e.WORLD_MATRIX,tDiffuse:e.DIFFUSE_MAP,h:1/128,r:.5},vshader:["attribute vec3 vertexPosition;","attribute vec2 vertexUV0;","uniform mat4 viewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 worldMatrix;","varying vec2 vUv;","void main() {","vUv = vertexUV0;","gl_Position = projectionMatrix * viewMatrix * worldMatrix * vec4( vertexPosition, 1.0 );","}"].join("\n"),fshader:["uniform sampler2D tDiffuse;","uniform float h;","uniform float r;","varying vec2 vUv;","void main() {","vec4 sum = vec4( 0.0 );","float hh = h * abs( r - vUv.y );","sum += texture2D( tDiffuse, vec2( vUv.x - 4.0 * hh, vUv.y ) ) * 0.051;","sum += texture2D( tDiffuse, vec2( vUv.x - 3.0 * hh, vUv.y ) ) * 0.0918;","sum += texture2D( tDiffuse, vec2( vUv.x - 2.0 * hh, vUv.y ) ) * 0.12245;","sum += texture2D( tDiffuse, vec2( vUv.x - 1.0 * hh, vUv.y ) ) * 0.1531;","sum += texture2D( tDiffuse, vec2( vUv.x,            vUv.y ) ) * 0.1633;","sum += texture2D( tDiffuse, vec2( vUv.x + 1.0 * hh, vUv.y ) ) * 0.1531;","sum += texture2D( tDiffuse, vec2( vUv.x + 2.0 * hh, vUv.y ) ) * 0.12245;","sum += texture2D( tDiffuse, vec2( vUv.x + 3.0 * hh, vUv.y ) ) * 0.0918;","sum += texture2D( tDiffuse, vec2( vUv.x + 4.0 * hh, vUv.y ) ) * 0.051;","gl_FragColor = sum;","}"].join("\n")},a.colorify={attributes:{vertexPosition:t.POSITION,vertexUV0:t.TEXCOORD0},uniforms:{viewMatrix:e.VIEW_MATRIX,projectionMatrix:e.PROJECTION_MATRIX,worldMatrix:e.WORLD_MATRIX,tDiffuse:e.DIFFUSE_MAP,color:[1,1,1],amount:1},vshader:["attribute vec3 vertexPosition;","attribute vec2 vertexUV0;","uniform mat4 viewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 worldMatrix;","varying vec2 vUv;","void main() {","vUv = vertexUV0;","gl_Position = projectionMatrix * viewMatrix * worldMatrix * vec4( vertexPosition, 1.0 );","}"].join("\n"),fshader:["uniform vec3 color;","uniform float amount;","uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","gl_FragColor = texture2D( tDiffuse, vUv );","vec3 luma = vec3( 0.299, 0.587, 0.114 );","float v = dot( gl_FragColor.rgb, luma );","gl_FragColor.rgb = mix(gl_FragColor.rgb, v * color, amount);","}"].join("\n")},a.hatch={attributes:{vertexPosition:t.POSITION,vertexUV0:t.TEXCOORD0},uniforms:{viewMatrix:e.VIEW_MATRIX,projectionMatrix:e.PROJECTION_MATRIX,worldMatrix:e.WORLD_MATRIX,tDiffuse:e.DIFFUSE_MAP,width:0,spread:10,replace:!0},vshader:["attribute vec3 vertexPosition;","attribute vec2 vertexUV0;","uniform mat4 viewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 worldMatrix;","varying vec2 vUv;","void main() {","vUv = vertexUV0;","gl_Position = projectionMatrix * viewMatrix * worldMatrix * vec4( vertexPosition, 1.0 );","}"].join("\n"),fshader:["uniform sampler2D tDiffuse;","uniform float width;","uniform float spread;","uniform bool replace;","varying vec2 vUv;","void main() {","gl_FragColor = texture2D( tDiffuse, vUv );","float lum = length(gl_FragColor.rgb);","vec3 mult = vec3(1.0, 1.0, 1.0);","float halfSpread = (spread*0.5);","if (lum < 1.00) {","float diff = abs(mod(gl_FragCoord.x + gl_FragCoord.y, spread) - halfSpread);","if (diff <= width) {","mult *= vec3(1.0 - (width - diff) / width);","}","}","if (lum < 0.75) {","float diff = abs(mod(gl_FragCoord.x - gl_FragCoord.y, spread) - halfSpread);","if (diff <= width) {","mult *= vec3(1.0 - (width - diff) / width);","}","}","if (lum < 0.50) {","float diff = abs(mod(gl_FragCoord.x + halfSpread + gl_FragCoord.y, spread) - halfSpread);","if (diff <= width) {","mult *= vec3(1.0 - (width - diff) / width);","}","}","if (lum < 0.25) {","float diff = abs(mod(gl_FragCoord.x + halfSpread - gl_FragCoord.y, spread) - halfSpread);","if (diff <= width) {","mult *= vec3(1.0 - (width - diff) / width);","}","}","if (replace) {","gl_FragColor.rgb = mult;","} else {","gl_FragColor.rgb *= mult;","}","}"].join("\n")},a.normalmap={attributes:{vertexPosition:t.POSITION,vertexUV0:t.TEXCOORD0},uniforms:{viewMatrix:e.VIEW_MATRIX,projectionMatrix:e.PROJECTION_MATRIX,worldMatrix:e.WORLD_MATRIX,heightMap:e.DIFFUSE_MAP,resolution:[512,512],height:.05},vshader:["attribute vec3 vertexPosition;","attribute vec2 vertexUV0;","uniform mat4 viewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 worldMatrix;","varying vec2 vUv;","void main() {","vUv = vertexUV0;","gl_Position = projectionMatrix * viewMatrix * worldMatrix * vec4( vertexPosition, 1.0 );","}"].join("\n"),fshader:["uniform float height;","uniform vec2 resolution;","uniform sampler2D heightMap;","varying vec2 vUv;","void main() {","float val = texture2D( heightMap, vUv ).x;","float valU = texture2D( heightMap, vUv + vec2( 1.0 / resolution.x, 0.0 ) ).x;","float valV = texture2D( heightMap, vUv + vec2( 0.0, 1.0 / resolution.y ) ).x;","gl_FragColor = vec4( ( 0.5 * normalize( vec3( val - valU, val - valV, height  ) ) + 0.5 ), 1.0 );","}"].join("\n")},a.ssao={attributes:{vertexPosition:t.POSITION,vertexUV0:t.TEXCOORD0},uniforms:{viewMatrix:e.VIEW_MATRIX,projectionMatrix:e.PROJECTION_MATRIX,worldMatrix:e.WORLD_MATRIX,tDiffuse:e.DIFFUSE_MAP,tDepth:e.DEPTH_MAP,size:[512,512],cameraNear:e.MAIN_NEAR_PLANE,cameraFar:e.MAIN_FAR_PLANE,fogNear:e.MAIN_NEAR_PLANE,fogFar:e.MAIN_FAR_PLANE,fogEnabled:0,onlyAO:0,aoClamp:.3,lumInfluence:0},vshader:["attribute vec3 vertexPosition;","attribute vec2 vertexUV0;","uniform mat4 viewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 worldMatrix;","varying vec2 vUv;","void main() {","vUv = vertexUV0;","gl_Position = projectionMatrix * viewMatrix * worldMatrix * vec4( vertexPosition, 1.0 );","}"].join("\n"),fshader:["uniform float cameraNear;","uniform float cameraFar;","uniform float fogNear;","uniform float fogFar;","uniform bool fogEnabled;","uniform bool onlyAO;","uniform vec2 size;","uniform float aoClamp;","uniform float lumInfluence;","uniform sampler2D tDiffuse;","uniform sampler2D tDepth;","varying vec2 vUv;","#define DL 2.399963229728653","#define EULER 2.718281828459045","float width = size.x;","float height = size.y;","float cameraFarPlusNear = cameraFar + cameraNear;","float cameraFarMinusNear = cameraFar - cameraNear;","float cameraCoef = 2.0 * cameraNear;","const int samples = 16;","const float radius = 2.0;","const bool useNoise = false;","const float noiseAmount = 0.0003;","const float diffArea = 0.4;","const float gDisplace = 0.4;","const vec3 onlyAOColor = vec3( 1.0, 1.0, 1.0 );","float unpackDepth( const in vec4 rgba_depth ) {","const vec4 bit_shift = vec4( 1.0 / ( 256.0 * 256.0 * 256.0 ), 1.0 / ( 256.0 * 256.0 ), 1.0 / 256.0, 1.0 );","float depth = dot( rgba_depth, bit_shift );","return depth;","}","vec2 rand( const vec2 coord ) {","vec2 noise;","if ( useNoise ) {","float nx = dot ( coord, vec2( 12.9898, 78.233 ) );","float ny = dot ( coord, vec2( 12.9898, 78.233 ) * 2.0 );","noise = clamp( fract ( 43758.5453 * sin( vec2( nx, ny ) ) ), 0.0, 1.0 );","} else {","float ff = fract( 1.0 - coord.s * ( width / 2.0 ) );","float gg = fract( coord.t * ( height / 2.0 ) );","noise = vec2( 0.25, 0.75 ) * vec2( ff ) + vec2( 0.75, 0.25 ) * gg;","}","return ( noise * 2.0  - 1.0 ) * noiseAmount;","}","float doFog() {","float zdepth = unpackDepth( texture2D( tDepth, vUv ) );","float depth = -cameraFar * cameraNear / ( zdepth * cameraFarMinusNear - cameraFar );","return smoothstep( fogNear, fogFar, depth );","}","float readDepth( const in vec2 coord ) {","return cameraCoef / ( cameraFarPlusNear - unpackDepth( texture2D( tDepth, coord ) ) * cameraFarMinusNear );","}","float compareDepths( const in float depth1, const in float depth2, inout int far ) {","float garea = 2.0;","float diff = ( depth1 - depth2 ) * 100.0;","if ( diff < gDisplace ) {","garea = diffArea;","} else {","far = 1;","}","float dd = diff - gDisplace;","float gauss = pow( EULER, -2.0 * dd * dd / ( garea * garea ) );","return gauss;","}","float calcAO( float depth, float dw, float dh ) {","float dd = radius - depth * radius;","vec2 vv = vec2( dw, dh );","vec2 coord1 = vUv + dd * vv;","vec2 coord2 = vUv - dd * vv;","float temp1 = 0.0;","float temp2 = 0.0;","int far = 0;","temp1 = compareDepths( depth, readDepth( coord1 ), far );","if ( far > 0 ) {","temp2 = compareDepths( readDepth( coord2 ), depth, far );","temp1 += ( 1.0 - temp1 ) * temp2;","}","return temp1;","}","void main() {","vec2 noise = rand( vUv );","float depth = readDepth( vUv );","float tt = clamp( depth, aoClamp, 1.0 );","float w = ( 1.0 / width )  / tt + ( noise.x * ( 1.0 - noise.x ) );","float h = ( 1.0 / height ) / tt + ( noise.y * ( 1.0 - noise.y ) );","float pw;","float ph;","float ao;","float dz = 1.0 / float( samples );","float z = 1.0 - dz / 2.0;","float l = 0.0;","for ( int i = 0; i <= samples; i ++ ) {","float r = sqrt( 1.0 - z );","pw = cos( l ) * r;","ph = sin( l ) * r;","ao += calcAO( depth, pw * w, ph * h );","z = z - dz;","l = l + DL;","}","ao /= float( samples );","ao = 1.0 - ao;","if ( fogEnabled ) {","ao = mix( ao, 1.0, doFog() );","}","vec3 color = texture2D( tDiffuse, vUv ).rgb;","vec3 lumcoeff = vec3( 0.299, 0.587, 0.114 );","float lum = dot( color.rgb, lumcoeff );","vec3 luminance = vec3( lum );","vec3 final = vec3( color * mix( vec3( ao ), vec3( 1.0 ), luminance * lumInfluence ) );","if ( onlyAO ) {","final = onlyAOColor * vec3( mix( vec3( ao ), vec3( 1.0 ), luminance * lumInfluence ) );","}","gl_FragColor = vec4( final, 1.0 );","}"].join("\n")},a.skinning={defines:{JOINT_COUNT:56,WEIGHTS:4},attributes:{vertexPosition:t.POSITION,vertexUV0:t.TEXCOORD0,vertexWeights:t.WEIGHTS,vertexJointIDs:t.JOINTIDS},uniforms:{viewProjectionMatrix:e.VIEW_PROJECTION_MATRIX,worldMatrix:e.WORLD_MATRIX,diffuseMap:e.DIFFUSE_MAP,jointPalette:function(t){var e=t.meshData,i=e.currentPose;
if(i){var o=i._matrixPalette,r=16*e.paletteMap.length,n=e.store;n||(n=new Float32Array(r),e.store=n);for(var a,s=0;s<e.paletteMap.length;s++){a=o[e.paletteMap[s]];for(var c=0;4>c;c++)for(var l=0;4>l;l++)n[16*s+4*c+l]=a.data[4*l+c]}return n}}},vshader:["attribute vec3 vertexPosition;","attribute vec2 vertexUV0;","attribute vec4 vertexWeights;","attribute vec4 vertexJointIDs;","uniform mat4 viewProjectionMatrix;","uniform mat4 worldMatrix;","uniform mat4 jointPalette[JOINT_COUNT];","varying vec2 texCoord0;","void main(void) {","	mat4 mat = mat4(0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0);","	mat += jointPalette[int(vertexJointIDs.x)] * vertexWeights.x;","	mat += jointPalette[int(vertexJointIDs.y)] * vertexWeights.y;","	mat += jointPalette[int(vertexJointIDs.z)] * vertexWeights.z;","	mat += jointPalette[int(vertexJointIDs.w)] * vertexWeights.w;","	texCoord0 = vertexUV0;","	gl_Position = viewProjectionMatrix * worldMatrix * mat * vec4(vertexPosition, 1.0);","}"].join("\n"),fshader:["uniform sampler2D diffuseMap;","varying vec2 texCoord0;","void main(void)","{","	gl_FragColor = texture2D(diffuseMap, texCoord0);","}"].join("\n")},a.rgbshift={attributes:{vertexPosition:t.POSITION,vertexUV0:t.TEXCOORD0},uniforms:{viewMatrix:e.VIEW_MATRIX,projectionMatrix:e.PROJECTION_MATRIX,worldMatrix:e.WORLD_MATRIX,tDiffuse:e.DIFFUSE_MAP,amount:.005,angle:0},vshader:["attribute vec3 vertexPosition;","attribute vec2 vertexUV0;","uniform mat4 viewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 worldMatrix;","varying vec2 vUv;","void main() {","vUv = vertexUV0;","gl_Position = projectionMatrix * viewMatrix * worldMatrix * vec4( vertexPosition, 1.0 );","}"].join("\n"),fshader:["uniform sampler2D tDiffuse;","uniform float amount;","uniform float angle;","varying vec2 vUv;","void main() {","vec2 offset = amount * vec2( cos(angle), sin(angle));","vec4 cr = texture2D(tDiffuse, vUv + offset);","vec4 cga = texture2D(tDiffuse, vUv);","vec4 cb = texture2D(tDiffuse, vUv - offset);","gl_FragColor = vec4(cr.r, cga.g, cb.b, cga.a);","}"].join("\n")},a.brightnesscontrast={attributes:{vertexPosition:t.POSITION,vertexUV0:t.TEXCOORD0},uniforms:{viewMatrix:e.VIEW_MATRIX,projectionMatrix:e.PROJECTION_MATRIX,worldMatrix:e.WORLD_MATRIX,tDiffuse:e.DIFFUSE_MAP,brightness:0,contrast:0,saturation:0},vshader:["attribute vec3 vertexPosition;","attribute vec2 vertexUV0;","uniform mat4 viewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 worldMatrix;","varying vec2 vUv;","void main() {","vUv = vertexUV0;","gl_Position = projectionMatrix * viewMatrix * worldMatrix * vec4( vertexPosition, 1.0 );","}"].join("\n"),fshader:["uniform sampler2D tDiffuse;","uniform float brightness;","uniform float contrast;","uniform float saturation;","varying vec2 vUv;","void main() {","gl_FragColor = texture2D( tDiffuse, vUv );","gl_FragColor.rgb += brightness;","if (contrast > 0.0) {","gl_FragColor.rgb = (gl_FragColor.rgb - 0.5) / (1.0 - contrast) + 0.5;","} else {","gl_FragColor.rgb = (gl_FragColor.rgb - 0.5) * (1.0 + contrast) + 0.5;","}","vec3 gray = vec3(dot(vec3(0.2126,0.7152,0.0722), gl_FragColor.rgb));","gl_FragColor.rgb = mix(gl_FragColor.rgb, gray, -saturation);","}"].join("\n")},a.hsb={attributes:{vertexPosition:t.POSITION,vertexUV0:t.TEXCOORD0},uniforms:{viewMatrix:e.VIEW_MATRIX,projectionMatrix:e.PROJECTION_MATRIX,worldMatrix:e.WORLD_MATRIX,tDiffuse:e.DIFFUSE_MAP,hue:0,saturation:0,brightness:0},vshader:["attribute vec3 vertexPosition;","attribute vec2 vertexUV0;","uniform mat4 viewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 worldMatrix;","varying vec2 vUv;","void main() {","vUv = vertexUV0;","gl_Position = projectionMatrix * viewMatrix * worldMatrix * vec4( vertexPosition, 1.0 );","}"].join("\n"),fshader:["uniform sampler2D tDiffuse;","uniform float hue;","uniform float saturation;","uniform float brightness;","varying vec2 vUv;",i.methods.hsv,"void main() {","gl_FragColor = texture2D(tDiffuse, vUv);","vec3 fragHSV = rgb2hsv(gl_FragColor.rgb).xyz;","fragHSV.x += hue * 0.5;","fragHSV.y *= saturation + 1.0 - max(brightness, 0.0) * 2.0;","fragHSV.z *= min(brightness + 1.0, 1.0);","fragHSV.z += max(brightness, 0.0);","fragHSV.xyz = clamp(fragHSV.xyz, vec3(-10.0, 0.0, 0.0), vec3(10.0, 1.0, 1.0));","gl_FragColor.rgb = hsv2rgb(fragHSV);","}"].join("\n")},a.luminosity={attributes:{vertexPosition:t.POSITION,vertexUV0:t.TEXCOORD0},uniforms:{viewMatrix:e.VIEW_MATRIX,projectionMatrix:e.PROJECTION_MATRIX,worldMatrix:e.WORLD_MATRIX,tDiffuse:e.DIFFUSE_MAP},vshader:["attribute vec3 vertexPosition;","attribute vec2 vertexUV0;","uniform mat4 viewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 worldMatrix;","varying vec2 vUv;","void main() {","vUv = vertexUV0;","gl_Position = projectionMatrix * viewMatrix * worldMatrix * vec4( vertexPosition, 1.0 );","}"].join("\n"),fshader:["uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","vec4 texel = texture2D( tDiffuse, vUv );","vec3 luma = vec3( 0.299, 0.587, 0.114 );","float v = dot( texel.xyz, luma );","gl_FragColor = vec4( v, v, v, texel.w );","}"].join("\n")},a.point={attributes:{vertexPosition:t.POSITION,vertexColor:t.COLOR},uniforms:{viewProjectionMatrix:e.VIEW_PROJECTION_MATRIX,worldMatrix:e.WORLD_MATRIX,pointSize:2},vshader:["attribute vec3 vertexPosition;","attribute vec4 vertexColor;","uniform mat4 viewProjectionMatrix;","uniform mat4 worldMatrix;","uniform float pointSize;","varying vec4 color;","void main(void) {","	color = vertexColor;","	gl_Position = viewProjectionMatrix * worldMatrix * vec4(vertexPosition, 1.0);","	gl_PointSize = pointSize;","}"].join("\n"),fshader:["varying vec4 color;","void main(void)","{","	gl_FragColor = color;","}"].join("\n")},a.toon={attributes:{vertexPosition:t.POSITION,vertexNormal:t.NORMAL},uniforms:{viewMatrix:e.VIEW_MATRIX,projectionMatrix:e.PROJECTION_MATRIX,worldMatrix:e.WORLD_MATRIX,cameraPosition:e.CAMERA,lightPosition:e.LIGHT0,HighlightColour:[.9,.8,.7,1],MidColour:[.65,.55,.45,1],ShadowColour:[.4,.3,.2,1],HighlightSize:.2,ShadowSize:.01,OutlineWidth:.15},vshader:["attribute vec3 vertexPosition;","attribute vec3 vertexNormal;","uniform mat4 viewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 worldMatrix;","uniform vec3 cameraPosition;","uniform vec3 lightPosition;","varying vec3 N;","varying vec3 V;","varying vec3 L;","void main()","{","	vec4 worldPos = worldMatrix * vec4(vertexPosition, 1.0);","	N = (worldMatrix * vec4(vertexNormal, 0.0)).xyz;","	L = lightPosition - worldPos.xyz;","	V = cameraPosition - worldPos.xyz;","	gl_Position = projectionMatrix * viewMatrix * worldPos;","}"].join("\n"),fshader:["uniform vec4 HighlightColour;","uniform vec4 MidColour;","uniform vec4 ShadowColour;","uniform float HighlightSize;","uniform float ShadowSize;","uniform float OutlineWidth;","varying vec3 N;","varying vec3 L;","varying vec3 V;","void main()","{","	vec3 n = normalize(N);","	vec3 l = normalize(L);","	vec3 v = normalize(V);","    float lambert = dot(l,n);","    vec4 colour = MidColour;","    if (lambert > 1.0 - HighlightSize) colour = HighlightColour;","    if (lambert < ShadowSize) colour = ShadowColour;","    if (dot(n,v) < OutlineWidth) colour = vec4(0.0,0.0,0.0,1.0);","    gl_FragColor = colour;","}"].join("\n")},a.differenceOfGaussians={attributes:{vertexPosition:t.POSITION,vertexUV0:t.TEXCOORD0},uniforms:{viewMatrix:e.VIEW_MATRIX,projectionMatrix:e.PROJECTION_MATRIX,worldMatrix:e.WORLD_MATRIX,gaussBlurredImage1:"BLUR1",gaussBlurredImage2:"BLUR2",originalImage:"ORIGINAL",threshold:.01},vshader:["attribute vec3 vertexPosition;","attribute vec2 vertexUV0;","uniform mat4 viewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 worldMatrix;","varying vec2 texCoord0;","void main(void) {","	texCoord0 = vertexUV0;","	gl_Position = projectionMatrix * viewMatrix * worldMatrix * vec4(vertexPosition, 1.0);","}"].join("\n"),fshader:["uniform sampler2D gaussBlurredImage1;","uniform sampler2D gaussBlurredImage2;","uniform sampler2D originalImage;","uniform float threshold;","varying vec2 texCoord0;","void main(void)","{","	vec4 blur1 = texture2D(gaussBlurredImage1, texCoord0);","	vec4 blur2 = texture2D(gaussBlurredImage2, texCoord0);","	vec4 originalColor = texture2D(originalImage, texCoord0);","	vec3 col = clamp(blur1.rgb - blur2.rgb, 0.0, 1.0);","	float value = (col.r + col.g + col.b) / 3.0;","	value = step(threshold, value);","	vec3 outputColor = mix(originalColor.rgb, vec3(value), value);","	gl_FragColor = vec4(outputColor, 1.0);","}"].join("\n")},a.downsample={attributes:{vertexPosition:t.POSITION,vertexUV0:t.TEXCOORD0},uniforms:{viewMatrix:e.VIEW_MATRIX,projectionMatrix:e.PROJECTION_MATRIX,worldMatrix:e.WORLD_MATRIX,tDiffuse:e.DIFFUSE_MAP},vshader:["attribute vec3 vertexPosition;","attribute vec2 vertexUV0;","uniform mat4 viewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 worldMatrix;","varying vec2 vUv;","void main() {","vUv = vertexUV0;","gl_Position = projectionMatrix * viewMatrix * worldMatrix * vec4( vertexPosition, 1.0 );","}"].join("\n"),fshader:["uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","gl_FragColor = texture2D( tDiffuse, vUv );","}"].join("\n")},a.boxfilter={attributes:{vertexPosition:t.POSITION,vertexUV0:t.TEXCOORD0},uniforms:{viewMatrix:e.VIEW_MATRIX,projectionMatrix:e.PROJECTION_MATRIX,worldMatrix:e.WORLD_MATRIX,tDiffuse:e.DIFFUSE_MAP,viewport:[128,128]},vshader:["attribute vec3 vertexPosition;","attribute vec2 vertexUV0;","uniform mat4 viewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 worldMatrix;","varying vec2 vUv;","void main() {","vUv = vertexUV0;","gl_Position = projectionMatrix * viewMatrix * worldMatrix * vec4( vertexPosition, 1.0 );","}"].join("\n"),fshader:["uniform sampler2D tDiffuse;","uniform vec2 viewport;","varying vec2 vUv;","void main() {","vec3 result = vec3(0.0);","for(int x=-1; x<=1; x++) {","	for(int y=-1; y<=1; y++) {","		result += texture2D(tDiffuse, vUv + vec2(x, y) / viewport).rgb;","	}","}","gl_FragColor = vec4(result / vec3(9.0), 1.0);","}"].join("\n")},a.lightDepth={processors:[o.animation.processor],defines:{SHADOW_TYPE:0,WEIGHTS:!0,JOINTIDS:!0},attributes:{vertexPosition:t.POSITION,vertexJointIDs:t.JOINTIDS,vertexWeights:t.WEIGHTS},uniforms:{viewMatrix:e.VIEW_MATRIX,projectionMatrix:e.PROJECTION_MATRIX,worldMatrix:e.WORLD_MATRIX,cameraScale:e.MAIN_DEPTH_SCALE},vshader:["attribute vec3 vertexPosition;","uniform mat4 viewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 worldMatrix;","varying vec4 worldPosition;",o.animation.prevertex,"void main(void) {","mat4 wMatrix = worldMatrix;",o.animation.vertex,"worldPosition = viewMatrix * wMatrix * vec4(vertexPosition, 1.0);","gl_Position = projectionMatrix * worldPosition;","}"].join("\n"),fshader:["uniform float cameraScale;","varying vec4 worldPosition;","void main(void)","{","float linearDepth = length(worldPosition) * cameraScale;","#if SHADOW_TYPE == 0","gl_FragColor = vec4(linearDepth);","#elif SHADOW_TYPE == 1","gl_FragColor = vec4(linearDepth);","#elif SHADOW_TYPE == 2","gl_FragColor = vec4(linearDepth, linearDepth * linearDepth, 0.0, 0.0);","#endif","}"].join("\n")},a.packDepth={attributes:{vertexPosition:t.POSITION},uniforms:{viewMatrix:e.VIEW_MATRIX,projectionMatrix:e.PROJECTION_MATRIX,worldMatrix:e.WORLD_MATRIX,farPlane:e.FAR_PLANE},vshader:["attribute vec3 vertexPosition;","uniform mat4 viewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 worldMatrix;","varying vec4 vPosition;","void main(void) {","	vPosition = viewMatrix * worldMatrix * vec4(vertexPosition, 1.0);","	gl_Position = projectionMatrix * vPosition;","}"].join("\n"),fshader:["uniform float farPlane;",i.methods.packDepth,"varying vec4 vPosition;","void main(void)","{","	float linearDepth = min(length(vPosition), farPlane) / farPlane;","	gl_FragColor = packDepth(linearDepth);","}"].join("\n")},a.pickingShader={defines:{WEIGHTS:!0,JOINTIDS:!0},attributes:{vertexPosition:t.POSITION,vertexJointIDs:t.JOINTIDS,vertexWeights:t.WEIGHTS},uniforms:{viewMatrix:e.VIEW_MATRIX,projectionMatrix:e.PROJECTION_MATRIX,worldMatrix:e.WORLD_MATRIX,cameraFar:e.FAR_PLANE,id:function(t){return t.renderable.id+1}},processors:[o.animation.processor],vshader:["attribute vec3 vertexPosition;","uniform mat4 viewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 worldMatrix;","uniform float cameraFar;",o.animation.prevertex,"varying float depth;","void main() {","mat4 wMatrix = worldMatrix;",o.animation.vertex,"vec4 mvPosition = viewMatrix * wMatrix * vec4( vertexPosition, 1.0 );","depth = length(mvPosition.xyz) / cameraFar;","gl_Position = projectionMatrix * mvPosition;","}"].join("\n"),fshader:["uniform float id;","varying float depth;",i.methods.packDepth16,"void main() {","vec2 packedId = vec2(floor(id/255.0), mod(id, 255.0)) * vec2(1.0/255.0);","vec2 packedDepth = packDepth16(depth);","gl_FragColor = vec4(packedId, packedDepth);","}"].join("\n")},a}),define("goo/addons/ammo/AmmoComponent",["goo/entities/EntityUtils","goo/entities/components/Component","goo/math/Quaternion","goo/addons/ammo/calculateTriangleMeshShape","goo/shapes/Box","goo/shapes/Quad","goo/shapes/Sphere","goo/renderer/Material","goo/shapes/ShapeCreator","goo/renderer/shaders/ShaderLib","goo/renderer/bounds/BoundingBox","goo/renderer/bounds/BoundingSphere"],function(t,e,i,o,r,n,a,s,c,l,h,u){"use strict";function d(t){this.type="AmmoComponent",this.settings=t=t||{},this.mass=void 0!==t.mass?t.mass:0,this.useBounds=void 0!==t.useBounds?t.useBounds:!1,this.useWorldBounds=void 0!==t.useWorldBounds?t.useWorldBounds:!1,this.useWorldTransform=void 0!==t.useWorldTransform?t.useWorldTransform:!1,this.ammoTransform=new p.btTransform,this.gooQuaternion=new i,this.isTrigger=void 0!==t.isTrigger?t.isTrigger:!1}var p=window.Ammo;return d.prototype=Object.create(e.prototype),d.prototype.getAmmoShapefromGooShape=function(t,e){var i,s=e.scale;if(t.meshDataComponent&&t.meshDataComponent.meshData){var c=t.meshDataComponent.meshData;if(c instanceof r)i=new p.btBoxShape(new p.btVector3(c.xExtent,c.yExtent,c.zExtent));else if(c instanceof a)i=new p.btSphereShape(c.radius);else if(c instanceof n)i=new p.btBoxShape(new p.btVector3(c.xExtent,c.yExtent,.01));else if(this.useBounds||this.mass>0){t.meshDataComponent.computeBoundFromPoints();var l=t.meshDataComponent.modelBound;l instanceof h?i=new p.btBoxShape(new p.btVector3(l.xExtent*s.x,l.yExtent*s.y,l.zExtent*s.z)):l instanceof u&&(i=new p.btSphereShape(l.radius*s.x))}else i=o(t,s.data)}else for(var i=new p.btCompoundShape,d=t.transformComponent.children,f=0;f<d.length;f++){var m=this.getAmmoShapefromGooShape(d[f].entity),g=new p.btTransform;g.setIdentity();var v=d[f].transform.translation;g.setOrigin(new p.btVector3(v.x,v.y,v.z)),i.addChildShape(g,m)}return i},d.prototype.getAmmoShapefromGooShapeWorldBounds=function(e){var i,o=t.getTotalBoundingBox(e);return this.center=o.center,i=new p.btBoxShape(new p.btVector3(o.xExtent,o.yExtent,o.zExtent))},d.prototype.initialize=function(t){var e=t.transformComponent.transform;this.useWorldTransform&&(e=t.transformComponent.worldTransform);var i=e.translation,o=new p.btTransform;o.setIdentity(),o.setOrigin(new p.btVector3(i.x,i.y,i.z)),this.gooQuaternion.fromRotationMatrix(e.rotation);var r=this.gooQuaternion;if(o.setRotation(new p.btQuaternion(r.x,r.y,r.z,r.w)),this.shape,this.useWorldBounds?(t._world.process(),this.shape=this.getAmmoShapefromGooShapeWorldBounds(t,e),this.difference=this.center.clone().sub(e.translation).invert()):this.shape=this.getAmmoShapefromGooShape(t,e),0==this.isTrigger){var n=new p.btDefaultMotionState(o),a=new p.btVector3(0,0,0);0!==this.mass&&this.shape.calculateLocalInertia(this.mass,a);var s=new p.btRigidBodyConstructionInfo(this.mass,n,this.shape,a);this.body=new p.btRigidBody(s)}},d.prototype.showBounds=function(e){var i,o=t.getTotalBoundingBox(e);o.xExtent?i=t.createTypicalEntity(e._world,c.createBox(2*o.xExtent,2*o.yExtent,2*o.zExtent)):o.radius&&(i=t.createTypicalEntity(e._world,c.createSphere(12,12,o.radius)));var r=s.createMaterial(l.simpleLit);r.wireframe=!0,i.meshRendererComponent.materials.push(r),i.transformComponent.setTranslation(o.center),i.addToWorld(),this.bv=i},d.prototype.copyPhysicalTransformToVisual=function(t){var e=t.transformComponent;if(this.body){this.body.getMotionState().getWorldTransform(this.ammoTransform);var i=this.ammoTransform.getRotation();this.gooQuaternion.setd(i.x(),i.y(),i.z(),i.w()),e.transform.rotation.copyQuaternion(this.gooQuaternion);var o=this.ammoTransform.getOrigin();e.setTranslation(o.x(),o.y(),o.z()),this.settings.showBounds&&(this.bv||this.showBounds(t),this.bv.transformComponent.transform.rotation.copy(e.transform.rotation),this.bv.transformComponent.setTranslation(e.transform.translation)),this.difference&&e.addTranslation(this.difference)}},d}),define("goo/addons/ammo/AmmoSystem",["goo/entities/systems/System"],function(t){"use strict";function e(e){t.call(this,"AmmoSystem",["AmmoComponent","TransformComponent"]),this.settings=e||{},this.fixedTime=1/(this.settings.stepFrequency||60),this.maxSubSteps=this.settings.maxSubSteps||5;var o=new i.btDefaultCollisionConfiguration,r=new i.btCollisionDispatcher(o),n=new i.btDbvtBroadphase,a=new i.btSequentialImpulseConstraintSolver;this.ammoWorld=new i.btDiscreteDynamicsWorld(r,n,a,o),this.ammoWorld.setGravity(new i.btVector3(0,this.settings.gravity||-9.81,0))}var i=window.Ammo;return e.prototype=Object.create(t.prototype),e.prototype.inserted=function(t){t.ammoComponent?(t.ammoComponent.initialize(t),this.ammoWorld.addRigidBody(t.ammoComponent.body)):console.log("Warning: missing entity.ammoComponent")},e.prototype.deleted=function(t){t.ammoComponent&&this.ammoWorld.remove(t.ammoComponent.body)},e.prototype.process=function(t,e){this.ammoWorld.stepSimulation(e,this.maxSubSteps,this.fixedTime);for(var i=0;i<t.length;i++){var o=t[i];o.ammoComponent.mass>0&&o.ammoComponent.copyPhysicalTransformToVisual(o,e)}},e}),define("goo/addons/box2d/components/Box2DComponent",["goo/entities/components/Component"],function(t){"use strict";function e(t){this.type="Box2DComponent",this.body=null,this.world=null,this.mass=1,this.settings=t||{},this.shape=t.shape?t.shape:"box",this.width=t.width?t.width:1,this.height=t.height?t.height:1,this.radius=t.radius?t.radius:1,this.vertices=t.vertices?t.vertices:[0,1,2,2,0,2],this.movable=t.movable===!1?!1:!0,this.friction=t.friction?t.friction:1,this.restitution=t.restitution?t.restitution:0,this.offsetX=t.offsetX?t.offsetX:0,this.offsetY=t.offsetY?t.offsetY:0}return e.prototype=Object.create(t.prototype),e}),define("goo/addons/box2d/systems/Box2DSystem",["goo/entities/systems/System"],function(t){"use strict";function e(){t.call(this,"Box2DSystem",["Box2DComponent","MeshDataComponent"]),this.SCALE=.5,this.world=new Box2D.b2World(new Box2D.b2Vec2(0,-9.81)),this.sortVertexesClockWise=function(t,e){var i=Math.atan2(t.get_y(),t.get_x()),o=Math.atan2(e.get_y(),e.get_x());return i>o?1:-1},this.velocityIterations=8,this.positionIterations=3;var e=4;this.createPolygonShape=function(t){for(var i=new Box2D.b2PolygonShape,o=Box2D.allocate(2*t.length*e,"float",Box2D.ALLOC_STACK),r=0,n=0;n<t.length;n++)Box2D.setValue(o+r,t[n].get_x(),"float"),Box2D.setValue(o+(r+e),t[n].get_y(),"float"),r+=2*e;var a=Box2D.wrapPointer(o,Box2D.b2Vec2);return i.Set(a,t.length),i}}return e.prototype=Object.create(t.prototype),e.prototype.inserted=function(t){var e=t.box2DComponent,i=0,o=0,r=new Box2D.b2PolygonShape;if("box"===e.shape)r.SetAsBox(e.width*this.SCALE,e.height*this.SCALE);else if("circle"===e.shape)r=new Box2D.b2CircleShape,r.set_m_radius(e.radius);else if("mesh"===e.shape){for(var n=t.meshDataComponent.meshData,a=n.getAttributeBuffer("POSITION"),s=0,c=[],l=1/0,h=-1/0,u=1/0,d=-1/0;s<=a.length-3;){var p=a[s],f=a[++s];l>f&&(l=f),f>h&&(h=f),u>p&&(u=p),p>d&&(d=p),++s,t.transformComponent.updateWorldTransform();var m=new Box2D.b2Vec2(p,f);c.push(m)}r=this.createPolygonShape(c),i=h-l,o=d-u}else if("polygon"===e.shape){for(var c=[],s=0;s<=e.vertices.length-2;){var m=new Box2D.b2Vec2(e.vertices[s],e.vertices[++s]);c.push(m),++s}r=this.createPolygonShape(c)}var g=new Box2D.b2FixtureDef;g.set_shape(r),g.set_density(1),g.set_friction(e.friction),g.set_restitution(e.restitution);var v=new Box2D.b2BodyDef;e.movable===!0&&v.set_type(Box2D.b2_dynamicBody),v.set_position(new Box2D.b2Vec2(t.transformComponent.transform.translation.x+e.offsetX,t.transformComponent.transform.translation.y+e.offsetY));var y=t.transformComponent.transform.rotation.toAngles();v.set_angle(y.z);var x=this.world.CreateBody(v);x.CreateFixture(g),x.SetLinearDamping(.95),x.SetAngularDamping(.6),e.body=x,e.world=this.world,t.body=x,t.body.h=i,t.body.w=o},e.prototype.deleted=function(t){this.world.DestroyBody(t.body)},e.prototype.process=function(t,e){this.world.Step(e,this.velocityIterations,this.positionIterations);for(var i=0;i<t.length;i++){var o=t[i],r=o.transformComponent,n=r.transform,a=o.body.GetPosition(),s=a.get_x(),c=a.get_y();-10>c?o.removeFromWorld():(n.translation.x=s-o.box2DComponent.offsetX,n.translation.y=c-o.box2DComponent.offsetY,r.setRotation(0,0,o.body.GetAngle()),r.setUpdated())}},e}),define("goo/addons/cannon/CannonComponent",["goo/entities/components/Component"],function(t){"use strict";function e(t){this.type="CannonComponent",this.settings=t||{},this.mass=void 0!==t.mass?t.mass:0,this.useBounds=void 0!==t.useBounds?t.useBounds:!1,this.linearDamping=void 0!==t.linearDamping?t.linearDamping:0,this.angularDamping=void 0!==t.angularDamping?t.angularDamping:0}return e.prototype=Object.create(t.prototype),e}),define("goo/addons/cannon/CannonSystem",["goo/entities/systems/System","goo/renderer/bounds/BoundingBox","goo/renderer/bounds/BoundingSphere","goo/math/Quaternion","goo/shapes/Box","goo/shapes/Quad","goo/shapes/Sphere","goo/renderer/MeshData"],function(t,e,i,o,r,n,a,s){"use strict";function c(e){t.call(this,"CannonSystem",["CannonComponent","TransformComponent"]),e=e||{};var i=this.world=new l.World;i.gravity.y=-9.82,i.broadphase=new l.NaiveBroadphase,this.stepFrequency=e.stepFrequency||60,this.quat=new o}var l=window.CANNON;return c.prototype=Object.create(t.prototype),c.prototype.createShape=function(t){var o,c=t.cannonComponent,h=t.transformComponent;if(t.meshDataComponent){var u=t.meshDataComponent;if(c.useBounds){u.computeBoundFromPoints();var d=u.modelBound;d instanceof e?o=new l.Box(new l.Vec3(d.xExtent,d.yExtent,d.zExtent)):d instanceof i&&(o=new l.Sphere(d.radius))}else{var p=u.meshData;if(p instanceof r)o=new l.Box(new l.Vec3(p.xExtent,p.yExtent,p.zExtent));else if(p instanceof a)o=new l.Sphere(p.radius);else if(p instanceof n)o=new l.Plane;else{for(var f=[],m=[],g=p.getAttributeBuffer(s.POSITION),v=p.getIndexBuffer(),y=0;y<3*p.vertexCount;y+=3)f.push(new l.Vec3(g[y],g[y+1],g[y+2]));for(var y=0;y<p.indexCount;y+=3){var x=[v[y],v[y+1],v[y+2]];m.push(x)}o=new l.ConvexPolyhedron(f,m)}}}else for(var w=h.children,y=0;y<w.length;y++){var _=w[y].entity,b=this.createShape(_);if(b){o||(o=new l.Compound);var S=_.transformComponent.transform.translation,M=_.transformComponent.transform.rotation,C=new l.Vec3(S.x,S.y,S.z);this.quat.fromRotationMatrix(M);var T=new l.Quaternion(this.quat.x,this.quat.y,this.quat.z,this.quat.w);o.addChild(b,C,T)}}return o},c.prototype.inserted=function(t){var e=t.cannonComponent,i=t.transformComponent,o=this.createShape(t);if(!o)return t.clearComponent("CannonComponent"),void 0;var r=new l.RigidBody(e.mass,o);r.position.set(i.transform.translation.x,i.transform.translation.y,i.transform.translation.z),this.quat.fromRotationMatrix(i.transform.rotation),r.quaternion.set(this.quat.x,this.quat.y,this.quat.z,this.quat.w),e.body=r,this.world.add(r)},c.prototype.deleted=function(t){var e=t.cannonComponent;e&&this.world.remove(e.body)},c.prototype.process=function(t){this.world.step(1/this.stepFrequency);for(var e=0;e<t.length;e++){var i=t[e],o=i.cannonComponent,r=o.body.position;i.transformComponent.setTranslation(r.x,r.y,r.z);var n=o.body.quaternion;this.quat.set(n.x,n.y,n.z,n.w),i.transformComponent.transform.rotation.copyQuaternion(this.quat),i.transformComponent.setUpdated()}},c}),define("goo/addons/howler/components/HowlerComponent",["goo/entities/components/Component"],function(t){"use strict";function e(){this.type="HowlerComponent",this.sounds=[]}return e.prototype=Object.create(t.prototype),e.prototype.addSound=function(t){-1===this.sounds.indexOf(t)&&this.sounds.push(t)},e.prototype.playSound=function(t,e,i){this.sounds[t].play(e,i)},e.prototype.getSound=function(t){return this.sounds[t]},e}),define("goo/renderer/RendererRecord",[],function(){"use strict";function t(){this.currentBuffer={ArrayBuffer:{buffer:null,valid:!1},ElementArrayBuffer:{buffer:null,valid:!1}},this.currentFrameBuffer=null,this.clippingTestValid=!1,this.clippingTestEnabled=!1,this.clips=[],this.enabledTextures=0,this.texturesValid=!1,this.currentTextureArraysUnit=0,this.textureRecord=[],this.usedProgram=null,this.boundAttributes=[],this.depthRecord={},this.cullRecord={},this.blendRecord={},this.offsetRecord={},this.lineRecord={},this.pointRecord={}}return t.prototype.invalidateBuffer=function(t){this.currentBuffer[t].buffer=null,this.currentBuffer[t].valid=!1},t}),define("goo/util/rsvp",["exports"],function(t){"use strict";function e(t,e){n.async(function(){t.trigger("promise:resolved",{detail:e}),t.isResolved=!0,t.resolvedValue=e})}function i(t,e){n.async(function(){t.trigger("promise:failed",{detail:e}),t.isRejected=!0,t.rejectedValue=e})}function o(t){var e,i=[],o=new g,r=t.length;0===r&&o.resolve([]);var n=function(t,e){i[t]=e,0===--r&&o.resolve(i)},a=function(t){return function(e){n(t,e)}},s=function(t){o.reject(t)};for(e=0;r>e;e++)t[e].then(a(e),s);return o}function r(t,e){n[t]=e}var n={},a="undefined"!=typeof window?window:{},s=a.MutationObserver||a.WebKitMutationObserver,c=window.process;if("undefined"!=typeof c&&"[object process]"==={}.toString.call(c))n.async=function(t,e){c.nextTick(function(){t.call(e)})};else if(s){var l=[],h=new s(function(){var t=l.slice();l=[],t.forEach(function(t){var e=t[0],i=t[1];e.call(i)})}),u=document.createElement("div");h.observe(u,{attributes:!0}),window.addEventListener("unload",function(){h.disconnect(),h=null}),n.async=function(t,e){l.push([t,e]),u.setAttribute("drainQueue","drainQueue")}}else n.async=function(t,e){setTimeout(function(){t.call(e)},1)};var d=function(t,e){this.type=t;for(var i in e)e.hasOwnProperty(i)&&(this[i]=e[i])},p=function(t,e){for(var i=0,o=t.length;o>i;i++)if(t[i][0]===e)return i;return-1},f=function(t){var e=t._promiseCallbacks;return e||(e=t._promiseCallbacks={}),e},m={mixin:function(t){return t.on=this.on,t.off=this.off,t.trigger=this.trigger,t},on:function(t,e,i){var o,r,n=f(this);for(t=t.split(/\s+/),i=i||this;r=t.shift();)o=n[r],o||(o=n[r]=[]),-1===p(o,e)&&o.push([e,i])},off:function(t,e){var i,o,r,n=f(this);for(t=t.split(/\s+/);o=t.shift();)e?(i=n[o],r=p(i,e),-1!==r&&i.splice(r,1)):n[o]=[]},trigger:function(t,e){var i,o,r,n,a,s=f(this);if(i=s[t])for(var c=0,l=i.length;l>c;c++)o=i[c],r=o[0],n=o[1],"object"!=typeof e&&(e={detail:e}),a=new d(t,e),r.call(n,a)}},g=function(){this.on("promise:resolved",function(t){this.trigger("success",{detail:t.detail})},this),this.on("promise:failed",function(t){this.trigger("error",{detail:t.detail})},this)},v=function(){},y=function(t,e,i,o){var r,n,a,s,c="function"==typeof i;if(c)try{r=i(o.detail),a=!0}catch(l){s=!0,n=l}else r=o.detail,a=!0;r&&"function"==typeof r.then?r.then(function(t){e.resolve(t)},function(t){e.reject(t)}):c&&a?e.resolve(r):s?e.reject(n):e[t](r)};g.prototype={then:function(t,e){var i=new g;return this.isResolved&&n.async(function(){y("resolve",i,t,{detail:this.resolvedValue})},this),this.isRejected&&n.async(function(){y("reject",i,e,{detail:this.rejectedValue})},this),this.on("promise:resolved",function(e){y("resolve",i,t,e)}),this.on("promise:failed",function(t){y("reject",i,e,t)}),i},resolve:function(t){e(this,t),this.resolve=v,this.reject=v},reject:function(t){i(this,t),this.resolve=v,this.reject=v}},m.mixin(g.prototype),t.Promise=g,t.Event=d,t.EventTarget=m,t.all=o,t.configure=r}),define("goo/util/Ajax",["goo/util/rsvp"],function(t){"use strict";function e(t){this._loadStack=[],this._callback=t}return e.prototype.get=function(e){var i=new t.Promise,o=this._progress.bind(this),r={loaded:0,total:0,lengthComputable:!1};this._loadStack.push(r),e=e||{};var n=e.url||"",a="GET",s=!0,c=new XMLHttpRequest;return c.open(a,n,s),e.responseType&&(c.responseType=e.responseType),c.onreadystatechange=function(){4===c.readyState&&(c.status>=200&&c.status<=299?(r.loaded=r.total,o(),i.resolve(c)):i.reject(c.statusText))},c.addEventListener("progress",function(t){r.loaded=t.loaded||t.position,r.total=t.total||t.totalSize,r.lengthComputable=t.lengthComputable,o()},!1),c.send(),i},e.prototype._progress=function(){if(this._callback){for(var t={total:0,loaded:0,count:this._loadStack.length},e=0;e<this._loadStack.length;e++)t.total+=this._loadStack[e].total,t.loaded+=this._loadStack[e].loaded;this._callback(t)}},e.ARRAY_BUFFER="arraybuffer",e.prototype.load=function(t,i){if("undefined"==typeof t||null===t)throw new Error("Ajax(): `path` was undefined/null");var o={url:t};i===e.ARRAY_BUFFER&&(o.responseType=e.ARRAY_BUFFER);var r=this.get(o).then(function(t){return t.response});return r.then(null,function(t){throw console.error("Ajax.load(): Could not retrieve data from `"+o.url+"`.\n Reason: "+t),new Error("Ajax.load(): Could not retrieve data from `"+o.url+"`.\n Reason: "+t)}),r},e.prototype.loadImage=function(i,o){window.URL=window.URL||window.webkitURL;var r=new t.Promise,n=new Image;return n.addEventListener("load",function(){n.dataReady=!0,window.URL&&void 0!=window.URL.revokeObjectURL&&window.URL.revokeObjectURL(n.src),r.resolve(n)},!1),n.addEventListener("error",function(t){console.log(t),r.reject("Ajax.loadImage(): Couldn't load from ["+i+"]")},!1),o?this.load(i,function(t){var e=new Uint8Array(t,0,t.byteLength),o="image/jpeg";/\.png$/.test(i)&&(o="image/png");var r=new Blob([e],{type:o});return n.src=window.URL.createObjectURL(r),n},e.ARRAY_BUFFER):n.src=i,r},e}),define("goo/loaders/Loader",["goo/util/rsvp","goo/util/Ajax"],function(t,e){"use strict";function i(t){if("undefined"!=typeof t&&null!==t&&"object"!=typeof t)throw new Error("Loader(): Argument `parameters` must be of type `object`");("undefined"==typeof t||null===t)&&(t={}),this.rootPath=t.rootPath||"",this.xhr=t.xhr||new e(this._progressCallback.bind(this)),this._progressCallbacks=[],this.total=0}return i.prototype.load=function(t,e,o){if("undefined"==typeof t||null===t)throw new Error("Loader(): `path` was undefined/null");var r={url:this._buildURL(t)};o===i.ARRAY_BUFFER&&(r.responseType=i.ARRAY_BUFFER);var n=this.xhr.get(r).then(function(t){return t.response});return e&&(n=n.then(function(t){return"function"==typeof e?e(t):t})),n.then(function(){console.log("Loaded: "+r.url)}),n.then(null,function(t){throw console.error("Loader.load(): Could not retrieve data from `"+r.url+"`.\n Reason: "+t),new Error("Loader.load(): Could not retrieve data from `"+r.url+"`.\n Reason: "+t)}),n},i.prototype.addProgressCallback=function(t){this._progressCallbacks.push(t)},i.prototype.removeProgressCallback=function(t){for(var e=0;e<this._progressCallbacks.length;e++)if(this._progressCallbacks[e]===t){this._progressCallbacks.splice(e,1);break}},i.prototype._progressCallback=function(t){this.total&&(t.total=this.total);for(var e=0;e<this._progressCallbacks.length;e++)this._progressCallbacks[e](t)},i.prototype.loadImage=function(e,o){window.URL=window.URL||window.webkitURL;var r=new t.Promise,n=new Image;return n.addEventListener("load",function(){n.dataReady=!0,window.URL&&void 0!=window.URL.revokeObjectURL&&window.URL.revokeObjectURL(n.src),r.resolve(n)},!1),n.addEventListener("error",function(){r.reject("Loader.loadImage(): Couldn't load from ["+e+"]")},!1),o?this.load(e,function(t){var i=new Uint8Array(t,0,t.byteLength),o="image/jpeg";/\.png$/.test(e)&&(o="image/png");var r=new Blob([i],{type:o});
n.src=window.URL.createObjectURL(r)},i.ARRAY_BUFFER):n.src=this._buildURL(e),r},i.prototype._buildURL=function(t){return this.rootPath+window.escape(t)},i.ARRAY_BUFFER="arraybuffer",i}),define("goo/loaders/dds/DdsUtils",[],function(){"use strict";function t(){}return t.getDdsExtension=function(t){for(var e=["","WEBKIT_","MOZ_"],i=0;i<e.length;i++){var o=t.getExtension(e[i]+"WEBGL_compressed_texture_s3tc");if("undefined"!=typeof o&&null!==o)return o}return null},t.isSupported=function(e){return null!==t.getDdsExtension(e)},t.shiftCount=function(t){if(0===t)return 0;for(var e=0;0===(1&t);)if(t>>=1,e++,e>32)throw"invalid mask!";return e},t.isSet=function(t,e){return(t&e)===e},t.getIntFromString=function(e){for(var i=[],o=0;o<e.length;o++)i[o]=e.charCodeAt(o);return t.getIntFromBytes(i)},t.getIntFromBytes=function(t){var e=0;return e|=(255&t[0])<<0,t.length>1&&(e|=(255&t[1])<<8),t.length>2&&(e|=(255&t[2])<<16),t.length>3&&(e|=(255&t[3])<<24),e},t.getComponents=function(t){switch(t){case"Alpha":return 1;case"RGB":return 3;case"RGBA":return 4;case"Luminance":return 1;case"LuminanceAlpha":return 2;case"PrecompressedDXT1":return 1;case"PrecompressedDXT1A":return 1;case"PrecompressedDXT3":return 2;case"PrecompressedDXT5":return 2}return 0},t.flipDXT=function(e,i,o,r){for(var n=new Uint8Array(e.length),a=i+3>>2,s=o+3>>2,c=8*t.getComponents(r),l=0;s>l;l++)for(var h=s-l-1,u=0;a>u;u++){var d=(h*a+u)*c,p=(l*a+u)*c;switch(r){case"PrecompressedDXT1":case"PrecompressedDXT1A":n[d+0]=e[p+0],n[d+1]=e[p+1],n[d+2]=e[p+2],n[d+3]=e[p+3],n[d+4]=e[p+7],n[d+5]=e[p+6],n[d+6]=e[p+5],n[d+7]=e[p+4];break;case"PrecompressedDXT3":n[d+0]=e[p+6],n[d+1]=e[p+7],n[d+2]=e[p+4],n[d+3]=e[p+5],n[d+4]=e[p+2],n[d+5]=e[p+3],n[d+6]=e[p+0],n[d+7]=e[p+1],n[d+8]=e[p+8],n[d+9]=e[p+9],n[d+10]=e[p+10],n[d+11]=e[p+11],n[d+12]=e[p+15],n[d+13]=e[p+14],n[d+14]=e[p+13],n[d+15]=e[p+12];break;case"PrecompressedDXT5":n[d+0]=e[p+0],n[d+1]=e[p+1],t.getBytesFromUInt24(n,d+5,t.flipUInt24(t.getUInt24(e,p+2))),t.getBytesFromUInt24(n,d+2,t.flipUInt24(t.getUInt24(e,p+5))),n[d+8]=e[p+8],n[d+9]=e[p+9],n[d+10]=e[p+10],n[d+11]=e[p+11],n[d+12]=e[p+15],n[d+13]=e[p+14],n[d+14]=e[p+13],n[d+15]=e[p+12]}}return n},t.getUInt24=function(t,e){var i=0;return i|=(255&t[e+0])<<0,i|=(255&t[e+1])<<8,i|=(255&t[e+2])<<16},t.getBytesFromUInt24=function(t,e,i){t[e+0]=255&i,t[e+1]=(65280&i)>>8,t[e+2]=(16711680&i)>>16},t.ThreeBitMask=7,t.flipUInt24=function(e){for(var i=[],o=0;2>o;o++)i.push([0,0,0,0]);i[0][0]=e&t.ThreeBitMask,e>>=3,i[0][1]=e&t.ThreeBitMask,e>>=3,i[0][2]=e&t.ThreeBitMask,e>>=3,i[0][3]=e&t.ThreeBitMask,e>>=3,i[1][0]=e&t.ThreeBitMask,e>>=3,i[1][1]=e&t.ThreeBitMask,e>>=3,i[1][2]=e&t.ThreeBitMask,e>>=3,i[1][3]=e&t.ThreeBitMask;var r=0;return r|=i[1][0]<<0,r|=i[1][1]<<3,r|=i[1][2]<<6,r|=i[1][3]<<9,r|=i[0][0]<<12,r|=i[0][1]<<15,r|=i[0][2]<<18,r|=i[0][3]<<21},t}),define("goo/loaders/dds/DdsLoader",["goo/loaders/dds/DdsUtils"],function(t){"use strict";function e(){this.dwSize=0,this.dwFlags=0,this.dwFourCC=0,this.dwRGBBitCount=0,this.dwRBitMask=0,this.dwGBitMask=0,this.dwBBitMask=0,this.dwABitMask=0}function i(){this.dwSize=0,this.dwFlags=0,this.dwHeight=0,this.dwWidth=0,this.dwLinearSize=0,this.dwDepth=0,this.dwMipMapCount=0,this.dwAlphaBitDepth=0,this.dwReserved1=[],this.ddpf=null,this.dwCaps=0,this.dwCaps2=0,this.dwCaps3=0,this.dwCaps4=0,this.dwTextureStage=0}function o(){this.flipVertically=!1,this.bpp=0,this.header=null,this.headerDX10=null,this.mipmapByteSizes=[]}function r(){}return e.HEADER_OFFSET=19,e.DDPF_ALPHAPIXELS=1,e.DDPF_ALPHA=2,e.DDPF_FOURCC=4,e.DDPF_RGB=64,e.DDPF_YUV=512,e.DDPF_LUMINANCE=131072,e.read=function(t){var i=new e;if(i.dwSize=t[e.HEADER_OFFSET+0],32!==i.dwSize)throw"invalid pixel format size: "+i.dwSize;return i.dwFlags=t[e.HEADER_OFFSET+1],i.dwFourCC=t[e.HEADER_OFFSET+2],i.dwRGBBitCount=t[e.HEADER_OFFSET+3],i.dwRBitMask=t[e.HEADER_OFFSET+4],i.dwGBitMask=t[e.HEADER_OFFSET+5],i.dwBBitMask=t[e.HEADER_OFFSET+6],i.dwABitMask=t[e.HEADER_OFFSET+7],i},i.DDSD_CAPS=1,i.DDSD_HEIGHT=2,i.DDSD_WIDTH=4,i.DDSD_PITCH=8,i.DDSD_PIXELFORMAT=4096,i.DDSD_MIPMAPCOUNT=131072,i.DDSD_LINEARSIZE=524288,i.DDSD_DEPTH=8388608,i.DDSCAPS_COMPLEX=8,i.DDSCAPS_MIPMAP=4194304,i.DDSCAPS_TEXTURE=4096,i.DDSCAPS2_CUBEMAP=512,i.DDSCAPS2_CUBEMAP_POSITIVEX=1024,i.DDSCAPS2_CUBEMAP_NEGATIVEX=2048,i.DDSCAPS2_CUBEMAP_POSITIVEY=4096,i.DDSCAPS2_CUBEMAP_NEGATIVEY=8192,i.DDSCAPS2_CUBEMAP_POSITIVEZ=16384,i.DDSCAPS2_CUBEMAP_NEGATIVEZ=32768,i.DDSCAPS2_VOLUME=2097152,i.read=function(o){var r=new i;if(r.dwSize=o[1],124!==r.dwSize)throw"invalid dds header size: "+r.dwSize;r.dwFlags=o[2],r.dwHeight=o[3],r.dwWidth=o[4],r.dwLinearSize=o[5],r.dwDepth=o[6],r.dwMipMapCount=o[7],r.dwAlphaBitDepth=o[8];for(var n=0;n<r.dwReserved1.length;n++)r.dwReserved1[n]=o[9+n];r.ddpf=e.read(o),r.dwCaps=o[27],r.dwCaps2=o[28],r.dwCaps3=o[29],r.dwCaps4=o[30],r.dwTextureStage=o[31];var a=1+Math.ceil(Math.log(Math.max(r.dwHeight,r.dwWidth))/Math.log(2));return t.isSet(r.dwCaps,i.DDSCAPS_MIPMAP)?t.isSet(r.dwFlags,i.DDSD_MIPMAPCOUNT)?r.dwMipMapCount!==a&&console.warn("Got "+r.dwMipMapCount+" mipmaps, expected "+a):r.dwMipMapCount=a:r.dwMipMapCount=1,r},o.prototype.calcMipmapSizes=function(t){for(var e=this.header.dwWidth,i=this.header.dwHeight,o=0,r=0;r<this.header.dwMipMapCount;r++)o=t?2*~~((e+3)/4)*~~((i+3)/4)*this.bpp:~~(e*i*this.bpp/8),this.mipmapByteSizes.push(4*~~((o+3)/4)),e=~~(e/2)>1?~~(e/2):1,i=~~(i/2)>1?~~(i/2):1},r.updateDepth=function(e,o){if(t.isSet(o.header.dwCaps2,i.DDSCAPS2_CUBEMAP)){var r=0;if(t.isSet(o.header.dwCaps2,i.DDSCAPS2_CUBEMAP_POSITIVEX)&&r++,t.isSet(o.header.dwCaps2,i.DDSCAPS2_CUBEMAP_NEGATIVEX)&&r++,t.isSet(o.header.dwCaps2,i.DDSCAPS2_CUBEMAP_POSITIVEY)&&r++,t.isSet(o.header.dwCaps2,i.DDSCAPS2_CUBEMAP_NEGATIVEY)&&r++,t.isSet(o.header.dwCaps2,i.DDSCAPS2_CUBEMAP_POSITIVEZ)&&r++,t.isSet(o.header.dwCaps2,i.DDSCAPS2_CUBEMAP_NEGATIVEZ)&&r++,6!==r)throw new Error("Cubemaps without all faces defined are not currently supported.");e.depth=r}else e.depth=o.header.dwDepth>0?o.header.dwDepth:1},r.readDXT=function(e,i,o,r){if(r.image.isCompressed=!0,!o.flipVertically)return new Uint8Array(e.buffer,e.byteOffset+0,i);for(var n=o.header.dwWidth,a=o.header.dwHeight,s=new Uint8Array(i),c=0,l=0;l<o.header.dwMipMapCount;l++){var h=e.subarray(c,c+o.mipmapByteSizes[l]),u=t.flipDXT(h,n,a,r.format);s.set(u,c),c+=u.length,n=~~(n/2)>1?~~(n/2):1,a=~~(a/2)>1?~~(a/2):1}return s},r.readUncompressed=function(e,i,o,r,n,a,s,c){var l=t.shiftCount(s.header.ddpf.dwRBitMask),h=t.shiftCount(s.header.ddpf.dwGBitMask),u=t.shiftCount(s.header.ddpf.dwBBitMask),d=t.shiftCount(s.header.ddpf.dwABitMask),p=~~(s.header.ddpf.dwRGBBitCount/8),f=1*t.getComponents(c.format),m=new Uint8Array(i),g=s.header.dwWidth,v=s.header.dwHeight,y=0,x=0,w=0,_=[];for(w=0;p>w;w++)_.push(0);for(var b=0;b<s.header.dwMipMapCount;b++){for(var S=0;v>S;S++)for(var M=0;g>M;M++){for(w=0;p>w;w++)_[w]=e[x++];w=t.getIntFromBytes(_);var C=(w&s.header.ddpf.dwRBitMask)>>l,T=(w&s.header.ddpf.dwGBitMask)>>h,E=(w&s.header.ddpf.dwBBitMask)>>u,P=(w&s.header.ddpf.dwABitMask)>>d;n?m[y++]=P:r?(m[y++]=C,a&&(m[y++]=P)):o&&(m[y++]=C,m[y++]=T,m[y++]=E,a&&(m[y++]=P))}y+=g*v*f,g=~~(g/2)>1?~~(g/2):1,v=~~(v/2)>1?~~(v/2):1}return m},r.populate=function(i,o,n){var a=o.header.ddpf.dwFlags,s=t.isSet(a,e.DDPF_FOURCC),c=t.isSet(a,e.DDPF_RGB),l=t.isSet(a,e.DDPF_ALPHAPIXELS),h=t.isSet(a,e.DDPF_LUMINANCE),u=t.isSet(a,e.DDPF_ALPHA);if(i.type="UnsignedByte",s){var d=o.header.ddpf.dwFourCC;if(d===t.getIntFromString("DXT1"))o.bpp=4,i.format="PrecompressedDXT1A";else if(d===t.getIntFromString("DXT3"))o.bpp=8,i.format="PrecompressedDXT3";else{if(d!==t.getIntFromString("DXT5"))throw d===t.getIntFromString("DX10")?new Error("dxt10 LATC formats not supported currently: "+o.headerDX10.dxgiFormat):d===t.getIntFromString("DXT2")?"DXT2 is not supported.":d===t.getIntFromString("DXT4")?"DXT4 is not supported.":"unsupported compressed dds format found ("+d+")";o.bpp=8,i.format="PrecompressedDXT5"}}else if(o.bpp=o.header.ddpf.dwRGBBitCount,c)i.format=l?"RGBA":"RGB";else{if(!h&&!l)throw new Error("unsupported uncompressed dds format found.");h&&l?i.format="LuminanceAlpha":h?i.format="Luminance":u&&(i.format="Alpha")}o.calcMipmapSizes(s),i.image.mipmapSizes=o.mipmapByteSizes;for(var p=0,f=0;f<o.mipmapByteSizes.length;f++)p+=o.mipmapByteSizes[f];for(var m=[],f=0;f<i.image.depth;f++)s?m.push(r.readDXT(n,p,o,i)):(c||h||u)&&m.push(r.readUncompressed(n,p,c,h,u,l,o,i));i.image.data=1===i.image.depth?m[0]:m,i.image.useArrays=!0},r.prototype.load=function(e,n,a,s,c){var l=new Int32Array(e,s+0,32),h=l[0];if(h!==t.getIntFromString("DDS "))throw"Not a dds file.";var u=new o;u.flipVertically=a,u.header=i.read(l),u.headerDX10=u.header.ddpf.dwFourCC===t.getIntFromString("DX10")?i.read(Int32Array.create(e,s+128,5)):null;var d=n.image;("undefined"==typeof d||null===d)&&(d={},n.image=d),d.width=u.header.dwWidth,d.height=u.header.dwHeight,r.updateDepth(d,u);var p=128+(u.headerDX10?20:0);r.populate(n,u,new Uint8Array(e,s+p,c-p)),(!u.mipmapByteSizes||u.mipmapByteSizes.length<2)&&(n.minFilter="BilinearNoMipMaps"),d.bpp=u.bpp,d.dataReady=!0,n.needsUpdate=!0},r.SUPPORTS_DDS=!1,r.prototype.isSupported=function(){return r.SUPPORTS_DDS},r.prototype.toString=function(){return"DdsLoader"},r}),define("goo/loaders/crunch/CrunchLoader",["goo/loaders/dds/DdsLoader","goo/loaders/dds/DdsUtils"],function(t,e){"use strict";function i(){}return i.cCRNFmtDXT1=0,i.cCRNFmtDXT3=1,i.cCRNFmtDXT5=2,i.prototype.arrayBufferCopy=function(t,e,i,o){var r,n=i/4,a=o%4,s=new Uint32Array(t.buffer,0,(o-a)/4),c=new Uint32Array(e.buffer);for(r=0;r<s.length;r++)c[n+r]=s[r];for(r=o-a;o>r;r++)e[i+r]=t[r]},i.prototype.load=function(t,o,r){if("undefined"==typeof window.CrunchModule)return console.warn("Crunch library not loaded! Include a script tag pointing to lib/crunch/crunch.js in your html-file."),void 0;var n,a,s,c,l,h,u,d,p=window.CrunchModule,f=new Uint8Array(t),m=t.byteLength,g=p._malloc(m);this.arrayBufferCopy(f,p.HEAPU8,g,m),n=p._crn_get_dxt_format(g,m);var v;switch(n){case i.cCRNFmtDXT1:o.format="PrecompressedDXT1A",v=4;break;case i.cCRNFmtDXT3:o.format="PrecompressedDXT3",v=8;break;case i.cCRNFmtDXT5:o.format="PrecompressedDXT5",v=8;break;default:return console.error("Unsupported image format"),0}c=p._crn_get_width(g,m),l=p._crn_get_height(g,m),h=p._crn_get_levels(g,m),s=p._crn_get_uncompressed_size(g,m,0),a=p._malloc(s);var y=o.image;("undefined"==typeof y||null===y)&&(y={},o.image=y),y.width=c,y.height=l,y.depth=1;var x=[];for(o.image.mipmapSizes=[],d=0;h>d;++d)d&&(s=p._crn_get_uncompressed_size(g,m,d)),p._crn_decompress(g,m,a,s,d),u=new Uint8Array(p.HEAPU8.buffer,a,s),r&&(u=e.flipDXT(u,c,l,o.format)),x.push(u),o.image.mipmapSizes.push(s),c*=.5,l*=.5;o.image.data=x,o.image.useArrays=!0,o.type="UnsignedByte",o.image.isCompressed=!0,1>=h&&(o.minFilter="BilinearNoMipMaps"),y.bpp=v,y.dataReady=!0,o.needsUpdate=!0,p._free(g),p._free(a)},i.prototype.dxtToRgb565=function(t,e,i,o){for(var r=new Uint16Array(4),n=new Uint16Array(i*o),a=0,s=0,c=0,l=0,h=0,u=0,d=0,p=0,f=0,m=i/4,g=o/4,v=0;g>v;v++)for(var y=0;m>y;y++)c=e+4*(v*m+y),r[0]=t[c],r[1]=t[c+1],l=31&r[0],h=2016&r[0],u=63488&r[0],d=31&r[1],p=2016&r[1],f=63488&r[1],r[2]=5*l+3*d>>3|2016&5*h+3*p>>3|63488&5*u+3*f>>3,r[3]=5*d+3*l>>3|2016&5*p+3*h>>3|63488&5*f+3*u>>3,a=t[c+2],s=4*v*i+4*y,n[s]=r[3&a],n[s+1]=r[3&a>>2],n[s+2]=r[3&a>>4],n[s+3]=r[3&a>>6],s+=i,n[s]=r[3&a>>8],n[s+1]=r[3&a>>10],n[s+2]=r[3&a>>12],n[s+3]=r[a>>14],a=t[c+3],s+=i,n[s]=r[3&a],n[s+1]=r[3&a>>2],n[s+2]=r[3&a>>4],n[s+3]=r[3&a>>6],s+=i,n[s]=r[3&a>>8],n[s+1]=r[3&a>>10],n[s+2]=r[3&a>>12],n[s+3]=r[a>>14];return n},i.prototype.isSupported=function(){return t.SUPPORTS_DDS},i.prototype.toString=function(){return"CrunchLoader"},i}),define("goo/loaders/tga/TgaLoader",[],function(){"use strict";function t(){this.header=null,this.offset=0,this.use_rle=!1,this.use_pal=!1,this.use_rgb=!1,this.use_grey=!1}return t.TYPE_NO_DATA=0,t.TYPE_INDEXED=1,t.TYPE_RGB=2,t.TYPE_GREY=3,t.TYPE_RLE_INDEXED=9,t.TYPE_RLE_RGB=10,t.TYPE_RLE_GREY=11,t.ORIGIN_MASK=48,t.ORIGIN_SHIFT=4,t.ORIGIN_BL=0,t.ORIGIN_BR=1,t.ORIGIN_UL=2,t.ORIGIN_UR=3,t.prototype.load=function(t,e){this.loadData(new Uint8Array(t));var i=this.getImageData();e.setImage(i,null,i.width,i.height),i.dataReady=!0,e.needsUpdate=!0},t.prototype.loadData=function(e){if(e.length<19)throw new Error("Targa::load() - Not enough data to contain header.");if(this.offset=0,this.header={id_length:e[this.offset++],colormap_type:e[this.offset++],image_type:e[this.offset++],colormap_index:e[this.offset++]|e[this.offset++]<<8,colormap_length:e[this.offset++]|e[this.offset++]<<8,colormap_size:e[this.offset++],origin:[e[this.offset++]|e[this.offset++]<<8,e[this.offset++]|e[this.offset++]<<8],width:e[this.offset++]|e[this.offset++]<<8,height:e[this.offset++]|e[this.offset++]<<8,pixel_size:e[this.offset++],flags:e[this.offset++]},this.checkHeader(),this.header.id_length+this.offset>e.length)throw new Error("Targa::load() - No data ?");switch(this.offset+=this.header.id_length,this.header.image_type){case t.TYPE_RLE_INDEXED:this.use_rle=!0;break;case t.TYPE_INDEXED:this.use_pal=!0;break;case t.TYPE_RLE_RGB:this.use_rle=!0;break;case t.TYPE_RGB:this.use_rgb=!0;break;case t.TYPE_RLE_GREY:this.use_rle=!0;break;case t.TYPE_GREY:this.use_grey=!0}this.parse(e)},t.prototype.checkHeader=function(){switch(this.header.image_type){case t.TYPE_INDEXED:case t.TYPE_RLE_INDEXED:if(this.header.colormap_length>256||24!==this.header.colormap_size||1!==this.header.colormap_type)throw new Error("Targa::checkHeader() - Invalid type colormap data for indexed type");break;case t.TYPE_RGB:case t.TYPE_GREY:case t.TYPE_RLE_RGB:case t.TYPE_RLE_GREY:if(this.header.colormap_type)throw new Error("Targa::checkHeader() - Invalid type colormap data for colormap type");break;case t.TYPE_NO_DATA:throw new Error("Targa::checkHeader() - No data on this TGA file");default:throw new Error("Targa::checkHeader() - Invalid type '"+this.header.image_type+"'")}if(this.header.width<=0||this.header.height<=0)throw new Error("Targa::checkHeader() - Invalid image size");if(8!==this.header.pixel_size&&16!==this.header.pixel_size&&24!==this.header.pixel_size&&32!==this.header.pixel_size)throw new Error("Targa::checkHeader() - Invalid pixel size '"+this.header.pixel_size+"'")},t.prototype.parse=function(t){var e,i,o,r,n;if(e=this.header,i=15&e.flags,r=e.pixel_size>>3,n=e.width*e.height*r,this.use_pal&&(this.palettes=t.subarray(this.offset,this.offset+=e.colormap_length*r)),this.use_rle){o=new Uint8Array(n);for(var a,s,c,l=0,h=new Uint8Array(r);n>l;)if(a=t[this.offset++],s=(127&a)+1,128&a){for(c=0;r>c;++c)h[c]=t[this.offset++];for(c=0;s>c;++c)o.set(h,l+c*r);l+=r*s}else{for(s*=r,c=0;s>c;++c)o[l+c]=t[this.offset++];l+=s}}else o=t.subarray(this.offset,this.offset+=this.use_pal?e.width*e.height:n);this.image=o},t.prototype.getImageData=function(e){var i,o,r,n,a,s,c,l,h=this.header.width,u=this.header.height;switch(l=e||document&&document.createElement("canvas").getContext("2d").createImageData(h,u)||{width:h,height:u,data:new Uint8Array(4*h*u)},(this.header.flags&t.ORIGIN_MASK)>>t.ORIGIN_SHIFT){default:case t.ORIGIN_UL:i=0,r=1,s=h,o=0,n=1,a=u;break;case t.ORIGIN_BL:i=0,r=1,s=h,o=u-1,n=-1,a=-1;break;case t.ORIGIN_UR:i=h-1,r=-1,s=-1,o=0,n=1,a=u;break;case t.ORIGIN_BR:i=h-1,r=-1,s=-1,o=u-1,n=-1,a=-1}return c="getImageData"+(this.use_grey?"Grey":"")+this.header.pixel_size+"bits",this[c](l.data,o,n,a,i,r,s),l},t.prototype.getCanvas=function(){var t=document.createElement("canvas"),e=t.getContext("2d"),i=e.createImageData(this.header.width,this.header.height);return t.width=this.header.width,t.height=this.header.height,e.putImageData(this.getImageData(i),0,0),t},t.prototype.getDataURL=function(t){return this.getCanvas().toDataURL(t||"image/png")},t.prototype.getImageData8bits=function(t,e,i,o,r,n,a){var s,c,l,h=this.image,u=this.palettes,d=this.header.width,p=0;for(l=e;l!==o;l+=i)for(c=r;c!==a;c+=n,p++)s=h[p],t[4*(c+d*l)+3]=255,t[4*(c+d*l)+2]=u[3*s+0],t[4*(c+d*l)+1]=u[3*s+1],t[4*(c+d*l)+0]=u[3*s+2];return t},t.prototype.getImageData16bits=function(t,e,i,o,r,n,a){var s,c,l,h=this.image,u=this.header.width,d=0;for(l=e;l!==o;l+=i)for(c=r;c!==a;c+=n,d+=2)s=h[d+0]+(h[d+1]<<8),t[4*(c+u*l)+0]=(31744&s)>>7,t[4*(c+u*l)+1]=(992&s)>>2,t[4*(c+u*l)+2]=(31&s)>>3,t[4*(c+u*l)+3]=32768&s?0:255;return t},t.prototype.getImageData24bits=function(t,e,i,o,r,n,a){var s,c,l=this.image,h=this.header.width,u=0;for(c=e;c!==o;c+=i)for(s=r;s!==a;s+=n,u+=3)t[4*(s+h*c)+3]=255,t[4*(s+h*c)+2]=l[u+0],t[4*(s+h*c)+1]=l[u+1],t[4*(s+h*c)+0]=l[u+2];return t},t.prototype.getImageData32bits=function(t,e,i,o,r,n,a){var s,c,l=this.image,h=this.header.width,u=0;for(c=e;c!==o;c+=i)for(s=r;s!==a;s+=n,u+=4)t[4*(s+h*c)+2]=l[u+0],t[4*(s+h*c)+1]=l[u+1],t[4*(s+h*c)+0]=l[u+2],t[4*(s+h*c)+3]=l[u+3];return t},t.prototype.getImageDataGrey8bits=function(t,e,i,o,r,n,a){var s,c,l,h=this.image,u=this.header.width,d=0;for(l=e;l!==o;l+=i)for(c=r;c!==a;c+=n,d++)s=h[d],t[4*(c+u*l)+0]=s,t[4*(c+u*l)+1]=s,t[4*(c+u*l)+2]=s,t[4*(c+u*l)+3]=255;return t},t.prototype.getImageDataGrey16bits=function(t,e,i,o,r,n,a){var s,c,l=this.image,h=this.header.width,u=0;for(c=e;c!==o;c+=i)for(s=r;s!==a;s+=n,u+=2)t[4*(s+h*c)+0]=l[u+0],t[4*(s+h*c)+1]=l[u+0],t[4*(s+h*c)+2]=l[u+0],t[4*(s+h*c)+3]=l[u+1];return t},t.prototype.isSupported=function(){return!0},t.prototype.toString=function(){return"TgaLoader"},t}),define("goo/util/Latch",[],function(){"use strict";function t(t,e){this.count=t,this.callback=e}return t.prototype.countDown=function(){this.count--,this.isDone()&&this.callback&&this.callback.done?this.callback.done():this.callback&&this.callback.progress&&this.callback.progress(this.count)},t.prototype.isDone=function(){return 0===this.count},t}),define("goo/renderer/TextureCreator",["goo/loaders/Loader","goo/renderer/Texture","goo/loaders/dds/DdsLoader","goo/loaders/crunch/CrunchLoader","goo/loaders/tga/TgaLoader","goo/renderer/Util","goo/util/Latch"],function(t,e,i,o,r,n,a){"use strict";function s(e){e=e||{},this.verticalFlip=void 0!==e.verticalFlip?e.verticalFlip:!0,this._loader=void 0!==e.loader?e.loader:new t,this.textureLoaders={".dds":new i,".crn":new o,".tga":new r}}function c(t,e){return-1!==t.indexOf(e,t.length-e.length)}s.cache={},s.UNSUPPORTED_FALLBACK=".png",s.clearCache=function(){s.cache={}},s.prototype.loadTexture2D=function(i,o,r){if(void 0!==s.cache[i])return r&&r(),s.cache[i];var a={onSuccess:function(t){u.load(t,d,l.verticalFlip,0,t.byteLength),s._finishedLoading(),r&&r()}.bind(this),onError:function(t){console.warn("Error loading texture: "+i+" | "+t)}.bind(this)},l=this;for(var h in this.textureLoaders)if(c(i.toLowerCase(),h)){var u=this.textureLoaders[h];if(!u||!u.isSupported()){i=i.substring(0,i.length-h.length),i+=s.UNSUPPORTED_FALLBACK,o=o||{},o.flipY=!1;break}var d=new e(n.clone(s.DEFAULT_TEXTURE_2D.image),o);return d.image.dataReady=!1,d.a=i,s.cache[i]=d,this._loader.load(i,null,t.ARRAY_BUFFER).then(a.onSuccess,a.onError),d}if(void 0!==s.cache[i])return r&&r(),s.cache[i];var p=new e(null,o);return s.cache[i]=p,this._loader.loadImage(i).then(function(t){p.setImage(t),s._finishedLoading(t),r&&r()}).then(null,function(t){console.error(t)}),p},s.prototype.loadTextureVideo=function(t,i,o,r){if(void 0!==s.cache[t])return s.cache[t];var a=document.createElement("video");for(var c in o)a[c]=o[c];a.loop="boolean"==typeof i?i:!0,a.addEventListener("error",function(e){console.warn("Couldn't load video URL ["+t+"]",e),r&&r(e)},!1);var l=new e(a,{wrapS:"EdgeClamp",wrapT:"EdgeClamp"});return l.readyCallback=function(){return a.readyState>=3?(console.log("Video ready: "+a.videoWidth+", "+a.videoHeight),a.width=a.videoWidth,a.height=a.videoHeight,(n.isPowerOfTwo(a.width)===!1||n.isPowerOfTwo(a.height)===!1)&&(l.generateMipmaps=!1,l.minFilter="BilinearNoMipMaps"),a.play(),a.dataReady=!0,!0):!1},l.updateCallback=function(){return!a.paused},a.crossOrigin="anonymous",a.src=t,s.cache[t]=l,l},s.prototype.loadTextureWebCam=function(){var t=document.createElement("video");t.autoplay=!0,t.loop=!0;var i=new e(t,{wrapS:"EdgeClamp",wrapT:"EdgeClamp"});return i.readyCallback=function(){return t.readyState>=3?(console.log("WebCam video ready: "+t.videoWidth+", "+t.videoHeight),t.width=t.videoWidth,t.height=t.videoHeight,(n.isPowerOfTwo(t.width)===!1||n.isPowerOfTwo(t.height)===!1)&&(i.generateMipmaps=!1,i.minFilter="BilinearNoMipMaps"),t.dataReady=!0,!0):!1},i.updateCallback=function(){return!t.paused},window.URL=window.URL||window.webkitURL,navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia,navigator.getUserMedia?navigator.getUserMedia({video:!0},function(e){t.src=window.URL.createObjectURL(e)},function(t){console.warn("Unable to capture WebCam. Please reload the page.",t)}):console.warn("No support for WebCam getUserMedia found!"),i},s.prototype.loadTextureCube=function(t,i){var o=new e(null,i);o.variant="CUBE";for(var r=[],n=new a(6,{done:function(){for(var t=r[0].width,e=r[0].height,i=0;6>i;i++){var n=r[i];(t!==n.width||e!==n.height)&&(o.generateMipmaps=!1,o.minFilter="BilinearNoMipMaps",console.error("Images not all the same size!"))}o.setImage(r),o.image.dataReady=!0,o.image.width=t,o.image.height=e}}),s=this,c=0;c<t.length;c++)!function(e){var i=t[e];"string"==typeof i?s._loader.loadImage(i).then(function(t){r[e]=t,n.countDown()}):(r[e]=i,n.countDown())}(c);return o},s._globalCallback=null,s._finishedLoading=function(t){if(s._globalCallback)try{s._globalCallback(t)}catch(e){console.error("Error in texture callback:",e)}};var l=new Uint8Array([255,255,255,255]);return s.DEFAULT_TEXTURE_2D=new e(l,null,1,1),s.DEFAULT_TEXTURE_CUBE=new e([l,l,l,l,l,l],null,1,1),s.DEFAULT_TEXTURE_CUBE.variant="CUBE",s}),define("goo/renderer/pass/RenderTarget",["goo/math/Vector2"],function(t){"use strict";function e(e,i,o){this.glTexture=null,this._glRenderBuffer=null,this._glFrameBuffer=null,this.width=Math.floor(e),this.height=Math.floor(i),o=o||{},this.wrapS=void 0!==o.wrapS?o.wrapS:"EdgeClamp",this.wrapT=void 0!==o.wrapT?o.wrapT:"EdgeClamp",this.magFilter=void 0!==o.magFilter?o.magFilter:"Bilinear",this.minFilter=void 0!==o.minFilter?o.minFilter:"BilinearNoMipMaps",this.anisotropy=void 0!==o.anisotropy?o.anisotropy:1,this.format=void 0!==o.format?o.format:"RGBA",this.type=void 0!==o.type?o.type:"UnsignedByte",this.variant="2D",this.offset=new t(0,0),this.repeat=new t(1,1),this.generateMipmaps=void 0!==o.generateMipmaps?o.generateMipmaps:!1,this.premultiplyAlpha=void 0!==o.premultiplyAlpha?o.premultiplyAlpha:!1,this.unpackAlignment=void 0!==o.unpackAlignment?o.unpackAlignment:1,this.flipY=void 0!==o.flipY?o.flipY:!0,this.depthBuffer=void 0!==o.depthBuffer?o.depthBuffer:!0,this.stencilBuffer=void 0!==o.stencilBuffer?o.stencilBuffer:!0}return e.prototype.clone=function(){var t=new e(this.width,this.height);return t.wrapS=this.wrapS,t.wrapT=this.wrapT,t.magFilter=this.magFilter,t.minFilter=this.minFilter,t.anisotropy=this.anisotropy,t.format=this.format,t.type=this.type,t.variant=this.variant,t.offset.copy(this.offset),t.repeat.copy(this.repeat),t.generateMipmaps=this.generateMipmaps,t.premultiplyAlpha=this.premultiplyAlpha,t.unpackAlignment=this.unpackAlignment,t.flipY=this.flipY,t.depthBuffer=this.depthBuffer,t.stencilBuffer=this.stencilBuffer,t},e}),define("goo/renderer/pass/FullscreenUtil",["goo/shapes/ShapeCreator","goo/renderer/Camera","goo/math/Vector3"],function(t,e,i){"use strict";function o(){}var r=new e;return r.projectionMode=e.Parallel,r.setFrustum(0,1,-1,1,1,-1),r._left.copy(i.UNIT_X).invert(),r._up.copy(i.UNIT_Y),r._direction.copy(i.UNIT_Z),r.onFrameChange(),o.camera=r,o.quad=t.createQuad(2,2),o}),define("goo/renderer/pass/FullscreenPass",["goo/renderer/Material","goo/renderer/pass/FullscreenUtil","goo/renderer/shaders/ShaderLib"],function(t,e,i){"use strict";function o(o){this.material=t.createMaterial(o||i.simple),this.useReadBuffer=!0,this.renderToScreen=!1,this.renderable={meshData:e.quad,materials:[this.material]},this.enabled=!0,this.clear=!1,this.needsSwap=!0}return o.prototype.render=function(t,i,o){this.useReadBuffer&&this.material.setTexture("DIFFUSE_MAP",o),this.renderToScreen?t.render(this.renderable,e.camera,[],null,this.clear):t.render(this.renderable,e.camera,[],i,this.clear)},o}),define("goo/renderer/shadow/ShadowHandler",["goo/math/Vector3","goo/renderer/pass/FullscreenPass","goo/renderer/Camera","goo/renderer/Material","goo/renderer/shaders/ShaderLib","goo/renderer/pass/RenderTarget","goo/math/Vector4","goo/renderer/light/PointLight","goo/renderer/light/DirectionalLight","goo/renderer/light/SpotLight"],function(t,e,i,o,r,n,a,s,c,l){"use strict";function h(){this.depthMaterial=o.createMaterial(r.lightDepth,"depthMaterial"),this.depthMaterial.cullState.cullFace="Back",this.fullscreenPass=new e,this.downsample=o.createShader(r.downsample,"downsample");var i=2;this.blurfilter=o.createShader(r.convolution,"blurfilter");var n=2*Math.ceil(3*i)+1;this.blurfilter.defines={KERNEL_SIZE_FLOAT:n.toFixed(1),KERNEL_SIZE_INT:n.toFixed(0)},this.blurfilter.uniforms.cKernel=r.convolution.buildKernel(i),this.oldClearColor=new a(0,0,0,0),this.shadowClearColor=new a(1,1,1,1),this.renderList=[],this.shadowList=[],this.tmpVec=new t,this.first=!0}return h.prototype._createShadowData=function(t){var e=t.resolution[0],i=t.resolution[1];t.shadowData=t.shadowData||{},t.shadowData.shadowTarget=new n(e,i,{type:"Float",magFilter:"NearestNeighbor",minFilter:"NearestNeighborNoMipMaps"}),t.shadowData.shadowResult=null,"VSM"===t.shadowType&&(t.shadowData.shadowTargetDown=new n(e/2,i/2,{type:"Float"}),t.shadowData.shadowBlurred=new n(e/2,i/2,{type:"Float"})),t.shadowRecord=t.shadowRecord||{},t.shadowRecord.resolution=t.shadowRecord.resolution||[],t.shadowRecord.resolution[0]=e,t.shadowRecord.resolution[0]=e,t.shadowRecord.shadowType=t.shadowType},h.prototype._testStatesEqual=function(t,e){var i=Object.keys(t),o=Object.keys(e);if(i.length!==o.length)return!1;for(var r=0;r<i.length;r++){var n=i[r];if(t[n]!==e[n])return!1}return!0},h.prototype.checkShadowRendering=function(e,o,r,n){if(this.first!==!0){this.shadowResults=[],this.shadowLights=[];for(var a=0;a<n.length;a++){var c=n[a];if(c.shadowCaster||c.lightCookie){var h=c.shadowSettings;h.shadowData||(this._createShadowData(h),h.shadowData.lightCamera=new i(55,1,1,1e3));var u=h.shadowRecord,d=h.shadowData.lightCamera;if(d.translation.copy(c.translation),c.direction?(this.tmpVec.setv(c.translation).addv(c.direction),d.lookAt(this.tmpVec,h.upVector)):d.lookAt(t.ZERO,h.upVector),u.angle!==c.angle||!u.resolution||u.resolution[0]!==h.resolution[0]||u.resolution[1]!==h.resolution[1]||u.near!==h.near||u.far!==h.far||u.size!==h.size){if(u.resolution&&u.resolution[0]===h.resolution[0]&&u.resolution[1]===h.resolution[1]||this._createShadowData(h),c instanceof l)d.setFrustumPerspective(c.angle,h.resolution[0]/h.resolution[1],h.near,h.far);else if(c instanceof s)d.setFrustumPerspective(90,h.resolution[0]/h.resolution[1],h.near,h.far);else{var p=h.size;d.setFrustum(h.near,h.far,-p,p,p,-p),d.projectionMode=i.Parallel}d.update(),u.resolution=u.resolution||[],u.resolution[0]=h.resolution[0],u.resolution[1]=h.resolution[1],u.angle=c.angle,u.near=h.near,u.far=h.far,u.size=h.size}if("VSM"===h.shadowType&&u.shadowType!==h.shadowType&&(this._createShadowData(h),u.shadowType=h.shadowType),d.onFrameChange(),c.shadowCaster){this.depthMaterial.shader.defines.SHADOW_TYPE="VSM"===h.shadowType?2:0,this.depthMaterial.uniforms.cameraScale=1/(d.far-d.near),this.oldClearColor.copy(e.clearColor),e.setClearColor(this.shadowClearColor.r,this.shadowClearColor.g,this.shadowClearColor.b,this.shadowClearColor.a),this.shadowList.length=0;for(var f=0;f<r.length;f++){var m=r[f];m.meshRendererComponent&&m.meshRendererComponent.castShadows&&!m.isSkybox&&this.shadowList.push(m)}switch(o.process(d,this.shadowList,this.renderList),e.render(this.renderList,d,[],h.shadowData.shadowTarget,!0,this.depthMaterial),h.shadowType){case"VSM":this.fullscreenPass.material.shader=this.downsample,this.fullscreenPass.render(e,h.shadowData.shadowTargetDown,h.shadowData.shadowTarget,0),this.fullscreenPass.material.shader=this.blurfilter,this.fullscreenPass.material.uniforms.uImageIncrement=[2/h.resolution[0],0],this.fullscreenPass.render(e,h.shadowData.shadowBlurred,h.shadowData.shadowTargetDown,0),this.fullscreenPass.material.uniforms.uImageIncrement=[0,2/h.resolution[1]],this.fullscreenPass.render(e,h.shadowData.shadowTargetDown,h.shadowData.shadowBlurred,0),h.shadowData.shadowResult=h.shadowData.shadowTargetDown;break;case"PCF":h.shadowData.shadowResult=h.shadowData.shadowTarget;break;case"Basic":h.shadowData.shadowResult=h.shadowData.shadowTarget;break;default:h.shadowData.shadowResult=h.shadowData.shadowTarget}e.setClearColor(this.oldClearColor.r,this.oldClearColor.g,this.oldClearColor.b,this.oldClearColor.a)}}}}else this.first=!1},h}),define("goo/util/ArrayUtil",[],function(){"use strict";var t={};return t.getTypedArray=function(t,e){var i=e[0],o=e[1],r=e[2];if("float32"===r)return new Float32Array(t,i,o);if("uint8"===r)return new Uint8Array(t,i,o);if("uint16"===r)return new Uint16Array(t,i,o);if("uint32"===r)return new Uint32Array(t,i,o);throw new Error("Binary format "+r+" is not supported")},t.remove=function(t,e,i){var o=-1;if("function"==typeof i){for(var r=0;r<t.length;r++)if(i(t[r],e)){o=r;break}}else o=t.indexOf(e);o>-1&&t.splice(o,1)},t.find=function(t,e){for(var i=0;i<t.length;i++)if(e(t[i]))return t[i];return null},t}),define("goo/entities/Bus",["goo/util/ArrayUtil"],function(t){"use strict";function e(){this.trie={name:"",listeners:[],children:{}}}return e.prototype.emit=function(t,e,i){"string"==typeof t&&(t=[t]);for(var o=0;o<t.length;o++)this._emitToSingle(t[o],e,i)},e.prototype._getNode=function(t,e){for(var i=this.trie,o=t.split("."),r=0;r<o.length;r++){var n=o[r];if(i.children[n])i=i.children[n];else{if(!e)return;var a={listeners:[],children:[]};i.children[n]=a,i=a}}return i},e.prototype._emitToSingle=function(t,e,i){var o=this._getNode(t,i);o&&(this._emitToAll(o,e),i&&(o.latestData=e))},e.prototype._emitToAll=function(t,e){for(var i=0;i<t.listeners.length;i++)t.listeners[i](e);for(var o=Object.keys(t.children),i=0;i<o.length;i++)this._emitToAll(t.children[o],e)},e.prototype.addListener=function(t,e,i){for(var o=this.trie,r=t.split("."),n=0;n<r.length;n++){var a=r[n];if(o.children[a])o=o.children[a];else{var s={listeners:[],children:[]};o.children[a]=s,o=s}}-1===o.listeners.indexOf(e)&&(o.listeners.push(e),i&&o.latestData&&e(o.latestData))},e.prototype.removeListener=function(e,i){var o=this._getNode(e);o&&t.remove(o.listeners,i)},e.prototype.removeAllOnChannel=function(t){var e=this._getNode(t);e&&(e.listeners=[])},e.prototype.removeChannelAndChildren=function(t){var e=t.split("."),i=e.pop(),o=e.join("."),r=this._getNode(o);delete r.children[i]},e.prototype._removeListener=function(e,i){t.remove(e.listeners,i);for(var o=Object.keys(e.children),r=0;r<o.length;r++)this._removeListener(e.children[o[r]],i)},e.prototype.removeListenerFromAllChannels=function(t){this._removeListener(this.trie,t)},e}),define("goo/entities/SystemBus",["goo/entities/Bus"],function(t){"use strict";return new t}),define("goo/renderer/Renderer",["goo/renderer/RendererRecord","goo/renderer/Util","goo/renderer/TextureCreator","goo/renderer/pass/RenderTarget","goo/math/Vector4","goo/entities/Entity","goo/renderer/Texture","goo/loaders/dds/DdsLoader","goo/loaders/dds/DdsUtils","goo/renderer/Material","goo/math/Transform","goo/renderer/RenderQueue","goo/renderer/shaders/ShaderLib","goo/renderer/shadow/ShadowHandler","goo/entities/SystemBus"],function(t,e,i,o,r,n,a,s,c,l,h,u,d,p,f){"use strict";function m(e){e=e||{};var i=e.canvas;void 0===i&&(i=document.createElement("canvas"),i.width=500,i.height=500),i.screencanvas=!0,this.domElement=i,this._alpha=void 0!==e.alpha?e.alpha:!1,this._premultipliedAlpha=void 0!==e.premultipliedAlpha?e.premultipliedAlpha:!0,this._antialias=void 0!==e.antialias?e.antialias:!0,this._stencil=void 0!==e.stencil?e.stencil:!1,this._preserveDrawingBuffer=void 0!==e.preserveDrawingBuffer?e.preserveDrawingBuffer:!1,this._onError=e.onError;
var o={alpha:this._alpha,premultipliedAlpha:this._premultipliedAlpha,antialias:this._antialias,stencil:this._stencil,preserveDrawingBuffer:this._preserveDrawingBuffer};if(this.context=null,!window.WebGLRenderingContext)throw{name:"GooWebGLError",message:"WebGL is not supported",supported:!1,enabled:!1};for(var n=["experimental-webgl","webgl","moz-webgl","webkit-3d"],a=0;a<n.length;a++)try{if(this.context=i.getContext(n[a],o),this.context&&"function"==typeof this.context.getParameter)break}catch(h){}if(!this.context)throw{name:"GooWebGLError",message:"WebGL is supported but disabled",supported:!0,enabled:!1};if(e.debug){var d=new XMLHttpRequest;d.open("GET","/js/goo/lib/webgl-debug.js",!1),d.onreadystatechange=function(){4===d.readyState&&d.status>=200&&d.status<=299&&window.eval.call(window,d.responseText)},d.send(null),"undefined"==typeof window.WebGLDebugUtils?console.warn("You need to include webgl-debug.js in your script definition to run in debug mode."):(console.log("Running in webgl debug mode."),e.validate?(console.log('Running with "undefined arguments" validation.'),this.context=window.WebGLDebugUtils.makeDebugContext(this.context,this.onDebugError.bind(this),g)):this.context=window.WebGLDebugUtils.makeDebugContext(this.context,this.onDebugError.bind(this)))}this.rendererRecord=new t,this.glExtensionCompressedTextureS3TC=s.SUPPORTS_DDS=c.isSupported(this.context),this.glExtensionTextureFloat=this.context.getExtension("OES_texture_float"),this.glExtensionTextureFloatLinear=this.context.getExtension("OES_texture_float_linear"),this.glExtensionTextureHalfFloat=this.context.getExtension("OES_texture_half_float"),this.glExtensionStandardDerivatives=this.context.getExtension("OES_standard_derivatives"),this.glExtensionTextureFilterAnisotropic=this.context.getExtension("EXT_texture_filter_anisotropic")||this.context.getExtension("MOZ_EXT_texture_filter_anisotropic")||this.context.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.glExtensionDepthTexture=this.context.getExtension("WEBGL_depth_texture")||this.context.getExtension("WEBKIT_WEBGL_depth_texture")||this.context.getExtension("MOZ_WEBGL_depth_texture"),this.glExtensionElementIndexUInt=this.context.getExtension("OES_element_index_uint"),this.glExtensionTextureFloat||console.log("Float textures not supported."),this.glExtensionTextureFloatLinear||console.log("Float textures with linear filtering not supported."),this.glExtensionStandardDerivatives||console.log("Standard derivatives not supported."),this.glExtensionTextureFilterAnisotropic||console.log("Anisotropic texture filtering not supported."),this.glExtensionCompressedTextureS3TC||console.log("S3TC compressed textures not supported."),this.glExtensionDepthTexture||console.log("Depth textures not supported."),this.glExtensionElementIndexUInt||console.log("32 bit indices not supported."),void 0===this.context.getShaderPrecisionFormat&&(this.context.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}}),this.capabilities={maxTexureSize:this.context.getParameter(v.MAX_TEXTURE_SIZE),maxCubemapSize:this.context.getParameter(v.MAX_CUBE_MAP_TEXTURE_SIZE),maxRenderbufferSize:this.context.getParameter(v.MAX_RENDERBUFFER_SIZE),maxViewPortDims:this.context.getParameter(v.MAX_VIEWPORT_DIMS),maxAnisotropy:this.glExtensionTextureFilterAnisotropic?this.context.getParameter(this.glExtensionTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0,maxVertexTextureUnits:this.context.getParameter(v.MAX_VERTEX_TEXTURE_IMAGE_UNITS),maxFragmentTextureUnits:this.context.getParameter(v.MAX_TEXTURE_IMAGE_UNITS),maxCombinedTextureUnits:this.context.getParameter(v.MAX_COMBINED_TEXTURE_IMAGE_UNITS),maxVertexAttributes:this.context.getParameter(v.MAX_VERTEX_ATTRIBS),maxVertexUniformVectors:this.context.getParameter(v.MAX_VERTEX_UNIFORM_VECTORS),maxFragmentUniformVectors:this.context.getParameter(v.MAX_FRAGMENT_UNIFORM_VECTORS),maxVaryingVectors:this.context.getParameter(v.MAX_VARYING_VECTORS),aliasedPointSizeRange:this.context.getParameter(v.ALIASED_POINT_SIZE_RANGE),aliasedLineWidthRange:this.context.getParameter(v.ALIASED_LINE_WIDTH_RANGE),samples:this.context.getParameter(v.SAMPLES),sampleBuffers:this.context.getParameter(v.SAMPLE_BUFFERS),depthBits:this.context.getParameter(v.DEPTH_BITS),stencilBits:this.context.getParameter(v.STENCIL_BITS),subpixelBits:this.context.getParameter(v.SUBPIXEL_BITS),supportedExtensionsList:this.context.getSupportedExtensions(),renderer:this.context.getParameter(v.RENDERER),vendor:this.context.getParameter(v.VENDOR),version:this.context.getParameter(v.VERSION),shadingLanguageVersion:this.context.getParameter(v.SHADING_LANGUAGE_VERSION),vertexShaderHighpFloat:this.context.getShaderPrecisionFormat(this.context.VERTEX_SHADER,this.context.HIGH_FLOAT),vertexShaderMediumpFloat:this.context.getShaderPrecisionFormat(this.context.VERTEX_SHADER,this.context.MEDIUM_FLOAT),vertexShaderLowpFloat:this.context.getShaderPrecisionFormat(this.context.VERTEX_SHADER,this.context.LOW_FLOAT),fragmentShaderHighpFloat:this.context.getShaderPrecisionFormat(this.context.FRAGMENT_SHADER,this.context.HIGH_FLOAT),fragmentShaderMediumpFloat:this.context.getShaderPrecisionFormat(this.context.FRAGMENT_SHADER,this.context.MEDIUM_FLOAT),fragmentShaderLowpFloat:this.context.getShaderPrecisionFormat(this.context.FRAGMENT_SHADER,this.context.LOW_FLOAT),vertexShaderHighpInt:this.context.getShaderPrecisionFormat(this.context.VERTEX_SHADER,this.context.HIGH_INT),vertexShaderMediumpInt:this.context.getShaderPrecisionFormat(this.context.VERTEX_SHADER,this.context.MEDIUM_INT),vertexShaderLowpInt:this.context.getShaderPrecisionFormat(this.context.VERTEX_SHADER,this.context.LOW_INT),fragmentShaderHighpInt:this.context.getShaderPrecisionFormat(this.context.FRAGMENT_SHADER,this.context.HIGH_INT),fragmentShaderMediumpInt:this.context.getShaderPrecisionFormat(this.context.FRAGMENT_SHADER,this.context.MEDIUM_INT),fragmentShaderLowpInt:this.context.getShaderPrecisionFormat(this.context.FRAGMENT_SHADER,this.context.LOW_INT)},this.maxTextureSize=isNaN(e.maxTextureSize)?this.capabilities.maxTexureSize:Math.min(e.maxTextureSize,this.capabilities.maxTexureSize),this.shaderPrecision=e.shaderPrecision||"highp",this.shaderPrecision="highp"===this.shaderPrecision&&this.capabilities.vertexShaderHighpFloat.precision>0&&this.capabilities.fragmentShaderHighpFloat.precision>0?"highp":"lowp"!==this.shaderPrecision&&this.capabilities.vertexShaderMediumpFloat.precision>0&&this.capabilities.fragmentShaderMediumpFloat.precision>0?"mediump":"lowp",this.downScale=e.downScale||1,this.clearColor=new r,this._clearColor=new Float64Array(4),this.setClearColor(.3,.3,.3,1),this.context.clearDepth(1),this.context.clearStencil(0),this.context.stencilMask(0),this.context.enable(v.DEPTH_TEST),this.context.depthFunc(v.LEQUAL),this.viewportX=0,this.viewportY=0,this.viewportWidth=0,this.viewportHeight=0,this.currentWidth=0,this.currentHeight=0,this._overrideMaterials=[],this._mergedMaterial=new l("Merged Material"),this.renderQueue=new u,this.info={calls:0,vertices:0,indices:0,reset:function(){this.calls=0,this.vertices=0,this.indices=0},toString:function(){return"Calls: "+this.calls+" Vertices: "+this.vertices+" Indices: "+this.indices}},this.shadowHandler=new p,this.hardwarePicking=null}function g(t,e){for(var i=0;i<e.length;++i)void 0===e[i]&&console.error("undefined passed to gl."+t+"("+window.WebGLDebugUtils.glFunctionArgsToString(t,e)+")")}var v=window.WebGLRenderingContext;return m.prototype.onDebugError=function(t,e,i){for(var o="WebGL error "+window.WebGLDebugUtils.glEnumToString(t)+" in "+e+"(",r=0;r<i.length;++r)o+=(0===r?"":", ")+window.WebGLDebugUtils.glFunctionArgToString(e,r,i[r]);o+=")",console.error(o),this._onError&&this._onError(o)},m.mainCamera=null,f.addListener("goo.setCurrentCamera",function(t){m.mainCamera=t.camera}),m.prototype.checkResize=function(t){var e,i,o=window.devicePixelRatio||1;document.querySelector?(e=this.domElement.offsetWidth,i=this.domElement.offsetHeight):(e=window.innerWidth,i=window.innerHeight),e=e*o/this.downScale,i=i*o/this.downScale;var r=e,n=i;t&&t.lockedRatio===!0&&t.aspect&&(e=i*t.aspect);var a=e/i;this.setSize(e,i,r,n),t&&t.lockedRatio===!1&&t.aspect!==a&&(t.aspect=a,0===t.projectionMode?t.setFrustumPerspective():t.setFrustum(),t.onFrameChange())},m.prototype.setSize=function(t,e,i,o){if(void 0===i&&(i=t),void 0===o&&(o=e),this.domElement.width=i,this.domElement.height=o,t>i){var r=i/t;t=i,e=o*r}var n=.5*(i-t),a=.5*(o-e);(n!==this.viewportX||a!==this.viewportY||t!==this.viewportWidth||e!==this.viewportHeight)&&this.setViewport(n,a,t,e),null!==this.hardwarePicking&&(this.hardwarePicking.pickingTarget=null)},m.prototype.setViewport=function(t,e,i,o){this.viewportX=void 0!==t?t:0,this.viewportY=void 0!==e?e:0,this.viewportWidth=void 0!==i?i:this.domElement.width,this.viewportHeight=void 0!==o?o:this.domElement.height,this.context.viewport(this.viewportX,this.viewportY,this.viewportWidth,this.viewportHeight),f.emit("goo.viewportResize",{x:this.viewportX,y:this.viewportY,width:this.viewportWidth,height:this.viewportHeight},!0)},m.prototype.setClearColor=function(t,e,i,o){(this._clearColor[0]!==t||this._clearColor[1]!==e||this._clearColor[2]!==i||this._clearColor[3]!==o)&&(this._clearColor[0]=t,this._clearColor[1]=e,this._clearColor[2]=i,this._clearColor[3]=o,this.clearColor.seta(this._clearColor),this.context.clearColor(t,e,i,o))},m.prototype.bindData=function(t){var e=t.glBuffer;null!==e?(this.setBoundBuffer(e,t.target),t._dataNeedsRefresh&&(this.context.bufferSubData(this.getGLBufferTarget(t.target),0,t.data),t._dataNeedsRefresh=!1)):(e=this.context.createBuffer(),t.glBuffer=e,this.rendererRecord.invalidateBuffer(t.target),this.setBoundBuffer(e,t.target),this.context.bufferData(this.getGLBufferTarget(t.target),t.data,this.getGLBufferUsage(t._dataUsage)))},m.prototype.setShadowType=function(t){this.shadowHandler.shadowType=t},m.prototype.updateShadows=function(t,e,i){this.shadowHandler.checkShadowRendering(this,t,e,i)},m.prototype.render=function(t,i,o,r,n,a){if(this._overrideMaterials=a?a instanceof Array?a:[a]:[],i){null===m.mainCamera&&(m.mainCamera=i),this.setRenderTarget(r),void 0===n||null===n||n===!0?this.clear():"object"==typeof n&&this.clear(n.color,n.depth,n.stencil);var s={camera:i,mainCamera:m.mainCamera,lights:o,shadowHandler:this.shadowHandler,renderer:this};if(Array.isArray(t)){this.renderQueue.sort(t,i);for(var c=0;c<t.length;c++){var l=t[c];l.isSkybox&&this._overrideMaterials.length>0||(this.fillRenderInfo(l,s),this.renderMesh(s))}}else this.fillRenderInfo(t,s),this.renderMesh(s);r&&r.generateMipmaps&&e.isPowerOfTwo(r.width)&&e.isPowerOfTwo(r.height)&&this.updateRenderTargetMipmap(r)}},m.prototype.fillRenderInfo=function(t,e){t instanceof n?(e.meshData=t.meshDataComponent.meshData,e.materials=t.meshRendererComponent.materials,e.transform=t.particleComponent?h.IDENTITY:t.transformComponent.worldTransform,t.meshDataComponent.currentPose?e.currentPose=t.meshDataComponent.currentPose:delete e.currentPose):(e.meshData=t.meshData,e.materials=t.materials,e.transform=t.transform,t.currentPose?e.currentPose=t.currentPose:delete e.currentPose),e.renderable=t},m.prototype._override=function(t,e,i){i.empty();for(var o=Object.keys(i),r=0,n=o.length;n>r;r++){var a=o[r],s=i[a],c=t[a],l=e[a];if(s instanceof Object&&"shader"!==a){for(var h=Object.keys(c),u=0,d=h.length;d>u;u++){var p=h[u];s[p]=c[p]}for(var h=Object.keys(l),u=0,d=h.length;d>u;u++){var p=h[u];void 0===s[p]&&(s[p]=l[p])}}else i[a]=void 0!==c?c:l}},m.prototype.renderMesh=function(t){var e=t.meshData;if(!(null===e.vertexData||null!==e.vertexData&&0===e.vertexData.data.byteLength||null!==e.indexData&&0===e.indexData.data.byteLength)){this.bindData(e.vertexData);var i=t.materials,o=null,r=e,n=0;n=0===this._overrideMaterials.length?i.length:this._overrideMaterials.length;for(var a=0;n>a;a++){var s=null,c=null;if(a<i.length&&(s=i[a]),a<this._overrideMaterials.length&&(c=this._overrideMaterials[a]),s&&c?(this._override(c,s,this._mergedMaterial),s=this._mergedMaterial):c&&(s=c),s.shader){s.errorOnce=!1,s.wireframe&&"wire"!==o?(e.wireframeData||(e.wireframeData=e.buildWireframeData()),e=e.wireframeData,this.bindData(e.vertexData),o="wire"):s.flat&&"flat"!==o?(e.flatMeshData||(e.flatMeshData=e.buildFlatMeshData()),e=e.flatMeshData,this.bindData(e.vertexData),o="flat"):s.wireframe||s.flat||null===o||(e=r,this.bindData(e.vertexData),o=null),t.material=s,t.meshData=e;var l=s.shader;if(l.processors||l.defines){if(l.processors)for(var h=0;h<l.processors.length;h++)l.processors[h](l,t);for(var u=Object.keys(l.defines),d=u.length,p=[],h=0;d>h;h++){var f=u[h];p.push(f+"_"+l.defines[f])}p.sort();var m=p.join("_")+"_"+l.name,g=this.rendererRecord.shaderCache=this.rendererRecord.shaderCache||{};if(g[m]){if(l=g[m],l!==s.shader){for(var f in s.shader.uniforms)l.uniforms[f]=s.shader.uniforms[f];s.shader=l}}else l.builder&&l.builder(l,t),l=s.shader=l.clone(),g[m]=l}l.apply(t,this),this.updateDepthTest(s),this.updateCulling(s),this.updateBlending(s),this.updateOffset(s),this.updateTextures(s),this.updateLineAndPointSettings(s),this._checkDualTransparency(s,e),this.updateCulling(s),this._drawBuffers(e),this.info.calls++,this.info.vertices+=e.vertexCount,this.info.indices+=e.indexCount}else s.errorOnce||(console.warn("No shader set on material: "+s.name),s.errorOnce=!0)}}},m.prototype._drawBuffers=function(t){null!==t.getIndexBuffer()?(this.bindData(t.getIndexData()),null!==t.getIndexLengths()?this.drawElementsVBO(t.getIndexBuffer(),t.getIndexModes(),t.getIndexLengths()):this.drawElementsVBO(t.getIndexBuffer(),t.getIndexModes(),[t.getIndexBuffer().length])):null!==t.getIndexLengths()?this.drawArraysVBO(t.getIndexModes(),t.getIndexLengths()):this.drawArraysVBO(t.getIndexModes(),[t.vertexCount])},m.prototype._checkDualTransparency=function(t,e){if(t.dualTransparency){var i=t.cullState.cullFace,o="Front"===i?"Back":"Front";t.cullState.cullFace=o,this.updateCulling(t),this._drawBuffers(e),t.cullState.cullFace=i}},m.prototype.readPixels=function(t,e,i,o,r){this.context.readPixels(t,e,i,o,v.RGBA,v.UNSIGNED_BYTE,r)},m.prototype.drawElementsVBO=function(t,e,i){for(var o=0,r=0,n=t.type=t.type||this.getGLArrayType(t),a=this.getGLByteSize(t),s=0;s<i.length;s++){var c=i[s],l=this.getGLIndexMode(e[r]);this.context.drawElements(l,c,n,o*a),o+=c,r<e.length-1&&r++}},m.prototype.drawArraysVBO=function(t,e){for(var i=0,o=0,r=0;r<e.length;r++){var n=e[r],a=this.getGLIndexMode(t[o]);this.context.drawArrays(a,i,n),i+=n,o<t.length-1&&o++}},m.prototype.renderToPick=function(t,e,i,n,a,s,c,h){if(0!==this.viewportWidth*this.viewportHeight){var u=4;if(null===this.hardwarePicking){var p=l.createEmptyMaterial(d.pickingShader,"pickingMaterial");p.blendState={blending:"NoBlending",blendEquation:"AddEquation",blendSrc:"SrcAlphaFactor",blendDst:"OneMinusSrcAlphaFactor"},this.hardwarePicking={pickingTarget:new o(this.viewportWidth/u,this.viewportHeight/u,{minFilter:"NearestNeighborNoMipMaps",magFilter:"NearestNeighbor"}),pickingMaterial:p,pickingBuffer:new Uint8Array(4),clearColorStore:new r},n=!1}else null===this.hardwarePicking.pickingTarget&&(this.hardwarePicking.pickingTarget=new o(this.viewportWidth/u,this.viewportHeight/u,{minFilter:"NearestNeighborNoMipMaps",magFilter:"NearestNeighbor"}),n=!1);if(n)this.setRenderTarget(this.hardwarePicking.pickingTarget);else{if(this.hardwarePicking.clearColorStore.setv(this.clearColor),a&&void 0!==s&&void 0!==c){var f=window.devicePixelRatio||1,m=Math.floor((s*f-this.viewportX)/u),g=Math.floor((this.viewportHeight-(c*f-this.viewportY))/u);this.context.enable(v.SCISSOR_TEST),this.context.scissor(m,g,1,1)}for(var y=[],x=0,w=t.length;w>x;x++){var _=t[x];(!_.meshRendererComponent||_.meshRendererComponent.isPickable)&&y.push(_)}this.render(y,e,[],this.hardwarePicking.pickingTarget,i,h||this.hardwarePicking.pickingMaterial),a&&this.context.disable(v.SCISSOR_TEST)}}},m.prototype.pick=function(t,e,i,o){if(0===this.viewportWidth*this.viewportHeight)return i.id=-1,i.depth=0,void 0;var r=window.devicePixelRatio||1,n=4,a=Math.floor((t*r-this.viewportX)/n),s=Math.floor((this.viewportHeight-(e*r-this.viewportY))/n);this.readPixels(a,s,1,1,this.hardwarePicking.pickingBuffer);var c=255*this.hardwarePicking.pickingBuffer[0]+this.hardwarePicking.pickingBuffer[1]-1,l=(this.hardwarePicking.pickingBuffer[2]/255+this.hardwarePicking.pickingBuffer[3]/65025)*o.far;i.id=c,i.depth=l},m.prototype.updateLineAndPointSettings=function(t){var e=this.rendererRecord.lineRecord,i=t.lineWidth||1;e.lineWidth!==i&&(this.context.lineWidth(i),e.lineWidth=i)},m.prototype.updateDepthTest=function(t){var e=this.rendererRecord.depthRecord,i=t.depthState;e.enabled!==i.enabled&&(i.enabled?this.context.enable(v.DEPTH_TEST):this.context.disable(v.DEPTH_TEST),e.enabled=i.enabled),e.write!==i.write&&(i.write?this.context.depthMask(!0):this.context.depthMask(!1),e.write=i.write)},m.prototype.updateCulling=function(t){var e=this.rendererRecord.cullRecord,i=t.cullState.cullFace,o=t.cullState.frontFace,r=t.cullState.enabled;if(e.enabled!==r&&(r?this.context.enable(v.CULL_FACE):this.context.disable(v.CULL_FACE),e.enabled=r),e.cullFace!==i){var n="Front"===i?v.FRONT:"Back"===i?v.BACK:v.FRONT_AND_BACK;this.context.cullFace(n),e.cullFace=i}if(e.frontFace!==o){switch(o){case"CCW":this.context.frontFace(v.CCW);break;case"CW":this.context.frontFace(v.CW)}e.frontFace=o}},m.prototype.updateTextures=function(t){for(var r=this.context,n=t.shader.textureSlots,a=0;a<n.length;a++){var s=n[a],c=t.getTexture(s.mapping);if(void 0!==c){var l=c;0==c instanceof Array&&(l=[c]);for(var h=0;h<l.length;h++){c=l[h];var u=s.index instanceof Array?s.index[h]:s.index;(null===c||0==c instanceof o&&(void 0===c.image||c.checkDataReady()===!1))&&("sampler2D"===s.format?c=i.DEFAULT_TEXTURE_2D:"samplerCube"===s.format&&(c=i.DEFAULT_TEXTURE_CUBE));var d=this.rendererRecord.textureRecord[u];void 0===d&&(d=this.rendererRecord.textureRecord[u]={}),null===c.glTexture?(c.glTexture=r.createTexture(),this.updateTexture(r,c,u,d)):0==c instanceof o&&c.checkNeedsUpdate()?(this.updateTexture(r,c,u,d),c.needsUpdate=!1):this.bindTexture(r,c,u,d);var p=void 0!==c.image?c.image:c,f=e.isPowerOfTwo(p.width)&&e.isPowerOfTwo(p.height);this.updateTextureParameters(c,f)}}}},m.prototype.updateTextureParameters=function(t,e){var i=this.context,o=t.textureRecord;void 0===o&&(o={},t.textureRecord=o);var r=this.getGLType(t.variant);o.magFilter!==t.magFilter&&(i.texParameteri(r,v.TEXTURE_MAG_FILTER,this.getGLMagFilter(t.magFilter)),o.magFilter=t.magFilter);var n=e?t.minFilter:this.getFilterFallback(t.minFilter);o.minFilter!==n&&(i.texParameteri(r,v.TEXTURE_MIN_FILTER,this.getGLMinFilter(n)),o.minFilter=n);var a=e?t.wrapS:"EdgeClamp";if(o.wrapS!==a){var s=this.getGLWrap(a,i);i.texParameteri(r,v.TEXTURE_WRAP_S,s),o.wrapS=a}var c=e?t.wrapT:"EdgeClamp";if(o.wrapT!==c){var l=this.getGLWrap(c,i);i.texParameteri(r,v.TEXTURE_WRAP_T,l),o.wrapT=c}if(this.glExtensionTextureFilterAnisotropic&&"Float"!==t.type){var h=t.anisotropy;o.anisotropy!==h&&(i.texParameterf(r,this.glExtensionTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(h,this.capabilities.maxAnisotropy)),o.anisotropy=h)}},m.prototype.bindTexture=function(t,e,i,o){(void 0===o.boundTexture||void 0!==e.glTexture&&o.boundTexture!==e.glTexture)&&(t.activeTexture(v.TEXTURE0+i),t.bindTexture(this.getGLType(e.variant),e.glTexture),o.boundTexture=e.glTexture)},m.prototype.getGLType=function(t){switch(t){case"2D":return v.TEXTURE_2D;case"CUBE":return v.TEXTURE_CUBE_MAP}throw"invalid texture type: "+t},m.prototype.loadCompressedTexture=function(t,e,i,o){var r=i.image.mipmapSizes,n=0,a=0,s=i.image.width,l=i.image.height,h=c.getDdsExtension(t),u=h.COMPRESSED_RGBA_S3TC_DXT5_EXT;if("PrecompressedDXT1"===i.format)u=h.COMPRESSED_RGB_S3TC_DXT1_EXT;else if("PrecompressedDXT1A"===i.format)u=h.COMPRESSED_RGBA_S3TC_DXT1_EXT;else if("PrecompressedDXT3"===i.format)u=h.COMPRESSED_RGBA_S3TC_DXT3_EXT;else{if("PrecompressedDXT5"!==i.format)throw new Error("Unhandled compression format: "+o.getDataFormat().name());u=h.COMPRESSED_RGBA_S3TC_DXT5_EXT}if("undefined"==typeof r||null===r)o instanceof Uint8Array?t.compressedTexImage2D(e,0,u,s,l,0,o):t.compressedTexImage2D(e,0,u,s,l,0,new Uint8Array(o.buffer,o.byteOffset,o.byteLength));else{if(i.generateMipmaps=!1,o instanceof Array)for(var d=0;d<o.length;d++)t.compressedTexImage2D(e,d,u,s,l,0,o[d]),s=~~(s/2)>1?~~(s/2):1,l=~~(l/2)>1?~~(l/2):1;else for(var d=0;d<r.length;d++)a=r[d],t.compressedTexImage2D(e,d,u,s,l,0,new Uint8Array(o.buffer,o.byteOffset+n,a)),s=~~(s/2)>1?~~(s/2):1,l=~~(l/2)>1?~~(l/2):1,n+=a;var p=1+Math.ceil(Math.log(Math.max(i.image.height,i.image.width))/Math.log(2)),f=r[r.length-1];if(r.length<p)for(var d=r.length;p>d;d++)f=2*~~((s+3)/4)*~~((l+3)/4)*i.image.bpp,t.compressedTexImage2D(e,d,u,s,l,0,new Uint8Array(f)),s=~~(s/2)>1?~~(s/2):1,l=~~(l/2)>1?~~(l/2):1}},m.prototype.updateTexture=function(t,i,o,r){t.activeTexture(v.TEXTURE0+o),t.bindTexture(this.getGLType(i.variant),i.glTexture),r.boundTexture=i.glTexture,t.pixelStorei(v.UNPACK_ALIGNMENT,i.unpackAlignment),t.pixelStorei(v.UNPACK_PREMULTIPLY_ALPHA_WEBGL,i.premultiplyAlpha),t.pixelStorei(v.UNPACK_FLIP_Y_WEBGL,i.flipY);var n=i.image;if("2D"===i.variant)n?(!n.isCompressed&&(i.generateMipmaps||n.width>this.maxTextureSize||n.height>this.maxTextureSize)&&(this.checkRescale(i,n,n.width,n.height,this.maxTextureSize),n=i.image),n.isData===!0?n.isCompressed?this.loadCompressedTexture(t,v.TEXTURE_2D,i,n.data):t.texImage2D(v.TEXTURE_2D,0,this.getGLInternalFormat(i.format),n.width,n.height,i.hasBorder?1:0,this.getGLInternalFormat(i.format),this.getGLPixelDataType(i.type),n.data):t.texImage2D(v.TEXTURE_2D,0,this.getGLInternalFormat(i.format),this.getGLInternalFormat(i.format),this.getGLPixelDataType(i.type),n),i.generateMipmaps&&!n.isCompressed&&t.generateMipmap(v.TEXTURE_2D)):t.texImage2D(v.TEXTURE_2D,0,this.getGLInternalFormat(i.format),i.width,i.height,0,this.getGLInternalFormat(i.format),this.getGLPixelDataType(i.type),null);else if("CUBE"===i.variant){if(n&&(i.generateMipmaps||n.width>this.capabilities.maxCubemapSize||n.height>this.capabilities.maxCubemapSize)){for(var s=0;s<a.CUBE_FACES.length;s++)this.checkRescale(i,n.data[s],n.width,n.height,this.capabilities.maxCubemapSize,s);i.image.width=Math.min(this.capabilities.maxCubemapSize,e.nearestPowerOfTwo(i.image.width)),i.image.height=Math.min(this.capabilities.maxCubemapSize,e.nearestPowerOfTwo(i.image.height)),n=i.image}for(var c=0;c<a.CUBE_FACES.length;c++){var l=a.CUBE_FACES[c];n?n.isData===!0?n.isCompressed?this.loadCompressedTexture(t,this.getGLCubeMapFace(l),i,n.data[c]):t.texImage2D(this.getGLCubeMapFace(l),0,this.getGLInternalFormat(i.format),n.width,n.height,i.hasBorder?1:0,this.getGLInternalFormat(i.format),this.getGLPixelDataType(i.type),n.data[c]):t.texImage2D(this.getGLCubeMapFace(l),0,this.getGLInternalFormat(i.format),this.getGLInternalFormat(i.format),this.getGLPixelDataType(i.type),n.data[c]):t.texImage2D(this.getGLCubeMapFace(l),0,this.getGLInternalFormat(i.format),i.width,i.height,0,this.getGLInternalFormat(i.format),this.getGLPixelDataType(i.type),null)}n&&i.generateMipmaps&&!n.isCompressed&&t.generateMipmap(v.TEXTURE_CUBE_MAP)}},m.prototype.checkRescale=function(t,i,o,r,n,a){var s=e.nearestPowerOfTwo(o),c=e.nearestPowerOfTwo(r);if(s=Math.min(s,n),c=Math.min(c,n),o!==s||r!==c){var l=document.createElement("canvas");l.width=s,l.height=c,i.getAttribute&&l.setAttribute("data-ref",i.getAttribute("data-ref"));var h=l.getContext("2d");h.drawImage(i,0,0,o,r,0,0,s,c),document.body.appendChild(l),l.dataReady=!0,l.src=i.src,void 0===a?t.image=l:t.image.data[a]=l,l.parentNode.removeChild(l)}},m.prototype.getGLWrap=function(t){switch(t){case"Repeat":return v.REPEAT;case"MirroredRepeat":return v.MIRRORED_REPEAT;case"EdgeClamp":return v.CLAMP_TO_EDGE}throw"invalid WrapMode type: "+t},m.prototype.getGLInternalFormat=function(t){switch(t){case"RGBA":return v.RGBA;case"RGB":return v.RGB;case"Alpha":return v.ALPHA;case"Luminance":return v.LUMINANCE;case"LuminanceAlpha":return v.LUMINANCE_ALPHA;default:throw"Unsupported format: "+t}},m.prototype.getGLPixelDataType=function(t){switch(t){case"UnsignedByte":return v.UNSIGNED_BYTE;case"UnsignedShort565":return v.UNSIGNED_SHORT_5_6_5;case"UnsignedShort4444":return v.UNSIGNED_SHORT_4_4_4_4;case"UnsignedShort5551":return v.UNSIGNED_SHORT_5_5_5_1;case"Float":return v.FLOAT;default:throw"Unsupported type: "+t}},m.prototype.getFilterFallback=function(t){switch(t){case"NearestNeighborNoMipMaps":case"NearestNeighborNearestMipMap":case"NearestNeighborLinearMipMap":return"NearestNeighborNoMipMaps";case"BilinearNoMipMaps":case"Trilinear":case"BilinearNearestMipMap":return"BilinearNoMipMaps";default:return"NearestNeighborNoMipMaps"}},m.prototype.getGLMagFilter=function(t){switch(t){case"Bilinear":return v.LINEAR;case"NearestNeighbor":return v.NEAREST}throw"invalid MagnificationFilter type: "+t},m.prototype.getGLMinFilter=function(t){switch(t){case"BilinearNoMipMaps":return v.LINEAR;case"Trilinear":return v.LINEAR_MIPMAP_LINEAR;case"BilinearNearestMipMap":return v.LINEAR_MIPMAP_NEAREST;case"NearestNeighborNoMipMaps":return v.NEAREST;case"NearestNeighborNearestMipMap":return v.NEAREST_MIPMAP_NEAREST;case"NearestNeighborLinearMipMap":return v.NEAREST_MIPMAP_LINEAR}throw"invalid MinificationFilter type: "+t},m.prototype.getGLBufferTarget=function(t){return"ElementArrayBuffer"===t?v.ELEMENT_ARRAY_BUFFER:v.ARRAY_BUFFER},m.prototype.getGLArrayType=function(t){return t instanceof Uint8Array?v.UNSIGNED_BYTE:t instanceof Uint16Array?v.UNSIGNED_SHORT:t instanceof Uint32Array?v.UNSIGNED_INT:t instanceof Int8Array?v.UNSIGNED_BYTE:t instanceof Int16Array?v.UNSIGNED_SHORT:t instanceof Int32Array?v.UNSIGNED_INT:null},m.prototype.getGLByteSize=function(t){return t instanceof Uint8Array?1:t instanceof Uint16Array?2:t instanceof Uint32Array?4:t instanceof Int8Array?1:t instanceof Int16Array?2:t instanceof Int32Array?4:1},m.prototype.getGLCubeMapFace=function(t){switch(t){case"PositiveX":return v.TEXTURE_CUBE_MAP_POSITIVE_X;case"NegativeX":return v.TEXTURE_CUBE_MAP_NEGATIVE_X;case"PositiveY":return v.TEXTURE_CUBE_MAP_POSITIVE_Y;case"NegativeY":return v.TEXTURE_CUBE_MAP_NEGATIVE_Y;case"PositiveZ":return v.TEXTURE_CUBE_MAP_POSITIVE_Z;case"NegativeZ":return v.TEXTURE_CUBE_MAP_NEGATIVE_Z}throw"Invalid cubemap face: "+t},m.prototype.getGLBufferUsage=function(t){var e=v.STATIC_DRAW;switch(t){case"StaticDraw":e=v.STATIC_DRAW;break;case"DynamicDraw":e=v.DYNAMIC_DRAW;break;case"StreamDraw":e=v.STREAM_DRAW}return e},m.prototype.getGLIndexMode=function(t){var e=v.TRIANGLES;switch(t){case"Triangles":e=v.TRIANGLES;break;case"TriangleStrip":e=v.TRIANGLE_STRIP;break;case"TriangleFan":e=v.TRIANGLE_FAN;break;case"Lines":e=v.LINES;break;case"LineStrip":e=v.LINE_STRIP;break;case"LineLoop":e=v.LINE_LOOP;break;case"Points":e=v.POINTS}return e},m.prototype.updateBlending=function(t){var e=this.rendererRecord.blendRecord,i=this.context,o=t.blendState.blending;if(o!==e.blending&&("NoBlending"===o?i.disable(v.BLEND):"AdditiveBlending"===o?(i.enable(v.BLEND),i.blendEquation(v.FUNC_ADD),i.blendFunc(v.SRC_ALPHA,v.ONE)):"SubtractiveBlending"===o?(i.enable(v.BLEND),i.blendEquation(v.FUNC_ADD),i.blendFunc(v.ZERO,v.ONE_MINUS_SRC_COLOR)):"MultiplyBlending"===o?(i.enable(v.BLEND),i.blendEquation(v.FUNC_ADD),i.blendFunc(v.DST_COLOR,v.ONE_MINUS_SRC_ALPHA)):"AlphaBlending"===o?(i.enable(v.BLEND),i.blendEquation(v.FUNC_ADD),i.blendFunc(v.SRC_ALPHA,v.ONE_MINUS_SRC_ALPHA)):"CustomBlending"===o?i.enable(v.BLEND):(i.enable(v.BLEND),i.blendEquationSeparate(v.FUNC_ADD,v.FUNC_ADD),i.blendFuncSeparate(v.SRC_ALPHA,v.ONE_MINUS_SRC_ALPHA,v.ONE,v.ONE_MINUS_SRC_ALPHA)),e.blending=o),"CustomBlending"===o){var r=t.blendState.blendEquation,n=t.blendState.blendSrc,a=t.blendState.blendDst;r!==e.blendEquation&&(i.blendEquation(this.getGLBlendParam(r)),e.blendEquation=r),(n!==e.blendSrc||a!==e.blendDst)&&(i.blendFunc(this.getGLBlendParam(n),this.getGLBlendParam(a)),e.blendSrc=n,e.blendDst=a)}else e.blendEquation=null,e.blendSrc=null,e.blendDst=null},m.prototype.updateOffset=function(t){var e=this.rendererRecord.offsetRecord,i=this.context,o=t.offsetState.enabled,r=t.offsetState.factor,n=t.offsetState.units;e.enabled!==o&&(o?i.enable(v.POLYGON_OFFSET_FILL):i.disable(v.POLYGON_OFFSET_FILL),e.enabled=o),!o||e.factor===r&&e.units===n||(i.polygonOffset(r,n),e.factor=r,e.units=n)},m.prototype.setBoundBuffer=function(t,e){var i=this.rendererRecord.currentBuffer[e];i.valid&&i.buffer===t||(this.context.bindBuffer(this.getGLBufferTarget(e),t),i.buffer=t,i.valid=!0)},m.prototype.bindVertexAttribute=function(t,e){this.context.vertexAttribPointer(t,e.count,this.getGLDataType(e.type),e.normalized,e.stride,e.offset)},m.prototype.getGLDataType=function(t){switch(t){case"Float":case"HalfFloat":case"Double":return v.FLOAT;case"Byte":return v.BYTE;case"UnsignedByte":return v.UNSIGNED_BYTE;case"Short":return v.SHORT;case"UnsignedShort":return v.UNSIGNED_SHORT;case"Int":return v.INT;case"UnsignedInt":return v.UNSIGNED_INT;default:throw"Unknown datatype: "+t}},m.prototype.getGLBlendParam=function(t){switch(t){case"AddEquation":return v.FUNC_ADD;case"SubtractEquation":return v.FUNC_SUBTRACT;case"ReverseSubtractEquation":return v.FUNC_REVERSE_SUBTRACT;case"ZeroFactor":return v.ZERO;case"OneFactor":return v.ONE;case"SrcColorFactor":return v.SRC_COLOR;case"OneMinusSrcColorFactor":return v.ONE_MINUS_SRC_COLOR;case"SrcAlphaFactor":return v.SRC_ALPHA;case"OneMinusSrcAlphaFactor":return v.ONE_MINUS_SRC_ALPHA;case"DstAlphaFactor":return v.DST_ALPHA;case"OneMinusDstAlphaFactor":return v.ONE_MINUS_DST_ALPHA;case"DstColorFactor":return v.DST_COLOR;case"OneMinusDstColorFactor":return v.ONE_MINUS_DST_COLOR;case"SrcAlphaSaturateFactor":return v.SRC_ALPHA_SATURATE;default:throw"Unknown blend param: "+t}},m.prototype.clear=function(t,e,i){var o=0;(void 0===t||t)&&(o|=v.COLOR_BUFFER_BIT),(void 0===e||e)&&(o|=v.DEPTH_BUFFER_BIT),(void 0===i||i)&&(o|=v.STENCIL_BUFFER_BIT);var r=this.rendererRecord.depthRecord;r.write!==!0&&(this.context.depthMask(!0),r.write=!0),this.context.clear(o)},m.prototype.flush=function(){this.context.flush()},m.prototype.finish=function(){this.context.finish()},m.prototype.setupFrameBuffer=function(t,e,i){this.context.bindFramebuffer(v.FRAMEBUFFER,t),this.context.framebufferTexture2D(v.FRAMEBUFFER,v.COLOR_ATTACHMENT0,i,e.glTexture,0)},m.prototype.setupRenderBuffer=function(t,e){this.context.bindRenderbuffer(v.RENDERBUFFER,t),e.depthBuffer&&!e.stencilBuffer?(this.context.renderbufferStorage(v.RENDERBUFFER,v.DEPTH_COMPONENT16,e.width,e.height),this.context.framebufferRenderbuffer(v.FRAMEBUFFER,v.DEPTH_ATTACHMENT,v.RENDERBUFFER,t)):e.depthBuffer&&e.stencilBuffer?(this.context.renderbufferStorage(v.RENDERBUFFER,v.DEPTH_STENCIL,e.width,e.height),this.context.framebufferRenderbuffer(v.FRAMEBUFFER,v.DEPTH_STENCIL_ATTACHMENT,v.RENDERBUFFER,t)):this.context.renderbufferStorage(v.RENDERBUFFER,v.RGBA4,e.width,e.height)},m.prototype.setRenderTarget=function(t){if(t&&!t._glFrameBuffer){void 0===t.depthBuffer&&(t.depthBuffer=!0),void 0===t.stencilBuffer&&(t.stencilBuffer=!0),t.glTexture=this.context.createTexture();var i=e.isPowerOfTwo(t.width)&&e.isPowerOfTwo(t.height),o=this.getGLInternalFormat(t.format),r=this.getGLDataType(t.type);t._glFrameBuffer=this.context.createFramebuffer(),t._glRenderBuffer=this.context.createRenderbuffer(),this.context.bindTexture(v.TEXTURE_2D,t.glTexture),this.updateTextureParameters(t,i),this.context.texImage2D(v.TEXTURE_2D,0,o,t.width,t.height,0,o,r,null),this.setupFrameBuffer(t._glFrameBuffer,t,v.TEXTURE_2D),this.setupRenderBuffer(t._glRenderBuffer,t),t.generateMipmaps&&i&&this.context.generateMipmap(v.TEXTURE_2D),this.context.bindTexture(v.TEXTURE_2D,null),this.context.bindRenderbuffer(v.RENDERBUFFER,null),this.context.bindFramebuffer(v.FRAMEBUFFER,null)}var n,a,s,c,l;t?(n=t._glFrameBuffer,c=0,l=0,a=t.width,s=t.height):(n=null,c=this.viewportX,l=this.viewportY,a=this.viewportWidth,s=this.viewportHeight),n!==this.rendererRecord.currentFrameBuffer&&(this.context.bindFramebuffer(v.FRAMEBUFFER,n),this.context.viewport(c,l,a,s),this.rendererRecord.currentFrameBuffer=n,this.rendererRecord.textureRecord=[]),this.currentWidth=a,this.currentHeight=s
},m.prototype.updateRenderTargetMipmap=function(t){this.context.bindTexture(v.TEXTURE_2D,t.glTexture),this.context.generateMipmap(v.TEXTURE_2D),this.context.bindTexture(v.TEXTURE_2D,null)},m.prototype.getCapabilitiesString=function(){var t=[];for(var e in this.capabilities){var i=this.capabilities[e],o="";if(i instanceof ArrayBufferView){o+="[";for(var r=0;r<i.length;r++)o+=i[r],r<i.length-1&&(o+=",");o+="]"}else o=i;t.push(e+": "+o)}return t.join("\n")},m.prototype._deallocateMeshData=function(){},m.prototype._deallocateTexture=function(){},m.prototype._deallocateRenderTarget=function(){},m.prototype._deallocateShader=function(){},m}),define("goo/addons/howler/systems/HowlerSystem",["goo/entities/systems/System","goo/math/Vector3","goo/renderer/Renderer"],function(t,e,i){"use strict";function o(e){t.call(this,"HowlerSystem",["HowlerComponent"]),this.settings=e||{},this.settings.scale=this.settings.scale||.1}return o.prototype=Object.create(t.prototype),o.prototype.deleted=function(t){for(var e=t.howlerComponent,i=e.sounds,o=0;o<i.length;o++)i[o].stop()},o.prototype.process=function(t){for(var o=0;o<t.length;o++){var r=t[o],n=r.howlerComponent,a=n.sounds,s=new e;if(s.copy(r.transformComponent.transform.translation),i.mainCamera)for(var c=i.mainCamera.getViewMatrix().applyPostPoint(s),l=0;l<a.length;l++)a[l].pos3d(c.data[0]*this.settings.scale,c.data[1]*this.settings.scale,c.data[2]*this.settings.scale)}},o}),define("goo/addons/scripts/PolyBoundingScript",[],function(){"use strict";function t(t){this.collidables=t||[]}return t.prototype.addCollidable=function(t){this.collidables.push(t)},t.prototype.removeAllAt=function(t,e,i){this.collidables=this.collidables.filter(function(o){return o.bottom<=i&&o.top>=i?!window.PolyK.ContainsPoint(o.poly,t,e):void 0})},t.prototype.inside=function(t,e,i){for(var o=0;o<this.collidables.length;o++){var r=this.collidables[o];if(r.bottom<=e&&r.top>=e&&window.PolyK.ContainsPoint(r.poly,t,i))return window.PolyK.ClosestEdge(r.poly,t,i)}},t.prototype.run=function(t){for(var e=t.transformComponent,i=e.transform.translation,o=0;o<this.collidables.length;o++){var r=this.collidables[o];if(r.bottom<=i.data[1]&&r.top>=i.data[1]&&window.PolyK.ContainsPoint(r.poly,i.data[0],i.data[2])){var n=window.PolyK.ClosestEdge(r.poly,i.data[0],i.data[2]);return i.data[0]=n.point.x,i.data[2]=n.point.y,e.setUpdated(),void 0}}},t}),define("goo/addons/soundmanager2/components/SoundManager2Component",["goo/entities/components/Component"],function(t){"use strict";function e(t){this.type="SoundManager2Component",this.settings=t||{},this.sounds={}}return e.prototype=Object.create(t.prototype),e.prototype.addSound=function(t,e){this.sounds[t]=e},e.prototype.playSound=function(t){this.sounds[t].soundObject.play()},e}),define("goo/addons/soundmanager2/systems/SoundManager2System",["goo/entities/systems/System"],function(t){"use strict";function e(e){t.call(this,"SoundManager2System",["SoundManager2Component","TransformComponent"]),e=e||{},this.isReady=!1,window.soundManager?window.soundManager.bind(this).setup({url:"swf",onready:function(){this.isReady=!0},ontimeout:function(){console.warn("Failed to load soundmanager")}}):console.warn("SoundManager2System: soundManager global not found")}return e.prototype=Object.create(t.prototype),e.prototype.inserted=function(t){for(var e=t.soundManager2Component,i=0;i<e.sounds.length;i++){var o=e.sounds[i],r=window.soundManager.createSound(o);o.soundObject=r}},e.prototype.deleted=function(){},e.prototype.process=function(){},e}),define("goo/addons/terrain/Terrain",["goo/entities/components/MeshDataComponent","goo/entities/components/MeshRendererComponent","goo/renderer/MeshData","goo/renderer/Material","goo/renderer/Shader","goo/renderer/TextureCreator"],function(t,e,i,o,r,n){"use strict";function a(t){var e="../resources",i=o.createMaterial(s),r=(new n).loadTexture2D(e+"/head_diffuse.jpg");i.setTexture("DIFFUSE_MAP",r);var a=o.createMaterial(s);a.setTexture("HEIGHT_MAP",r),a.wireframe=!0,this.material=i,this.material2=a;var c=t.createEntity();c.addToWorld();for(var l=0;6>l;l++){var h=this.createClipmapLevel(t,l,0===l);c.transformComponent.attachChild(h.transformComponent)}}a.prototype.createClipmapLevel=function(t,e,i){var o=t.createEntity(),r=Math.pow(2,e);o.transformComponent.transform.scale.set(r,r,1);var n=(2*Math.pow(-1,e+1)+Math.pow(2,e+1))/6,a=0===e%2?n:-n;return o.transformComponent.transform.translation.set(a,-a,0),o.addToWorld(),this.createQuadEntity(t,o,0,0,3,3),this.createQuadEntity(t,o,3,0,3,3),this.createQuadEntity(t,o,6,0,2,3),this.createQuadEntity(t,o,8,0,3,3),this.createQuadEntity(t,o,11,0,3,3),this.createQuadEntity(t,o,0,3,3,3),this.createQuadEntity(t,o,11,3,3,3),this.createQuadEntity(t,o,0,6,3,2),this.createQuadEntity(t,o,11,6,3,2),this.createQuadEntity(t,o,0,8,3,3),this.createQuadEntity(t,o,11,8,3,3),this.createQuadEntity(t,o,0,11,3,3),this.createQuadEntity(t,o,3,11,3,3),this.createQuadEntity(t,o,6,11,2,3),this.createQuadEntity(t,o,8,11,3,3),this.createQuadEntity(t,o,11,11,3,3),i&&this.createQuadEntity(t,o,3,4,7,7),o},a.prototype.createQuadEntity=function(i,o,r,n,a,s){var c=this.createGrid(r,n,a,s),l=i.createEntity();o.transformComponent.attachChild(l.transformComponent);var h=new t(c);l.setComponent(h);var u=new e;return u.materials.push(this.material2),l.setComponent(u),l.addToWorld(),l},a.prototype.createGrid=function(t,e,o,r){for(var n=i.defaultMap([i.POSITION,i.TEXCOORD0]),a=new i(n,(o+1)*(r+1),6*o*r),s=a.getAttributeBuffer(i.POSITION),c=a.getAttributeBuffer(i.TEXCOORD0),l=a.getIndexBuffer(),h=0;o+1>h;h++)for(var u=0;r+1>u;u++){var d=u*(o+1)+h;s[3*d+0]=h+t-7,s[3*d+1]=u+e-7,s[3*d+2]=0,c[2*d+0]=(h+t)/15,c[2*d+1]=(u+e)/15}for(var h=0;o>h;h++)for(var u=0;r>u;u++){var d=u*(o+1)+h,p=u*o+h;l[6*p+0]=d,l[6*p+1]=d+1,l[6*p+2]=d+o+1,l[6*p+3]=d+1,l[6*p+4]=d+o+1+1,l[6*p+5]=d+o+1}return a};var s={attributes:{vertexPosition:i.POSITION,vertexUV0:i.TEXCOORD0},uniforms:{viewMatrix:r.VIEW_MATRIX,projectionMatrix:r.PROJECTION_MATRIX,worldMatrix:r.WORLD_MATRIX,diffuseMap:"DIFFUSE_MAP",time:r.TIME},vshader:["attribute vec3 vertexPosition;","attribute vec2 vertexUV0;","uniform mat4 viewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 worldMatrix;","uniform float time;","uniform sampler2D diffuseMap;","varying vec4 texCol;","void main(void) {","	texCol = texture2D(diffuseMap, vertexUV0 + vec2(time*0.0));","	float height = length(texCol.rgb);","	gl_Position = projectionMatrix * viewMatrix * worldMatrix * ","		vec4(vertexPosition.x,vertexPosition.y,height*5.0, 1.0);","}"].join("\n"),fshader:["precision mediump float;","varying vec4 texCol;","void main(void)","{","	gl_FragColor = texCol;","}"].join("\n")};return a}),define("goo/addons/water/FlatWaterRenderer",["goo/renderer/MeshData","goo/renderer/Shader","goo/renderer/Camera","goo/math/Plane","goo/renderer/pass/RenderTarget","goo/math/Vector3","goo/math/Vector4","goo/renderer/Material","goo/renderer/TextureCreator","goo/renderer/shaders/ShaderFragment"],function(t,e,i,o,r,n,a,s,c,l){"use strict";function h(t){t=t||{},this.useRefraction=void 0!==t.useRefraction?t.useRefraction:!0,this.waterCamera=new i(45,1,.1,2e3),this.renderList=[],this.waterPlane=new o;var e=Math.floor(window.innerWidth/(t.divider||2)),l=Math.floor(window.innerHeight/(t.divider||2));this.reflectionTarget=new r(e,l),this.useRefraction&&(this.refractionTarget=new r(e,l),this.depthTarget=new r(e,l));var h=s.createMaterial(u,"WaterMaterial");h.shader.defines.REFRACTION=this.useRefraction,h.cullState.enabled=!1;var p=t.normalsUrl||"../resources/water/waternormals3.png";h.setTexture("NORMAL_MAP",(new c).loadTexture2D(p)),h.setTexture("REFLECTION_MAP",this.reflectionTarget),this.useRefraction&&(h.setTexture("REFRACTION_MAP",this.refractionTarget),h.setTexture("DEPTH_MAP",this.depthTarget)),this.waterMaterial=h,this.followCam=!0,this.updateWaterPlaneFromEntity=void 0!==t.updateWaterPlaneFromEntity?this.updateWaterPlaneFromEntity:!0,this.calcVect=new n,this.camReflectDir=new n,this.camReflectUp=new n,this.camReflectLeft=new n,this.camLocation=new n,this.camReflectPos=new n,this.offset=new n,this.clipPlane=new a,this.waterEntity=null,this.depthMaterial=s.createMaterial(d,"depth")}h.prototype.process=function(t,e,i,o,r){e=e.filter(function(t){return t.meshRendererComponent.isReflectable});var n=this.waterPlane;this.waterCamera.copy(o),this.updateWaterPlaneFromEntity&&(n.constant=this.waterEntity.transformComponent.transform.translation.y);var a=o.translation.y>n.constant;if(this.waterEntity.skip=!0,a){this.useRefraction&&(i.process(this.waterCamera,e,this.renderList),this.clipPlane.setd(n.normal.x,-n.normal.y,n.normal.z,n.constant),this.waterCamera.setToObliqueMatrix(this.clipPlane),t.render(this.renderList,this.waterCamera,r,this.depthTarget,!0,this.depthMaterial),t.render(this.renderList,this.waterCamera,r,this.refractionTarget,!0));var s=this.calcVect,c=this.camReflectDir,l=this.camReflectUp,h=this.camReflectLeft,u=this.camLocation,d=this.camReflectPos;u.set(o.translation);var p=n.pseudoDistance(u);if(s.set(n.normal).mul(2*p),d.set(u.sub(s)),u.set(o.translation).add(o._direction),p=n.pseudoDistance(u),s.set(n.normal).mul(2*p),c.set(u.sub(s)).sub(d).normalize(),u.set(o.translation).add(o._up),p=n.pseudoDistance(u),s.set(n.normal).mul(2*p),l.set(u.sub(s)).sub(d).normalize(),h.set(l).cross(c).normalize(),this.waterCamera.translation.set(d),this.waterCamera._direction.set(c),this.waterCamera._up.set(l),this.waterCamera._left.set(h),this.waterCamera.normalize(),this.waterCamera.update(),this.skybox&&this.followCam){var f=this.skybox.transformComponent.worldTransform;f.translation.setv(d),f.update()}}if(this.waterMaterial.shader.uniforms.abovewater=a,i.process(this.waterCamera,e,this.renderList),t.setRenderTarget(this.reflectionTarget),t.clear(),this.skybox)if(this.skybox instanceof Array){this.clipPlane.setd(n.normal.x,n.normal.y,n.normal.z,n.constant),this.waterCamera.setToObliqueMatrix(this.clipPlane,10);for(var m=0;m<this.skybox.length;m++)t.render(this.skybox[m],this.waterCamera,r,this.reflectionTarget,!1),this.skybox[m].skip=!0}else t.render(this.skybox,this.waterCamera,r,this.reflectionTarget,!1),this.skybox.skip=!0;if(this.clipPlane.setd(n.normal.x,n.normal.y,n.normal.z,n.constant),this.waterCamera.setToObliqueMatrix(this.clipPlane),t.render(this.renderList,this.waterCamera,r,this.reflectionTarget,!1),this.waterEntity.skip=!1,this.skybox)if(this.skybox instanceof Array)for(var m=0;m<this.skybox.length;m++)this.skybox[m].skip=!1;else this.skybox.skip=!1;if(a&&this.skybox&&this.followCam){var g=o.translation,f=this.skybox.transformComponent.worldTransform;f.translation.setv(g).addv(this.offset),f.update(),this.waterCamera._updatePMatrix=!0}},h.prototype.setSkyBox=function(t){this.skybox=t,t.meshRendererComponent&&(this.skybox.meshRendererComponent.materials[0].depthState.enabled=!1,this.skybox.meshRendererComponent.materials[0].renderQueue=0,this.skybox.meshRendererComponent.cullMode="Never")},h.prototype.setWaterEntity=function(t){this.waterEntity=t,this.waterEntity.meshRendererComponent.materials[0]=this.waterMaterial};var u={defines:{REFRACTION:!1},attributes:{vertexPosition:t.POSITION,vertexNormal:t.NORMAL},uniforms:{viewMatrix:e.VIEW_MATRIX,projectionMatrix:e.PROJECTION_MATRIX,worldMatrix:e.WORLD_MATRIX,normalMatrix:e.NORMAL_MATRIX,cameraPosition:e.CAMERA,normalMap:"NORMAL_MAP",reflection:"REFLECTION_MAP",refraction:"REFRACTION_MAP",depthmap:"DEPTH_MAP",vertexTangent:[1,0,0,1],waterColor:[.0625,.0625,.0625],abovewater:!0,fogColor:[1,1,1],sunDirection:[.66,.66,.33],sunColor:[1,1,.5],sunShininess:100,sunSpecPower:4,fogStart:0,fogScale:2e3,timeMultiplier:1,time:e.TIME,distortionMultiplier:.025,fresnelPow:2,normalMultiplier:3,fresnelMultiplier:1,waterScale:5,doFog:!0,resolution:e.RESOLUTION},vshader:["attribute vec3 vertexPosition;","attribute vec3 vertexNormal;","uniform vec4 vertexTangent;","uniform mat4 viewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 worldMatrix;","uniform mat4 normalMatrix;","uniform vec3 cameraPosition;","uniform float waterScale;","varying vec2 texCoord0;","varying vec3 eyeVec;","varying vec4 viewCoords;","varying vec3 worldPos;","void main(void) {","	worldPos = (worldMatrix * vec4(vertexPosition, 1.0)).xyz;","	texCoord0 = worldPos.xz * waterScale;","	vec3 n = normalize((normalMatrix * vec4(vertexNormal.x, vertexNormal.y, -vertexNormal.z, 0.0)).xyz);","	vec3 t = normalize((normalMatrix * vec4(vertexTangent.xyz, 0.0)).xyz);","	vec3 b = cross(n, t) * vertexTangent.w;","	mat3 rotMat = mat3(t, b, n);","	vec3 eyeDir = worldPos - cameraPosition;","	eyeVec = eyeDir * rotMat;","	viewCoords = projectionMatrix * viewMatrix * worldMatrix * vec4(vertexPosition, 1.0);","	gl_Position = viewCoords;","}"].join("\n"),fshader:["uniform sampler2D normalMap;","uniform sampler2D reflection;","#ifdef REFRACTION","uniform sampler2D refraction;","uniform sampler2D depthmap;","#endif","uniform vec3 waterColor;","uniform bool abovewater;","uniform vec3 fogColor;","uniform float fogStart;","uniform float fogScale;","uniform float time;","uniform float timeMultiplier;","uniform float distortionMultiplier;","uniform float fresnelPow;","uniform vec3 sunDirection;","uniform vec3 sunColor;","uniform float sunShininess;","uniform float sunSpecPower;","uniform float normalMultiplier;","uniform float fresnelMultiplier;","uniform bool doFog;","uniform vec2 resolution;","varying vec2 texCoord0;","varying vec3 eyeVec;","varying vec4 viewCoords;","varying vec3 worldPos;","vec4 combineTurbulence(in vec2 coords) {","	float t = time * timeMultiplier;","	vec4 coarse1 = texture2D(normalMap, coords * vec2(0.0012, 0.001) + vec2(0.019 * t, 0.021 * t));","	vec4 coarse2 = texture2D(normalMap, coords * vec2(0.001, 0.0011) + vec2(-0.017 * t, 0.016 * t));","	vec4 detail1 = texture2D(normalMap, coords * vec2(0.008) + vec2(0.06 * t, 0.03 * t));","	vec4 detail2 = texture2D(normalMap, coords * vec2(0.006) + vec2(0.05 * t, -0.04 * t));","	return (detail1 * 0.25 + detail2 * 0.25 + coarse1 * 0.75 + coarse2 * 1.0) / 2.25 - 0.48;","}","#ifdef REFRACTION",l.methods.unpackDepth,"#endif","void main(void)","{","	float fogDist = clamp((viewCoords.z-fogStart)/fogScale,0.0,1.0);","	vec2 normCoords = texCoord0;","	vec4 noise = combineTurbulence(normCoords);","	vec3 normalVector = normalize(noise.xyz * vec3(normalMultiplier, normalMultiplier, 1.0));","	vec3 localView = normalize(eyeVec);","	float fresnel = dot(normalize(normalVector * vec3(fresnelMultiplier, fresnelMultiplier, 1.0)), localView);","	if ( abovewater == false ) {","		fresnel = -fresnel;","	}","	fresnel *= 1.0 - fogDist;","	float fresnelTerm = 1.0 - fresnel;","	fresnelTerm = pow(fresnelTerm, fresnelPow);","	fresnelTerm = clamp(fresnelTerm, 0.0, 1.0);","	fresnelTerm = fresnelTerm * 0.95 + 0.05;","	vec2 projCoord = viewCoords.xy / viewCoords.q;","	projCoord = (projCoord + 1.0) * 0.5;","	projCoord.y -= 1.0 / resolution.y;","#ifdef REFRACTION","	float depthUnpack = unpackDepth(texture2D(depthmap, projCoord));","	if (depthUnpack > 0.5) {depthUnpack = 0.0;}","	float depth2 = clamp(depthUnpack * 400.0, 0.0, 1.0);","	vec2 projCoordRefr = vec2(projCoord);","	projCoordRefr += (normalVector.xy * distortionMultiplier) * (depth2);","	projCoordRefr = clamp(projCoordRefr, 0.001, 0.999);","	depthUnpack = unpackDepth(texture2D(depthmap, projCoordRefr));","	float depth = clamp(depthUnpack * 40.0, 0.8, 1.0);","#endif","	projCoord += (normalVector.xy * distortionMultiplier);","	projCoord = clamp(projCoord, 0.001, 0.999);","	if ( abovewater == true ) {","		projCoord.x = 1.0 - projCoord.x;","	}","	vec4 waterColorX = vec4(waterColor, 1.0);","	vec4 reflectionColor = texture2D(reflection, projCoord);","	if ( abovewater == false ) {","		reflectionColor *= vec4(0.8,0.9,1.0,1.0);","		vec4 endColor = mix(reflectionColor,waterColorX,fresnelTerm);","		gl_FragColor = mix(endColor,waterColorX,fogDist);","	}","	else {","		vec3 sunSpecReflection = normalize(reflect(-sunDirection, normalVector));","		float sunSpecDirection = max(0.0, dot(localView, sunSpecReflection));","		vec3 specular = pow(sunSpecDirection, sunShininess) * sunSpecPower * sunColor;","		vec4 endColor = waterColorX;","#ifdef REFRACTION","		vec4 refractionColor = texture2D(refraction, projCoordRefr) * vec4(0.6);","		endColor = mix(refractionColor, waterColorX, depth);","#endif","		endColor = mix(endColor, reflectionColor, fresnelTerm);","		if (doFog) {","			gl_FragColor = (vec4(specular, 1.0) + mix(endColor,reflectionColor,fogDist)) * (1.0-fogDist) + vec4(fogColor, 1.0) * fogDist;","		} else {","			gl_FragColor = vec4(specular, 1.0) + mix(endColor,reflectionColor,fogDist);","		}","	}","}"].join("\n")},d={attributes:{vertexPosition:t.POSITION},uniforms:{viewProjectionMatrix:e.VIEW_PROJECTION_MATRIX,worldMatrix:e.WORLD_MATRIX,farPlane:e.FAR_PLANE},vshader:["attribute vec3 vertexPosition;","uniform mat4 viewProjectionMatrix;","uniform mat4 worldMatrix;","varying vec4 vPosition;","void main(void) {","	vPosition = worldMatrix * vec4(vertexPosition, 1.0);","	gl_Position = viewProjectionMatrix * vPosition;","}"].join("\n"),fshader:["uniform float farPlane;",l.methods.packDepth,"varying vec4 vPosition;","void main(void)","{","	float linearDepth = abs(vPosition.y) / farPlane;","	gl_FragColor = packDepth(linearDepth);","}"].join("\n")};return h}),define("goo/addons/water/ProjectedGridWaterRenderer",["goo/renderer/MeshData","goo/renderer/Shader","goo/renderer/Camera","goo/math/Plane","goo/renderer/pass/RenderTarget","goo/renderer/pass/FullscreenPass","goo/math/Vector3","goo/renderer/Material","goo/renderer/TextureCreator","goo/renderer/shaders/ShaderLib","goo/renderer/shaders/ShaderFragment"],function(t,e,i,o,r,n,a,s,c,l,h){"use strict";function u(e){this.waterCamera=new i(45,1,.1,2e3),this.renderList=[],this.waterPlane=new o,e=e||{};var h=window.innerWidth/(e.divider||4),u=window.innerHeight/(e.divider||4);this.renderTarget=new r(h,u),h=window.innerWidth/(e.divider||1),u=window.innerHeight/(e.divider||1),this.heightTarget=new r(h,u,{type:"Float"}),this.normalTarget=new r(h,u,{}),this.fullscreenPass=new n(l.normalmap),this.fullscreenPass.material.shader.uniforms.resolution=[h,u];var f=this.waterMaterial=s.createMaterial(d,"WaterMaterial");f.cullState.enabled=!1,f.setTexture("NORMAL_MAP",(new c).loadTexture2D("../resources/water/waternormals3.png")),f.setTexture("REFLECTION_MAP",this.renderTarget),f.setTexture("BUMP_MAP",this.heightTarget),f.setTexture("NORMAL_MAP_COARSE",this.normalTarget);var m=this.materialWire=s.createMaterial(l.simple,"mat");m.wireframe=!0,m.wireframeColor=[0,0,0],this.calcVect=new a,this.camReflectDir=new a,this.camReflectUp=new a,this.camReflectLeft=new a,this.camLocation=new a,this.camReflectPos=new a,this.waterEntity=null;var g=this.projData=new t(t.defaultMap([t.POSITION]),4,6);g.getAttributeBuffer(t.POSITION).set([0,0,0,1,0,0,1,1,0,0,1,0]),g.getIndexBuffer().set([1,3,0,2,3,1]);var v=s.createMaterial(p,"mat");this.projRenderable={meshData:g,materials:[v]}}u.prototype.updateHelper=function(e,i,o,r){var n=this.projData.getAttributeBuffer(t.POSITION);n[0]=e.x/e.w,n[1]=0,n[2]=e.z/e.w,n[3]=i.x/i.w,n[4]=0,n[5]=i.z/i.w,n[6]=o.x/o.w,n[7]=0,n[8]=o.z/o.w,n[9]=r.x/r.w,n[10]=0,n[11]=r.z/r.w,this.projData.setVertexDataUpdated()},u.prototype.process=function(t,e,i,o,r){var n=this.waterEntity.meshDataComponent.meshData;n.update(o),this.waterMaterial.shader.uniforms.intersectBottomLeft=[n.intersectBottomLeft.x,n.intersectBottomLeft.y,n.intersectBottomLeft.z,n.intersectBottomLeft.w],this.waterMaterial.shader.uniforms.intersectBottomRight=[n.intersectBottomRight.x,n.intersectBottomRight.y,n.intersectBottomRight.z,n.intersectBottomRight.w],this.waterMaterial.shader.uniforms.intersectTopLeft=[n.intersectTopLeft.x,n.intersectTopLeft.y,n.intersectTopLeft.z,n.intersectTopLeft.w],this.waterMaterial.shader.uniforms.intersectTopRight=[n.intersectTopRight.x,n.intersectTopRight.y,n.intersectTopRight.z,n.intersectTopRight.w],this.updateHelper(n.intersectBottomLeft,n.intersectBottomRight,n.intersectTopRight,n.intersectTopLeft),t.render(this.projRenderable,o,r,this.heightTarget,!0),this.fullscreenPass.render(t,this.normalTarget,this.heightTarget,0);var a=this.waterPlane;this.waterCamera.copy(o),a.constant=this.waterEntity.transformComponent.transform.translation.y;var s=o.translation.y>a.constant;if(s){var c=this.calcVect,l=this.camReflectDir,h=this.camReflectUp,u=this.camReflectLeft,d=this.camLocation,p=this.camReflectPos;d.set(o.translation);var f=a.pseudoDistance(d);if(c.set(a.normal).mul(2*f),p.set(d.sub(c)),d.set(o.translation).add(o._direction),f=a.pseudoDistance(d),c.set(a.normal).mul(2*f),l.set(d.sub(c)).sub(p).normalize(),d.set(o.translation).add(o._up),f=a.pseudoDistance(d),c.set(a.normal).mul(2*f),h.set(d.sub(c)).sub(p).normalize(),u.set(h).cross(l).normalize(),this.waterCamera.translation.set(p),this.waterCamera._direction.set(l),this.waterCamera._up.set(h),this.waterCamera._left.set(u),this.waterCamera.normalize(),this.waterCamera.update(),this.skybox){var m=this.skybox.transformComponent.worldTransform;m.translation.setv(p),m.update()}}if(this.waterMaterial.shader.uniforms.abovewater=s,this.waterEntity.skip=!0,this.renderList.length=0,i.process(this.waterCamera,e,this.renderList),t.render(this.renderList,this.waterCamera,r,this.renderTarget,!0),this.waterEntity.skip=!1,s&&this.skybox){var g=o.translation,m=this.skybox.transformComponent.worldTransform;m.translation.setv(g),m.update()}},u.prototype.setSkyBox=function(t){this.skybox=t},u.prototype.setWaterEntity=function(t){this.waterEntity=t,this.waterEntity.meshRendererComponent.cullMode="Never",this.waterEntity.meshRendererComponent.materials[0]=this.waterMaterial;var e=this.waterEntity.meshDataComponent.meshData;this.waterMaterial.shader.uniforms.density=[e.densityX,e.densityY]};var d={attributes:{vertexUV0:t.TEXCOORD0},uniforms:{viewMatrix:e.VIEW_MATRIX,projectionMatrix:e.PROJECTION_MATRIX,worldMatrix:e.WORLD_MATRIX,normalMatrix:e.NORMAL_MATRIX,cameraPosition:e.CAMERA,normalMap:"NORMAL_MAP",reflection:"REFLECTION_MAP",bump:"BUMP_MAP",normalMapCoarse:"NORMAL_MAP_COARSE",vertexNormal:[0,-1,0],vertexTangent:[1,0,0,1],waterColor:[15,15,15],abovewater:!0,fogColor:[1,1,1,1],sunDirection:[.66,-.1,.66],coarseStrength:.25,detailStrength:2,fogStart:0,camNear:e.NEAR_PLANE,camFar:e.FAR_PLANE,time:e.TIME,intersectBottomLeft:[0,0,0,0],intersectTopLeft:[0,0,0,0],intersectTopRight:[0,0,0,0],intersectBottomRight:[0,0,0,0],grid:!1,heightMultiplier:50,density:[1,1]},vshader:["attribute vec2 vertexUV0;","uniform vec3 vertexNormal;","uniform vec4 vertexTangent;","uniform mat4 viewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 worldMatrix;","uniform mat4 normalMatrix;","uniform vec3 cameraPosition;","uniform float time;","uniform vec3 sunDirection;","uniform float coarseStrength;","uniform float heightMultiplier;","uniform sampler2D bump;","uniform vec4 intersectBottomLeft;","uniform vec4 intersectTopLeft;","uniform vec4 intersectTopRight;","uniform vec4 intersectBottomRight;","varying vec2 texCoord0;","varying vec2 texCoord1;","varying vec3 eyeVec;","varying vec3 sunDir;","varying vec4 viewCoords;","varying vec3 worldPos;","varying vec3 normal;","void main(void) {","	vec4 pointTop = mix(intersectTopLeft, intersectTopRight, vertexUV0.x);","	vec4 pointBottom = mix(intersectBottomLeft, intersectBottomRight, vertexUV0.x);","	vec4 pointFinal = mix(pointTop, pointBottom, 1.0 - vertexUV0.y);","	pointFinal.xz /= pointFinal.w;","	pointFinal.y = 0.0;","	vec4 screenpos = projectionMatrix * viewMatrix * worldMatrix * vec4(pointFinal.xyz, 1.0);","	vec2 projCoord = screenpos.xy / screenpos.q;","	projCoord = (projCoord + 1.0) * 0.5;","	float height = texture2D(bump, projCoord).x;","	pointFinal.y = height * heightMultiplier;","	texCoord1 = vertexUV0;","	vec4 pos = worldMatrix * vec4(pointFinal.xyz, 1.0);","	worldPos = pos.xyz;","	texCoord0 = worldPos.xz * 2.0;","	vec3 n = normalize((normalMatrix * vec4(vertexNormal, 0.0)).xyz);","	vec3 t = normalize((normalMatrix * vec4(vertexTangent.xyz, 0.0)).xyz);","	vec3 b = cross(n, t) * vertexTangent.w;","	mat3 rotMat = mat3(t, b, n);","	vec3 eyeDir = worldPos - cameraPosition;","	eyeVec = eyeDir * rotMat;","	sunDir = sunDirection * rotMat;","	viewCoords = projectionMatrix * viewMatrix * pos;","	gl_Position = viewCoords;","}"].join("\n"),fshader:["uniform sampler2D normalMap;","uniform sampler2D reflection;","uniform sampler2D normalMapCoarse;","uniform vec3 waterColor;","uniform bool abovewater;","uniform vec4 fogColor;","uniform float time;","uniform bool grid;","uniform vec2 density;","uniform float camNear;","uniform float camFar;","uniform float fogStart;","uniform float coarseStrength;","uniform float detailStrength;","varying vec2 texCoord0;","varying vec2 texCoord1;","varying vec3 eyeVec;","varying vec3 sunDir;","varying vec4 viewCoords;","varying vec3 worldPos;","varying vec3 normal;","const vec3 sunColor = vec3(1.0, 0.96, 0.96);","vec4 getNoise(vec2 uv) {","    vec2 uv0 = (uv/123.0)+vec2(time/17.0, time/29.0);","    vec2 uv1 = uv/127.0-vec2(time/-19.0, time/31.0);","    vec2 uv2 = uv/vec2(897.0, 983.0)+vec2(time/51.0, time/47.0);","    vec2 uv3 = uv/vec2(991.0, 877.0)-vec2(time/59.0, time/-63.0);","    vec4 noise = (texture2D(normalMap, uv0)) +","                 (texture2D(normalMap, uv1)) +","                 (texture2D(normalMap, uv2)*3.0) +","                 (texture2D(normalMap, uv3)*3.0);","    return noise/4.0-1.0;","}","void main(void)","{","	vec2 projCoord = viewCoords.xy / viewCoords.q;","	projCoord = (projCoord + 1.0) * 0.5;","	float fs = camFar * fogStart;","	float fogDist = clamp(max(viewCoords.z - fs, 0.0)/(camFar - camNear - fs), 0.0, 1.0);","	vec3 coarseNormal = texture2D(normalMapCoarse, projCoord).xyz * 2.0 - 1.0;","	vec2 normCoords = texCoord0;","	vec4 noise = getNoise(normCoords);","	vec3 normalVector = normalize(noise.xyz * vec3(1.8 * detailStrength, 1.8 * detailStrength, 1.0) + coarseNormal.xyz * vec3(1.8 * coarseStrength, 1.8 * coarseStrength, 1.0));","	vec3 localView = normalize(eyeVec);","	float fresnel = dot(normalize(normalVector*vec3(1.0, 1.0, 1.0)), localView);","	if ( abovewater == false ) {","		fresnel = -fresnel;","	}","	float fresnelTerm = 1.0 - fresnel;","	fresnelTerm *= fresnelTerm;","	fresnelTerm *= fresnelTerm;","	fresnelTerm = fresnelTerm * 0.95 + 0.05;","	if ( abovewater == true ) {","		projCoord.x = 1.0 - projCoord.x;","	}","	projCoord += (normalVector.xy * 0.05);","	projCoord = clamp(projCoord, 0.001, 0.999);"," vec4 waterColorX = vec4(waterColor / 255.0, 1.0);","	vec4 reflectionColor = texture2D(reflection, projCoord);","	if ( abovewater == false ) {","		reflectionColor *= vec4(0.8,0.9,1.0,1.0);","		vec4 endColor = mix(reflectionColor,waterColorX,fresnelTerm);","		gl_FragColor = mix(endColor,waterColorX,fogDist);","	}","	else {","		vec3 diffuse = vec3(0.0);","		vec3 specular = vec3(0.0);","		vec3 sunreflection = normalize(reflect(-sunDir, normalVector));","		float direction = max(0.0, dot(localView, sunreflection));","		specular += pow(direction, 100.0)*sunColor * 2.0;","		diffuse += max(dot(sunDir, normalVector),0.0)*sunColor*0.4;","		vec4 endColor = mix(waterColorX,reflectionColor,fresnelTerm);","		gl_FragColor = mix(vec4(diffuse*0.0 + specular, 1.0) + mix(endColor,reflectionColor,fogDist), fogColor, fogDist);","	}","	if (grid) {","		vec2 low = abs(fract(texCoord1*density)-0.5);","		float dist = 1.0 - step(min(low.x, low.y), 0.05);","		gl_FragColor *= vec4(dist);","	}","}"].join("\n")},p={attributes:{vertexPosition:t.POSITION},uniforms:{viewMatrix:e.VIEW_MATRIX,projectionMatrix:e.PROJECTION_MATRIX,worldMatrix:e.WORLD_MATRIX,time:e.TIME},vshader:["attribute vec3 vertexPosition;","uniform mat4 viewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 worldMatrix;","varying vec4 worldPos;","varying vec4 viewCoords;","void main(void) {","	worldPos = worldMatrix * vec4(vertexPosition, 1.0);","	viewCoords = viewMatrix * worldPos;","	gl_Position = projectionMatrix * viewMatrix * worldPos;","}"].join("\n"),fshader:["precision mediump float;","uniform float time;","varying vec4 worldPos;","varying vec4 viewCoords;",h.noise3d,"vec4 getNoise(sampler2D map, vec2 uv) {","    vec2 uv0 = (uv/223.0)+vec2(time/17.0, time/29.0);","    vec2 uv1 = uv/327.0-vec2(time/-19.0, time/31.0);","    vec2 uv2 = uv/vec2(697.0, 983.0)+vec2(time/151.0, time/147.0);","    vec2 uv3 = uv/vec2(791.0, 877.0)-vec2(time/259.0, time/263.0);","    vec4 noise = (texture2D(map, uv0)*0.0) +","                 (texture2D(map, uv1)*0.0) +","                 (texture2D(map, uv2)*0.0) +","                 (texture2D(map, uv3)*10.0);","    return noise/5.0-1.0;","}","void main(void)","{","	float fogDist = clamp(-viewCoords.z / 1000.0, 0.0, 1.0);","	gl_FragColor = vec4((snoise(vec3(worldPos.xz * 0.008, time * 0.4))+snoise(vec3(worldPos.xz * 0.02, time * 0.8))*0.5)/10.0);","}"].join("\n")};return u}),define("goo/animation/Joint",["goo/math/Transform"],function(t){"use strict";function e(e){this._name=e,this._index=0,this._parentIndex=0,this._inverseBindPose=new t}return e.NO_PARENT=-32768,e}),define("goo/animation/Skeleton",["goo/animation/Joint"],function(t){"use strict";function e(t,e){this._name=t,this._joints=e}return e.prototype.clone=function(){for(var i=this._name,o=this._joints,r=[],n=0,a=o.length;a>n;n++){var s=o[n],c=s._name,l=new t(c);l._index=s._index,l._parentIndex=s._parentIndex,l._inverseBindPose.copy(s._inverseBindPose),l._inverseBindPose.update(),r[n]=l}return new e(i,r)},e}),define("goo/animation/SkeletonPose",["goo/math/Transform","goo/animation/Joint","goo/math/Matrix4x4"],function(t,e,i){"use strict";function o(e){this._skeleton=e,this._localTransforms=[],this._globalTransforms=[],this._matrixPalette=[],this._poseListeners=[];for(var o=this._skeleton._joints.length,r=0;o>r;r++)this._localTransforms[r]=new t;for(var r=0;o>r;r++)this._globalTransforms[r]=new t;for(var r=0;o>r;r++)this._matrixPalette[r]=new i;this.setToBindPose()}return o.prototype.setToBindPose=function(){for(var t=0;t<this._localTransforms.length;t++){this._localTransforms[t].matrix.copy(this._skeleton._joints[t]._inverseBindPose.matrix).invert();var o=this._skeleton._joints[t]._parentIndex;o!==e.NO_PARENT&&i.combine(this._skeleton._joints[o]._inverseBindPose.matrix,this._localTransforms[t].matrix,this._localTransforms[t].matrix)}this.updateTransforms()},o.prototype.updateTransforms=function(){for(var t=0;t<this._skeleton._joints.length;t++){var o=this._skeleton._joints[t]._parentIndex;o!==e.NO_PARENT?i.combine(this._globalTransforms[o].matrix,this._localTransforms[t].matrix,this._globalTransforms[t].matrix):this._globalTransforms[t].matrix.copy(this._localTransforms[t].matrix),i.combine(this._globalTransforms[t].matrix,this._skeleton._joints[t]._inverseBindPose.matrix,this._matrixPalette[t])}this.firePoseUpdated()},o.prototype.firePoseUpdated=function(){for(var t=this._poseListeners.length-1;t>=0;t--)this._poseListeners[t].poseUpdated(this)},o.prototype.clone=function(){return new o(this._skeleton)},o}),define("goo/animation/blendtree/BinaryLERPSource",["goo/math/MathUtils","goo/animation/clip/TransformData"],function(t,e){"use strict";function i(t,e,i){this._sourceA=t?t:null,this._sourceB=e?e:null,this.blendWeight=i?i:null}return i.prototype.getSourceData=function(){var t=this._sourceA?this._sourceA.getSourceData():null,e=this._sourceB?this._sourceB.getSourceData():null;return i.combineSourceData(t,e,this.blendWeight)},i.prototype.setTime=function(t){var e=!1,i=!1;return this._sourceA&&(e=this._sourceA.setTime(t)),this._sourceB&&(i=this._sourceB.setTime(t)),e||i},i.prototype.resetClips=function(t){this._sourceA&&this._sourceA.resetClips(t),this._sourceB&&this._sourceB.resetClips(t)},i.prototype.shiftClipTime=function(t){this._sourceA&&this._sourceA.shiftClipTime(t),this._sourceB&&this._sourceB.shiftClipTime(t)},i.prototype.setTimeScale=function(t){this._sourceA.setTimeScale(t),this._sourceB.setTimeScale(t)},i.prototype.isActive=function(){var t=!1;return this._sourceA&&(t=t||this._sourceA.isActive()),this._sourceB&&(t=t||this._sourceB.isActive()),t
},i.combineSourceData=function(t,o,r,n){if(!o)return t;if(!t)return o;var a=n?n:{};for(var s in t){var c=t[s],l=o[s];isNaN(c)?c instanceof e?l?a[s]=c.blend(l,r,a[s]):a[s]?a[s].set(c):a[s]=new c.constructor(c):a[s]=c:i.blendFloatValues(a,s,r,c,l)}for(var s in o)a[s]||(a[s]=o[s]);return a},i.blendFloatValues=function(e,i,o,r,n){e[i]=isNaN(n)?r:t.lerp(o,r[0],n[0])},i.prototype.clone=function(){return new i(this._sourceA,this._sourceB,this._blendWeight)},i}),define("goo/animation/clip/AnimationClipInstance",["goo/entities/World"],function(t){"use strict";function e(){this._active=!0,this._loopCount=0,this._timeScale=1,this._startTime=0,this._prevClockTime=0,this._prevUnscaledClockTime=0,this._clipStateObjects={}}return e.prototype.setTimeScale=function(e,i){var i=i||t.time;if(this._active&&this._timeScale!==e)if(0!==this._timeScale&&0!==e){var o=i,r=o-this._startTime;r*=this._timeScale,r/=e,this._startTime=o-r}else if(0===this._timeScale){var o=i;this._startTime=o-this._prevUnscaledClockTime}this._timeScale=e},e.prototype.getApplyTo=function(t){var e=t._channelName,i=this._clipStateObjects[e];return i||(i=t.createStateDataObject(),this._clipStateObjects[e]=i),i},e.prototype.clone=function(){var t=new e;return t._active=this._active,t._loopCount=this._loopCount,t._timeScale=this._timeScale,t},e}),define("goo/animation/blendtree/ClipSource",["goo/math/MathUtils","goo/animation/clip/AnimationClipInstance"],function(t,e){"use strict";function i(t,i,o){this._clip=t,this._clipInstance=new e,this._filterChannels={},this._filter=null,this.setFilter(i,o),this._startTime=-1/0,this._endTime=1/0}return i.prototype.setFilter=function(t,e){if(t&&e){this._filter=["Exclude","Include"].indexOf(t)>-1?t:null;for(var i=0;i<e.length;i++)this._filterChannels[e[i]]=!0}else this._filter=null},i.prototype.setTime=function(e){var i=this._clipInstance;i._startTime||(i._startTime=e);var o,r;if(i._active){0!==i._timeScale?(i._prevUnscaledClockTime=e-i._startTime,o=i._timeScale*i._prevUnscaledClockTime,i._prevClockTime=o):o=i._prevClockTime;var n=Math.min(this._clip._maxTime,this._endTime),a=Math.max(this._startTime,0);if(r=n-a,-1===n)return!1;0!==n&&(-1===i._loopCount?0>o?(o*=-1,o%=r,o=r-o,o+=a):(o%=r,o+=a):i._loopCount>0&&r*i._loopCount>=Math.abs(o)&&(0>o?(o*=-1,o%=r,o=r-o,o+=a):(o%=r,o+=a)),(o>n||0>o)&&(o=t.clamp(o,0,n),i._active=!1)),this._clip.update(o,i)}return i._active},i.prototype.resetClips=function(t){this._clipInstance._startTime=t,this._clipInstance._active=!0},i.prototype.shiftClipTime=function(t){this._clipInstance._startTime+=t,this._clipInstance._active=!0},i.prototype.setTimeScale=function(t){this._clipInstance.setTimeScale(t)},i.prototype.isActive=function(){return this._clipInstance._active&&-1!==this._clip._maxTime},i.prototype.getSourceData=function(){if(!this._filter||!this._filterChannels)return this._clipInstance._clipStateObjects;var t=this._clipInstance._clipStateObjects,e={},i="Include"===this._filter;for(var o in t)void 0!==this._filterChannels[o]===i&&(e[o]=t[o]);return e},i.prototype.clone=function(){var t=new i(this._clip);t._clipInstance=this._clipInstance.clone(),t._filter=this._filter;for(var e in this._filterChannels)t._filterChannels[e]=this._filterChannels[e];return t._startTime=this._startTime,t._endTime=this._endTime,t},i}),define("goo/animation/clip/AbstractAnimationChannel",[],function(){"use strict";function t(t,e,i){this._blendType=i||"Linear",this._channelName=t,this._times=(e instanceof Array||e instanceof Float32Array)&&e.length?new Float32Array(e):[],this._lastStartFrame=0}return t.prototype.getSampleCount=function(){return this._times.length},t.prototype.getMaxTime=function(){return this._times.length?this._times[this._times.length-1]:0},t.prototype.updateSample=function(t,e){var i=this._times.length;if(i){var o=i-1;if(0>t||1===i)this.setCurrentSample(0,0,e);else if(t>=this._times[o])this.setCurrentSample(o,0,e);else{var r=0;if(t>=this._times[this._lastStartFrame]){r=this._lastStartFrame;for(var n=this._lastStartFrame;i-1>n&&!(this._times[n]>=t);n++)r=n}else for(var n=0;n<this._lastStartFrame&&!(this._times[n]>=t);n++)r=n;var a=(t-this._times[r])/(this._times[r+1]-this._times[r]);this.setCurrentSample(r,a,e),this._lastStartFrame=r}}},t}),define("goo/animation/clip/TransformChannel",["goo/animation/clip/AbstractAnimationChannel","goo/animation/clip/TransformData","goo/math/Quaternion","goo/math/Vector3"],function(t,e,i,o){"use strict";function r(e,r,n,a,s,c){if(t.call(this,e,r,c),n.length/4!==r.length||a.length/3!==r.length||s.length/3!==r.length)throw new Error("All provided arrays must be the same length (accounting for type)! Channel: "+e);this._rotations=new Float32Array(n),this._translations=new Float32Array(a),this._scales=new Float32Array(s),this.tmpVec=new o,this.tmpQuat=new i,this.tmpQuat2=new i}return r.prototype=Object.create(t.prototype),r.prototype.createStateDataObject=function(){return new e},r.prototype.setCurrentSample=function(t,e,o){var r=o,n=4*t,a=3*t,s=4*(t+1),c=3*(t+1);return 0===e?(r._rotation.data[0]=this._rotations[n+0],r._rotation.data[1]=this._rotations[n+1],r._rotation.data[2]=this._rotations[n+2],r._rotation.data[3]=this._rotations[n+3],r._translation.data[0]=this._translations[a+0],r._translation.data[1]=this._translations[a+1],r._translation.data[2]=this._translations[a+2],r._scale.data[0]=this._scales[a+0],r._scale.data[1]=this._scales[a+1],r._scale.data[2]=this._scales[a+2],void 0):1===e?(r._rotation.data[0]=this._rotations[s+0],r._rotation.data[1]=this._rotations[s+1],r._rotation.data[2]=this._rotations[s+2],r._rotation.data[3]=this._rotations[s+3],r._translation.data[0]=this._translations[c+0],r._translation.data[1]=this._translations[c+1],r._translation.data[2]=this._translations[c+2],r._scale.data[0]=this._scales[c+0],r._scale.data[1]=this._scales[c+1],r._scale.data[2]=this._scales[c+2],void 0):(r._rotation.data[0]=this._rotations[n+0],r._rotation.data[1]=this._rotations[n+1],r._rotation.data[2]=this._rotations[n+2],r._rotation.data[3]=this._rotations[n+3],this.tmpQuat.data[0]=this._rotations[s+0],this.tmpQuat.data[1]=this._rotations[s+1],this.tmpQuat.data[2]=this._rotations[s+2],this.tmpQuat.data[3]=this._rotations[s+3],r._rotation.equals(this.tmpQuat)||(i.slerp(r._rotation,this.tmpQuat,e,this.tmpQuat2),r._rotation.setv(this.tmpQuat2)),r._translation.data[0]=(1-e)*this._translations[a+0]+e*this._translations[c+0],r._translation.data[1]=(1-e)*this._translations[a+1]+e*this._translations[c+1],r._translation.data[2]=(1-e)*this._translations[a+2]+e*this._translations[c+2],r._scale.data[0]=(1-e)*this._scales[a+0]+e*this._scales[c+0],r._scale.data[1]=(1-e)*this._scales[a+1]+e*this._scales[c+1],r._scale.data[2]=(1-e)*this._scales[a+2]+e*this._scales[c+2],void 0)},r.prototype.getData=function(t,i){var o=i?i:new e;return this.setCurrentSample(t,0,o),o},r}),define("goo/animation/clip/JointChannel",["goo/animation/clip/TransformChannel","goo/animation/clip/JointData"],function(t,e){"use strict";function i(e,o,r,n,a,s,c){t.call(this,i.JOINT_CHANNEL_NAME+o,r,n,a,s,c),this._jointName=e,this._jointIndex=o}return i.prototype=Object.create(t.prototype),i.JOINT_CHANNEL_NAME="_jnt",i.prototype.createStateDataObject=function(){return new e},i.prototype.setCurrentSample=function(e,i,o){t.prototype.setCurrentSample.call(this,e,i,o),o._jointIndex=this._jointIndex},i.prototype.getData=function(i,o){var r=o?o:new e;return t.prototype.getData.call(this,i,r),r._jointIndex=this._jointIndex,r},i}),define("goo/animation/blendtree/ExclusiveClipSource",["goo/animation/clip/JointChannel","goo/animation/blendtree/ClipSource"],function(t,e){"use strict";function i(t){e.call(this,t),this._disabledChannels={}}return i.prototype=Object.create(e.prototype),i.prototype.clearDisabled=function(){this._disabledChannels={}},i.prototype.addDisabledChannels=function(){if(1===arguments.length&&"object"==typeof arguments[0])for(var t=0;t<arguments[0].length;t++)this._disabledChannels[arguments[0][t]]=!0;else for(var t=0;t<arguments.length;t++)this._disabledChannels[arguments[t]]=!0},i.prototype.addDisabledJoints=function(){if(1===arguments.length&&"object"==typeof arguments[0])for(var e=0;e<arguments[0].length;e++){var i=t.JOINT_CHANNEL_NAME+arguments[0][e];this._disabledChannels[i]=!0}else for(var e=0;e<arguments.length;e++){var i=t.JOINT_CHANNEL_NAME+arguments[e];this._disabledChannels[i]=!0}},i.prototype.getSourceData=function(){var t=e.prototype.getSourceData.call(this),i={};for(var o in t)this._disabledChannels[o]||(i[o]=t[o]);return i},i}),define("goo/animation/blendtree/FrozenClipSource",[],function(){"use strict";function t(t,e){this._source=t,this._time=e}return t.prototype.getSourceData=function(){return this._source.getSourceData()},t.prototype.resetClips=function(){this._source.resetClips(0)},t.prototype.setTime=function(){return this._source.setTime(this._time),!0},t.prototype.isActive=function(){return!0},t.prototype.setTimeScale=function(){},t.prototype.clone=function(){var e=new t(this._source.clone(),this._time);return e},t}),define("goo/animation/blendtree/InclusiveClipSource",["goo/animation/clip/JointChannel","goo/animation/blendtree/ClipSource"],function(t,e){"use strict";function i(t){e.call(this,t),this._enabledChannels={}}return i.prototype=Object.create(e.prototype),i.prototype.clearEnabled=function(){this._enabledChannels={}},i.prototype.addEnabledChannels=function(){if(1===arguments.length&&"object"==typeof arguments[0])for(var t=0;t<arguments[0].length;t++)this._enabledChannels[arguments[0][t]]=!0;else for(var t=0;t<arguments.length;t++)this._enabledChannels[arguments[t]]=!0},i.prototype.addEnabledJoints=function(){if(1===arguments.length&&"object"==typeof arguments[0])for(var e=0;e<arguments[0].length;e++){var i=t.JOINT_CHANNEL_NAME+arguments[0][e];this._enabledChannels[i]=!0}else for(var e=0;e<arguments.length;e++){var i=t.JOINT_CHANNEL_NAME+arguments[e];this._enabledChannels[i]=!0}},i.prototype.getSourceData=function(){var t=e.prototype.getSourceData.call(this),i={};for(var o in this._enabledChannels)this._enabledChannels[o]&&(i[o]=t[o]);return i},i}),define("goo/animation/blendtree/ManagedTransformSource",["goo/animation/clip/JointChannel","goo/animation/clip/JointData","goo/animation/clip/JointChannel","goo/animation/clip/JointData"],function(t,e,i,o){"use strict";function r(t){this._sourceName=t?t:null,this._data={}}return r.prototype.setTranslation=function(t,e){var i=this._data[t];i instanceof o&&i._translation.setv(e)},r.prototype.setScale=function(t,e){var i=this._data[t];i instanceof o&&i._scale.setv(e)},r.prototype.setRotation=function(t,e){var i=this._data[t];i instanceof o&&i._rotation.set(e)},r.prototype.initFromClip=function(t,e,i){if("Include"===e&&i&&i.length)for(var o=0,r=i.length;r>o;o++){var n=i[o],a=t.findChannelByName(n),s=a.getData(0);this._data[n]=s}else for(var o=0,r=t._channels.length;r>o;o++){var a=t._channels[o],n=a._channelName;if("Exclude"===e&&i&&i.length&&i.indexOf(n)>-1){var s=a.getData(0);this._data[n]=s}}},r.prototype.resetClips=function(){},r.prototype.setTimeScale=function(){},r.prototype.setTime=function(){return!0},r.prototype.isActive=function(){return!0},r.prototype.getChannelData=function(t){return this._data[t]},r.prototype.getSourceData=function(){return this._data},r.prototype.clone=function(){var t={};for(var e in this._data)t[e]=this._data[e].clone();return new r(this._sourceName,t)},r}),define("goo/animation/clip/AnimationClip",[],function(){"use strict";function t(t,e){this._name=t,this._channels=e||[],this._maxTime=-1,this.updateMaxTimeIndex()}return t.prototype.update=function(t,e){for(var i=0,o=this._channels.length;o>i;++i){var r=this._channels[i],n=e.getApplyTo(r);r.updateSample(t,n)}},t.prototype.addChannel=function(t){this._channels.push(t),this.updateMaxTimeIndex()},t.prototype.removeChannel=function(t){var e=this._channels.indexOf(t);return e>=0?(this._channels.splice(e,1),this.updateMaxTimeIndex(),!0):!1},t.prototype.findChannelByName=function(t){for(var e=0,i=this._channels.length;i>e;++e){var o=this._channels[e];if(t===o._channelName)return o}return null},t.prototype.updateMaxTimeIndex=function(){this._maxTime=-1;for(var t,e=0;e<this._channels.length;e++){var i=this._channels[e];t=i.getMaxTime(),t>this._maxTime&&(this._maxTime=t)}},t.prototype.toString=function(){return this._name+this._channels.length},t}),define("goo/animation/clip/InterpolatedFloatChannel",["goo/animation/clip/AbstractAnimationChannel","goo/math/MathUtils"],function(t,e){"use strict";function i(e,i,o,r){t.call(this,e,i,r),this._values=o?o.slice(0):null}return i.prototype=Object.create(t.prototype),i.prototype.createStateDataObject=function(){return[0]},i.prototype.setCurrentSample=function(t,i,o){o[0]=e.lerp(i,this._values[t],this._values[t+1])},i.prototype.getData=function(t,e){var i=e||[];return i[0]=this._values[t],i},i}),define("goo/animation/clip/TriggerChannel",["goo/animation/clip/AbstractAnimationChannel","goo/animation/clip/TriggerData"],function(t,e){"use strict";function i(e,i,o,r){t.call(this,e,i,r),this._keys=o?o.slice(0):null,this.guarantee=!1}return i.prototype=Object.create(t.prototype),i.prototype.createStateDataObject=function(){return new e},i.prototype.setCurrentSample=function(t,e,i){var o=i._currentIndex,r=1!==e?t:t+1;if(o!==r&&this.guarantee){var n=[];if(o>r){for(var a=o+1;a<this._keys.length;a++)n.push(this._keys[a]);o=-1}for(var a=o+1;r>=a;a++)n.push(this._keys[a]);i.arm(r,n)}else i.arm(r,[this._keys[r]])},i}),define("goo/animation/layer/LayerLERPBlender",["goo/animation/blendtree/BinaryLERPSource"],function(t){"use strict";function e(){this._blendWeight=null,this._layerA=null,this._layerB=null}return e.prototype.getBlendedSourceData=function(){var e=this._layerA.getCurrentSourceData(),i=this._layerB._currentState?this._layerB._currentState.getCurrentSourceData():null;return t.combineSourceData(e,i,this._blendWeight)},e}),define("goo/animation/state/AbstractTransitionState",["goo/animation/state/AbstractState","goo/animation/blendtree/BinaryLERPSource","goo/math/MathUtils"],function(t,e,i){"use strict";function o(){t.call(this),this._sourceState=null,this._targetState=null,this._percent=0,this._sourceData=null,this._fadeTime=0,this._blendType="Linear"}return o.prototype=Object.create(t.prototype),o.prototype.constructor=o,o.prototype.update=function(t){var e=t-this._globalStartTime;if(e>this._fadeTime&&this.onFinished)return this.onFinished(),void 0;var o=e/this._fadeTime;switch(this._blendType){case"SCurve3":this._percent=i.scurve3(o);break;case"SCurve5":this._percent=i.scurve5(o);break;default:this._percent=o}},o.prototype.readFromConfig=function(t){t&&(void 0!==t.fadeTime&&(this._fadeTime=t.fadeTime),void 0!==t.blendType&&(this._blendType=t.blendType))},o.prototype.getCurrentSourceData=function(){var t=this._sourceState?this._sourceState.getCurrentSourceData():null,i=this._targetState?this._targetState.getCurrentSourceData():null;return this._sourceData||(this._sourceData={}),e.combineSourceData(t,i,this._percent,this._sourceData)},o.prototype.isValid=function(t,e){var i=e-this._sourceState._globalStartTime,o=t[0],r=t[1];return 0>=o?0>=r?!0:r>=i:0>=r?i>=o:r>=o?i>=o&&r>=i:i>=o||r>=i},o.prototype.resetClips=function(e){t.prototype.resetClips.call(this,e),this._percent=0},o.prototype.shiftClipTime=function(e){t.prototype.shiftClipTime.call(this,e)},o.prototype.setTimeScale=function(t){this._sourceState&&this._sourceState.setTimeScale(t),this._targetState&&this._targetState.setTimeScale(t)},o}),define("goo/animation/state/FadeTransitionState",["goo/animation/state/AbstractTransitionState"],function(t){"use strict";function e(){t.call(this)}return e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.prototype.update=function(e){t.prototype.update.call(this,e),this._sourceState&&this._sourceState.update(e),this._targetState&&this._targetState.update(e)},e.prototype.postUpdate=function(){this._sourceState&&this._sourceState.postUpdate(),this._targetState&&this._targetState.postUpdate()},e.prototype.resetClips=function(e){t.prototype.resetClips.call(this,e),this._targetState&&this._targetState.resetClips(e)},e.prototype.shiftClipTime=function(e){t.prototype.shiftClipTime.call(this,e),this._targetState&&this._targetState.shiftClipTime(e),this._sourceState&&this._sourceState.shiftClipTime(e)},e}),define("goo/animation/state/FrozenTransitionState",["goo/animation/state/AbstractTransitionState"],function(t){"use strict";function e(){t.call(this)}return e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.prototype.update=function(e){t.prototype.update.call(this,e),this._targetState&&this._targetState.update(e)},e.prototype.postUpdate=function(){this._targetState&&this._targetState.postUpdate()},e.prototype.resetClips=function(e){t.prototype.resetClips.call(this,e),this._targetState.resetClips(e)},e.prototype.shiftClipTime=function(e){t.prototype.shiftClipTime.call(this,e),this._targetState.shiftClipTime(e)},e}),define("goo/animation/state/SyncFadeTransitionState",["goo/animation/state/FadeTransitionState"],function(t){"use strict";function e(){t.call(this)}return e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.prototype.resetClips=function(e){t.prototype.resetClips.call(this,e),this._targetState.resetClips(this._sourceState._globalStartTime)},e.prototype.shiftClipTime=function(e){t.prototype.shiftClipTime.call(this,e),this._targetState.shiftClipTime(this._sourceState._globalStartTime+e),this._sourceState.shiftClipTime(e)},e}),define("goo/util/MeshBuilder",["goo/renderer/MeshData","goo/math/Vector3","goo/entities/EntityUtils"],function(t,e,i){"use strict";function o(){this.meshDatas=[],this.vertexData={},this.indexData=[],this.vertexCounter=0,this.indexCounter=0,this.indexLengths=[],this.indexModes=[]}o.prototype.addEntity=function(t){i.traverse(t,function(){t.transformComponent._dirty&&t.transformComponent.updateTransform()}),i.traverse(t,function(){t.transformComponent._dirty&&i.updateWorldTransform(t.transformComponent)}),i.traverse(t,function(){t.meshDataComponent&&this.addMeshData(t.meshDataComponent.meshData,t.transformComponent.worldTransform)})};var r=new e;return o.prototype.addMeshData=function(e,i){if(e.vertexCount>=65536)throw new Error("Maximum number of vertices for a mesh to add is 65535. Got: "+e.vertexCount);this.vertexCounter+e.vertexCount>=65536&&this._generateMesh();var o=e.attributeMap;for(var n in o){var a=o[n],s=this.vertexData[n];s||(this.vertexData[n]={},s=this.vertexData[n],s.array=[],s.map={count:a.count,type:a.type,stride:a.stride,offset:a.offset,normalized:a.normalized});var c=e.getAttributeBuffer(n),l=c.length,h=s.array;if(n===t.POSITION)for(var u=0;l>u;u+=3)r.setd(c[u+0],c[u+1],c[u+2]),i.matrix.applyPostPoint(r),h[this.vertexCounter*a.count+u+0]=r[0],h[this.vertexCounter*a.count+u+1]=r[1],h[this.vertexCounter*a.count+u+2]=r[2];else if(n===t.NORMAL)for(var u=0;l>u;u+=3)r.setd(c[u+0],c[u+1],c[u+2]),i.rotation.applyPost(r),h[this.vertexCounter*a.count+u+0]=r[0],h[this.vertexCounter*a.count+u+1]=r[1],h[this.vertexCounter*a.count+u+2]=r[2];else if(n===t.TANGENT)for(var u=0;l>u;u+=3)r.setd(c[u+0],c[u+1],c[u+2]),i.rotation.applyPost(r),h[this.vertexCounter*a.count+u+0]=r[0],h[this.vertexCounter*a.count+u+1]=r[1],h[this.vertexCounter*a.count+u+2]=r[2];else for(var u=0;l>u;u++)h[this.vertexCounter*a.count+u]=c[u]}for(var d=e.getIndexBuffer(),u=0,p=e.indexCount;p>u;u++)this.indexData[this.indexCounter+u]=d[u]+this.vertexCounter;this.vertexCounter+=e.vertexCount,this.indexCounter+=e.indexCount,this.indexLengths=e.indexLengths?this.indexLengths.concat(e.indexLengths):this.indexLengths.concat(e.getIndexBuffer().length),this.indexModes=this.indexModes.concat(e.indexModes)},o.prototype._generateMesh=function(){var e={};for(var i in this.vertexData){var o=this.vertexData[i];e[i]=o.map}var r=new t(e,this.vertexCounter,this.indexCounter);for(var i in this.vertexData){var o=this.vertexData[i].array;r.getAttributeBuffer(i).set(o)}r.getIndexBuffer().set(this.indexData),r.indexLengths=this.indexLengths,r.indexModes=this.indexModes,this.meshDatas.push(r),this.vertexData={},this.indexData=[],this.vertexCounter=0,this.indexCounter=0,this.indexLengths=[],this.indexModes=[]},o.prototype.build=function(){return this.vertexCounter>0&&this._generateMesh(),this.meshDatas},o}),define("goo/debug/BoundingVolumeMeshBuilder",["goo/renderer/bounds/BoundingBox","goo/renderer/bounds/BoundingSphere","goo/util/MeshBuilder","goo/renderer/MeshData","goo/math/Transform"],function(t,e,i,o,r){"use strict";function n(){}function a(t,e,i){var r=[t,e,i,t,e,-i,t,-e,i,t,-e,-i,-t,e,i,-t,e,-i,-t,-e,i,-t,-e,-i],n=[0,1,0,2,1,3,2,3,4,5,4,6,5,7,6,7,0,4,1,5,2,6,3,7],a=new o(o.defaultMap([o.POSITION]),r.length/3,n.length);return a.getAttributeBuffer(o.POSITION).set(r),a.getIndexBuffer().set(n),a.indexLengths=null,a.indexModes=["Lines"],a}function s(t,e){t=t||1,e=e||8;for(var i=[],r=[],n=2*Math.PI/e,a=0,s=0;e>a;a++,s+=n)i.push(Math.cos(s)*t,Math.sin(s)*t,0),r.push(a,a+1);r[r.length-1]=0;var c=new o(o.defaultMap([o.POSITION]),e,r.length);return c.getAttributeBuffer(o.POSITION).set(i),c.getIndexBuffer().set(r),c.indexLengths=null,c.indexModes=["Lines"],c}function c(t){t=t||1;var e,o=new i,n=128,a=s(t,n);e=new r,o.addMeshData(a,e),e=new r,e.rotation.fromAngles(0,Math.PI/2,0),e.update(),o.addMeshData(a,e),e=new r,e.rotation.fromAngles(Math.PI/2,Math.PI/2,0),e.update(),o.addMeshData(a,e);var c=o.build();return c[0]}return n.buildBox=function(t){var e=a(t.xExtent,t.yExtent,t.zExtent);return e},n.buildSphere=function(t){var e=c(t.radius);return e},n.build=function(i){return i instanceof t?n.buildBox(i):i instanceof e?n.buildSphere(i):void 0},n}),define("goo/shapes/debug/LightDebug",["goo/renderer/MeshData","goo/util/MeshBuilder","goo/math/Transform","goo/shapes/ShapeCreator","goo/renderer/light/PointLight","goo/renderer/light/DirectionalLight","goo/renderer/light/SpotLight"],function(t,e,i,o,r,n,a){"use strict";function s(){this._ball=o.createSphere(12,12,.3),this._pointLightMesh=s._buildPointLightMesh(),this._spotLightMesh=s._buildSpotLightMesh(),this._directionalLightMesh=s._buildDirectionalLightMesh()}function c(e,i){e=e||1,i=i||8;for(var o=[],r=[],n=2*Math.PI/i,a=0,s=0;i>a;a++,s+=n)o.push(Math.cos(s)*e,Math.sin(s)*e,0),r.push(a,a+1);r[r.length-1]=0;var c=new t(t.defaultMap([t.POSITION]),i,r.length);return c.getAttributeBuffer(t.POSITION).set(o),c.getIndexBuffer().set(r),c.indexLengths=null,c.indexModes=["Lines"],c}function l(){var t,o=1,r=new e,n=128,a=c(o,n);t=new i,r.addMeshData(a,t),t=new i,t.rotation.fromAngles(0,Math.PI/2,0),t.update(),r.addMeshData(a,t),t=new i,t.rotation.fromAngles(Math.PI/2,Math.PI/2,0),t.update(),r.addMeshData(a,t);var s=r.build();return s[0]}function h(e){e=e||8;for(var i=[0,0,0],o=[],r=2*Math.PI/e,n=0,a=0;e>n;n++,a+=r)i.push(Math.cos(a),Math.sin(a),1),o.push(0,n+1);var s=new t(t.defaultMap([t.POSITION]),e+1,o.length);return s.getAttributeBuffer(t.POSITION).set(i),s.getIndexBuffer().set(o),s.indexLengths=null,s.indexModes=["Lines"],s}function u(){for(var t=-1,o=new e,r=64,n=2,a=t/2,s=a,l=1;n>=l;l++){var u=c(s*l,r),d=new i;d.translation.set(0,0,a*l),d.update(),o.addMeshData(u,d)}var p=h(4),d=new i;d.scale.set(s*n,s*n,a*n),d.update(),o.addMeshData(p,d);var f=o.build();return f[0]}function d(e){e=e||8;for(var i=[],o=[],r=2*Math.PI/e,n=0,a=0;e>n;n++,a+=r)i.push(Math.cos(a),Math.sin(a),0),i.push(Math.cos(a),Math.sin(a),1),o.push(2*n,2*n+1);var s=new t(t.defaultMap([t.POSITION]),2*e,o.length);return s.getAttributeBuffer(t.POSITION).set(i),s.getIndexBuffer().set(o),s.indexLengths=null,s.indexModes=["Lines"],s}function p(){for(var t=new e,o=64,r=2,n=10/r,a=1,s=0;r>s;s++){var l=c(a,o),h=new i;h.translation.set(0,0,-n*s),h.update(),t.addMeshData(l,h)}var u=d(4),h=new i;h.scale.set(a,a,-n*r),h.update(),t.addMeshData(u,h);var p=t.build();return p[0]}return s.prototype.getMesh=function(t,e){return t instanceof r?e.full?[this._ball,this._pointLightMesh]:[this._ball]:t instanceof a?e.full?[this._ball,this._spotLightMesh]:[this._ball]:t instanceof n?e.full?[this._ball,this._directionalLightMesh]:[this._ball]:void 0},s._buildPointLightMesh=function(){return l()},s._buildSpotLightMesh=function(){return u()},s._buildDirectionalLightMesh=function(){return p()},s}),define("goo/shapes/debug/CameraDebug",["goo/renderer/MeshData","goo/util/MeshBuilder","goo/math/Transform","goo/shapes/Box","goo/shapes/Cylinder"],function(t,e,i,o,r){"use strict";function n(){this._camera=n.buildCamera()}return n.prototype.getMesh=function(t,e){return e.full?[this._camera,n.buildFrustum(t)]:[this._camera]},n.buildFrustum=function(e){var i,o,r=e.near,n=e.far,a=e.aspect;if(0===e.projectionMode){var s=Math.tan(e.fov/2*Math.PI/180);i=s*n,o=s*r}else{var c=e.size||100;i=c,o=c}var l,h,u,d;l={x:-i*a,y:i,z:-n},h={x:-i*a,y:-i,z:-n},u={x:i*a,y:-i,z:-n},d={x:i*a,y:i,z:-n};var p,f,m,g;p={x:-o*a,y:o,z:-r},f={x:-o*a,y:-o,z:-r},m={x:o*a,y:-o,z:-r},g={x:o*a,y:o,z:-r};var v=[];v.push(l.x,l.y,l.z),v.push(h.x,h.y,h.z),v.push(u.x,u.y,u.z),v.push(d.x,d.y,d.z),v.push(p.x,p.y,p.z),v.push(f.x,f.y,f.z),v.push(m.x,m.y,m.z),v.push(g.x,g.y,g.z);var y=[];y.push(0,1),y.push(1,2),y.push(2,3),y.push(3,0),y.push(4,5),y.push(5,6),y.push(6,7),y.push(7,4),y.push(0,4),y.push(1,5),y.push(2,6),y.push(3,7);var x=new t(t.defaultMap([t.POSITION]),8,24);return x.getAttributeBuffer(t.POSITION).set(v),x.getIndexBuffer().set(y),x.indexLengths=null,x.indexModes=["Lines"],x},n.buildCamera=function(){var n=new e,a=new i,s=new r(32,.6),c=new r(32,.6),l=new o(.3,1,1.6),h=new o(.2,.15,.7);h.applyFunction(t.POSITION,function(t){return[t.x+t.x/(.3*(t.z+1.1)),t.y+t.y/(.3*(t.z+1.1)),t.z]}),a.translation.setd(0,0,0),a.update(),n.addMeshData(h,a),a.translation.setd(0,0,1.3),a.update(),n.addMeshData(l,a),a.scale.setd(1,1,.5),a.setRotationXYZ(0,Math.PI/2,0),a.translation.setd(0,1.2,.6),a.update(),n.addMeshData(s,a),a.translation.setd(0,1.2,2),a.update(),n.addMeshData(c,a);var u=n.build();return u[0]},n}),define("goo/shapes/debug/MeshRendererDebug",["goo/renderer/MeshData"],function(t){"use strict";function e(){this._meshes=[i(1,1,1),null]}function i(e,i,o){var r=[e,i,o,e,i,-o,e,-i,o,e,-i,-o,-e,i,o,-e,i,-o,-e,-i,o,-e,-i,-o],n=[0,1,0,2,1,3,2,3,4,5,4,6,5,7,6,7,0,4,1,5,2,6,3,7],a=new t(t.defaultMap([t.POSITION]),r.length/3,n.length);return a.getAttributeBuffer(t.POSITION).set(r),a.getIndexBuffer().set(n),a.indexLengths=null,a.indexModes=["Lines"],a}return e.prototype.getMesh=function(){return this._meshes},e}),define("goo/shapes/debug/SkeletonDebug",["goo/shapes/Box","goo/math/Transform","goo/animation/Joint","goo/util/MeshBuilder","goo/renderer/MeshData"],function(t,e,i,o,r){"use strict";function n(){}var a=new e;return n.prototype.getMesh=function(t){var e=t._skeleton._joints;return[this._buildLines(e),this._buildBoxes(e)]},n.prototype._buildBoxes=function(e){var i=new o,n=new t(2,2,2);n.attributeMap.WEIGHTS=r.createAttribute(4,"Float"),n.attributeMap.JOINTIDS=r.createAttribute(4,"Float"),n.rebuildData(),n.rebuild();for(var s=0;s<e.length;s++)a.matrix.copy(e[s]._inverseBindPose.matrix).invert(),this._stuffBox(n,e[s]),i.addMeshData(n,a);var c=i.build(),l=c[0];return this._buildPaletteMap(l,e),l},n.prototype._buildLines=function(t){for(var e=[],o=[],n=[],s=[],c=0,l=a.matrix.data,h=0;h<t.length;h++){var u=t[h];if(u._parentIndex!==i.NO_PARENT){var d=t[u._parentIndex];o.push(1,0,0,0,1,0,0,0),n.push(u._index,0,0,0,d._index,0,0,0),s.push(2*c,2*c+1),c++,a.matrix.copy(u._inverseBindPose.matrix).invert(),e.push(l[12],l[13],l[14]),a.matrix.copy(d._inverseBindPose.matrix).invert(),e.push(l[12],l[13],l[14])}}var p=new r(r.defaultMap([r.POSITION,r.WEIGHTS,r.JOINTIDS]),e.length/3,s.length);return p.indexModes=["Lines"],p.getAttributeBuffer(r.POSITION).set(e),p.getAttributeBuffer(r.WEIGHTS).set(o),p.getAttributeBuffer(r.JOINTIDS).set(n),p.getIndexBuffer().set(s),this._buildPaletteMap(p,t),p},n.prototype._stuffBox=function(t,e){for(var i=t.getAttributeBuffer("WEIGHTS"),o=t.getAttributeBuffer("JOINTIDS"),r=0;r<i.length;r+=4)i[r]=1,o[r]=e._index},n.prototype._buildPaletteMap=function(t,e){for(var i=[],o=0;o<e.length;o++)i[o]=e[o]._index;t.paletteMap=i,t.weightsPerVertex=4},n}),define("goo/debug/DebugDrawHelper",["goo/entities/components/LightComponent","goo/entities/components/CameraComponent","goo/entities/components/MeshRendererComponent","goo/animation/SkeletonPose","goo/renderer/light/PointLight","goo/renderer/light/DirectionalLight","goo/renderer/light/SpotLight","goo/shapes/debug/LightDebug","goo/shapes/debug/CameraDebug","goo/shapes/debug/MeshRendererDebug","goo/shapes/debug/SkeletonDebug","goo/renderer/Material","goo/renderer/Util","goo/renderer/shaders/ShaderLib","goo/renderer/shaders/ShaderBuilder","goo/math/Transform"],function(t,e,i,o,r,n,a,s,c,l,h,u,d,p,f,m){"use strict";var g={},v=new s,y=new c,x=new l,w=new h;return g.getRenderablesFor=function(t,e){var i,r;if("LightComponent"===t.type)i=v.getMesh(t.light,e),r=u.createMaterial(p.simpleColored,"DebugDrawLightMaterial");else if("CameraComponent"===t.type)i=y.getMesh(t.camera,e),r=u.createMaterial(p.simpleLit,"DebugDrawCameraMaterial"),r.uniforms.materialAmbient=[.4,.4,.4,1],r.uniforms.materialDiffuse=[.6,.6,.6,1],r.uniforms.materialSpecular=[0,0,0,1];else if("MeshRendererComponent"===t.type)i=x.getMesh(),r=u.createMaterial(p.simpleColored,"DebugMeshRendererComponentMaterial");else if(t instanceof o){i=w.getMesh(t,e);for(var n=[u.createMaterial(p.uber,"SkeletonDebugMaterial"),u.createMaterial(p.uber,"SkeletonDebugMaterial")],a=[],s=n.length;s--;){var r=n[s];r.depthState={enabled:!1,write:!1},r.renderQueue=3e3,r.uniforms.materialDiffuse=[0,0,0,1],r.uniforms.materialDiffuse[s]=.8,r.uniforms.materialAmbient=[0,0,0,1],r.uniforms.materialAmbient[s]=.5,a[s]={meshData:i[s],transform:new m,materials:[r],currentPose:t}}return a}return i.map(function(t){return{meshData:t,transform:new m,materials:[r]}})},g.update=function(t,e,i){if(e.camera&&e.camera.changedProperties){var o=e.camera;t.length>1&&(o.far/o.near!==t[1].farNear||o.fov!==t[1].fov||o.size!==t[1].size||o.aspect!==t[1].aspect||o.projectionMode!==t[1].projectionMode)&&(t[1].meshData=c.buildFrustum(o),t[1].farNear=o.far/o.near,t[1].fov=o.fov,t[1].size=o.size,t[1].aspect=o.aspect,t[1].projectionMode=o.projectionMode),e.camera.changedProperties=!1}g[e.type].updateMaterial(t[0].materials[0],e),t[1]&&g[e.type].updateMaterial(t[1].materials[0],e),t[1]&&g[e.type].updateTransform(t[1].transform,e);var r=t[0].transform.translation.distance(i)/30;t[0].transform.scale.setd(r,r,r),t[0].transform.update(),e.light&&e.light instanceof n&&(t[1]&&t[1].transform.scale.scale(r),t[1]&&t[1].transform.update())},g.LightComponent={},g.CameraComponent={},g.LightComponent.updateMaterial=function(t,e){var i=e.light,o=t.uniforms.color=t.uniforms.color||[];o[0]=i.color.data[0],o[1]=i.color.data[1],o[2]=i.color.data[2]},g.LightComponent.updateTransform=function(t,e){var i=e.light;if(!(i instanceof n)){var o=i.range;if(t.scale.setd(o,o,o),i instanceof a){var r=i.angle*Math.PI/180,s=Math.tan(r/2);t.scale.muld(s,s,1)}}t.update()},g.CameraComponent.updateMaterial=function(t){t.uniforms.color=t.uniforms.color||[1,1,1]},g.CameraComponent.updateTransform=function(){},g}),define("goo/debug/components/MarkerComponent",["goo/entities/components/Component","goo/shapes/ShapeCreator","goo/debug/BoundingVolumeMeshBuilder"],function(t,e,i){"use strict";function o(t){this.type="MarkerComponent";var e=t.meshRendererComponent.worldBound;this.meshData=i.build(e)}return o.prototype=Object.create(t.prototype),o}),define("goo/debug/systems/MarkerSystem",["goo/entities/systems/System","goo/renderer/Material","goo/renderer/shaders/ShaderLib","goo/shapes/ShapeCreator","goo/debug/components/MarkerComponent","goo/renderer/Renderer","goo/math/Transform"],function(t,e,i,o,r,n,a){"use strict";function s(o){t.call(this,"MarkerSystem",["MarkerComponent"]),this.material=e.createMaterial(i.simpleColored,""),this.material.depthState.enabled=!1,this.material.shader.uniforms.color=[0,1,0],this.goo=o,this.renderer=this.goo.renderer,this.entities=[],this.goo.callbacks.push(function(){for(var t=0;t<this.entities.length;t++){var e=this.entities[t];
if(e.hasComponent("MarkerComponent")){var i=new a;i.copy(e.transformComponent.worldTransform),i.setRotationXYZ(0,0,0),i.scale.setd(1,1,1),i.update();var o={meshData:e.markerComponent.meshData,materials:[this.material],transform:i};this.goo.renderer.render(o,n.mainCamera,[],null,!1)}}}.bind(this))}return s.prototype=Object.create(t.prototype),s.prototype.process=function(t){this.entities=t},s}),define("goo/debug/Debugger",["goo/debug/components/MarkerComponent","goo/debug/systems/MarkerSystem"],function(MarkerComponent,MarkerSystem){"use strict";function Debugger(t){this.goo=null,this.exportPicked=t||!1,this.picked=null,this.oldPicked=null}function createPanel(){var t=document.createElement("div");t.id="debugdiv";var e='<span style="font-size: x-small;font-family: sans-serif">Filter</span><br /><textarea cols="30" id="debugparams">name, Compo, tran, data</textarea><br /><span style="font-size: x-small;font-family: sans-serif">Result</span><br /><textarea readonly rows="10" cols="30" id="debugtex">Click on an entity</textarea><br />';e+='<hr /><span style="font-size: x-small;font-family: sans-serif">REPL</span><br /><textarea readonly rows="10" cols="30" id="replouttex">...</textarea><br /><textarea cols="30" id="replintex">entity.</textarea>',t.innerHTML=e,t.style.position="absolute",t.style.zIndex="2001",t.style.backgroundColor="#DDDDDD",t.style.left="10px",t.style.top="100px",t.style.webkitTouchCallout="none",t.style.webkitUserSelect="none",t.style.khtmlUserSelect="none",t.style.mozUserSelect="none",t.style.msUserSelect="none",t.style.userSelect="none",t.style.padding="3px",t.style.borderRadius="6px",document.body.appendChild(t)}function getFilterList(t){return t.split(",").map(function(t){return t.replace(/(^[\s]+|[\s]+$)/g,"")}).filter(function(t){return t.length>0}).map(function(t){return new RegExp(t)})}function stringifyTypedArray(t){if(0===t.length)return"[]";for(var e="["+t[0],i=1;i<t.length;i++)e+=" "+t[i];return e+="]"}function filterProperties(t,e,i,o){if(0===e.length)return"No interests specified;\n\nSome popular interests: is, tran, Compo\n\nEvery entry separated by a comma is a regex";if(0>o)return i+"REACHED MAXIMUM DEPH\n";if(null===t)return i+"null\n";var r=typeof t;if("undefined"===r||"number"===r||"boolean"===r||"string"===r||t instanceof Array&&("string"==typeof t[0]||"number"==typeof t[0]||"boolean"==typeof t[0]))return i+JSON.stringify(t)+"\n";if(-1!==Object.prototype.toString.call(t).indexOf("Array]"))return i+stringifyTypedArray(t)+"\n";var n=[];for(var a in t)if(t.hasOwnProperty(a)){if("function"==typeof t[a])continue;for(var s in e)if(e[s].test(a)){var c=filterProperties(t[a],e,i+" ",o-1);n.push(i+a+"\n"+c);break}}return n.join("")}function updateMarker(t,e){t!==e?(null!==e&&e.hasComponent("MarkerComponent")&&e.clearComponent("MarkerComponent"),null!==t&&t.setComponent(new MarkerComponent(t))):t.hasComponent("MarkerComponent")?t.clearComponent("MarkerComponent"):t.setComponent(new MarkerComponent(t))}function displayInfo(t){var e=getFilterList(document.getElementById("debugparams").value);t&&console.log("==> ",t);var i=filterProperties(t,e,"",20),o=document.getElementById("debugtex");o.value=i}return Debugger.prototype._setUpREPL=function(){var lastCommStr="";document.getElementById("replintex").addEventListener("keyup",function(event){event.stopPropagation();var replinElemHandle=document.getElementById("replintex"),reploutElemHandle=document.getElementById("replouttex");if(13!==event.keyCode||event.shiftKey)38===event.keyCode&&(replinElemHandle.value=lastCommStr);else{var commStr=replinElemHandle.value.substr(0,replinElemHandle.value.length-1);lastCommStr=commStr;var entity=this.picked,goo=this.goo,resultStr="";try{resultStr+=eval(commStr)}catch(err){resultStr+=err}replinElemHandle.value="entity.",reploutElemHandle.value+="\n-------\n"+resultStr,displayInfo(this.picked)}}.bind(this),!1)},Debugger.prototype._setUpPicking=function(){document.addEventListener("mouseup",function(t){t.stopPropagation();var e=t.pageX,i=t.pageY;this.goo.pick(e,i,function(t){var e=this.goo.world.entityManager.getEntityById(t);e&&(this.oldPicked=this.picked,this.picked=e,this.picked===this.oldPicked&&(this.picked=null),this.exportPicked&&(window.picked=this.picked),displayInfo(this.picked),updateMarker(this.picked,this.oldPicked))}.bind(this))}.bind(this),!1)},Debugger.prototype.inject=function(t){return this.goo=t,createPanel(),this.goo.world.getSystem("MarkerSystem")||this.goo.world.setSystem(new MarkerSystem(this.goo)),this._setUpPicking(),document.getElementById("debugparams").addEventListener("keyup",function(){displayInfo(this.picked)}.bind(this)),this._setUpREPL(),this},Debugger}),define("goo/debug/EntityCounter",[],function(){"use strict";function t(t){this.goo=null,this.skipFrames=t||20,this.texHandle=null}function e(){var t=document.createElement("div");t.id="_entitycounterdiv";var e='<span style="font-size: x-small;font-family: sans-serif">Counter</span><br /><textarea cols="30" rows="6" id="_entitycountertex">...</textarea>';return t.innerHTML=e,t.style.position="absolute",t.style.zIndex="2001",t.style.backgroundColor="#BBBBBB",t.style.left="10px",t.style.bottom="10px",t.style.webkitTouchCallout="none",t.style.webkitUserSelect="none",t.style.khtmlUserSelect="none",t.style.mozUserSelect="none",t.style.msUserSelect="none",t.style.userSelect="none",t.style.padding="3px",t.style.borderRadius="6px",document.body.appendChild(t),document.getElementById("_entitycountertex")}return t.prototype.inject=function(t){this.goo=t,this.texHandle=e();var i=this,o=0;return this.goo.callbacks.push(function(){if(o--,0>=o){o=i.skipFrames;var t="";for(var e in i.goo.world._systems){var r=i.goo.world._systems[e];t+=r.type+": "+r._activeEntities.length+"\n"}i.texHandle.value=t}}),this},t}),define("goo/debug/FrustumViewer",["goo/renderer/MeshData","goo/util/MeshBuilder","goo/math/Transform","goo/shapes/ShapeCreator","goo/entities/components/MeshDataComponent","goo/entities/components/MeshRendererComponent","goo/renderer/Material","goo/renderer/shaders/ShaderLib","goo/shapes/Box","goo/shapes/Cylinder"],function(t,e,i,o,r,n,a,s,c,l){"use strict";function h(){}function u(e,i,o,r){var n,a,s,c,l=e*Math.PI/180/2,h=Math.tan(l);n={x:-h*r*i,y:h*r,z:-r},a={x:-h*r*i,y:-h*r,z:-r},s={x:h*r*i,y:-h*r,z:-r},c={x:h*r*i,y:h*r,z:-r};var u,d,p,f;u={x:-h*o*i,y:h*o,z:-o},d={x:-h*o*i,y:-h*o,z:-o},p={x:h*o*i,y:-h*o,z:-o},f={x:h*o*i,y:h*o,z:-o};var m=[];m.push(n.x,n.y,n.z),m.push(a.x,a.y,a.z),m.push(s.x,s.y,s.z),m.push(c.x,c.y,c.z),m.push(u.x,u.y,u.z),m.push(d.x,d.y,d.z),m.push(p.x,p.y,p.z),m.push(f.x,f.y,f.z);var g=[];g.push(0,1),g.push(1,2),g.push(2,3),g.push(3,0),g.push(4,5),g.push(5,6),g.push(6,7),g.push(7,4),g.push(0,4),g.push(1,5),g.push(2,6),g.push(3,7);var v=new t(t.defaultMap([t.POSITION]),8,24);return v.getAttributeBuffer(t.POSITION).set(m),v.getIndexBuffer().set(g),v.indexLengths=null,v.indexModes=["Lines"],v}function d(o){var r=new e,n=new i,a=u(o.fov,o.aspect,o.near,o.far);r.addMeshData(a,n);var s=new l(32,.6),h=new l(32,.6),d=new c(.3,1,1.6),p=new c(.2,.15,.7);p.applyFunction(t.POSITION,function(t){return[t.x+t.x/(.3*(t.z+1.1)),t.y+t.y/(.3*(t.z+1.1)),t.z]}),n.translation.setd(0,0,0),n.update(),r.addMeshData(p,n),n.translation.setd(0,0,1.3),n.update(),r.addMeshData(d,n),n.scale.setd(1,1,.5),n.setRotationXYZ(0,Math.PI/2,0),n.translation.setd(0,1.2,.6),n.update(),r.addMeshData(s,n),n.translation.setd(0,1.2,2),n.update(),r.addMeshData(h,n);var f=r.build();return f[0]}return h.getMeshData=function(t){var e=d(t);return e},h.attachGuide=function(t){var e=t.getComponent("CameraComponent").camera,i=u(e.fov,e.aspect,e.near,e.far-e.far/1e3),o=new r(i);t.setComponent(o);var c=new n,l=a.createMaterial(s.simpleColored,"");return l.uniforms.color=[.5,.7,1],c.materials.push(l),t.setComponent(c),t},h.removeMesh=function(t){return t.hasComponent("cameraComponent")&&(t.clearComponent("meshDataComponent"),t.clearComponent("meshRendererComponent")),t},h}),define("goo/debug/LightPointer",["goo/renderer/MeshData","goo/util/MeshBuilder","goo/math/Transform","goo/shapes/ShapeCreator","goo/entities/components/MeshDataComponent","goo/entities/components/MeshRendererComponent","goo/renderer/Material","goo/renderer/shaders/ShaderLib","goo/math/MathUtils","goo/renderer/light/PointLight","goo/renderer/light/DirectionalLight","goo/renderer/light/SpotLight"],function(t,e,i,o,r,n,a,s,c,l,h,u){"use strict";function d(){}function p(e,i){e=e||1,i=i||8;for(var o=[],r=[],n=2*Math.PI/i,a=0,s=0;i>a;a++,s+=n)o.push(Math.cos(s)*e,Math.sin(s)*e,0),r.push(a,a+1);r[r.length-1]=0;var c=new t(t.defaultMap([t.POSITION]),i,r.length);return c.getAttributeBuffer(t.POSITION).set(o),c.getIndexBuffer().set(r),c.indexLengths=null,c.indexModes=["Lines"],c}function f(t){t=t||1;var o,r=new e,n=128,a=p(t,n);o=new i,r.addMeshData(a,o),o=new i,o.rotation.fromAngles(0,Math.PI/2,0),o.update(),r.addMeshData(a,o),o=new i,o.rotation.fromAngles(Math.PI/2,Math.PI/2,0),o.update(),r.addMeshData(a,o);var s=r.build();return s[0]}function m(e){e=e||8;for(var i=[0,0,0],o=[],r=2*Math.PI/e,n=0,a=0;e>n;n++,a+=r)i.push(Math.cos(a),Math.sin(a),1),o.push(0,n+1);var s=new t(t.defaultMap([t.POSITION]),e+1,o.length);return s.getAttributeBuffer(t.POSITION).set(i),s.getIndexBuffer().set(o),s.indexLengths=null,s.indexModes=["Lines"],s}function g(t,o){t=t||45,o=o||1;for(var r=new e,n=64,a=2,s=o/2,l=Math.tan(t*c.DEG_TO_RAD/2)*s,h=1;a>=h;h++){var u=p(l*h,n),d=new i;d.translation.set(0,0,s*h),d.update(),r.addMeshData(u,d)}var f=m(4),d=new i;d.scale.set(l*a,l*a,s*a),d.update(),r.addMeshData(f,d);var g=r.build();return g[0]}function v(e){e=e||8;for(var i=[],o=[],r=2*Math.PI/e,n=0,a=0;e>n;n++,a+=r)i.push(Math.cos(a),Math.sin(a),0),i.push(Math.cos(a),Math.sin(a),1),o.push(2*n,2*n+1);var s=new t(t.defaultMap([t.POSITION]),2*e,o.length);return s.getAttributeBuffer(t.POSITION).set(i),s.getIndexBuffer().set(o),s.indexLengths=null,s.indexModes=["Lines"],s}function y(){for(var t=new e,o=64,r=2,n=10,a=2,s=0;r>s;s++){var c=p(a,o),l=new i;l.translation.set(0,0,n*s),l.update(),t.addMeshData(c,l)}var h=v(4),l=new i;l.scale.set(a,a,n*r),l.update(),t.addMeshData(h,l);var u=t.build();return u[0]}function x(t){var r=new e,n=new i,a=f(t.range),s=o.createSphere(8,8,.1);r.addMeshData(a,n),r.addMeshData(s,n);var c=r.build();return c[0]}function w(t){var r=new e,n=new i,a=g(t.angle,t.range),s=o.createSphere(8,8,.1);r.addMeshData(s,n),n.scale.setd(1,1,-1),n.update(),r.addMeshData(a,n);var c=r.build();return c[0]}function _(){var t=new e,r=new i;r.scale.setd(1,1,-1),r.update();var n=y(),a=o.createSphere(8,8,.1);t.addMeshData(n,r),t.addMeshData(a,r);var s=t.build();return s[0]}function b(t){return t instanceof l?x(t):t instanceof h?_(t):t instanceof u?w(t):void 0}return d.getMeshData=function(t){var e=b(t);return e},d.attachPointer=function(t){var e=t.getComponent("lightComponent").light,i=b(e),o=new r(i);t.setComponent(o);var c=new n;t.setComponent(c);var l=a.createMaterial(s.simpleColored,"");return l.uniforms.color=[e.color.data[0],e.color.data[1],e.color.data[2]],t.meshRendererComponent.materials.push(l),t},d.removeMesh=function(t){return t.clearComponent("meshDataComponent"),t.clearComponent("meshRendererComponent"),t},d}),define("goo/entities/systems/TransformSystem",["goo/entities/systems/System"],function(t){"use strict";function e(){t.call(this,"TransformSystem",["TransformComponent"])}return e.prototype=Object.create(t.prototype),e.prototype.process=function(t){var e,i;for(e=0;e<t.length;e++)i=t[e].transformComponent,i._updated=!1,i._dirty&&i.updateTransform();for(e=0;e<t.length;e++)i=t[e].transformComponent,i._dirty&&this.updateWorldTransform(i)},e.prototype.updateWorldTransform=function(t){t.updateWorldTransform();for(var e=0;e<t.children.length;e++)this.updateWorldTransform(t.children[e])},e}),define("goo/renderer/SimplePartitioner",["goo/renderer/Camera"],function(t){"use strict";function e(){}return e.prototype.added=function(){},e.prototype.removed=function(){},e.prototype.process=function(e,i,o){for(var r=0,n=0;n<i.length;n++){var a=i[n];if(!a.skip&&!a.meshRendererComponent.hidden)if("Never"===a.meshRendererComponent.cullMode)o[r++]=a,a.isVisible=!0;else{var s=a.meshRendererComponent.worldBound,c=e.contains(s);c!==t.Outside?(o[r++]=a,a.isVisible=!0):a.isVisible=!1}}o.length=r},e}),define("goo/entities/systems/RenderSystem",["goo/entities/systems/System","goo/entities/SystemBus","goo/renderer/SimplePartitioner","goo/renderer/Material","goo/renderer/shaders/ShaderLib","goo/renderer/Util"],function(t,e,i,o,r,n){"use strict";function a(){t.call(this,"RenderSystem",["MeshRendererComponent","MeshDataComponent"]),this.entities=[],this.renderList=[],this.postRenderables=[],this.partitioner=new i,this.preRenderers=[],this.composers=[],this._composersActive=!0,this.doRender=!0,this._debugMaterials={},this.overrideMaterials=[],this.camera=null,this.lights=[],this.currentTpf=0;var o=this;e.addListener("goo.setCurrentCamera",function(t){o.camera=t.camera}),e.addListener("goo.setLights",function(t){o.lights=t}),this.picking={doPick:!1,x:0,y:0,pickingStore:{},pickingCallback:function(t,e){console.log(t,e)},skipUpdateBuffer:!1}}return a.prototype=Object.create(t.prototype),a.prototype.pick=function(t,e,i,o){this.picking.x=t,this.picking.y=e,this.picking.skipUpdateBuffer=void 0===o?!1:o,i&&(this.picking.pickingCallback=i),this.picking.doPick=!0},a.prototype.inserted=function(t){this.partitioner&&this.partitioner.added(t)},a.prototype.deleted=function(t){this.partitioner&&this.partitioner.removed(t)},a.prototype.process=function(t,e){this.entities=t,this.currentTpf=e},a.prototype.render=function(t){if(this.doRender&&this.camera){t.updateShadows(this.partitioner,this.entities,this.lights);for(var e=0;e<this.preRenderers.length;e++){var i=this.preRenderers[e];i.process(t,this.entities,this.partitioner,this.camera,this.lights)}if(this.partitioner.process(this.camera,this.entities,this.renderList),this.composers.length>0&&this._composersActive)for(var e=0;e<this.composers.length;e++){var o=this.composers[e];o.render(t,this.currentTpf,this.camera,this.lights,null,!0,this.overrideMaterials)}else t.render(this.renderList,this.camera,this.lights,null,{color:!1,depth:!0,stencil:!0},this.overrideMaterials)}},a.prototype.renderToPick=function(t,e){t.renderToPick(this.renderList,this.camera,!0,e)},a.prototype.enableComposers=function(t){this._composersActive=!!t},a.prototype._createDebugMaterial=function(t){if(""!==t){var e;switch(t){case"wireframe":case"color":e=n.clone(r.simpleColored.fshader);break;case"lit":e=n.clone(r.simpleLit.fshader);break;case"texture":e=n.clone(r.textured.fshader);break;case"normals":e=n.clone(r.showNormals.fshader);break;case"simple":e=n.clone(r.simple.fshader)}var i=n.clone(r.uber);i.fshader=e,"flat"!==t?(this._debugMaterials[t]=o.createMaterial(i,t),"wireframe"===t&&(this._debugMaterials[t].wireframe=!0),"lit"===t&&(this._debugMaterials[t]._textureMaps={EMISSIVE_MAP:null,DIFFUSE_MAP:null,SPECULAR_MAP:null,NORMAL_MAP:null,AO_MAP:null,LIGHT_MAP:null,TRANSPARENCY_MAP:null})):(this._debugMaterials[t]=o.createEmptyMaterial(null,t),this._debugMaterials[t].flat=!0)}},a.prototype.setDebugMaterial=function(t){if(t&&""!==t){var e=t.split("+");this.overrideMaterials=[];for(var i=0;i<e.length;i++){var t=e[i];this._debugMaterials[t]||this._createDebugMaterial(t),""===t?this.overrideMaterials.push(null):this.overrideMaterials.push(this._debugMaterials[t])}}else this.overrideMaterials=[]},a}),define("goo/entities/systems/BoundingUpdateSystem",["goo/entities/systems/System","goo/renderer/bounds/BoundingBox"],function(t,e){"use strict";function i(){t.call(this,"BoundingUpdateSystem",["TransformComponent","MeshRendererComponent","MeshDataComponent"]),this._worldBound=new e,this._computeWorldBound=null}return i.prototype=Object.create(t.prototype),i.prototype.process=function(t){for(var e=0;e<t.length;e++){var i=t[e],o=i.meshDataComponent,r=i.transformComponent,n=i.meshRendererComponent;o.autoCompute?(o.computeBoundFromPoints(),n.updateBounds(o.modelBound,r.worldTransform)):r._updated&&n.updateBounds(o.modelBound,r.worldTransform)}if(this._computeWorldBound&&this._computeWorldBound instanceof Function){if(0===t.length)return this._computeWorldBound=null,void 0;for(var e=0;e<t.length;e++)if(!t[e].particleComponent){this._worldBound=t[e].meshRendererComponent.worldBound.clone();break}for(;e<t.length;e++)if(!t[e].particleComponent){var a=t[e].meshRendererComponent;this._worldBound=this._worldBound.merge(a.worldBound)}this._computeWorldBound(this._worldBound),this._computeWorldBound=null}},i.prototype.getWorldBound=function(t){this._computeWorldBound=t},i}),define("goo/entities/systems/ScriptSystem",["goo/entities/systems/System"],function(t){"use strict";function e(e){t.call(this,"ScriptSystem",["ScriptComponent"]),this.renderer=e,this.environment={domElement:null,viewportWidth:0,viewportHeight:0},this.priority=500}return e.prototype=Object.create(t.prototype),e.prototype.process=function(t,e){this.environment.domElement=this.renderer.domElement,this.environment.viewportWidth=this.renderer.viewportWidth,this.environment.viewportHeight=this.renderer.viewportHeight;for(var i=0;i<t.length;i++){var o=t[i].scriptComponent;o.run(t[i],e,this.environment)}},e}),define("goo/entities/systems/LightingSystem",["goo/entities/systems/System","goo/entities/SystemBus"],function(t,e){"use strict";function i(){t.call(this,"LightingSystem",["LightComponent","TransformComponent"]),this.overrideLights=null,this._needsUpdate=!0}return i.prototype=Object.create(t.prototype),i.prototype.setOverrideLights=function(t){this.overrideLights=t,e.emit("goo.setLights",this.overrideLights),this._needsUpdate=!0},i.prototype.clearOverrideLights=function(){this.overrideLights=void 0,this._needsUpdate=!0},i.prototype.process=function(t){if(!this.overrideLights){for(var i=[],o=0;o<t.length;o++){var r=t[o],n=r.transformComponent,a=r.lightComponent;(n._updated||this._needsUpdate)&&a.updateLight(n.worldTransform),a.hidden||i.push(a.light)}this._needsUpdate=!1,e.emit("goo.setLights",i)}},i}),define("goo/entities/systems/CameraSystem",["goo/entities/systems/System","goo/entities/SystemBus","goo/renderer/Renderer"],function(t,e,i){"use strict";function o(){t.call(this,"CameraSystem",["TransformComponent","CameraComponent"]),this.mainCamera=null}return o.prototype=Object.create(t.prototype),o.prototype.findMainCamera=function(){for(var t=null,o=null,r=0;r<this._activeEntities.length;r++){var n=this._activeEntities[r].cameraComponent;(!t||n.isMain)&&(t=n.camera,o=this._activeEntities[r])}e.emit("goo.setCurrentCamera",{camera:t,entity:o}),i.mainCamera=t},o.prototype.inserted=function(){this.findMainCamera()},o.prototype.deleted=function(){this.findMainCamera()},o.prototype.process=function(t){for(var e=0;e<t.length;e++){var i=t[e],o=i.transformComponent,r=i.cameraComponent;o._updated&&r.updateCamera(o.worldTransform)}},o}),define("goo/entities/systems/ParticlesSystem",["goo/entities/systems/System"],function(t){"use strict";function e(){t.call(this,"ParticlesSystem",["TransformComponent","MeshRendererComponent","MeshDataComponent","ParticleComponent"]),this.passive=!1}return e.prototype=Object.create(t.prototype),e.prototype.process=function(t,e){if(!(e>1))for(var i=0,o=t.length;o>i;i++){var r=t[i],n=r.particleComponent;n.enabled&&this.updateParticles(r,n,e)}},e.prototype.updateParticles=function(t,e,i){for(var o,r=0,n=-1,a=!1,s=!1;r<e.particleCount;){for(;void 0===o;)if(n++,e.emitters.length>n){if(o=e.emitters[n],o.influences.length)for(var c=0,l=o.influences.length;l>c;c++)o.influences[c].prepare(t,o);if(!o.enabled){o=void 0;continue}if(0!==o.totalParticlesToSpawn&&(o.particlesWaitingToRelease+=o.releaseRatePerSecond*i,o.particlesWaitingToRelease=Math.max(o.particlesWaitingToRelease,0),s=!0),o.particlesWaitingToRelease<1){o=void 0;continue}}else o=null;var h=e.particles[r];if(h.alive&&h.emitter&&h.emitter.influences.length)for(var c=0,l=h.emitter.influences.length;l>c;c++)h.emitter.influences[c].enabled&&h.emitter.influences[c].apply(i,h,r);h.alive&&(h.update(i,t),a=!0,s=!0),!h.alive&&o&&(o.particlesWaitingToRelease--,o.totalParticlesToSpawn>=1&&o.totalParticlesToSpawn--,h.respawnParticle(o),o.getEmissionPoint(h,t),o.getEmissionVelocity(h,t),(o.particlesWaitingToRelease<1||0===o.totalParticlesToSpawn)&&(o=void 0)),r++}a&&(e.meshData.vertexData._dataNeedsRefresh=!0,t.meshDataComponent.autoCompute=!0),s||(e.enabled=!1)},e}),define("goo/util/Stats",[],function(){"use strict";function t(){var t=Date.now(),e=t,i=t,o=0,r=1/0,n=0,a=0,s=1/0,c=0,l=0,h=0,u=document.createElement("div");u.id="stats",u.addEventListener("mousedown",function(t){t.preventDefault(),_(++h%2)},!1),u.style.cssText="width:80px;cursor:pointer;z-index:1000;-webkit-touch-callout: none;-webkit-user-select: none;-khtml-user-select: none;-moz-user-select: none;-ms-user-select: none;user-select: none;";var d=document.createElement("div");d.id="fps",d.style.cssText="padding:0 0 3px 3px;text-align:left;background-color:#002",u.appendChild(d);var p=document.createElement("div");p.id="fpsText",p.style.cssText="color:#0ff;font-family:Helvetica,Arial,sans-serif;font-size:8px;font-weight:bold;line-height:13px",p.innerHTML="FPS",d.appendChild(p);var f=document.createElement("div");for(f.id="fpsGraph",f.style.cssText="position:relative;width:74px;height:30px;background-color:#0ff",d.appendChild(f);f.children.length<74;){var m=document.createElement("span");m.style.cssText="width:1px;height:30px;float:left;background-color:#113",f.appendChild(m)}var g=document.createElement("div");g.id="ms",g.style.cssText="padding:0 0 3px 3px;text-align:left;background-color:#020;display:none",u.appendChild(g);var v=document.createElement("div");v.id="msText",v.style.cssText="color:#0f0;font-family:Helvetica,Arial,sans-serif;font-size:8px;font-weight:bold;line-height:13px",v.innerHTML="MS",g.appendChild(v);var y=document.createElement("div");for(y.id="msGraph",y.style.cssText="position:relative;width:74px;height:30px;background-color:#0f0",g.appendChild(y);y.children.length<74;){var m=document.createElement("span");m.style.cssText="width:1px;height:30px;float:left;background-color:#131",y.appendChild(m)}var x=document.createElement("div");x.id="info",x.style.cssText="padding:0 0 3px 3px;text-align:left;background-color:#200",u.appendChild(x);var w=document.createElement("div");w.id="infoText",w.style.cssText="color:#f66;font-family:Helvetica,Arial,sans-serif;font-size:8px;font-weight:bold;line-height:13px",w.innerHTML="INFO",x.appendChild(w);var _=function(t){switch(h=t){case 0:d.style.display="block",g.style.display="none";break;case 1:d.style.display="none",g.style.display="block"}},b=function(t,e){var i=t.appendChild(t.firstChild);i.style.height=e+"px"};this.domElement=u,this.setMode=_,this.begin=function(){t=Date.now()},this.end=function(h){var u=Date.now();return u>i+100&&(o=u-t,r=Math.min(r,o),n=Math.max(n,o),v.textContent=o+" MS ("+r+"-"+n+")",b(y,Math.min(30,30-30*(o/200))),i=u,h&&(w.innerHTML="Calls: "+h.calls+"<br>Vertices: "+h.vertices+"<br>Indices: "+h.indices)),l++,u>e+1e3&&(a=Math.round(1e3*l/(u-e)),s=Math.min(s,a),c=Math.max(c,a),p.textContent=a+" FPS ("+s+"-"+c+")",b(f,Math.min(30,30-30*(a/(Math.min(500,c)+10)))),e=u,l=0),u},this.update=function(e){t=this.end(e)}}return t}),define("goo/entities/systems/CSSTransformSystem",["goo/entities/systems/System","goo/renderer/Renderer","goo/math/Matrix4x4","goo/math/MathUtils","goo/math/Vector3"],function(t,e,i,o,r){"use strict";function n(e){t.call(this,"CSSTransformSystem",["TransformComponent","CSSTransformComponent"]),this.renderer=e,document.querySelector&&(this.viewDom=document.querySelector("#view"),this.containerDom=document.querySelector("#cam1"),this.containerDom2=document.querySelector("#cam2")),this.tmpMatrix=new i,this.tmpMatrix2=new i,this.tmpVector=new r}n.prototype=Object.create(t.prototype);var a=function(t){return Math.abs(t)<1e-6?0:t},s=["","-webkit-","-moz-","-ms-","-o-"],c=function(t,e,i){for(var o=0;o<s.length;o++)t.style[s[o]+e]=i},l=function(t){var e=t.data;return"matrix3d("+a(e[0])+","+a(-e[1])+","+a(e[2])+","+a(e[3])+","+a(e[4])+","+a(-e[5])+","+a(e[6])+","+a(e[7])+","+a(e[8])+","+a(-e[9])+","+a(e[10])+","+a(e[11])+","+a(e[12])+","+a(-e[13])+","+a(e[14])+","+a(e[15])+")"};return n.prototype.process=function(t){if(0!==t.length){var i=e.mainCamera;if(i){var n=.5/Math.tan(.5*o.DEG_TO_RAD*i.fov)*this.renderer.domElement.offsetHeight;c(this.viewDom,"perspective",n+"px"),this.tmpMatrix.copy(i.getViewInverseMatrix()),this.tmpMatrix2.copy(this.tmpMatrix),this.tmpMatrix.invert(),this.tmpMatrix.setTranslation(new r(0,0,n));var a=l(this.tmpMatrix);c(this.containerDom,"transform",a),this.tmpMatrix2.e03=-this.tmpMatrix2.e03,this.tmpMatrix2.e23=-this.tmpMatrix2.e23,this.tmpMatrix2.setRotationFromVector(new r(0,0,0)),a=l(this.tmpMatrix2),c(this.containerDom2,"transform",a);for(var s=0;s<t.length;s++){var h=t[s],u=h.getComponent("CSSTransformComponent"),d=u.domElement,p=u.scale;p=[p,-p,p].join(","),u.faceCamera?(h.transformComponent.worldTransform.matrix.getTranslation(this.tmpVector),this.tmpMatrix.copy(i.getViewInverseMatrix()),this.tmpMatrix.setTranslation(this.tmpVector)):this.tmpMatrix.copy(h.transformComponent.worldTransform.matrix),a="translate3d(-50%,-50%,0) "+l(this.tmpMatrix)+"scale3d("+p+")",c(d,"transform",a),d.parentNode!==this.containerDom2&&this.containerDom2.appendChild(d)}}}},n}),define("goo/entities/systems/AnimationSystem",["goo/entities/systems/System","goo/entities/World"],function(t,e){"use strict";function i(){t.call(this,"AnimationSystem",["AnimationComponent"]),this.entities=[]}return i.prototype=Object.create(t.prototype),i.prototype.process=function(t){this.entities=t;for(var i=0;i<t.length;i++){var o=t[i],r=o.animationComponent;r.update(e.time),r.apply(o.transformComponent),r.postUpdate()}},i.prototype.pause=function(){this.passive=!0;for(var t=this.entities.length;t--;)this.entities[t].animationComponent.pause()},i.prototype.stop=function(){this.passive=!0;for(var t=0;t<this.entities.length;t++){var e=this.entities[t];e.animationComponent.stop()}},i.prototype.resume=function(){this.passive=!1;for(var t=0;t<this.entities.length;t++){var e=this.entities[t];e.animationComponent.resume()}},i}),define("goo/entities/systems/LightDebugSystem",["goo/entities/systems/System","goo/entities/components/MeshDataComponent","goo/entities/components/MeshRendererComponent","goo/renderer/Material","goo/renderer/shaders/ShaderLib","goo/debug/LightPointer"],function(t,e,i,o,r,n){"use strict";function a(){t.call(this,"LightDebugSystem",["LightDebugComponent"])}return a.prototype=Object.create(t.prototype),a.prototype.inserted=function(t){var a=t.lightComponent.light,s=n.getMeshData(a);t.setComponent(new e(s));var c=o.createMaterial(r.simpleColored,"");c.uniforms.color=[a.color.data[0],a.color.data[1],a.color.data[2]];var l=new i;l.materials.push(c),t.setComponent(l),l.updateBounds(t.meshDataComponent.modelBound,t.transformComponent.worldTransform)},a.prototype.process=function(t){for(var e=0;e<t.length;e++){var i=t[e],o=i.lightComponent.light;o.changedProperties&&(o.changedProperties=!1,i.meshDataComponent.meshData=n.getMeshData(o),i.meshRendererComponent.updateBounds(i.meshDataComponent.modelBound,i.transformComponent.worldTransform)),o.changedColor&&(o.changedColor=!1,i.meshRendererComponent.materials[0].uniforms.color=[o.color.data[0],o.color.data[1],o.color.data[2]])}},a.prototype.deleted=function(t){t.clearComponent("MeshDataComponent"),t.clearComponent("MeshRendererComponent")},a}),define("goo/entities/systems/CameraDebugSystem",["goo/entities/systems/System","goo/entities/components/MeshDataComponent","goo/entities/components/MeshRendererComponent","goo/renderer/Material","goo/renderer/shaders/ShaderLib","goo/debug/FrustumViewer"],function(t,e,i,o,r,n){"use strict";function a(){t.call(this,"CameraDebugSystem",["CameraDebugComponent"])}return a.prototype=Object.create(t.prototype),a.prototype.inserted=function(t){var a=t.cameraComponent.camera,s=n.getMeshData(a);t.setComponent(new e(s));var c=o.createMaterial(r.simpleColored,"");c.uniforms.color=[.4,.7,1];var l=new i;l.materials.push(c),t.setComponent(l),l.updateBounds(t.meshDataComponent.modelBound,t.transformComponent.worldTransform)},a.prototype.process=function(t){for(var e=0;e<t.length;e++){var i=t[e],o=i.cameraComponent.camera;o.changedProperties&&(i.meshDataComponent.meshData=n.getMeshData(o),i.meshRendererComponent.updateBounds(i.meshDataComponent.modelBound,i.transformComponent.worldTransform),o.changedProperties=!1)}},a.prototype.deleted=function(t){t.clearComponent("MeshDataComponent"),t.clearComponent("MeshRendererComponent")},a}),define("goo/entities/systems/MovementSystem",["goo/entities/systems/System"],function(t){"use strict";function e(){t.call(this,"MovementSystem",["MovementComponent"])}return e.prototype=Object.create(t.prototype),e.prototype.addVelocityToTransform=function(t,e,i){e.translation.add_d(t.data[0]*i,t.data[1]*i,t.data[2]*i)},e.prototype.addRotToTransform=function(t,e,i){e.rotation.rotateX(t.data[0]*i),e.rotation.rotateY(t.data[1]*i),e.rotation.rotateZ(t.data[2]*i)},e.prototype.applyMovementToEntity=function(t){var e=t._world.tpf,i=t.movementComponent.getRotationVelocity(),o=t.movementComponent.getVelocity(),r=t.transformComponent.transform;this.addVelocityToTransform(o,r,e),this.addRotToTransform(i,r,e),t.transformComponent.setUpdated()},e.prototype.process=function(t){var e,i;for(e=0;e<t.length;e++)i=t[e].movementComponent,this.applyMovementToEntity(t[e])},e}),define("goo/util/GameUtils",[],function(){"use strict";function t(){}return t.supported={fullscreen:!0,pointerLock:!0},t.toggleFullScreen=function(){document.fullscreenElement?document.cancelFullScreen&&document.cancelFullScreen():document.documentElement.requestFullScreen&&document.documentElement.requestFullScreen()},t.requestPointerLock=function(){document.documentElement.requestPointerLock&&document.documentElement.requestPointerLock()},t.exitPointerLock=function(){document.exitPointerLock&&document.exitPointerLock()},t.togglePointerLock=function(){document.pointerLockElement?document.exitPointerLock&&document.exitPointerLock():document.documentElement.requestPointerLock&&document.documentElement.requestPointerLock()},t.addVisibilityChangeListener=function(t){if("function"==typeof t){for(var e,i,o=["","ms","moz","webkit"],r=0;r<o.length;++r){var n=o[r]+(0===o[r].length?"hidden":"Hidden"),a=o[r]+"visibilitychange";if("undefined"!=typeof document[n]){e=n,i=a;break}}"undefined"!=typeof document.addEventListener&&"undefined"!=typeof e&&document.addEventListener(i,function(){document[e]?t(!0):t(!1)})}},t.initAllShims=function(e){t.initWebGLShims(),t.initAnimationShims(),t.initFullscreenShims(e),t.initPointerLockShims(e)},t.initWebGLShims=function(){window.Uint8ClampedArray=window.Uint8ClampedArray||window.Uint8Array},t.initAnimationShims=function(){for(var t=0,e=["ms","moz","webkit","o"],i=0;i<e.length&&!window.requestAnimationFrame;++i)window.requestAnimationFrame=window[e[i]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[e[i]+"CancelAnimationFrame"]||window[e[i]+"CancelRequestAnimationFrame"];void 0===window.requestAnimationFrame&&(window.requestAnimationFrame=function(e){var i=Date.now(),o=Math.max(0,16-(i-t)),r=window.setTimeout(function(){e(i+o)},o);return t=i+o,r}),void 0===window.cancelAnimationFrame&&(window.cancelAnimationFrame=function(t){clearTimeout(t)})},t.initFullscreenShims=function(e){function i(){var t=document.createEvent("CustomEvent");t.initCustomEvent("fullscreenchange",!0,!1,null),document.dispatchEvent(t)}function o(){var t=document.createEvent("CustomEvent");t.initCustomEvent("fullscreenerror",!0,!1,null),document.dispatchEvent(t)}e=e||window;var r=(e.HTMLElement||e.Element).prototype;if(!document.hasOwnProperty("fullscreenEnabled")){var n=function(){return"webkitIsFullScreen"in document?function(){return document.webkitFullscreenEnabled}:"mozFullScreenEnabled"in document?function(){return document.mozFullScreenEnabled
}:(t.supported.fullscreen=!1,function(){return!1})}();Object.defineProperty(document,"fullscreenEnabled",{enumerable:!0,configurable:!1,writeable:!1,get:n})}if(!document.hasOwnProperty("fullscreenElement")){var n=function(){for(var t=["webkitCurrentFullScreenElement","webkitFullscreenElement","mozFullScreenElement"],e=function(e){return function(){return document[t[e]]}},i=0;i<t.length;i++)if(t[i]in document)return e(i);return function(){return null}}();Object.defineProperty(document,"fullscreenElement",{enumerable:!0,configurable:!1,writeable:!1,get:n})}document.addEventListener("webkitfullscreenchange",i,!1),document.addEventListener("mozfullscreenchange",i,!1),document.addEventListener("webkitfullscreenerror",o,!1),document.addEventListener("mozfullscreenerror",o,!1),r.requestFullScreen||(r.requestFullScreen=function(){return r.webkitRequestFullScreen?function(){this.webkitRequestFullScreen(e.Element.ALLOW_KEYBOARD_INPUT)}:r.mozRequestFullScreen?function(){this.mozRequestFullScreen()}:function(){}}()),document.cancelFullScreen||(document.cancelFullScreen=function(){return document.webkitCancelFullScreen||document.mozCancelFullScreen||function(){}}())},t.initPointerLockShims=function(e){function i(){var t=document.createEvent("CustomEvent");t.initCustomEvent("pointerlockchange",!0,!1,null),document.dispatchEvent(t)}function o(){var t=document.createEvent("CustomEvent");t.initCustomEvent("pointerlockerror",!0,!1,null),document.dispatchEvent(t)}e=e||window;var r=(e.HTMLElement||e.Element).prototype;if(e.MouseEvent){var n=e.MouseEvent.prototype;if("movementX"in n||Object.defineProperty(n,"movementX",{enumerable:!0,configurable:!1,writeable:!1,get:function(){return this.webkitMovementX||this.mozMovementX||0}}),"movementY"in n||Object.defineProperty(n,"movementY",{enumerable:!0,configurable:!1,writeable:!1,get:function(){return this.webkitMovementY||this.mozMovementY||0}}),navigator.pointer||(navigator.pointer=navigator.webkitPointer||navigator.mozPointer),document.addEventListener("webkitpointerlockchange",i,!1),document.addEventListener("webkitpointerlocklost",i,!1),document.addEventListener("mozpointerlockchange",i,!1),document.addEventListener("mozpointerlocklost",i,!1),document.addEventListener("webkitpointerlockerror",o,!1),document.addEventListener("mozpointerlockerror",o,!1),!document.hasOwnProperty("pointerLockElement")){var a=function(){return"webkitPointerLockElement"in document?function(){return document.webkitPointerLockElement}:"mozPointerLockElement"in document?function(){return document.mozPointerLockElement}:function(){return null}}();Object.defineProperty(document,"pointerLockElement",{enumerable:!0,configurable:!1,writeable:!1,get:a})}r.requestPointerLock||(r.requestPointerLock=function(){return r.webkitRequestPointerLock?function(){this.webkitRequestPointerLock()}:r.mozRequestPointerLock?function(){this.mozRequestPointerLock()}:navigator.pointer?function(){var t=this;navigator.pointer.lock(t,i,o)}:(t.supported.pointerLock=!1,function(){})}()),document.exitPointerLock||(document.exitPointerLock=function(){return document.webkitExitPointerLock||document.mozExitPointerLock||function(){navigator.pointer&&navigator.pointer.unlock()}}())}},t}),define("goo/util/Logo",[],function(){"use strict";function t(){}t.blue="#2A3276",t.white="#FFFFFF";var e={color:t.white,shadow:!1};return t.getLogo=function(t){t=t||{};for(var i in e)void 0===t[i]&&(t[i]=e[i]);if(!document.createElementNS)return"";var o="http://www.w3.org/2000/svg",r=document.createElementNS(o,"svg");r.setAttribute("version","1.1"),r.setAttribute("xmlns",o),r.setAttribute("x","0px"),r.setAttribute("y","0px"),r.setAttribute("viewBox","0 0 396.603 277.343"),r.setAttribute("enable-background","new 0 0 396.603 277.343"),r.setAttribute("xml:space","preserve"),t.width&&r.setAttribute("width",t.width),t.height&&r.setAttribute("height",t.height);var n=document.createElementNS(o,"g");r.appendChild(n);var a=document.createElementNS(o,"filter");a.setAttribute("id","insetShadow");var s=document.createElementNS(o,"feGaussianBlur");s.setAttribute("in","SourceAlpha"),s.setAttribute("stdDeviation","0");var c=document.createElementNS(o,"feOffset");c.setAttribute("dx","0"),c.setAttribute("dy","-5"),c.setAttribute("result","offsetblur");var l=document.createElementNS(o,"feComponentTransfer"),h=document.createElementNS(o,"feFuncA");h.setAttribute("type","linear"),h.setAttribute("slope","0.5"),l.appendChild(h);var u=document.createElementNS(o,"feMerge"),d=document.createElementNS(o,"feMergeNode"),p=document.createElementNS(o,"feMergeNode");p.setAttribute("in","SourceGraphic"),u.appendChild(d),u.appendChild(p),a.appendChild(s),a.appendChild(c),a.appendChild(l),a.appendChild(u),n.appendChild(a);var f=document.createElementNS(o,"path");f.setAttribute("d","M303.337,46.286c-13.578,0-25.784,5.744-34.396,14.998c-9.86,10.59-26.319,10.59-36.172,0c-8.605-9.254-20.818-14.998-34.402-14.998c-25.936,0-46.971,21.034-46.971,46.978c0,25.936,21.035,46.972,46.971,46.972c13.584,0,25.797-5.744,34.402-14.998c9.853-10.598,26.325-10.598,36.172,0c8.612,9.254,20.818,14.998,34.396,14.998c25.941,0,46.977-21.036,46.977-46.972C350.313,67.32,329.278,46.286,303.337,46.286z M198.296,116.39c-12.785,0-23.146-10.359-23.146-23.144s10.361-23.151,23.146-23.151c12.795,0,23.156,10.367,23.156,23.151S211.091,116.39,198.296,116.39z M303.337,116.407c-12.785,0-23.146-10.36-23.146-23.144c0-12.784,10.36-23.151,23.146-23.151c12.795,0,23.156,10.367,23.156,23.151C326.493,106.047,316.132,116.407,303.337,116.407z M156.18,138.347c-14.087-3.23-22.316-17.482-18.068-31.305c3.704-12.072,2.568-25.511-4.22-37.256C120.927,47.323,92.22,39.63,69.766,52.587C47.317,65.552,39.624,94.26,52.581,116.713c6.795,11.761,17.853,19.462,30.17,22.282c14.084,3.235,22.314,17.497,18.074,31.317c-3.711,12.08-2.582,25.504,4.213,37.264c12.965,22.455,41.666,30.148,64.127,17.178c22.447-12.945,30.148-41.658,17.185-64.111C179.554,148.881,168.497,141.181,156.18,138.347z M104.802,113.287c-11.064,6.387-25.219,2.599-31.604-8.474c-6.397-11.07-2.604-25.225,8.474-31.609c11.057-6.398,25.22-2.598,31.611,8.46C119.673,92.741,115.872,106.897,104.802,113.287z M145.687,207.256c-12.785,0-23.145-10.361-23.145-23.145s10.359-23.15,23.145-23.15c12.797,0,23.156,10.367,23.156,23.15S158.483,207.256,145.687,207.256z"),f.setAttribute("fill",t.color),t.shadow&&(n.appendChild(a),f.setAttribute("style","filter:url(#insetShadow)")),n.appendChild(f);var m=new XMLSerializer,g=m.serializeToString(r);return g},t}),define("goo/entities/GooRunner",["goo/entities/World","goo/entities/systems/TransformSystem","goo/entities/systems/RenderSystem","goo/renderer/Renderer","goo/entities/systems/BoundingUpdateSystem","goo/entities/systems/ScriptSystem","goo/entities/systems/LightingSystem","goo/entities/systems/CameraSystem","goo/entities/systems/ParticlesSystem","goo/util/Stats","goo/entities/systems/CSSTransformSystem","goo/entities/systems/AnimationSystem","goo/entities/systems/LightDebugSystem","goo/entities/systems/CameraDebugSystem","goo/entities/systems/MovementSystem","goo/entities/components/TransformComponent","goo/entities/components/MeshDataComponent","goo/entities/components/MeshRendererComponent","goo/entities/components/CameraComponent","goo/entities/components/LightComponent","goo/entities/components/ScriptComponent","goo/util/GameUtils","goo/util/Logo"],function(t,e,i,o,r,n,a,s,c,l,h,u,d,p,f,m,g,v,y,x,w,_,b){"use strict";function S(v){if(v=v||{},_.initAllShims(),this.world=new t(this),this.renderer=new o(v),this.world.setSystem(new n(this.renderer)),this.world.setSystem(new e),this.world.setSystem(new s),this.world.setSystem(new h(this.renderer)),this.world.setSystem(new c),this.world.setSystem(new r),this.world.setSystem(new a),this.world.setSystem(new u),this.world.setSystem(new d),this.world.setSystem(new p),this.world.setSystem(new f),this.renderSystem=new i,this.renderSystems=[this.renderSystem],this.world.setSystem(this.renderSystem),this.world.registerComponent(m),this.world.registerComponent(g),this.doProcess=!0,this.doRender=!0,this.tpfSmoothingCount=void 0!==v.tpfSmoothingCount?v.tpfSmoothingCount:10,v.showStats&&(this.stats=new l,this.stats.domElement.style.position="absolute",this.stats.domElement.style.left="10px",this.stats.domElement.style.top="10px",document.body.appendChild(this.stats.domElement)),void 0===v.logo||v.logo){var y=this._buildLogo(v.logo);document.body.appendChild(y)}this.callbacks=[],this.callbacksPreProcess=[],this.callbacksPreRender=[],this._takeSnapshots=[];var x=this;this.start=-1,this.run=function(t){try{x._updateFrame(t)}catch(e){e instanceof Error?console.error(e.stack):console.error(e)}},this.animationId=0,v.manuallyStartGameLoop||this.startGameLoop(this.run),v.debugKeys&&this._addDebugKeys(),this._events={click:null,mousedown:null,mouseup:null,mousemove:null},this._eventListeners={click:[],mousedown:[],mouseup:[],mousemove:[]},this._eventTriggered={click:null,mousedown:null,mouseup:null,mousemove:null},_.addVisibilityChangeListener(function(t){t?this.stopGameLoop():this.startGameLoop()}.bind(this)),this._picking={x:0,y:0,skipUpdateBuffer:!1,doPick:!1,pickingCallback:null,pickingStore:{},clearColorStore:[]}}S.prototype.setRenderSystem=function(t,e){this.world.setSystem(t),void 0!==e?this.renderSystems.splice(e,0,t):this.renderSystems.push(t)};var M=[],C=0;return S.prototype._updateFrame=function(e){this.start<0&&(this.start=e);var i=(e-this.start)/1e3;if(0>i||i>1)return this.start=e,this.animationId=window.requestAnimationFrame(this.run),void 0;i=Math.max(Math.min(i,.5),1e-4),M[C]=i,C=(C+1)%this.tpfSmoothingCount;for(var r=0,n=0;n<M.length;n++)r+=M[n];r/=M.length,this.world.tpf=r,this.world.time+=this.world.tpf,t.time=this.world.time,t.tpf=this.world.tpf,this.start=e;for(var n=0;n<this.callbacksPreProcess.length;n++)this.callbacksPreProcess[n](this.world.tpf);if(this.doProcess&&this.world.process(),this.renderer.info.reset(),this.doRender){this.renderer.checkResize(o.mainCamera),this.renderer.setRenderTarget(),this.renderer.clear();for(var n=0;n<this.callbacksPreRender.length;n++)this.callbacksPreRender[n](this.world.tpf);for(var n=0;n<this.renderSystems.length;n++)this.renderSystems[n].render(this.renderer);if(this._picking.doPick&&o.mainCamera){var a=this.renderer.clearColor.data;this._picking.clearColorStore[0]=a[0],this._picking.clearColorStore[1]=a[1],this._picking.clearColorStore[2]=a[2],this._picking.clearColorStore[3]=a[3],this.renderer.setClearColor(0,0,0,1);for(var n=0;n<this.renderSystems.length;n++)this.renderSystems[n].renderToPick&&this.renderSystems[n].renderToPick(this.renderer,this._picking.skipUpdateBuffer);this.renderer.pick(this._picking.x,this._picking.y,this._picking.pickingStore,o.mainCamera),this._picking.pickingCallback(this._picking.pickingStore.id,this._picking.pickingStore.depth),this._picking.doPick=!1,this.renderer.setClearColor.apply(this.renderer,this._picking.clearColorStore)}}for(var n=0;n<this.callbacks.length;n++)this.callbacks[n](this.world.tpf);if(this.stats&&this.stats.update(this.renderer.info),this._takeSnapshots.length){try{for(var s=this.renderer.domElement.toDataURL(),n=this._takeSnapshots.length-1;n>=0;n--)this._takeSnapshots[n](s)}catch(c){console.error("Failed to take snapshot",c.message)}this._takeSnapshots=[]}this.animationId=window.requestAnimationFrame(this.run)},S.prototype._buildLogo=function(t){var e=document.createElement("div"),i=b.getLogo({width:"70px",height:"50px",color:b.blue}),o='<span style="color: #EEE; font-family: Helvetica, sans-serif; font-size: 11px; display: inline-block; margin-top: 14px; margin-right: -3px; vertical-align: top;">Powered by</span>';return e.innerHTML='<a style="text-decoration: none;" href="http://www.gooengine.com" target="_blank">'+o+i+"</a>",e.style.position="absolute",e.style.zIndex="2000","topright"===t?(e.style.top="10px",e.style.right="10px"):"topleft"===t?(e.style.top="10px",e.style.left="10px"):"bottomright"===t?(e.style.bottom="10px",e.style.right="10px"):"bottomleft"===t?(e.style.bottom="10px",e.style.left="10px"):(e.style.top="10px",e.style.right="10px"),e.id="goologo",e.style.webkitTouchCallout="none",e.style.webkitUserSelect="none",e.style.khtmlUserSelect="none",e.style.mozUserSelect="none",e.style.msUserSelect="none",e.style.userSelect="none",e.ondragstart=function(){return!1},e},S.prototype._addDebugKeys=function(){var t="shiftKey";document.addEventListener("keydown",function(e){32===e.which&&e[t]?_.toggleFullScreen():13===e.which&&e[t]?_.togglePointerLock():49===e.which&&e[t]?this.renderSystem.setDebugMaterial():50!==e.which&&222!==e.which||!e[t]?51===e.which&&e[t]?this.renderSystem.setDebugMaterial("lit"):52===e.which&&e[t]?this.renderSystem.setDebugMaterial("color"):53===e.which&&e[t]?this.renderSystem.setDebugMaterial("wireframe"):54===e.which&&e[t]?this.renderSystem.setDebugMaterial("flat"):55!==e.which&&191!==e.which||!e[t]?56===e.which&&e[t]&&this.renderSystem.setDebugMaterial("+wireframe"):this.renderSystem.setDebugMaterial("texture"):this.renderSystem.setDebugMaterial("normals")}.bind(this),!1),document.addEventListener("mousedown",function(e){if(e[t]){var i=e.clientX,o=e.clientY;this.pick(i,o,function(t,e){var i=this.world.entityManager.getEntityById(t);console.log("Picked entity:",i,"At depth:",e)}.bind(this))}}.bind(this),!1)},S.prototype.addEventListener=function(t,e){!this._eventListeners[t]||this._eventListeners[t].indexOf(e)>-1||"function"==typeof e&&(this._eventListeners[t].push(e),1===this._eventListeners[t].length&&this._enableEvent(t))},S.prototype.removeEventListener=function(t,e){if(this._eventListeners[t]){var i=this._eventListeners[t].indexOf(e);i>-1&&this._eventListeners[t].splice(i,1),0===this._eventListeners[t].length&&this._disableEvent(t)}},S.prototype._dispatchEvent=function(t){for(var e in this._eventTriggered)if(this._eventTriggered[e]&&this._eventListeners[e]){for(var i={entity:t.entity,depth:t.depth,x:t.x,y:t.y,type:e,domEvent:this._eventTriggered[e],id:t.id},o=0;o<this._eventListeners[e].length&&this._eventListeners[e][o](i)!==!1;o++);this._eventTriggered[e]=null}},S.prototype._enableEvent=function(t){if(!this._events[t]){var e=function(e){var i=void 0!==e.offsetX?e.offsetX:e.layerX,o=void 0!==e.offsetY?e.offsetY:e.layerY;this._eventTriggered[t]=e,this.pick(i,o,function(t,e){var r=this.world.entityManager.getEntityById(t);this._dispatchEvent({entity:r,depth:e,x:i,y:o,id:t})}.bind(this))}.bind(this);this.renderer.domElement.addEventListener(t,e),this._events[t]=e}},S.prototype._disableEvent=function(t){this._events[t]&&this.renderer.domElement.removeEventListener(t,this._events[t]),this._events[t]=null},S.prototype.startGameLoop=function(){this.animationId||(this.start=-1,this.animationId=window.requestAnimationFrame(this.run))},S.prototype.stopGameLoop=function(){window.cancelAnimationFrame(this.animationId),this.animationId=0},S.prototype.takeSnapshot=function(t){this._takeSnapshots.push(t)},S.prototype.pick=function(t,e,i,o){this._picking.x=t,this._picking.y=e,this._picking.skipUpdateBuffer=void 0===o?!1:o,i&&(this._picking.pickingCallback=i),this._picking.doPick=!0},S}),define("goo/entities/components/CameraDebugComponent",["goo/entities/components/Component"],function(t){"use strict";function e(){this.type="CameraDebugComponent"}return e.prototype=Object.create(t.prototype),e}),define("goo/entities/components/LightDebugComponent",["goo/entities/components/Component"],function(t){"use strict";function e(){this.type="LightDebugComponent"}return e.prototype=Object.create(t.prototype),e}),define("goo/logic/LogicInterface",[],function(){"use strict";function t(t){this.ports=[],this.configOpts=[],this.dn_pfx=void 0===t?"":t+"-"}return t.prototype.addInputProperty=function(e,i,o){return this.ports.push({id:++t._portID,input:!0,property:!0,event:!1,name:this.dn_pfx+e,type:i,def:o}),t._portID},t.prototype.addOutputProperty=function(e,i){return this.ports.push({id:++t._portID,input:!1,property:!0,event:!1,name:this.dn_pfx+e,type:i}),t._portID},t.prototype.addInputEvent=function(e){return this.ports.push({id:++t._portID,input:!0,property:!1,event:!0,name:this.dn_pfx+e}),t._portID},t.prototype.addOutputEvent=function(e){return this.ports.push({id:++t._portID,input:!1,property:!1,event:!0,name:this.dn_pfx+e}),t._portID},t.createDynamicInput=function(e){return{id:t.makeDynamicId(),input:!0,property:!0,event:!0,dynamic:!0,name:e}},t.createDynamicOutput=function(e){return{id:t.makeDynamicId(),input:!1,property:!0,event:!0,dynamic:!0,name:e}},t.prototype.addConfigEntry=function(t){this.configOpts.push(t)},t.prototype.getConfigEntries=function(){return this.configOpts},t.prototype.getPorts=function(){return this.ports},t.isDynamicPortName=function(t){return"$"===t[0]},t.makeDynamicId=function(){return++t._portID},t.makePortDataName=function(t){if(void 0!==t.dataname)return t.dataname;var e=t.input?"in-":"out-";t.property&&(e+="prop-"),t.event&&(e+="event-");var i=t.dynamic===!0?"$":"";return i+e+t.name},t.assignPortDataName=function(t,e){t.dataname=e},t._portID=0,t}),define("goo/logic/LogicLayer",["goo/logic/LogicInterface"],function(t){"use strict";function e(t){this._logicInterfaces={},this._connectionsBySource={},this._instanceID=0,this._updateRound=0,this._nextFrameNotifications=[],this.ownerEntity=t,this.logicSystem=t._world.getSystem("LogicSystem")}return e.prototype.clear=function(){this._logicInterfaces={},this._connectionsBySource={},this._instanceID=0,this._nextFrameNotifications=[]},e.prototype.addInterfaceInstance=function(t,e,i,o){null===i&&(i="_auto-"+this._instanceID);var r={id:this._instanceID,name:i,obj:e,iface:t,layer:this,wantsProcess:o};this._instanceID++;var n=this;return r.remove=function(){delete this.outConnections,delete n._logicInterfaces[i],n.unresolveAllConnections()},r.getPorts=function(){return t.getPorts()},void 0!==e.entityRef&&(r.proxyRef=e.entityRef),this._logicInterfaces[i]=r,r},e.prototype.unresolveAllConnections=function(){for(var t in this._logicInterfaces){var e=this._logicInterfaces[t].outConnections;if(void 0!==e)for(var i in e)for(var o=e[i],r=0;r<o.length;r++)o[r].length>2&&(o[r]=[o[r][0],o[r][1]])}},e.resolvePortID=function(e,i){if("number"==typeof i)return i;if(t.isDynamicPortName(i))return i;for(var o=e.getPorts(),r=0;r<o.length;r++)if(t.makePortDataName(o[r])===i)return o[r].id;return console.warn("Unable to resolve port ["+i+"]!"),null},e.prototype.resolveTargetAndPortID=function(i,o){var r=this._logicInterfaces[i];if(void 0!==r){if(void 0!==r.obj.entityRef&&t.isDynamicPortName(o)){var n=this.logicSystem.getLayerByEntity(r.obj.entityRef);for(var a in n._logicInterfaces){var s=n._logicInterfaces[a];if("LogicNodeInput"===s.obj.type&&null!==s.obj.dummyInport&&t.makePortDataName(s.obj.dummyInport))return{target:s,portID:o}}}var c=e.resolvePortID(r,o);return null!==c?{target:r,portID:c}:(console.warn("Failed resolving target&portid to "+i+":"+o),null)}},e.prototype.addConnectionByName=function(t,i,o,r){void 0===t.outConnections&&(t.outConnections={});var n=e.resolvePortID(t,i);void 0===t.outConnections[n]&&(t.outConnections[n]=[]),t.outConnections[n].push([o,r])},e.doConnections=function(t,e,i){if(void 0!==t.outConnections){var o=t.outConnections[e];if(void 0!==o){0===o.length&&delete t.outConnections;for(var r=0;r<o.length;r++){var n=o[r];if(2===n.length){var a=t.layer.resolveTargetAndPortID(n[0],n[1]);if(null===a){console.log("Target unresolved "+n[0]+" and "+n[1]);continue}n.push(a.target),n.push(a.portID)}i(n[2],n[3])}}}},e.writeValue=function(t,i,o){e.doConnections(t,i,function(t,e){void 0===t._portValues&&(t._portValues={}),void 0===t._lastNotification&&(t._lastNotification={});var i=t._portValues[e];if(t._portValues[e]=o,i!==o){var r=t.layer;t._lastNotification[e]!==r._updateRound?(t._lastNotification[e]=r._updateRound,t.obj.onInputChanged(t,e,o)):r._nextFrameNotifications.push([t,e,o])}})},e.writeValueToLayerOutput=function(t,e,i){var o=t.layer.logicSystem.makeOutputWriteFn(t.layer.ownerEntity,e);o(i)},e.readPort=function(t,e){var i=t._portValues;if(void 0!==i?i=i[e]:t._portValues={},void 0!==i)return i;var o=t.iface.getPorts();for(var r in o)if(o[r].id===e)return t._portValues[e]=o[r].def;return console.log("Could not find the port ["+e+"]!"),void 0},e.fireEvent=function(t,i){e.doConnections(t,i,function(t,e){t.obj.onEvent(t,e)})},e.resolveEntityRef=function(t,e){return"[self]"===e?t.layer.ownerEntity:t.layer.logicSystem.resolveEntityRef(e)},e.prototype.process=function(t){var e=this._nextFrameNotifications;this._nextFrameNotifications=[];for(var i=0;i<e.length;i++){var o=e[i];o[0]._lastNotification[o[1]]=this._updateRound,o[0].obj.onInputChanged(o[0],o[1],o[2])}for(var i in this._logicInterfaces)this._logicInterfaces[i].wantsProcess&&this._logicInterfaces[i].obj.processLogic&&this._logicInterfaces[i].obj.processLogic(t);this._updateRound++},e.prototype.forEachLogicObject=function(t){for(var e in this._logicInterfaces){var i=this._logicInterfaces[e].obj;void 0!==i&&t(i)}},e.prototype.connectObjectsWithLogic=function(t,e,i,o){this.connectEndpoints(t.logicInstance,e,i.logicInstance,o)},e.prototype.connectEndpoints=function(t,e,i,o){this.addConnectionByName(t,e,i.name,o)},e}),define("goo/logic/LogicNodes",[],function(){"use strict";function t(){}return t.types={},t.registerType=function(e,i){t.types[e]={fn:i,name:e,editorName:i.editorName}},t.getInterfaceByName=function(e){return void 0!==t.types[e]?t.types[e].fn.logicInterface:null},t.getClass=function(e){return void 0===t.types[e]?function(){return console.error("LogicNode type ["+e+"] does not exist."),null}:t.types[e].fn},t.getAllTypes=function(){var e=[];for(var i in t.types)e.push(t.types[i]);return e},t}),define("goo/entities/components/LogicComponent",["goo/logic/LogicInterface","goo/logic/LogicLayer","goo/logic/LogicNodes","goo/entities/components/Component"],function(t,e,i,o){"use strict";function r(t){o.call(this),this.type="LogicComponent",this.parent=null,this.logicInstance=null,this.logicLayer=null,this.nodes={},this._entity=t}return r.prototype=Object.create(o.prototype),r.prototype.configure=function(t){for(var o in this.nodes)void 0!==this.nodes[o].onSystemStopped&&this.nodes[o].onSystemStopped(!1);this.logicLayer=new e(this._entity),this.nodes={};for(var r in t.logicNodes){var n=t.logicNodes[r],a=i.getClass(n.type),s=new a;s.configure(n),s.addToLogicLayer(this.logicLayer,n.id),this.nodes[r]=s}},r.prototype.process=function(t){null!==this.logicLayer&&this.logicLayer.process(t)},r}),define("goo/entities/components/MovementComponent",["goo/math/Vector3","goo/entities/components/Component"],function(t,e){"use strict";function i(){this.type="MovementComponent",this.velocity=new t,this.rotationVelocity=new t}return i.prototype=Object.create(e.prototype),i.prototype.addVelocity=function(t){this.velocity.add(t)},i.prototype.setVelocity=function(t){this.velocity.set(t)},i.prototype.getVelocity=function(){return this.velocity},i.prototype.addRotationVelocity=function(t){this.rotationVelocity.add(t)},i.prototype.setRotationVelocity=function(t){this.rotationVelocity.set(t)},i.prototype.getRotationVelocity=function(){return this.rotationVelocity},i}),define("goo/entities/components/OccludeeComponent",["goo/entities/components/Component","goo/renderer/bounds/BoundingBox","goo/renderer/bounds/BoundingSphere"],function(t,e,i){"use strict";function o(t,o){this.type="OccludeeComponent",this.modelBound=o===!0?new e:new i;var r=t.getAttributeBuffer("POSITION");if(void 0!==r&&this.modelBound.computeFromPoints(r),this.positionArray=new Float32Array(32),o===!0){var n=this.modelBound.xExtent,a=this.modelBound.yExtent,s=this.modelBound.zExtent;this.positionArray.set([-n,a,-s,1,-n,a,s,1,n,a,s,1,n,a,-s,1,-n,-a,-s,1,-n,-a,s,1,n,-a,s,1,n,-a,-s,1])}}return o.prototype=Object.create(t.prototype),o}),define("goo/entities/components/OccluderComponent",["goo/entities/components/Component"],function(t){"use strict";function e(t){this.type="OccluderComponent",this.meshData=t}return e.prototype=Object.create(t.prototype),e}),define("goo/particles/ParticleUtils",["goo/math/Vector3"],function(t){"use strict";function e(){}return e.getRandomVelocityOffY=function(t,i,o,r,n){var a=i+Math.random()*(o-i),s=2*Math.PI*Math.random();return t.x=Math.cos(s)*Math.sin(a),t.y=Math.cos(a),t.z=Math.sin(s)*Math.sin(a),n&&e.applyEntityTransformVector(t,n),t.mul(r),t},e.randomPointInCube=function(t,e,i,o,r){return t.x=2*Math.random()*e-e+(r?r.x:0),t.y=2*Math.random()*i-i+(r?r.y:0),t.z=2*Math.random()*o-o+(r?r.z:0),t},e.createConstantForce=function(e){var i=new t(e);return{enabled:!0,prepare:function(){},apply:function(t,e){e.velocity.x+=i.x*t,e.velocity.y+=i.y*t,e.velocity.z+=i.z*t}}},e.applyEntityTransformPoint=function(t,e){return e.transformComponent&&e.transformComponent.worldTransform?e.transformComponent.worldTransform.applyForward(t,t):t},e.applyEntityTransformVector=function(t,e){return e.transformComponent&&e.transformComponent.worldTransform?e.transformComponent.worldTransform.applyForwardVector(t,t):t},e.applyTimeline=function(t,e){for(var i=t.age,o=t.lifeSpan,r=0,n=0,a=0,s=0,c=o,l=o,h=o,u=o,d=0,p=0,f=null,m=null,g=null,v=null,y=null,x=null,w=null,_=null,b=null,S=0,M=e.length;M>S;S++){var C=e[S];d+=(C.timeOffset?C.timeOffset:0)*o,null===x&&(d>i?void 0!==C.color&&(c=d,x=C):void 0!==C.color&&(r=d,f=C)),null===w&&(d>i?void 0!==C.mass&&(l=d,w=C):void 0!==C.mass&&(n=d,m=C)),i>=d&&void 0!==C.uvIndex&&(y=C),null===_&&(d>i?void 0!==C.size&&(h=d,_=C):void 0!==C.size&&(a=d,g=C)),null===b&&(d>i?void 0!==C.spin&&(u=d,b=C):void 0!==C.spin&&(s=d,v=C))}p=(i-r)/(c-r);var T=null!==f?f.color:[1,1,1,1],E=null!==x?x.color:T;t.color.data[0]=(1-p)*T[0]+p*E[0],t.color.data[1]=(1-p)*T[1]+p*E[1],t.color.data[2]=(1-p)*T[2]+p*E[2],t.color.data[3]=(1-p)*T[3]+p*E[3],p=(i-n)/(l-n);var T=null!==m?m.mass:1,E=null!==w?w.mass:T;t.mass=(1-p)*T+p*E,t.uvIndex=null!==y?y.uvIndex:0,p=(i-a)/(h-a);var T=null!==g?g.size:1,E=null!==_?_.size:T;t.size=(1-p)*T+p*E,p=(i-s)/(u-s);var T=null!==v?v.spin:0,E=null!==b?b.spin:T;t.spin=(1-p)*T+p*E},e}),define("goo/particles/Particle",["goo/particles/ParticleUtils","goo/math/Vector","goo/math/Vector3","goo/math/Vector4","goo/renderer/MeshData"],function(t,e,i,o,r){"use strict";function n(t,e){this.alive=!1,this.position=new i,this.velocity=new i,this.lifeSpan=0,this.parent=t,this.age=0,this.index=e,this.color=new o(1,0,0,1),this.size=0,this.spin=0,this.mass=1,this.emitter=null,this.uvIndex=0,this.lastUVIndex=-1,this.bbX=new i,this.bbY=new i,this.lastColor=new o}var a=new i;return n.prototype.respawnParticle=function(t){this.emitter=t,this.lifeSpan=t.nextParticleLifeSpan(),this.alive=!0,this.age=0},n.prototype.update=function(o,n){if(this.alive){if(this.age+=o,this.age>this.lifeSpan)return this.kill(),void 0;if(this.position.add_d(this.velocity.x*o,this.velocity.y*o,this.velocity.z*o),t.applyTimeline(this,this.emitter&&this.emitter.timeline?this.emitter.timeline:this.parent.timeline),!e.equals(this.lastColor,this.color)){var s=this.parent.meshData.getAttributeBuffer(r.COLOR);s.set(this.color.data,16*this.index+0),s.set(this.color.data,16*this.index+4),s.set(this.color.data,16*this.index+8),s.set(this.color.data,16*this.index+12),this.lastColor.setv(this.color)}if(this.emitter&&this.emitter.getParticleBillboardVectors(this,n),0===this.spin)this.bbX.muld(this.size,this.size,this.size),this.bbY.muld(this.size,this.size,this.size);else{var c=Math.cos(this.spin)*this.size,l=Math.sin(this.spin)*this.size,h=this.bbY.x,u=this.bbY.y,d=this.bbY.z;this.bbY.setv(this.bbX),this.bbX.muld(c,c,c).add_d(h*l,u*l,d*l),this.bbY.muld(-l,-l,-l).add_d(h*c,u*c,d*c)}var p=this.parent.meshData.getAttributeBuffer(r.POSITION);if(i.subv(this.position,this.bbX,a).subv(this.bbY),p.set(a.data,12*this.index+0),i.subv(this.position,this.bbX,a).addv(this.bbY),p.set(a.data,12*this.index+3),i.addv(this.position,this.bbX,a).addv(this.bbY),p.set(a.data,12*this.index+6),i.addv(this.position,this.bbX,a).subv(this.bbY),p.set(a.data,12*this.index+9),this.lastUVIndex!==this.uvIndex){var f=this.parent.meshData.getAttributeBuffer(r.TEXCOORD0),m=this.uvIndex%this.parent.uRange/this.parent.uRange,g=1-Math.floor(this.uvIndex/this.parent.vRange)/this.parent.vRange,v=1/this.parent.uRange,y=1/this.parent.vRange;f.set([m+v,g-y],8*this.index+0),f.set([m+v,g],8*this.index+2),f.set([m,g],8*this.index+4),f.set([m,g-y],8*this.index+6),this.lastUVIndex=this.uvIndex}}},n.prototype.kill=function(){this.alive=!1;var t=this.parent.meshData.getAttributeBuffer(r.POSITION),e=t.subarray(12*this.index,12*this.index+3);t.set(e,12*this.index+3),t.set(e,12*this.index+6),t.set(e,12*this.index+9)},n}),define("goo/particles/ParticleEmitter",["goo/particles/ParticleUtils","goo/renderer/Renderer"],function(t,e){"use strict";function i(e){e=e||{},this.totalParticlesToSpawn=isNaN(e.totalParticlesToSpawn)?-1:e.totalParticlesToSpawn,this.maxLifetime=isNaN(e.maxLifetime)?3:e.maxLifetime,this.minLifetime=isNaN(e.minLifetime)?2:e.minLifetime,this.timeline=e.timeline?e.timeline:void 0,this.influences=e.influences?e.influences:[],this.getEmissionPoint=e.getEmissionPoint?e.getEmissionPoint:function(e,i){var o=e.position;return o.setd(0,0,0),t.applyEntityTransformPoint(o,i)},this.getEmissionVelocity=e.getEmissionVelocity?e.getEmissionVelocity:function(e,i){var o=e.velocity;return o.setd(0,1,0),t.applyEntityTransformVector(o,i)},this.getParticleBillboardVectors=e.getParticleBillboardVectors?e.getParticleBillboardVectors:i.CAMERA_BILLBOARD_FUNC,this.releaseRatePerSecond=isNaN(e.releaseRatePerSecond)?10:e.releaseRatePerSecond,this.particlesWaitingToRelease=0,this.enabled=void 0!==e.enabled?e.enabled===!0:!0}return i.CAMERA_BILLBOARD_FUNC=function(t){var i=e.mainCamera;i&&(t.bbX.setv(i._left),t.bbY.setv(i._up))},i.prototype.nextParticleLifeSpan=function(){return this.minLifetime+(this.maxLifetime-this.minLifetime)*Math.random()},i}),define("goo/entities/components/ParticleComponent",["goo/entities/components/Component","goo/particles/Particle","goo/particles/ParticleEmitter","goo/renderer/MeshData"],function(t,e,i,o){"use strict";function r(e){if(this.type="ParticleComponent",t.call(this),e=e||{},this.emitters=[],e.emitters)for(var o=0,r=e.emitters.length;r>o;o++)this.emitters.push(new i(e.emitters[o]));this.timeline=e.timeline?e.timeline:[],this.uRange=isNaN(e.uRange)?1:e.uRange,this.vRange=isNaN(e.vRange)?1:e.vRange;var n=isNaN(e.particleCount)?100:e.particleCount;this.recreateParticles(n),this.enabled=!0}return r.prototype=Object.create(t.prototype),r.prototype.generateMeshData=function(){var t=o.defaultMap([o.POSITION,o.COLOR,o.TEXCOORD0]);this.meshData=new o(t,4*this.particleCount,6*this.particleCount);for(var e=this.meshData.getAttributeBuffer(o.TEXCOORD0),i=this.meshData.getIndexBuffer(),r=0,n=this.particleCount;n>r;r++)e.set([1,0],8*r+0),e.set([1,1],8*r+2),e.set([0,1],8*r+4),e.set([0,0],8*r+6),i.set([4*r+0,4*r+3,4*r+1,4*r+1,4*r+3,4*r+2],6*r)},r.prototype.recreateParticles=function(t){this.particleCount=t,this.particles=[];for(var i=0;i<this.particleCount;i++)this.particles[i]=new e(this,i);this.generateMeshData()},r}),define("goo/entities/components/PortalComponent",["goo/entities/components/Component","goo/renderer/pass/RenderTarget"],function(t,e){"use strict";function i(t,i,o,r){i=i||200,this.options=o||{},this.options.preciseRecursion=!!this.options.preciseRecursion,this.options.autoUpdate=this.options.autoUpdate!==!1,this.options.alwaysRender=!!this.options.alwaysRender,this.overrideMaterial=r,this.doUpdate=!0;var n=t.aspect;this.type="PortalComponent",this.camera=t,this.target=new e(i,i/n),this.options.preciseRecursion&&(this.secondaryTarget=new e(i,i/n))}return i.prototype=Object.create(t.prototype),i.prototype.requestUpdate=function(){this.doUpdate=!0},i}),define("goo/entities/components/ProximityComponent",["goo/entities/components/Component"],function(t){"use strict";function e(t){this.type="ProximityComponent",Object.defineProperty(this,"tag",{value:t||"red",writable:!1})}return e.prototype=Object.create(t.prototype),e}),define("goo/shapes/TextureGrid",["goo/renderer/MeshData"],function(t){"use strict";
function e(e,o){this.matrix=e,this.textureUnitsPerLine=o||8;var r=t.defaultMap([t.POSITION,t.NORMAL,t.TEXCOORD0]),n=i(e);t.call(this,r,4*n,6*n),this.rebuild()}function i(t){for(var e=0,i=0;i<t.length;i++)e+=t[i].length;return e}function o(t){var e=[],i=t.split("\n");return i.forEach(function(t){var i=t.split(""),o=i.map(function(t){return t.charCodeAt(0)});e.push(o)}),e}return e.prototype=Object.create(t.prototype),e.prototype.rebuild=function(){for(var e=[],i=[],o=[],r=[],n=0,a=0;a<this.matrix.length;a++)for(var s=0;s<this.matrix[a].length;s++){e.push(s,-a-1,0,s,-a,0,s+1,-a,0,s+1,-a-1,0),i.push(0,0,1,0,0,1,0,0,1,0,0,1);var c=this.matrix[a][s]%this.textureUnitsPerLine/this.textureUnitsPerLine,l=Math.floor(this.matrix[a][s]/this.textureUnitsPerLine)/this.textureUnitsPerLine;l=1-l,r.push(c,l-1/this.textureUnitsPerLine,c,l,c+1/this.textureUnitsPerLine,l,c+1/this.textureUnitsPerLine,l-1/this.textureUnitsPerLine),o.push(n+3,n+1,n+0,n+2,n+1,n+3),n+=4}return this.getAttributeBuffer(t.POSITION).set(e),this.getAttributeBuffer(t.NORMAL).set(i),this.getAttributeBuffer(t.TEXCOORD0).set(r),this.getIndexBuffer().set(o),this},e.fromString=function(t){return new e(o(t),16)},e}),define("goo/entities/components/TextComponent",["goo/entities/components/Component","goo/shapes/TextureGrid","goo/entities/components/MeshDataComponent"],function(t){"use strict";function e(t){this.type="TextComponent",this.text=t||"",this.dirty=!0}return e.prototype=Object.create(t.prototype),e.prototype.setText=function(t){return this.text=t,this.dirty=!0,this},e}),define("goo/entities/systems/DebugRenderSystem",["goo/entities/systems/System","goo/entities/SystemBus","goo/renderer/SimplePartitioner","goo/renderer/Material","goo/renderer/shaders/ShaderLib","goo/renderer/Util","goo/debug/DebugDrawHelper"],function(t,e,i,o,r,n,a){"use strict";function s(){t.call(this,"DebugRenderSystem",["TransformComponent"]),this._renderablesTree={},this.renderList=[],this.preRenderers=[],this.composers=[],this.doRender={CameraComponent:!1,LightComponent:!1,MeshRendererComponent:!1,SkeletonPose:!1},this.inserted(),this._interestComponents=["CameraComponent","LightComponent"],this.camera=null,this.lights=[],this.currentTpf=0,this.scale=20;var i=this;e.addListener("goo.setCurrentCamera",function(t){i.camera=t.camera}),e.addListener("goo.setLights",function(t){i.lights=t}),this.selectionRenderable=a.getRenderablesFor({type:"MeshRendererComponent"}),this.selectionActive=!1,this.oldSelectionActive=!1}return s.prototype=Object.create(t.prototype),s.prototype.inserted=function(){},s.prototype.deleted=function(){},s.prototype.process=function(t,e){for(var i,o=this.renderList.length=0,r=0;r<t.length;r++){for(var n=t[r],s=0,c=this._interestComponents.length;c>s;s++){var l=this._interestComponents[s];if("ToolCameraEntity"!==n.name&&n.hasComponent(l)){var h=n.getComponent(l),u={full:this.doRender[l]||n.getComponent(l).forceDebug},d=this._renderablesTree[n.id]=this._renderablesTree[n.id]||{};d[l]&&(2===d[l].length&&u.full||1===d[l].length&&!u.full)?i=d[l]:(i=a.getRenderablesFor(h,u),i.forEach(function(t){t.id=n.id}),d[l]=i),i.forEach(function(t){t.transform.copy(n.transformComponent.worldTransform)}),a.update(i,h,this.camera.translation),i.forEach(function(t){this.renderList[o++]=t}.bind(this))}}if(this.doRender.SkeletonPose&&n.meshDataComponent&&n.meshDataComponent.currentPose){var p=n.meshDataComponent.currentPose,d=this._renderablesTree[n.id]=this._renderablesTree[n.id]||{};d.skeleton?i=d.skeleton:(i=a.getRenderablesFor(p),i.forEach(function(t){t.id=n.id}),d.skeleton=i),i.forEach(function(t){t.transform.copy(n.transformComponent.worldTransform),this.renderList[o++]=t}.bind(this))}}this.selectionActive&&(this.renderList[o++]=this.selectionRenderable[0]),this.renderList.length=o,this.currentTpf=e},s.prototype.render=function(t){t.checkResize(this.camera),this.camera&&t.render(this.renderList,this.camera,this.lights,null,!1)},s.prototype.renderToPick=function(t,e){t.renderToPick(this.renderList,this.camera,!1,e)},s}),define("goo/util/gizmos/Gizmo",["goo/renderer/shaders/ShaderBuilder","goo/renderer/MeshData","goo/renderer/Shader","goo/renderer/Material","goo/renderer/Renderer","goo/math/Transform","goo/math/Matrix4x4","goo/math/Plane","goo/math/Ray","goo/math/Vector3"],function(t,e,i,o,r,n,a,s,c,l){"use strict";function h(t,e){this.name=t||"Default Gizmo",this.gizmoRenderSystem=e,this._colors=[[1,.1,.3],[.2,1,.3],[.2,.3,1],[.8,.8,.8]],this._gizmoSize=1/60,this._plane=new s,this._line=new l,this._activeHandle=null,this._mouse={position:[0,0],oldPosition:[0,0]},this.dirty=!1,this.visible=!1,this.transform=new n,this.renderables=[],this.onChange=null,this._oldRay=new c,this._newRay=new c,this._result=new l,this._v0=new l,this._v1=new l,this._v2=new l,this._v3=new l,this._s0=new l,this._s1=new l,this._s2=new l,this._s3=new l}return h.handleStore=[],h.registerHandle=function(t){var e=h.handleStore.length+16e3;return h.handleStore.push(t),e},h.getHandle=function(t){return 16e3>t?null:h.handleStore[t-16e3]},h.prototype.getRenderable=function(t){for(var e=0;e<this.renderables.length;e++){var i=this.renderables[e];if(i.id===t)return i}},h.prototype.activate=function(t){this._activeHandle=t.data,this._mouse.oldPosition[0]=t.x,this._mouse.oldPosition[1]=t.y,this._activeRenderable=this.getRenderable(t.id),this._activeRenderable.materials[0].uniforms.color=[1,1,0]},h.prototype.deactivate=function(){if(this._activeRenderable){var t=this._activeRenderable.originalColor;this._activeRenderable.materials[0].uniforms.color=[t[0],t[1],t[2]]}},h.prototype.copyTransform=function(t){this.transform.setIdentity(),t&&(t.matrix.getTranslation(this.transform.translation),this.transform.rotation.copy(t.rotation),this.updateTransforms())},h.prototype.update=function(t){this._mouse.position[0]=t[0],this._mouse.position[1]=t[1],this.dirty=!0},h.prototype.updateTransforms=function(){if(r.mainCamera){var t=r.mainCamera.translation,e=this.transform.translation,i=Math.sqrt(t.distanceSquared(e)),o=i*this._gizmoSize;this.transform.scale.setd(o,o,o)}this.transform.update();for(var n=this.renderables.length-1;n>=0;n--)this.renderables[n].transform.update(),a.combine(this.transform.matrix,this.renderables[n].transform.matrix,this.renderables[n].transform.matrix)},h.prototype._setPlane=function(){var t=this._plane.normal,e=this._v0,i=this._v1,o=this._v2,n=this._v3,a=this._s0,s=this._s1,c=this._s2,h=this._s3;"Plane"===this._activeHandle.type?(t.setv([l.UNIT_X,l.UNIT_Y,l.UNIT_Z][this._activeHandle.axis]),this.transform.matrix.applyPostVector(t),t.normalize(),e.setv(l.ZERO),this.transform.matrix.applyPostPoint(e),this._plane.constant=e.dot(t)):(e.setv(l.ZERO),this.transform.matrix.applyPostPoint(e),i.setv(l.UNIT_X),this.transform.matrix.applyPostPoint(i),o.setv(l.UNIT_Y),this.transform.matrix.applyPostPoint(o),n.setv(l.UNIT_Z),this.transform.matrix.applyPostPoint(n),r.mainCamera.getScreenCoordinates(e,1,1,a),r.mainCamera.getScreenCoordinates(i,1,1,s),s.subv(a),r.mainCamera.getScreenCoordinates(o,1,1,c),c.subv(a),r.mainCamera.getScreenCoordinates(n,1,1,h),h.subv(a),0===this._activeHandle.axis?c.cross(s).length()>h.cross(s).length()?t.setv(n).subv(e).normalize():t.setv(o).subv(e).normalize():1===this._activeHandle.axis?h.cross(c).length()>s.cross(c).length()?t.setv(i).subv(e).normalize():t.setv(n).subv(e).normalize():s.cross(h).length()>c.cross(h).length()?t.setv(o).subv(e).normalize():t.setv(i).subv(e).normalize(),this._plane.constant=e.dot(t))},h.prototype._setLine=function(){this._line.setv([l.UNIT_X,l.UNIT_Y,l.UNIT_Z][this._activeHandle.axis]),this.transform.matrix.applyPostVector(this._line),this._line.normalize()},h.prototype.addRenderable=function(t){t.originalColor=t.materials[0].uniforms.color,this.renderables.push(t)},h.prototype._buildMaterialForAxis=function(t,e){var i=o.createMaterial(h._shaderDef,t+"Material");return i.uniforms.color=this._colors[t],void 0!==e&&1>e&&(i.blendState.blending="CustomBlending",i.uniforms.opacity=e,i.renderQueue=3e3),i.cullState.enabled=!1,i},h._shaderDef={attributes:{vertexPosition:e.POSITION,vertexNormal:e.NORMAL},uniforms:{viewProjectionMatrix:i.VIEW_PROJECTION_MATRIX,worldMatrix:i.WORLD_MATRIX,cameraPosition:i.CAMERA,color:[1,1,1],opacity:1,light:[-20,20,20]},vshader:["attribute vec3 vertexPosition;","attribute vec3 vertexNormal;","uniform mat4 viewProjectionMatrix;","uniform mat4 worldMatrix;","uniform vec3 cameraPosition;","varying vec3 normal;","varying vec3 viewPosition;","void main(void) {","	vec4 worldPos = worldMatrix * vec4(vertexPosition, 1.0);","	gl_Position = viewProjectionMatrix * worldPos;","	normal = vertexNormal;","	viewPosition = cameraPosition - worldPos.xyz;","}"].join("\n"),fshader:["varying vec3 normal;","varying vec3 viewPosition;","uniform vec3 color;","uniform float opacity;","uniform vec3 light;","void main(void)","{","	vec3 N = normalize(normal);","	vec4 final_color = vec4(color, 1.0);"," vec3 lVector = normalize(light);"," float dotProduct = dot(N, lVector);"," float diffuse = max(dotProduct, 0.0);"," final_color.rgb *= (0.5*diffuse+0.5);"," final_color.a = opacity;","	gl_FragColor = final_color;","}"].join("\n")},h}),define("goo/shapes/Disk",["goo/renderer/MeshData"],function(t){"use strict";function e(e,i,o){if(1===arguments.length&&arguments[0]instanceof Object){var r=arguments[0];e=r.nSegments,i=r.radius,o=r.pointiness}this.nSegments=e||8,this.radius=i||1,this.pointiness=o||0;var n=t.defaultMap([t.POSITION,t.NORMAL,t.TEXCOORD0]);t.call(this,n,this.nSegments+1,3*this.nSegments),this.indexModes=["Triangles"],this.rebuild()}return e.prototype=Object.create(t.prototype),e.prototype.rebuild=function(){for(var e=[],i=[],o=[],r=[],n=Math.atan2(this.radius,this.pointiness),a=2*Math.PI/this.nSegments,s=0,c=0;s<this.nSegments;s++,c+=a)e.push(Math.cos(c)*this.radius,Math.sin(c)*this.radius,0),i.push(Math.cos(c)*Math.cos(n),Math.sin(c)*Math.cos(n),Math.sin(n)),o.push(.5*Math.cos(c)+.5,.5*Math.sin(c)+.5),r.push(this.nSegments,s,(s+1)%this.nSegments);return e.push(0,0,this.pointiness),i.push(0,0,1),o.push(.5,.5),this.getAttributeBuffer(t.POSITION).set(e),this.getAttributeBuffer(t.NORMAL).set(i),this.getAttributeBuffer(t.TEXCOORD0).set(o),this.getIndexBuffer().set(r),this},e}),define("goo/util/gizmos/TranslationGizmo",["goo/util/gizmos/Gizmo","goo/renderer/MeshData","goo/util/MeshBuilder","goo/shapes/Disk","goo/shapes/Quad","goo/math/Transform","goo/renderer/Renderer"],function(t,e,i,o,r,n,a){"use strict";function s(){t.call(this,"TranslationGizmo"),this._quadMesh=new r(2,2),this._arrowMesh=this._buildArrowMesh(),this._buildArrow(0),this._buildArrow(1),this._buildArrow(2)}return s.prototype=Object.create(t.prototype),s.prototype.activate=function(e){t.prototype.activate.call(this,e),this._setPlane(),"Axis"===this._activeHandle.type&&this._setLine()},s.prototype.process=function(){var t=this._mouse.oldPosition,e=this._mouse.position;a.mainCamera.getPickRay(t[0],t[1],1,1,this._oldRay),a.mainCamera.getPickRay(e[0],e[1],1,1,this._newRay),"Plane"===this._activeHandle.type?this._moveOnPlane():"Axis"===this._activeHandle.type&&this._moveOnLine(),t[0]=e[0],t[1]=e[1],this.updateTransforms(),this.dirty=!1,this.onChange instanceof Function&&this.onChange(this.transform.translation)},s.prototype.copyTransform=function(e,i){t.prototype.copyTransform.call(this,e),e&&i&&(this.transform.rotation.setIdentity(),this.updateTransforms())},s.prototype._moveOnPlane=function(){var t=this._v0,e=this._v1,i=this._result;this._plane.rayIntersect(this._oldRay,t),this._plane.rayIntersect(this._newRay,e),i.setv(e).subv(t),this.transform.translation.add(i)},s.prototype._moveOnLine=function(){var t=this._v0,e=this._v1,i=this._result,o=this._line;this._plane.rayIntersect(this._oldRay,t),this._plane.rayIntersect(this._newRay,e),i.setv(e).subv(t);var r=i.dot(o);i.setv(o).muld(r,r,r),this.transform.translation.addv(i)},s.prototype._buildArrow=function(e){var i=new n,o=new n,r=1;o.scale.setd(r,r,r),2===e?o.translation.setd(r,-r,0):0===e?(o.translation.setd(0,-r,r),o.setRotationXYZ(0,Math.PI/2,0),i.setRotationXYZ(0,Math.PI/2,0)):1===e&&(o.translation.setd(r,0,r),o.setRotationXYZ(Math.PI/2,0,0),i.setRotationXYZ(Math.PI/2,0,0)),this.addRenderable({meshData:this._arrowMesh,materials:[this._buildMaterialForAxis(e)],transform:i,id:t.registerHandle({type:"Axis",axis:e}),thickness:.6}),this.addRenderable({meshData:this._quadMesh,materials:[this._buildMaterialForAxis(e,.6)],transform:o,id:t.registerHandle({type:"Plane",axis:e})})},s.prototype._buildArrowMesh=function(){var t=new i,r=new o(32,.6,2.3),a=new o(32,.6),s=new e(e.defaultMap([e.POSITION]),2,2);s.getAttributeBuffer(e.POSITION).set([0,0,0,0,0,7]),s.getIndexBuffer().set([0,1]),s.indexLengths=null,s.indexModes=["Lines"];var c=new n;c.translation.setd(0,0,7),c.update(),t.addMeshData(r,c),c.setRotationXYZ(0,Math.PI,0),c.update(),t.addMeshData(a,c);var c=new n;c.update(),t.addMeshData(s,c);var l=t.build()[0];return l},s}),define("goo/util/gizmos/RotationGizmo",["goo/util/gizmos/Gizmo","goo/shapes/Sphere","goo/shapes/Torus","goo/math/Vector3","goo/math/Matrix3x3","goo/math/Transform","goo/renderer/Renderer","goo/math/Ray"],function(t,e,i,o,r,n,a,s){"use strict";function c(){t.call(this,"RotationGizmo"),this._ballMesh=new e(32,32,1.1),this._torusMesh=new i(64,8,.1,2.5),this._buildBall(),this._buildTorus(0),this._buildTorus(1),this._buildTorus(2),this._rotation=new r,this._rotationScale=4,this._axis=new o,this._direction=new o,this._ray=new s,this._m1=new r,this._m2=new r,this.snap=!1,this.accumulatedRotationX=0,this.accumulatedRotationY=0,this.accumulatedRotationThorX=0,this.accumulatedRotationThorY=0,this.accumulatedRotationThorZ=0,this.oldAngleX=0,this.oldAngleY=0,this.oldAngleZ=0}function l(t,e){return function(i){var o=i%t;return o+=0>o?t:0,e>o?i-o:o>t-e?i+t-o:i}}c.prototype=Object.create(t.prototype),c.prototype.activate=function(e){t.prototype.activate.call(this,e);var i=this._v0,r=this._v1,n=this._v2,s=this._axis,c=this._ray;if(this._activeHandle.axis<3){s.setv([o.UNIT_X,o.UNIT_Y,o.UNIT_Z][this._activeHandle.axis]),this.transform.rotation.applyPost(s),i.setv(o.ZERO),this.transform.matrix.applyPostPoint(i),a.mainCamera.getPickRay(e.x,e.y,1,1,c),r.setv(c.origin).subv(i);var l=.9*r.length();r.setv(c.direction).muld(l,l,l).addv(c.origin),n.setv(r).subv(i),o.cross(s,n,n),n.addv(r),a.mainCamera.getScreenCoordinates(n,1,1,this._direction),this._direction.sub_d(e.x,1-e.y,0),this._direction.y*=-1,this._direction.z=0,this._direction.normalize()}},c.prototype.process=function(){var t=this._mouse.oldPosition,e=this._mouse.position,i=e[0]-t[0],o=e[1]-t[1];3===this._activeHandle.axis?this._rotateOnScreen(i,o):this._rotateOnAxis(i,o),t[0]=e[0],t[1]=e[1],this.updateTransforms(),this.dirty=!1,this.onChange instanceof Function&&this.onChange(this.transform.rotation)},c.prototype._rotateOnScreen=function(t,e){this._rotation.setIdentity(),this._rotation.rotateY(t*this._rotationScale),this._rotation.rotateX(e*this._rotationScale);var i=a.mainCamera.getViewMatrix().data,o=this._m1,n=this._m2;o.set(i[0],i[1],i[2],i[4],i[5],i[6],i[8],i[9],i[10]),n.set(o).invert(),n.combine(this._rotation),n.combine(o),r.combine(n,this.transform.rotation,this.transform.rotation)};var h=l(Math.PI/4,Math.PI/16),u=h;return c.prototype._rotateOnAxis=function(t,e){this._rotation.setIdentity();var i=t*this._direction.x+e*this._direction.y;if(i*=this._rotationScale,this.snap)switch(this._activeHandle.axis){case 0:this.accumulatedRotationThorX+=i;var o=u(this.accumulatedRotationThorX);this._rotation.rotateX(o-this.oldAngleX),this.oldAngleX=o;break;case 1:this.accumulatedRotationThorY+=i;var n=u(this.accumulatedRotationThorY);this._rotation.rotateY(n-this.oldAngleY),this.oldAngleY=n;break;case 2:this.accumulatedRotationThorZ+=i;var a=u(this.accumulatedRotationThorZ);this._rotation.rotateZ(a-this.oldAngleZ),this.oldAngleZ=a}else switch(this._activeHandle.axis){case 0:this.accumulatedRotationThorX+=i;var o=this.accumulatedRotationThorX;this._rotation.rotateX(o-this.oldAngleX),this.oldAngleX=o;break;case 1:this.accumulatedRotationThorY+=i;var n=this.accumulatedRotationThorY;this._rotation.rotateY(n-this.oldAngleY),this.oldAngleY=n;break;case 2:this.accumulatedRotationThorZ+=i;var a=this.accumulatedRotationThorZ;this._rotation.rotateZ(a-this.oldAngleZ),this.oldAngleZ=a}r.combine(this.transform.rotation,this._rotation,this.transform.rotation)},c.prototype._buildBall=function(){var e=new n;e.scale.setd(1.2,1.2,1.2),this.addRenderable({meshData:this._ballMesh,materials:[this._buildMaterialForAxis(3,.6)],transform:new n,id:t.registerHandle({type:"Rotate",axis:3})})},c.prototype._buildTorus=function(e){var i=new n;i.scale.setd(1.7,1.7,1.7),0===e?i.setRotationXYZ(0,Math.PI/2,0):1===e&&i.setRotationXYZ(Math.PI/2,0,0),this.addRenderable({meshData:this._torusMesh,materials:[this._buildMaterialForAxis(e)],transform:i,id:t.registerHandle({type:"Rotate",axis:e}),thickness:.35})},c}),define("goo/util/gizmos/ScaleGizmo",["goo/util/gizmos/Gizmo","goo/renderer/MeshData","goo/util/MeshBuilder","goo/shapes/Box","goo/math/Transform","goo/renderer/Renderer","goo/math/Vector3","goo/math/MathUtils"],function(t,e,i,o,r,n,a,s){"use strict";function c(e){t.call(this,"ScaleGizmo",e),this._boxMesh=new o(1.4,1.4,1.4),this._arrowMesh=this._buildArrowMesh(),this._scale=1,this._transformScale=new a,this._transformScale.setd(1,1,1),this._buildBox(),this._buildArrow(0),this._buildArrow(1),this._buildArrow(2)}return c.prototype=Object.create(t.prototype),c.prototype.activate=function(e){t.prototype.activate.call(this,e),3!==this._activeHandle.axis&&(this._setPlane(),this._setLine())},c.prototype.copyTransform=function(e){t.prototype.copyTransform.call(this,e),this._transformScale.setv(e.scale)},c.prototype.process=function(){var t=this._mouse.oldPosition,e=this._mouse.position;3===this._activeHandle.axis?this._scaleUniform():this._scaleNonUniform(),t[0]=e[0],t[1]=e[1],this.updateTransforms(),this.dirty=!1,this.onChange instanceof Function&&this.onChange(this._transformScale)},c.prototype._scaleUniform=function(){var t=this._mouse.oldPosition,e=this._mouse.position,i=Math.pow(1+e[0]+t[1]-t[0]-e[1],this._scale),o=this.gizmoRenderSystem.entity.transformComponent.worldTransform.translation,r=n.mainCamera.translation,a=r.distance(o);i+=a/2e5*s.sign(i-1),this._transformScale.muld(i,i,i)},c.prototype._scaleNonUniform=function(){var t=this._mouse.position,e=this._mouse.oldPosition;n.mainCamera.getPickRay(e[0],e[1],1,1,this._oldRay),n.mainCamera.getPickRay(t[0],t[1],1,1,this._newRay);var i=this._v0,o=this._v1,r=this._line,a=this._result;this._plane.rayIntersect(this._oldRay,i),this._plane.rayIntersect(this._newRay,o),a.setv(o).subv(i),a.div(this.transform.scale).scale(.07);var s=a.dot(r);a.setv(r).muld(s,s,s);var c=Math.pow(1+s,this._scale);switch(this._activeHandle.axis){case 0:this._transformScale.data[0]*=c;break;case 1:this._transformScale.data[1]/=c;break;case 2:this._transformScale.data[2]*=c}},c.prototype._buildBox=function(){this.addRenderable({meshData:this._boxMesh,materials:[this._buildMaterialForAxis(3)],transform:new r,id:t.registerHandle({type:"Scale",axis:3})})},c.prototype._buildArrow=function(e){var i=new r;0===e?i.setRotationXYZ(0,Math.PI/2,0):1===e&&i.setRotationXYZ(Math.PI/2,0,0),this.addRenderable({meshData:this._arrowMesh,materials:[this._buildMaterialForAxis(e)],transform:i,id:t.registerHandle({type:"Scale",axis:e})})},c.prototype._buildArrowMesh=function(){var t=new i,n=new o,a=new e(e.defaultMap([e.POSITION]),2,2);a.getAttributeBuffer(e.POSITION).set([0,0,0,0,0,1]),a.getIndexBuffer().set([0,1]),a.indexLengths=null,a.indexModes=["Lines"];var s=new r;s.translation.setd(0,0,8),s.update(),t.addMeshData(n,s);var s=new r;s.scale.setd(1,1,8),s.update(),t.addMeshData(a,s);var c=t.build()[0];return c},c}),define("goo/entities/systems/GizmoRenderSystem",["goo/entities/systems/System","goo/entities/SystemBus","goo/renderer/SimplePartitioner","goo/renderer/Material","goo/renderer/shaders/ShaderLib","goo/renderer/shaders/ShaderFragment","goo/renderer/Util","goo/math/Matrix3x3","goo/math/Matrix4x4","goo/renderer/MeshData","goo/renderer/Shader","goo/util/gizmos/Gizmo","goo/util/gizmos/TranslationGizmo","goo/util/gizmos/RotationGizmo","goo/util/gizmos/ScaleGizmo"],function(t,e,i,o,r,n,a,s,c,l,h,u,d,p,f){"use strict";function m(i){t.call(this,"GizmoRenderSystem",null),this.renderables=[],this.camera=null,this.gizmos=[new d(this),new p(this),new f(this)],this.active=!1,this.nextGizmo=null,this.setupCallbacks(i),this.activeGizmo=null,this.viewportWidth=0,this.viewportHeight=0,this.domElement=null,this.global=!1,this.pickingMaterial=o.createEmptyMaterial(g,"pickingMaterial"),this.pickingMaterial.blendState={blending:"NoBlending",blendEquation:"AddEquation",blendSrc:"SrcAlphaFactor",blendDst:"OneMinusSrcAlphaFactor"},this.mouseMove=function(t){if(this.activeGizmo){var e=void 0!==t.offsetX?t.offsetX:t.layerX,i=void 0!==t.offsetY?t.offsetY:t.layerY;this.activeGizmo.update([e/this.viewportWidth,i/this.viewportHeight])}}.bind(this);var r=this;e.addListener("goo.setCurrentCamera",function(t){r.camera=t.camera})}m.prototype=Object.create(t.prototype),m.prototype.activate=function(t,e,i){this.active=!0;var o=u.getHandle(t);o&&this.activeGizmo&&(this.activeGizmo.activate({id:t,data:o,x:e/this.viewportWidth,y:i/this.viewportHeight}),this.domElement.addEventListener("mousemove",this.mouseMove))},m.prototype.deactivate=function(){this.activeGizmo.deactivate(),this.active=!1,this.domElement.removeEventListener("mousemove",this.mouseMove),null!==this.nextGizmo&&(this.setActiveGizmo(this.nextGizmo),this.nextGizmo=null)},m.prototype.getGizmo=function(t){return this.gizmos[t]},m.prototype.show=function(t){this.entity=t,this.activeGizmo&&(this.entity?this.showGizmo(this.activeGizmo):this.hideGizmo(this.activeGizmo))},m.prototype.showGizmo=function(t){t.copyTransform(this.entity.transformComponent.worldTransform,this.global),t.visible||(this.renderables=t.renderables,t.visible=!0)},m.prototype.hideGizmo=function(t){t.visible&&(this.renderables=[],t.visible=!1)},m.prototype.setActiveGizmo=function(t){this.active?this.nextGizmo=t:(this.activeGizmo&&this.hideGizmo(this.activeGizmo),this.activeGizmo=this.gizmos[t]||null,this.activeGizmo&&this.entity&&this.showGizmo(this.activeGizmo))},m.prototype.setGlobal=function(t){this.global!==t&&(this.global=!!t,this.entity&&this.activeGizmo&&this.showGizmo(this.activeGizmo))},m.prototype.setupCallbacks=function(t){if(t&&3===t.length)this.gizmos[0].onChange=t[0],this.gizmos[1].onChange=t[1],this.gizmos[2].onChange=t[2];else{var e=new s,i=new c;this.gizmos[0].onChange=function(t){if(this.entity){var e=this.entity.transformComponent.transform.translation;e.setv(t),this.entity.transformComponent.parent&&(i.copy(this.entity.transformComponent.parent.worldTransform.matrix),i.invert(),i.applyPostPoint(e)),this.entity.transformComponent.setUpdated()}}.bind(this),this.gizmos[1].onChange=function(t){this.entity&&(this.entity.transformComponent.transform.rotation.copy(t),this.entity.transformComponent.parent&&(e.copy(this.entity.transformComponent.parent.worldTransform.rotation),e.invert()),s.combine(e,this.entity.transformComponent.transform.rotation,this.entity.transformComponent.transform.rotation),this.entity.transformComponent.setUpdated())}.bind(this),this.gizmos[2].onChange=function(t){if(this.entity){var e=this.entity.transformComponent.transform.scale;e.setv(t),this.entity.transformComponent.parent&&e.div(this.entity.transformComponent.parent.worldTransform.scale),this.entity.transformComponent.setUpdated()}}.bind(this)}},m.prototype.inserted=function(){},m.prototype.deleted=function(){},m.prototype.process=function(){this.activeGizmo&&(this.activeGizmo.dirty?this.activeGizmo.process():this.entity&&this.entity.transformComponent._updated&&this.activeGizmo.copyTransform(this.entity.transformComponent.worldTransform,this.global),this.activeGizmo.updateTransforms())},m.prototype.render=function(t){t.checkResize(this.camera),this.domElement||(this.domElement=t.domElement),this.viewportHeight=t.viewportHeight,this.viewportWidth=t.viewportWidth,this.camera&&t.render(this.renderables,this.camera,this.lights,null,{color:!1,stencil:!0,depth:!0},this.overrideMaterials)},m.prototype.renderToPick=function(t,e){for(var i=0;i<this.renderables.length;i++){var o=this.renderables[i];void 0!==o.thickness&&(o.materials[0].uniforms.thickness=o.thickness)}t.renderToPick(this.renderables,this.camera,{color:!1,stencil:!0,depth:!0},e,void 0,void 0,void 0,this.pickingMaterial);for(var i=0;i<this.renderables.length;i++){var o=this.renderables[i];o.thickness&&(o.materials[0].uniforms.thickness=0)}};var g={attributes:{vertexPosition:l.POSITION,vertexNormal:l.NORMAL},processors:[function(t,e){var i=e.meshData.attributeMap;t.defines=t.defines||{};for(var o in i)t.defines[o]||(t.defines[o]=!0)}],uniforms:{viewMatrix:h.VIEW_MATRIX,projectionMatrix:h.PROJECTION_MATRIX,worldMatrix:h.WORLD_MATRIX,cameraFar:h.FAR_PLANE,thickness:0,id:function(t){return t.renderable.id+1}},vshader:["attribute vec3 vertexPosition;","#ifdef NORMAL","attribute vec3 vertexNormal;","#endif","uniform mat4 viewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 worldMatrix;","uniform float cameraFar;","uniform float thickness;","varying float depth;","void main() {","#ifdef NORMAL","vec4 mvPosition = viewMatrix * worldMatrix * vec4( vertexPosition + vertexNormal * thickness, 1.0 );","#else","vec4 mvPosition = viewMatrix * worldMatrix * vec4( vertexPosition, 1.0 );","#endif","depth = length(mvPosition.xyz) / cameraFar;","gl_Position = projectionMatrix * mvPosition;","}"].join("\n"),fshader:["uniform float id;","varying float depth;",n.methods.packDepth16,"void main() {","vec2 packedId = vec2(floor(id/255.0), mod(id, 255.0)) * vec2(1.0/255.0);","vec2 packedDepth = packDepth16(depth);","gl_FragColor = vec4(packedId, packedDepth);","}"].join("\n")};return m}),define("goo/shapes/Grid",["goo/renderer/MeshData"],function(t){"use strict";function e(e,i,o,r){if(1===arguments.length&&arguments[0]instanceof Object){var n=arguments[0];e=n.xSegments,i=n.ySegments,o=n.width,r=n.height}this.xSegments=e||10,this.ySegments=i||10,this.width=o||1,this.height=r||1;var a=t.defaultMap([t.POSITION]),s=4+2*(this.xSegments-1)+2*(this.ySegments-1),c=8+2*(this.xSegments-1)+2*(this.ySegments-1);t.call(this,a,s,c),this.indexModes[0]="Lines",this.rebuild()}return e.prototype=Object.create(t.prototype),e.prototype.rebuild=function(){var e=this.width/2,i=this.height/2,o=[],r=[];o.push(-e,-i,0,-e,i,0,e,i,0,e,-i,0),r.push(0,1,1,2,2,3,3,0);for(var n,a=this.width/this.xSegments,s=1;s<this.xSegments;s++)n=s*a-e,o.push(n,-i,0,n,i,0);var c;a=this.height/this.ySegments;for(var s=1;s<this.ySegments;s++)c=s*a-i,o.push(-e,c,0,e,c,0);for(var s=r.length/2;s<o.length/3;s+=2)r.push(s,s+1);this.getAttributeBuffer(t.POSITION).set(o),this.getIndexBuffer().set(r)},e}),define("goo/entities/systems/GridRenderSystem",["goo/entities/systems/System","goo/entities/SystemBus","goo/renderer/SimplePartitioner","goo/renderer/MeshData","goo/renderer/Material","goo/renderer/Shader","goo/renderer/shaders/ShaderLib","goo/renderer/Util","goo/math/Transform","goo/shapes/Grid","goo/shapes/Quad"],function(t,e,i,o,r,n,a,s,c,l,h){"use strict";function u(){t.call(this,"GridRenderSystem",[]),this.renderList=[],this.doRender={grid:!0,surface:!0},this.camera=null,this.lights=[],this.transform=new c,this.transform.rotation.rotateX(-Math.PI/2),this.transform.scale.setd(1e3,1e3,1e3),this.transform.update();var i=r.createMaterial(d,"Grid Material");i.depthState.write=!0,i.depthState.enabled=!0,this.grid={meshData:new l(100,100),materials:[i],transform:this.transform};var o=s.clone(a.simpleColored),n=r.createMaterial(o,"Surface Material");n.uniforms.color=[.4,.4,.4],n.uniforms.opacity=.9,n.blendState.blending="CustomBlending",n.cullState.enabled=!1,n.depthState.write=!0,n.depthState.enabled=!0,n.offsetState.enabled=!0,n.offsetState.units=10,n.offsetState.factor=.8,this.surface={meshData:new h,materials:[n],transform:this.transform};var u=this;e.addListener("goo.setCurrentCamera",function(t){u.camera=t.camera}),e.addListener("goo.setLights",function(t){u.lights=t})}u.prototype=Object.create(t.prototype),u.prototype.inserted=function(){},u.prototype.deleted=function(){},u.prototype.process=function(){var t=this.renderList.length=0;this.doRender.surface&&(this.renderList[t++]=this.surface),this.doRender.grid&&(this.renderList[t++]=this.grid),this.renderList.length=t},u.prototype.render=function(t){t.checkResize(this.camera),this.camera&&t.render(this.renderList,this.camera,this.lights,null,{color:!1,depth:!1,stencil:!1})};var d={attributes:{vertexPosition:o.POSITION},uniforms:{viewMatrix:n.VIEW_MATRIX,projectionMatrix:n.PROJECTION_MATRIX,worldMatrix:n.WORLD_MATRIX,color:[.55,.55,.55,1],fogOn:!1,fogColor:[.1,.1,.1,1],fogNear:n.NEAR_PLANE,fogFar:n.FAR_PLANE},vshader:["attribute vec3 vertexPosition;","uniform mat4 worldMatrix;","uniform mat4 viewMatrix;","uniform mat4 projectionMatrix;","varying float depth;","void main(void)","{","vec4 viewPosition = viewMatrix * worldMatrix * vec4(vertexPosition, 1.0);","depth = viewPosition.z;","gl_Position = projectionMatrix * viewPosition;","}"].join("\n"),fshader:["precision mediump float;","uniform vec4 fogColor;","uniform vec4 color;","uniform float fogNear;","uniform float fogFar;","uniform bool fogOn;","varying float depth;","void main(void)","{","if (fogOn) {","float lerpVal = clamp(depth / (-fogFar + fogNear), 0.0, 1.0);","lerpVal = pow(lerpVal, 1.5);","gl_FragColor = mix(color, fogColor, lerpVal);","} else {","gl_FragColor = color;","}","}"].join("\n")};return u}),define("goo/entities/systems/LogicSystem",["goo/entities/systems/System","goo/entities/SystemBus","goo/renderer/Renderer","goo/logic/LogicLayer","goo/logic/LogicInterface"],function(t,e,i,o,r){"use strict";function n(){t.call(this,"LogicSystem",null),this.passive=!0,this._entities={}}return n.prototype=Object.create(t.prototype),n.prototype.inserted=function(t){this._entities[t.name]={entity:t,inserted:!1}},n.prototype.deleted=function(t){delete this._entities[t.name]},n.prototype.process=function(t,e){for(var i=0;i<t.length;i++){var o=t[i];void 0!==o.logicComponent&&o.logicComponent.process(e)}},n.prototype.resolveEntityRef=function(t){var e=this._entities[t];return void 0!==e?e.entity:void 0},n.prototype.getLayerByEntity=function(t){var e=this._entities[t];if(void 0===e)return e;var i=e.entity.logicComponent;return void 0===i?i:i.logicLayer},n.prototype.makeOutputWriteFn=function(t,e){var i=[];return this.forEachLogicObject(function(o){"LogicNodeEntityProxy"===o.type&&o.entityRef===t.name&&i.push([o.logicInstance,r.makePortDataName(e)])}),function(t){for(var e=0;e<i.length;e++)o.writeValue(i[e][0],i[e][1],t)}},n.prototype.forEachLogicObject=function(t){for(var e in this._entities){var i=this._entities[e].entity;void 0!==i.logicComponent&&i.logicComponent.logicLayer.forEachLogicObject(t)}},n.prototype.play=function(){this.passive=!1,this.forEachLogicObject(function(t){void 0!==t.onSystemStarted&&t.onSystemStarted()})},n.prototype.pause=function(){this.passive=!0,this.forEachLogicObject(function(t){void 0!==t.onSystemStopped&&t.onSystemStopped(!0)})},n.prototype.stop=function(){this.passive=!0,this.forEachLogicObject(function(t){void 0!==t.onSystemStopped&&t.onSystemStopped(!1)});for(var t in this._entities)this._entities[t].inserted=!1},n}),define("goo/entities/systems/PickingSystem",["goo/entities/systems/System"],function(t){"use strict";function e(e){t.call(this,"PickingSystem",["MeshRendererComponent","TransformComponent"]),this.passive=!0,this.pickRay=null,this.onPick=null,e=e||{},this.setPickLogic(e.pickLogic||null)}return e.prototype=Object.create(t.prototype),e.prototype.setPickLogic=function(t){this.pickLogic=t,t&&-1===this.interests.indexOf("MeshDataComponent")&&this.interests.push("MeshDataComponent")},e.prototype.inserted=function(t){t.meshRendererComponent.isPickable&&this.pickLogic&&this.pickLogic.added(t)},e.prototype.deleted=function(t){this.pickLogic&&this.pickLogic.removed(t)
},e.prototype.process=function(t){if(this.pickRay&&this.onPick){for(var e=[],i=0;i<t.length;i++){var o=t[i],r=o.meshRendererComponent;if(r.isPickable)if(this.pickLogic){this.pickLogic.isConstructed(o)||this.pickLogic.added(o);var n=this.pickLogic.getPickResult(this.pickRay,o);n&&n.distances&&n.distances.length&&e.push({entity:o,intersection:n})}else if(r.worldBound){var n=r.worldBound.intersectsRayWhere(this.pickRay);n&&n.distances.length&&e.push({entity:o,intersection:n})}}e.sort(function(t,e){return t.intersection.distances[0]-e.intersection.distances[0]}),this.onPick(e)}},e}),define("goo/entities/systems/PortalSystem",["goo/entities/systems/System"],function(t){"use strict";function e(e,i){t.call(this,"PortalSystem",["MeshRendererComponent","MeshDataComponent","PortalComponent"]),this.renderer=e,this.renderSystem=i,this.renderList=[]}return e.prototype=Object.create(t.prototype),e.prototype.process=function(t){for(var e=0;e<t.length;e++){var i=t[e],o=i.portalComponent;if(o.options.autoUpdate||o.doUpdate){o.doUpdate=!1;var r=o.camera,n=o.target,a=o.secondaryTarget,s=o.overrideMaterial;if(o.alwaysRender||i.isVisible){this.render(this.renderer,r,n,s);var c=i.meshRendererComponent.materials[0];if(c.setTexture("DIFFUSE_MAP",n),o.options.preciseRecursion){var l=n;o.target=a,o.secondaryTarget=l}}}}},e.prototype.render=function(t,e,i,o){t.updateShadows(this.renderSystem.partitioner,this.renderSystem.entities,this.renderSystem.lights);for(var r=0;r<this.renderSystem.preRenderers.length;r++){var n=this.renderSystem.preRenderers[r];n.process(t,this.renderSystem.entities,this.renderSystem.partitioner,e,this.renderSystem.lights)}if(this.renderSystem.partitioner.process(e,this.renderSystem.entities,this.renderList),this.renderSystem.composers.length>0)for(var r=0;r<this.renderSystem.composers.length;r++){var a=this.renderSystem.composers[r];a.render(t,this.renderSystem.currentTpf,e,this.renderSystem.lights,null,!0)}else t.render(this.renderList,e,this.renderSystem.lights,i,!0,o)},e}),define("goo/entities/systems/ProximitySystem",["goo/entities/systems/System","goo/entities/SystemBus"],function(t,e){"use strict";function i(){t.call(this,"ProximitySystem",["ProximityComponent"]),this.collections={Red:{name:"Red",collection:[]},Blue:{name:"Blue",collection:[]},Green:{name:"Green",collection:[]},Yellow:{name:"Yellow",collection:[]}}}return i.prototype=Object.create(t.prototype),i.prototype._collides=function(t,i){for(var o=0;o<t.collection.length;o++)for(var r=t.collection[o],n=0;n<i.collection.length;n++){var a=i.collection[n];r.meshRendererComponent.worldBound.intersects(a.meshRendererComponent.worldBound)&&e.send("collides."+t.name+"."+i.name)}},i.prototype.getFor=function(t){return this.collections[t]?this.collections[t].collection:[]},i.prototype.inserted=function(t){var e=t.proximityComponent.tag;this.collections[e]||(this.collections[e]={name:e,collection:[]}),this.collections[e].collection.push(t)},i.prototype.deleted=function(t){var e=this.collections[t.proximityComponent.tag].collection,i=e.indexOf(t);e.splice(i,1)},i.prototype.process=function(){},i}),define("goo/entities/systems/TextSystem",["goo/entities/systems/System","goo/shapes/TextureGrid","goo/entities/components/MeshDataComponent"],function(t,e,i){"use strict";function o(){t.call(this,"TextSystem",["TextComponent"])}return o.prototype=Object.create(t.prototype),o.prototype.process=function(t){for(var o=0;o<t.length;o++){var r=t[o],n=r.textComponent;if(n.dirty){if(r.hasComponent("MeshDataComponent"))r.getComponent("MeshDataComponent").meshData=e.fromString(n.text);else{var a=e.fromString(n.text),s=new i(a);r.setComponent(s)}this.dirty=!1}}},o}),define("goo/loaders/handlers/ConfigHandler",[],function(){"use strict";function t(t,e,i,o){this.world=t,this.getConfig=e,this.updateObject=i,this.options=o}return t.prototype.update=function(){},t.prototype.remove=function(){},t.handlerClasses={},t.getHandler=function(e){return t.handlerClasses[e]},t._registerClass=function(e,i){return i._type=e,t.handlerClasses[e]=i},t}),define("goo/loaders/handlers/ComponentHandler",[],function(){"use strict";function t(t,e,i,o){this.world=t,this.getConfig=e,this.updateObject=i,this.options=o}return t.prototype._prepare=function(){},t.prototype._create=function(){throw new Error("ComponentHandler._create is abstract, use ComponentHandler.getHandler(type)")},t.prototype.update=function(t,e){this._prepare(e);var i;return i=null==t||null==t[this.constructor._type+"Component"]?this._create(t,e):t[this.constructor._type+"Component"]},t.prototype.remove=function(t){return null!=t&&t.clearComponent(this.constructor._type+"Component"),t},t.handlerClasses={},t.getHandler=function(e){return t.handlerClasses[e]},t._registerClass=function(e,i){i._type=e,t.handlerClasses[e]=i},t}),define("goo/util/StringUtil",[],function(){"use strict";var t={};t.endsWith=function(t,e){return-1!==t.indexOf(e,t.length-e.length)},t.startsWith=function(t,e){return 0===t.indexOf(e)},t.capitalize=function(t){return t.charAt(0).toUpperCase()+t.substring(1)},t.uncapitalize=function(t){return t.charAt(0).toLowerCase()+t.substring(1)},t.getUntil=function(t,e){var i=t.indexOf(e);return-1===i?t:t.slice(0,i)},t.getFrom=function(t,e){var i=t.indexOf(e);return-1===i?"":t.slice(i+e.length,t.length)},t.getIndexedName=function(t,e,i){i||(i="_");var o,r=new RegExp(t+"("+i+"\\d+)?"),n=0;for(o in e){var a=e[o],s=r.exec(a);if(s)if(s.length>1&&s[1]){var c=parseInt(s[1].substring(i.length),10);c>=n&&(n=c+1)}else n=1}return t+i+n},t.getUniqueName=function(e,i,o){return-1===i.indexOf(e)?e:t.getIndexedName(e,i,o)},t.toAscii=function(t){return t.replace(/([^\x00-\x7F])/g,"x")},t.hashCode=function(t){var e=0;if(0===t.length)return e;for(var i=0;i<t.length;i++){var o=t.charCodeAt(i);e=(e<<5)-e+o,e&=e}return btoa(e).replace("/","_").replace("+","-")};var e=+new Date;return t.getUniqueId=function(){e++;var i=Array.prototype.slice.call(arguments,0).join("");return t.hashCode(e+""+i)},t}),define("goo/util/PromiseUtil",["goo/util/rsvp"],function(t){"use strict";var e={};return e.createDummyPromise=function(e,i){var o;return o=new t.Promise,i?o.reject(i):o.resolve(e),o},e.optimisticAll=function(e){var i=0,o=e.length,r={results:[],errors:[]},n=new t.Promise;if(o>0)for(var a=0;o>a;a++)e[a].then(function(t){r.results.push(t),i++,i===o&&n.resolve(r)},function(t){r.errors.push(t),i++,i===o&&n.resolve(r)});else n.resolve(r);return n},e.defer=function(e,i){var o,r,n;return n=new t.Promise,i.apply?(o=new t.Promise,r=o.then(function(){return i()}),setTimeout(function(){o.resolve()},e),r):(setTimeout(function(){n.resolve(i)},e),n)},e}),define("goo/util/ObjectUtil",[],function(){"use strict";var t={},e=Array.prototype,i=Object.prototype,o={},r=e.slice,n=i.toString,a=i.hasOwnProperty,s=Array.isArray,c=Object.keys,l=e.forEach;t.has=function(t,e){return a.call(t,e)},t.defaults=function(t){return h(r.call(arguments,1),function(e){if(e)for(var i in e)("undefined"==typeof t[i]||null===t[i])&&(t[i]=e[i])}),t},t.extend=function(t){return h(r.call(arguments,1),function(e){if(e)for(var i in e)t[i]=e[i]}),t},t.isObject=function(t){return t===Object(t)},t.clone=function(e){return t.isObject(e)?t.isArray(e)?e.slice():t.extend({},e):e},t.keys=c||function(e){if(e!==Object(e))throw new TypeError("Invalid object");var i=[];for(var o in e)t.has(e,o)&&(i[i.length]=o);return i},t.isArray=s||function(t){return"[object Array]"===n.call(t)};var h=t.each=t.forEach=function(e,i,r){if("undefined"!=typeof e&&null!==e)if(l&&e.forEach===l)e.forEach(i,r);else if(e.length===+e.length){for(var n=0,a=e.length;a>n;n++)if(i.call(r,e[n],n,e)===o)return}else for(var s in e)if(t.has(e,s)&&i.call(r,e[s],s,e)===o)return};return t.deepClone=function(e){if(!e)return e;var i,o=[Number,String,Boolean];if(o.forEach(function(t){e instanceof t&&(i=t(e))}),"undefined"==typeof i)if("[object Array]"===Object.prototype.toString.call(e))i=[],e.forEach(function(e,o){i[o]=t.deepClone(e)});else if("object"==typeof e)if(e.nodeType&&"function"==typeof e.cloneNode)var i=e.cloneNode(!0);else if(e.prototype)i=e;else if(e instanceof Date)i=new Date(e);else{i={};for(var r in e)i[r]=t.deepClone(e[r])}else i=e;return i},t.indexOf=function(t,e){for(var i=0;i<t.length;i++)if(i in t&&t[i]===e)return i;return-1},t}),define("goo/loaders/handlers/CameraComponentHandler",["goo/loaders/handlers/ComponentHandler","goo/entities/components/CameraComponent","goo/renderer/Camera","goo/util/rsvp","goo/util/PromiseUtil","goo/util/ObjectUtil"],function(t,e,i,o,r,n){"use strict";function a(){t.apply(this,arguments)}return a.prototype=Object.create(t.prototype),t._registerClass("camera",a),a.prototype.constructor=a,a.prototype._prepare=function(t){return n.defaults(t,{fov:45,near:1,far:1e4,projectionMode:0,size:100,aspect:1,lockedRatio:!1})},a.prototype._create=function(t){var o=new i(45,1,1,1e3),r=new e(o);return t.setComponent(r),r},a.prototype.update=function(e,i){var o=t.prototype.update.call(this,e,i);if(o.camera.setProjectionMode(i.projectionMode),o.camera.lockedRatio=i.lockedRatio||!1,0===i.projectionMode)o.camera.setFrustumPerspective(i.fov,i.aspect||1,i.near,i.far);else{var n=i.size;o.camera.setFrustum(i.near,i.far,-n,n,n,-n,i.aspect||1),o.camera.size=n}return r.createDummyPromise(o)},a.prototype.remove=function(e){return t.prototype.remove.call(this,e)},a}),define("goo/loaders/handlers/EntityHandler",["goo/loaders/handlers/ConfigHandler","goo/loaders/handlers/ComponentHandler","goo/util/rsvp","goo/util/StringUtil","goo/util/PromiseUtil","goo/util/ObjectUtil","goo/entities/EntityUtils"],function(t,e,i,o,r,n,a){"use strict";function s(){t.apply(this,arguments)}return s.prototype=Object.create(t.prototype),t._registerClass("entity",s),s.prototype._prepare=function(){},s.prototype._create=function(t){var e=this.world.createEntity(t);return e.ref=t,e},s.prototype._getHandler=function(t){if(this._componentHandlers||(this._componentHandlers={}),!this._componentHandlers[t]){var i=e.getHandler(t);i&&(this._componentHandlers[t]=new i(this.world,this.getConfig,this.updateObject,this.options))}return this._componentHandlers[t]},s.prototype.update=function(t,e,i){function n(e){return e.ref===t}var s=this.world.entityManager.getEntityByName(t);if(!s){var c=this.world._addedEntities.filter(n);c&&(s=c[0])}s||(s=this._create(t));var l=[];for(var h in e.components){var u=e.components[h],d=this._getHandler(h);if(d){var p=d.update(s,u,i);p&&p.then?l.push(p):console.error("Handler for "+h+" did not return promise")}else console.warn("No componentHandler for "+h)}return s._components.forEach(function(t){var r=t.type;r=r.slice(0,r.lastIndexOf("Component")),r=o.uncapitalize(r),"howler"===r&&(r="sound"),e.components[r]||(d=this._getHandler(r),d?d.remove(s,i):console.warn("No componentHandler for "+r))}.bind(this)),l.length?r.optimisticAll(l).then(function(){return e.hidden?a.hide(s):a.show(s),s}):(console.error("No promises in "+t+" ",e),r.createDummyPromise(s))},s.prototype.remove=function(t){var e=this.world.entityManager.getEntityByName(t);"object"==typeof e&&this.world.removeEntity(e)},s}),define("goo/loaders/handlers/LightComponentHandler",["goo/loaders/handlers/ComponentHandler","goo/entities/components/LightComponent","goo/renderer/light/PointLight","goo/renderer/light/SpotLight","goo/renderer/light/DirectionalLight","goo/math/Vector","goo/util/rsvp","goo/util/PromiseUtil","goo/util/ObjectUtil"],function(t,e,i,o,r,n,a,s,c){"use strict";function l(){t.apply(this,arguments)}return l.prototype=Object.create(t.prototype),l.prototype.constructor=l,t._registerClass("light",l),l.prototype._prepare=function(t){c.defaults(t,{direction:[0,0,0],color:[1,1,1,1],attenuate:!0,shadowCaster:!1,lightCookie:null}),"DirectionalLight"!==t.type&&(t.range=void 0!==t.range?t.range:1e3),t.shadowCaster&&(t.shadowSettings=t.shadowSettings||{},c.defaults(t.shadowSettings,{type:"Blur",projection:"DirectionalLight"===t.type?"Parallel":"Perspective",fov:55,size:400,near:1,far:1e3,resolution:[512,512],upVector:[0,1,0],darkness:.5}))},l.prototype._create=function(t,n){var a;switch(n.type){case"SpotLight":a=new o;break;case"DirectionalLight":a=new r;break;default:a=new i}var s=new e(a);return t.setComponent(s),s},l.prototype.update=function(e,i){var o=t.prototype.update.call(this,e,i),r=o.light;for(var a in i){var l=i[a];if(r.hasOwnProperty(a))if("shadowSettings"===a)for(var a in l){var h=l[a];r.shadowSettings[a]instanceof n?r.shadowSettings[a].set(h):r.shadowSettings[a]=c.clone(h)}else r[a]instanceof n?r[a].set(l):r[a]=c.clone(l)}var u=this,d=function(t,e){return u.getConfig(e).then(function(i){return u.updateObject(e,i,u.options).then(function(i){return{type:t,ref:e,texture:i}})})};if(i.lightCookie){var p,f=i.lightCookie;"string"==typeof f?p=d("cookie",f):f&&f.enabled&&(p=d("cookie",f.textureRef)),p&&p.then(function(t){r.lightCookie=t.texture?t.texture:null}).then(null,function(t){console.error("Error loading texture: "+t)})}return s.createDummyPromise(o)},l}),define("goo/logic/LogicNode",[],function(){"use strict";function t(){Object.defineProperty(this,"id",{value:t._instanceCount++,writable:!1}),this.config={ref:"unconf-"+this.id},this.name=void 0!==name?name:"Logic_"+this.id,this.logicInstance=null,this.wantsProcessCall=!1}return t.prototype.addToLogicLayer=function(t,e){if(null!==this.logicInstance&&this.logicInstance.remove(),this.logicInstance=t.addInterfaceInstance(this.logicInterface,this,e,this.wantsProcessCall),void 0!==this.connections){for(var i=0;i<this.connections.length;i++){var o=this.connections[i];t.addConnectionByName(this.logicInstance,o.sourcePort,o.targetRef,o.targetPort)}delete this.connections}},t.prototype.configure=function(t){var e=void 0!==t.config?t.config:{};this.onConfigure(e),this.config=e,this.connections=t.connections},t.prototype.onConfigure=function(){},t.prototype.onSystemStarted=function(){},t.prototype.onSystemStopped=function(){},t.prototype.onInputChanged=function(){},t._instanceCount=0,t}),define("goo/logic/LogicNodeEntityProxy",["goo/logic/LogicLayer","goo/logic/LogicNode","goo/logic/LogicNodes","goo/logic/LogicInterface"],function(t,e,i,o){"use strict";function r(){e.call(this),this.logicInterface=r.logicInterface,this.type="LogicNodeEntityProxy"}return r.prototype=Object.create(e.prototype),r.editorName="EntityProxy",r.prototype.onConfigure=function(t){this.entityRef=t.entityRef},r.logicInterface=new o("Component Proxy"),r.logicInterface.addConfigEntry({name:"entityRef",type:"entityRef",label:"Entity"}),i.registerType("LogicNodeEntityProxy",r),r}),define("goo/logic/LogicNodeTransformComponent",["goo/logic/LogicLayer","goo/logic/LogicNode","goo/logic/LogicNodes","goo/logic/LogicInterface","goo/entities/components/TransformComponent","goo/math/Vector3","goo/math/Matrix3x3"],function(t,e,i,o,r,n,a){"use strict";function s(){e.call(this),this.logicInterface=s.logicInterface,this.type="TransformComponent"}return s.prototype=Object.create(e.prototype),s.editorName="TransformComponent",s.prototype.onConfigure=function(t){this.entityRef=t.entityRef},s.prototype.onInputChanged=function(e,i,o){var r=t.resolveEntityRef(e,this.entityRef),n=r.transformComponent;i===s.inportPos?n.setTranslation(o):i===s.inportRot?n.setRotation(o[0],o[1],o[2]):i===s.inportScale&&n.setScale(o),t.writeValue(this.logicInstance,s.outportPos,r.transformComponent.transform.translation.clone()),t.writeValue(this.logicInstance,s.outportRot,r.transformComponent.transform.rotation.clone())},s.logicInterface=new o("Transform"),s.inportPos=s.logicInterface.addInputProperty("position","Vector3",new n(0,0,0)),s.inportRot=s.logicInterface.addInputProperty("rotation","Vector3",new n(0,0,0)),s.inportScale=s.logicInterface.addInputProperty("scale","Vector3",new n(1,1,1)),s.outportPos=s.logicInterface.addOutputProperty("outpos","Vector3",new n),s.outportRot=s.logicInterface.addOutputProperty("rotmat","Matrix3",new a),s.logicInterface.addConfigEntry({name:"entityRef",type:"entityRef",label:"Entity"}),i.registerType("TransformComponent",s),s}),define("goo/logic/LogicNodeMeshRendererComponent",["goo/logic/LogicLayer","goo/logic/LogicNode","goo/logic/LogicNodes","goo/logic/LogicInterface","goo/entities/components/MeshRendererComponent","goo/math/Vector3"],function(t,e,i,o,r,n){"use strict";function a(){e.call(this),this.logicInterface=a.logicInterface,this.type="MeshRendererComponent"}return a.prototype=Object.create(e.prototype),a.editorName="MeshRendererComponent",a.prototype.onConfigure=function(t){this.entityRef=t.entityRef},a.prototype.onInputChanged=function(e,i,o){var r=t.resolveEntityRef(e,this.entityRef),n=r.meshRendererComponent;i===a.inportAmbient&&n.materials.length>0&&(n.meshRendererComponent.materials[0].uniforms.materialAmbient[0]=o[0],n.materials[0].uniforms.materialAmbient[1]=o[1],n.materials[0].uniforms.materialAmbient[2]=o[2])},a.prototype.onEvent=function(e,i){var o=t.resolveEntityRef(e,this.entityRef),r=o.meshRendererComponent;i===a.inportShadows?r.castShadows=!r.castShadows:i===a.inportHidden&&(r.hidden=!r.hidden)},a.logicInterface=new o("Material"),a.inportShadows=a.logicInterface.addInputEvent("toggle-shadows"),a.inportHidden=a.logicInterface.addInputEvent("toggle-hidden"),a.inportAmbient=a.logicInterface.addInputProperty("ambient","Vector3",new n(.5,0,0)),a.logicInterface.addConfigEntry({name:"entityRef",type:"entityRef",label:"Entity"}),i.registerType("MeshRendererComponent",a),a}),define("goo/logic/LogicNodeLightComponent",["goo/logic/LogicLayer","goo/logic/LogicNode","goo/logic/LogicNodes","goo/logic/LogicInterface"],function(t,e,i,o){"use strict";function r(){e.call(this),this.logicInterface=r.logicInterface,this.type="LightComponent"}return r.prototype=Object.create(e.prototype),r.editorName="LightComponent",r.prototype.onConfigure=function(t){this.entityRef=t.entityRef},r.logicInterface=new o("LightComponent"),r.inportIntensity=r.logicInterface.addInputProperty("Intensity","float"),r.inportRange=r.logicInterface.addInputProperty("Range","float"),r.prototype.onInputChanged=function(e,i,o){var n=t.resolveEntityRef(e,this.entityRef);i===r.inportIntensity?n.lightComponent.light.intensity=o:i===r.inportRange&&(n.lightComponent.light.range=o)},r.logicInterface.addConfigEntry({name:"entityRef",type:"entityRef",label:"Entity"}),i.registerType("LightComponent",r),r}),define("goo/logic/LogicNodeDebug",["goo/logic/LogicLayer","goo/logic/LogicNode","goo/logic/LogicNodes","goo/logic/LogicInterface"],function(t,e,i,o){"use strict";function r(){e.call(this),this.logicInterface=r.logicInterface,this.type="LogicNodeDebug",this._time=0}return r.prototype=Object.create(e.prototype),r.editorName="Debug",r.prototype.onInputChanged=function(t,e,i){console.log("LogicNodeDebug ("+this.logicInstance.name+") value port "+e+" = ["+i+"]")},r.prototype.onEvent=function(t,e){console.log("LogicNodeDebug ("+this.logicInstance.name+") event on port "+e)},r.logicInterface=new o,r.inportEvent=r.logicInterface.addInputEvent("Event"),r.inportFloat=r.logicInterface.addInputProperty("FloatValue","float",0),i.registerType("LogicNodeDebug",r),r}),define("goo/logic/LogicNodeRandom",["goo/logic/LogicLayer","goo/logic/LogicNode","goo/logic/LogicInterface","goo/logic/LogicNodes"],function(t,e,i,o){"use strict";function r(){e.call(this),this.wantsProcessCall=!0,this.logicInterface=r.logicInterface,this.type="LogicNodeRandom"}return r.prototype=Object.create(e.prototype),r.editorName="Random",r.logicInterface=new i,r.outPropRandom=r.logicInterface.addOutputProperty("Random0_1","float"),r.prototype.processLogic=function(){t.writeValue(this.logicInstance,r.outPropRandom,Math.random())},o.registerType("LogicNodeRandom",r),r}),define("goo/logic/LogicNodeTime",["goo/logic/LogicLayer","goo/logic/LogicNode","goo/logic/LogicInterface","goo/logic/LogicNodes"],function(t,e,i,o){"use strict";function r(){e.call(this),this.wantsProcessCall=!0,this.logicInterface=r.logicInterface,this.type="LogicNodeTime",this._time=0,this._running=!0}return r.prototype=Object.create(e.prototype),r.editorName="Time",r.logicInterface=new i,r.outPropTime=r.logicInterface.addOutputProperty("Time","float"),r.outEventReached1=r.logicInterface.addOutputEvent(">1"),r.inEventStart=r.logicInterface.addInputEvent("Start"),r.inEventStop=r.logicInterface.addInputEvent("Stop"),r.inEventReset=r.logicInterface.addInputEvent("Reset"),r.prototype.onConfigure=function(){this._time=0,this._running=!0},r.prototype.processLogic=function(e){if(this._running){var i=this._time;this._time+=e,t.writeValue(this.logicInstance,r.outPropTime,this._time),1>i&&this._time>=1&&t.fireEvent(this.logicInstance,r.outEventReached1)}},r.prototype.onEvent=function(e,i){i===r.inEventStart?this._running=!0:i===r.inEventStop?this._running=!1:i===r.inEventReset&&(this._time=0,t.writeValue(this.logicInstance,r.outPropTime,0))},o.registerType("LogicNodeTime",r),r}),define("goo/logic/LogicNodeSine",["goo/logic/LogicLayer","goo/logic/LogicNode","goo/logic/LogicNodes","goo/logic/LogicInterface"],function(t,e,i,o){"use strict";function r(){e.call(this),this.logicInterface=r.logicInterface,this.type="LogicNodeSine",this._time=0}return r.prototype=Object.create(e.prototype),r.editorName="Sine",r.prototype.onInputChanged=function(e,i,o){t.writeValue(this.logicInstance,r.outportSin,Math.sin(o)),t.writeValue(this.logicInstance,r.outportCos,Math.cos(o))},r.logicInterface=new o,r.outportSin=r.logicInterface.addOutputProperty("Sine","float"),r.outportCos=r.logicInterface.addOutputProperty("Cosine","float"),r.inportPhase=r.logicInterface.addInputProperty("Phase","float",0),i.registerType("LogicNodeSine",r),r}),define("goo/logic/LogicNodeVec3",["goo/logic/LogicLayer","goo/logic/LogicNode","goo/logic/LogicNodes","goo/logic/LogicInterface","goo/math/Vector3"],function(t,e,i,o,r){"use strict";function n(){e.call(this),this.logicInterface=n.logicInterface,this.type="LogicNodeVec3",this._x=this._y=this._z=0}return n.prototype=Object.create(e.prototype),n.editorName="Vec3",n.prototype.onInputChanged=function(e){var i=t.readPort(e,n.inportX),o=t.readPort(e,n.inportY),a=t.readPort(e,n.inportZ),s=t.readPort(e,n.inportVec3);null!==s&&(i=s.x,o=s.y,a=s.z),t.writeValue(this.logicInstance,n.outportVec3,new r(i,o,a)),t.writeValue(this.logicInstance,n.outportX,i),t.writeValue(this.logicInstance,n.outportY,o),t.writeValue(this.logicInstance,n.outportZ,a)},n.logicInterface=new o,n.outportVec3=n.logicInterface.addOutputProperty("xyz","Vector3"),n.inportVec3=n.logicInterface.addInputProperty("xyz","Vector3",null),n.inportX=n.logicInterface.addInputProperty("x","float",0),n.inportY=n.logicInterface.addInputProperty("y","float",0),n.inportZ=n.logicInterface.addInputProperty("z","float",0),n.outportX=n.logicInterface.addOutputProperty("x","float",0),n.outportY=n.logicInterface.addOutputProperty("y","float",0),n.outportZ=n.logicInterface.addOutputProperty("z","float",0),i.registerType("LogicNodeVec3",n),n}),define("goo/logic/LogicNodeMultiply",["goo/logic/LogicLayer","goo/logic/LogicNode","goo/logic/LogicNodes","goo/logic/LogicInterface"],function(t,e,i,o){"use strict";function r(){e.call(this),this.logicInterface=r.logicInterface,this.type="LogicNodeMultiply",this._x=this._y=0}return r.prototype=Object.create(e.prototype),r.editorName="Multiply",r.prototype.onInputChanged=function(e){var i=t.readPort(e,r.inportX),o=t.readPort(e,r.inportY);t.writeValue(e,r.outportProduct,i*o)},r.logicInterface=new o,r.outportProduct=r.logicInterface.addOutputProperty("product","float"),r.inportX=r.logicInterface.addInputProperty("x","float",0),r.inportY=r.logicInterface.addInputProperty("y","float",0),i.registerType("LogicNodeMultiply",r),r}),define("goo/logic/LogicNodeWASD",["goo/logic/LogicLayer","goo/logic/LogicNode","goo/logic/LogicNodes","goo/logic/LogicInterface"],function(t,e,i,o){"use strict";function r(){e.call(this),this.logicInterface=r.logicInterface,this.type="LogicNodeWASD";var i={};this.eventListenerDown=function(e){var o=String.fromCharCode(e.which).toLowerCase();if(!i[o]){var n=r.downKeys[o];n&&(i[o]=!0,t.fireEvent(this.logicInstance,n))}}.bind(this),this.eventListenerUp=function(e){var o=String.fromCharCode(e.which).toLowerCase();i[o]&&(i[o]=!1);var n=r.upKeys[o];n&&t.fireEvent(this.logicInstance,n)}.bind(this)}return r.prototype=Object.create(e.prototype),r.editorName="WASD",r.prototype.onSystemStarted=function(){document.addEventListener("keydown",this.eventListenerDown),document.addEventListener("keyup",this.eventListenerUp)},r.prototype.onSystemStopped=function(){document.removeEventListener("keydown",this.eventListenerDown),document.removeEventListener("keyup",this.eventListenerUp)},r.logicInterface=new o,r.downKeys={w:r.logicInterface.addOutputEvent("W-down"),a:r.logicInterface.addOutputEvent("A-down"),s:r.logicInterface.addOutputEvent("S-down"),d:r.logicInterface.addOutputEvent("D-down")},r.upKeys={w:r.logicInterface.addOutputEvent("W-up"),a:r.logicInterface.addOutputEvent("A-up"),s:r.logicInterface.addOutputEvent("S-up"),d:r.logicInterface.addOutputEvent("D-up")},i.registerType("LogicNodeWASD",r),r}),define("goo/logic/LogicNodeWASD2",["goo/logic/LogicLayer","goo/logic/LogicNode","goo/logic/LogicNodes","goo/logic/LogicInterface"],function(t,e,i,o){"use strict";function r(){e.call(this),this.logicInterface=r.logicInterface,this.type="LogicNodeWASD2";var i={};this.eventListenerDown=function(e){var o=String.fromCharCode(e.which).toLowerCase();if(!i[o]){var n=r.downKeys[o];n&&(i[o]=!0,t.writeValue(this.logicInstance,n.port,n.value))}}.bind(this),this.eventListenerUp=function(e){var o=String.fromCharCode(e.which).toLowerCase();i[o]&&(i[o]=!1);var n=r.downKeys[o];n&&t.writeValue(this.logicInstance,n.port,0)}.bind(this)}return r.prototype=Object.create(e.prototype),r.editorName="WASD2",r.prototype.onSystemStarted=function(){document.addEventListener("keydown",this.eventListenerDown),document.addEventListener("keyup",this.eventListenerUp)},r.prototype.onSystemStopped=function(){document.removeEventListener("keydown",this.eventListenerDown),document.removeEventListener("keyup",this.eventListenerUp)},r.logicInterface=new o,r.downKeys={w:{port:r.logicInterface.addOutputProperty("W","float",0),value:1},a:{port:r.logicInterface.addOutputProperty("A","float",0),value:1},s:{port:r.logicInterface.addOutputProperty("S","float",0),value:-1},d:{port:r.logicInterface.addOutputProperty("D","float",0),value:-1}},i.registerType("LogicNodeWASD2",r),r}),define("goo/logic/LogicNodeMouse",["goo/logic/LogicLayer","goo/logic/LogicNode","goo/logic/LogicNodes","goo/logic/LogicInterface"],function(t,e,i,o){"use strict";function r(){e.call(this),this.logicInterface=r.logicInterface,this.type="LogicNodeMouse",this.eventMouseMove=function(e){var i=e.clientX,o=e.clientY,n=i-this.x,a=o-this.y;t.writeValue(this.logicInstance,r.portX,i),t.writeValue(this.logicInstance,r.portY,o),t.writeValue(this.logicInstance,r.portDX,n),t.writeValue(this.logicInstance,r.portDY,a)}.bind(this),this.eventMouseDown=function(e){0===e.button&&t.fireEvent(this.logicInstance,r.outEventLmb),2===e.button&&t.fireEvent(this.logicInstance,r.outEventRmb)}.bind(this)}return r.prototype=Object.create(e.prototype),r.editorName="Mouse",r.prototype.onSystemStarted=function(){this.x=0,this.y=0,document.addEventListener("mousemove",this.eventMouseMove,!1),document.addEventListener("mousedown",this.eventMouseDown,!1)},r.prototype.onSystemStopped=function(){document.removeEventListener("mousemove",this.eventMouseMove),document.removeEventListener("mousedown",this.eventMouseDown)},r.logicInterface=new o,r.portX=r.logicInterface.addOutputProperty("x","float",0),r.portY=r.logicInterface.addOutputProperty("y","float",0),r.portDX=r.logicInterface.addOutputProperty("dx","float",0),r.portDY=r.logicInterface.addOutputProperty("dy","float",0),r.outEventLmb=r.logicInterface.addOutputEvent("lmb"),r.outEventRmb=r.logicInterface.addOutputEvent("rmb"),i.registerType("LogicNodeMouse",r),r}),define("goo/logic/LogicNodeAdd",["goo/logic/LogicLayer","goo/logic/LogicNode","goo/logic/LogicNodes","goo/logic/LogicInterface"],function(t,e,i,o){"use strict";function r(){e.call(this),this.logicInterface=r.logicInterface,this.type="LogicNodeAdd"}return r.prototype=Object.create(e.prototype),r.editorName="Add",r.prototype.onInputChanged=function(e){var i=t.readPort(e,r.inportX)+t.readPort(e,r.inportY);t.writeValue(this.logicInstance,r.outportSum,i)},r.logicInterface=new o,r.outportSum=r.logicInterface.addOutputProperty("sum","float"),r.inportX=r.logicInterface.addInputProperty("x","float",0),r.inportY=r.logicInterface.addInputProperty("y","float",0),i.registerType("LogicNodeAdd",r),r}),define("goo/logic/LogicNodeSub",["goo/logic/LogicLayer","goo/logic/LogicNode","goo/logic/LogicNodes","goo/logic/LogicInterface"],function(t,e,i,o){"use strict";function r(){e.call(this),this.logicInterface=r.logicInterface,this.type="LogicNodeSub"}return r.prototype=Object.create(e.prototype),r.editorName="Sub",r.prototype.onInputChanged=function(e){var i=t.readPort(e,r.inportX)-t.readPort(e,r.inportY);t.writeValue(this.logicInstance,r.outportSum,i)},r.logicInterface=new o,r.outportSum=r.logicInterface.addOutputProperty("sum","float"),r.inportX=r.logicInterface.addInputProperty("x","float",0),r.inportY=r.logicInterface.addInputProperty("y","float",0),i.registerType("LogicNodeSub",r),r}),define("goo/logic/LogicNodeFloat",["goo/logic/LogicLayer","goo/logic/LogicNode","goo/logic/LogicNodes","goo/logic/LogicInterface"],function(t,e,i,o){"use strict";function r(){e.call(this),this.logicInterface=r.logicInterface,this.type="LogicNodeFloat"}return r.prototype=Object.create(e.prototype),r.editorName="Float",r.prototype.onConfigure=function(e){void 0!==e.value&&(this.value=e.value,t.writeValue(this.logicInstance,r.outportFloat,this.value))},r.prototype.onSystemStarted=function(){t.writeValue(this.logicInstance,r.outportFloat,this.value)},i.registerType("LogicNodeFloat",r),r.logicInterface=new o,r.outportFloat=r.logicInterface.addOutputProperty("value","float"),r.logicInterface.addConfigEntry({name:"value",type:"float",label:"Value"}),r}),define("goo/logic/LogicNodeApplyMatrix",["goo/logic/LogicLayer","goo/logic/LogicNode","goo/logic/LogicNodes","goo/logic/LogicInterface","goo/math/Vector3","goo/math/Matrix3x3"],function(t,e,i,o,r,n){"use strict";function a(){e.call(this),this.logicInterface=a.logicInterface,this.type="LogicNodeApplyMatrix",this.vec=new r}return a.prototype=Object.create(e.prototype),a.editorName="ApplyMatrix",a.prototype.onInputChanged=function(e){var i=t.readPort(e,a.inportX),o=t.readPort(e,a.inportY);this.vec.copy(i),o.applyPost(this.vec),t.writeValue(this.logicInstance,a.outportProduct,this.vec)},a.logicInterface=new o,a.outportProduct=a.logicInterface.addOutputProperty("product","Vector3"),a.inportX=a.logicInterface.addInputProperty("vec","Vector3",new r),a.inportY=a.logicInterface.addInputProperty("mat","Matrix3",new n),i.registerType("LogicNodeApplyMatrix",a),a}),define("goo/logic/LogicNodeConstVec3",["goo/logic/LogicLayer","goo/logic/LogicNode","goo/logic/LogicNodes","goo/logic/LogicInterface","goo/math/Vector3"],function(t,e,i,o,r){"use strict";function n(){e.call(this),this.logicInterface=n.logicInterface,this.type="LogicNodeConstVec3"}return n.prototype=Object.create(e.prototype),n.editorName="ConstVec3",n.prototype.onConfigure=function(e){void 0!==e.value&&(this.value=e.value,t.writeValue(this.logicInstance,n.outportVec,new r(this.x,this.y,this.z)))},n.prototype.onSystemStarted=function(){t.writeValue(this.logicInstance,n.outportVec,new r(this.x,this.y,this.z))},i.registerType("LogicNodeConstVec3",n),n.logicInterface=new o,n.outportVec=n.logicInterface.addOutputProperty("xyz","Vector3"),n.logicInterface.addConfigEntry({name:"x",type:"float",label:"X"}),n.logicInterface.addConfigEntry({name:"y",type:"float",label:"Y"}),n.logicInterface.addConfigEntry({name:"z",type:"float",label:"Z"}),n}),define("goo/logic/LogicNodeVec3Add",["goo/logic/LogicLayer","goo/logic/LogicNode","goo/logic/LogicNodes","goo/logic/LogicInterface","goo/math/Vector3"],function(t,e,i,o,r){"use strict";function n(){e.call(this),this.logicInterface=n.logicInterface,this.type="LogicNodeVec3Add"
}return n.prototype=Object.create(e.prototype),n.editorName="AddVec3",n.prototype.onInputChanged=function(e){var i=t.readPort(e,n.inportX),o=t.readPort(e,n.inportY),a=new r;a.copy(i).add(o),t.writeValue(this.logicInstance,n.outportSum,a)},n.logicInterface=new o,n.outportSum=n.logicInterface.addOutputProperty("sum","Vector3"),n.inportX=n.logicInterface.addInputProperty("vec1","Vector3",new r),n.inportY=n.logicInterface.addInputProperty("vec2","Vector3",new r),i.registerType("LogicNodeVec3Add",n),n}),define("goo/logic/LogicNodeRotationMatrix",["goo/logic/LogicLayer","goo/logic/LogicNode","goo/logic/LogicNodes","goo/logic/LogicInterface","goo/math/Vector3","goo/math/Matrix3x3"],function(t,e,i,o,r,n){"use strict";function a(){e.call(this),this.logicInterface=a.logicInterface,this.type="LogicNodeRotationMatrix",this.vec=new r}return a.prototype=Object.create(e.prototype),a.editorName="RotationMatrix",a.prototype.onInputChanged=function(e){var i=t.readPort(e,a.inportX),o=new n;o.fromAngles(i.x,i.y,i.z),t.writeValue(e,a.outportProduct,o)},a.logicInterface=new o,a.inportX=a.logicInterface.addInputProperty("vec","Vector3",new r),a.outportProduct=a.logicInterface.addOutputProperty("mat","Matrix3",new n),i.registerType("LogicNodeRotationMatrix",a),a}),define("goo/logic/LogicNodeMultiplyFloat",["goo/logic/LogicLayer","goo/logic/LogicNode","goo/logic/LogicNodes","goo/logic/LogicInterface"],function(t,e,i,o){"use strict";function r(){e.call(this),this.logicInterface=r.logicInterface,this.type="LogicNodeMultiplyFloat",this._x=this._y=0}return r.prototype=Object.create(e.prototype),r.editorName="MultiplyFloat",r.prototype.onConfigure=function(t){void 0!==t.value&&(this.value=t.value)},r.prototype.onInputChanged=function(e){var i=t.readPort(e,r.inportX),o=this.value;t.writeValue(e,r.outportProduct,i*o)},r.logicInterface=new o,r.outportProduct=r.logicInterface.addOutputProperty("product","float"),r.inportX=r.logicInterface.addInputProperty("x","float",0),r.logicInterface.addConfigEntry({name:"value",type:"float",label:"Value"}),i.registerType("LogicNodeMultiplyFloat",r),r}),define("goo/logic/LogicNodeMax",["goo/logic/LogicLayer","goo/logic/LogicNode","goo/logic/LogicNodes","goo/logic/LogicInterface"],function(t,e,i,o){"use strict";function r(){e.call(this),this.logicInterface=r.logicInterface,this.type="LogicNodeMax"}return r.prototype=Object.create(e.prototype),r.editorName="Max",r.prototype.onInputChanged=function(e){var i=t.readPort(e,r.inportX),o=t.readPort(e,r.inportY),n=Math.max(i,o);t.writeValue(e,r.outportSum,n)},r.logicInterface=new o,r.outportSum=r.logicInterface.addOutputProperty("max","float"),r.inportX=r.logicInterface.addInputProperty("x","float",0),r.inportY=r.logicInterface.addInputProperty("y","float",0),i.registerType("LogicNodeMax",r),r}),define("goo/logic/LogicNodeInt",["goo/logic/LogicLayer","goo/logic/LogicNode","goo/logic/LogicNodes","goo/logic/LogicInterface"],function(t,e,i,o){"use strict";function r(){e.call(this),this.logicInterface=r.logicInterface,this.type="LogicNodeInt",this.defValue=0,this.value=0}return r.prototype=Object.create(e.prototype),r.editorName="Int",r.prototype.onConfigure=function(t){void 0!==t.value&&(this.defValue=t.value),this.value=this.defValue},r.prototype.onConnected=function(e){t.writeValue(e,r.outportInt,this.value)},r.prototype.onEvent=function(e,i){this.value=i===r.ineventIncrease?this.value+1:i===r.ineventDecrease?this.value-1:this.defValue,t.writeValue(this.logicInstance,r.outportInt,this.value)},r.prototype.onSystemStarted=function(){t.writeValue(this.logicInstance,r.outportInt,this.value)},r.prototype.onSystemStopped=function(){},i.registerType("LogicNodeInt",r),r.logicInterface=new o,r.ineventReset=r.logicInterface.addInputEvent("reset"),r.ineventIncrease=r.logicInterface.addInputEvent("increase"),r.ineventDecrease=r.logicInterface.addInputEvent("decrease"),r.outportInt=r.logicInterface.addOutputProperty("value","int"),r.logicInterface.addConfigEntry({name:"value",type:"int",label:"Value"}),r}),define("goo/logic/LogicNodeInput",["goo/logic/LogicLayer","goo/logic/LogicNode","goo/logic/LogicNodes","goo/logic/LogicInterface"],function(t,e,i,o){"use strict";function r(){e.call(this),this.logicInterface=r.logicInterface,this.type="LogicNodeInput",this.dummyInport=null}return r.prototype=Object.create(e.prototype),r.editorName="Input",r.prototype.onConfigure=function(t){this.dummyInport=o.createDynamicInput(t.Name)},r.prototype.onInputChanged=function(e,i,o){t.writeValue(this.logicInstance,r.outportInput,o)},i.registerType("LogicNodeInput",r),r.logicInterface=new o,r.outportInput=r.logicInterface.addOutputProperty("Input","any"),r.logicInterface.addConfigEntry({name:"Name",type:"string",label:"Name"}),r}),define("goo/logic/LogicNodeOutput",["goo/logic/LogicLayer","goo/logic/LogicNode","goo/logic/LogicNodes","goo/logic/LogicInterface"],function(t,e,i,o){"use strict";function r(){e.call(this),this.logicInterface=r.logicInterface,this.type="LogicNodeOutput",this.realOutport=null}return r.prototype=Object.create(e.prototype),r.editorName="Output",r.prototype.onInputChanged=function(e,i,o){t.writeValueToLayerOutput(e,this.realOutport,o)},r.prototype.onEvent=function(){},e.prototype.onConfigure=function(t){this.realOutport=o.createDynamicOutput(t.Name)},i.registerType("LogicNodeOutput",r),r.logicInterface=new o,r.inportOutput=r.logicInterface.addInputProperty("Output","any"),r.logicInterface.addConfigEntry({name:"Name",type:"string",label:"Name"}),r}),define("goo/loaders/handlers/LogicComponentHandler",["goo/loaders/handlers/ComponentHandler","goo/entities/components/LogicComponent","goo/util/rsvp","goo/util/PromiseUtil","goo/logic/LogicNodeEntityProxy","goo/logic/LogicNodeTransformComponent","goo/logic/LogicNodeMeshRendererComponent","goo/logic/LogicNodeLightComponent","goo/logic/LogicNodeDebug","goo/logic/LogicNodeRandom","goo/logic/LogicNodeTime","goo/logic/LogicNodeSine","goo/logic/LogicNodeVec3","goo/logic/LogicNodeMultiply","goo/logic/LogicNodeWASD","goo/logic/LogicNodeWASD2","goo/logic/LogicNodeMouse","goo/logic/LogicNodeAdd","goo/logic/LogicNodeSub","goo/logic/LogicNodeFloat","goo/logic/LogicNodeApplyMatrix","goo/logic/LogicNodeConstVec3","goo/logic/LogicNodeVec3Add","goo/logic/LogicNodeRotationMatrix","goo/logic/LogicNodeMultiplyFloat","goo/logic/LogicNodeMax","goo/logic/LogicNodeInt","goo/logic/LogicNodeInput","goo/logic/LogicNodeOutput"],function(t,e,i,o){"use strict";function r(){t.apply(this,arguments)}return r.prototype=Object.create(t.prototype),r.prototype.constructor=r,t._registerClass("logic",r),r.prototype._create=function(t,i){var o=new e(t);return o.configure(i),t.setComponent(o),o},r.prototype.update=function(e,i){var r=t.prototype.update.call(this,e,i);return r.configure(i),o.createDummyPromise(r)},r}),define("goo/loaders/handlers/MaterialHandler",["goo/loaders/handlers/ConfigHandler","goo/renderer/Material","goo/renderer/Util","goo/renderer/shaders/ShaderLib","goo/util/rsvp","goo/util/PromiseUtil","goo/util/ObjectUtil"],function(t,e,i,o,r,n,a){"use strict";function s(){t.apply(this,arguments),this._objects={}}return s.prototype=Object.create(t.prototype),t._registerClass("material",s),s.ENGINE_SHADER_PREFIX="GOO_ENGINE_SHADERS/",s.prototype._prepare=function(t){t.blendState||(t.blendState={}),a.defaults(t.blendState,{blending:"NoBlending",blendEquation:"AddEquation",blendSrc:"SrcAlphaFactor",blendDst:"OneMinusSrcAlphaFactor"}),t.cullState||(t.cullState={}),a.defaults(t.cullState,{enabled:!0,cullFace:"Back",frontFace:"CCW"}),t.depthState||(t.depthState={}),a.defaults(t.depthState,{enabled:!0,write:!0}),null==t.renderQueue&&(t.renderQueue=-1)},s.prototype._create=function(t){return this._objects||(this._objects={}),this._objects[t]=new e(t)},s.prototype.update=function(t,e){var o=this,n=this._objects[t]||this._create(t);return this._prepare(e),this._getShaderObject(e.shaderRef,e.wireframe).then(function(s){if(!s)return console.warn("Unknown shader",e.shaderRef,"- not updating material",t),void 0;e.wireframe&&(n.wireframe=e.wireframe),n.blendState=i.clone(e.blendState),n.cullState=i.clone(e.cullState),n.depthState=i.clone(e.depthState),n.dualTransparency=e.dualTransparency||!1,n.renderQueue=-1===e.renderQueue?null:e.renderQueue,n.shader=s,n.uniforms={};for(var c in e.uniforms)"undefined"==typeof e.uniforms[c].enabled?n.uniforms[c]=a.clone(e.uniforms[c]):e.uniforms[c].enabled?n.uniforms[c]=a.clone(e.uniforms[c].value):delete n.uniforms[c];var l=[],h=function(t,e){return l.push(o.getConfig(e).then(function(i){return o.updateObject(e,i,o.options).then(function(i){return{type:t,ref:e,texture:i}})}))};for(var u in e.texturesMapping){var d=e.texturesMapping[u];"string"==typeof d?h(u,d):d&&d.enabled?h(u,d.textureRef):n.removeTexture(u);for(var p in n._textureMaps)e.texturesMapping[p]||n.removeTexture(p)}return l.length?r.all(l).then(function(t){for(var e=0;e<t.length;e++){var i=t[e];i.texture&&n.setTexture(i.type,i.texture)}return n}).then(null,function(t){return console.error("Error loading textures: "+t)}):n})},s.prototype.remove=function(t){return delete this._objects[t]},s.prototype._getShaderObject=function(t,i){var a=this;if(i){var c=new r.Promise,l=e.createShader(o.simple);return c.resolve(l),c}if(t){if(0===t.indexOf(s.ENGINE_SHADER_PREFIX)){var h=t.slice(s.ENGINE_SHADER_PREFIX.length),l=e.createShader(o[h]);return n.createDummyPromise(l)}return this.getConfig(t).then(function(e){return a.updateObject(t,e,a.options)})}var u=e.createShader(o.texturedLit,"DefaultShader");return n.createDummyPromise(u)},s}),define("goo/shapes/Cone",["goo/renderer/MeshData"],function(t){"use strict";function e(e,i,o){if(1===arguments.length&&arguments[0]instanceof Object){var r=arguments[0];e=r.radialSamples,i=r.radius,o=r.height}this.radialSamples=e||8,this.radius=i||1,this.height="undefined"==typeof o?2:o;var n=t.defaultMap([t.POSITION,t.NORMAL,t.TEXCOORD0]);t.call(this,n,3*this.radialSamples+this.radialSamples+1,6*this.radialSamples),this.indexModes=["Triangles"],this.rebuild()}return e.prototype=Object.create(t.prototype),e.prototype.rebuild=function(){for(var e=[],i=[],o=[],r=[],n=Math.atan2(this.radius,this.height),a=2*Math.PI/this.radialSamples,s=1/this.radialSamples,c=0,l=0,h=0;c<this.radialSamples;c++,l+=a,h+=s)e.push(0,0,this.height,Math.cos(l)*this.radius,Math.sin(l)*this.radius,0,Math.cos(l+a)*this.radius,Math.sin(l+a)*this.radius,0),i.push(0,0,1,Math.cos(l)*Math.cos(n),Math.sin(l)*Math.cos(n),Math.sin(n),Math.cos(l+a)*Math.cos(n),Math.sin(l+a)*Math.cos(n),Math.sin(n)),o.push(h+s/2,1,h,.5,h+s,.5),r.push(3*c+0,3*c+1,3*c+2);var u=3*c+0;e.push(0,0,0),i.push(0,0,-1),o.push(.25,.25);for(var c=1,l=0;c<=this.radialSamples-1;c++,l+=a)e.push(Math.cos(l)*this.radius,Math.sin(l)*this.radius,0),i.push(0,0,-1),o.push(.25*Math.cos(l)+.25,.25*Math.sin(l)+.25),r.push(u+c,u,u+c+1);return e.push(Math.cos(l)*this.radius,Math.sin(l)*this.radius,0),i.push(0,0,-1),o.push(.25*Math.cos(l)+.25,.25*Math.sin(l)+.25),r.push(u+this.radialSamples,u,u+1),this.getAttributeBuffer(t.POSITION).set(e),this.getAttributeBuffer(t.NORMAL).set(i),this.getAttributeBuffer(t.TEXCOORD0).set(o),this.getIndexBuffer().set(r),this},e}),define("goo/util/ShapeCreatorMemoized",["goo/shapes/Box","goo/shapes/Quad","goo/shapes/Sphere","goo/shapes/Cylinder","goo/shapes/Torus","goo/shapes/Disk","goo/shapes/Cone"],function(t,e,i,o,r,n,a){"use strict";function s(){}function c(t,e){var i=Object.keys(e),o=i.map(function(t){return t+""+e[t]}).join("");return t+o}function l(t,e,i){var o=c(t,e);if(h[o])return h[o];var r=i();return h[o]=r,r}var h={};return s.createQuad=function(t,i){var o=1,r=1,n=1,a=1;return i&&o===i.xExtent&&r===i.yExtent&&n===i.tileX&&a===i.tileY?i:l("quad",{},function(){return new e(o,r,n,a)})},s.createBox=function(e,i){var o=1,r=1,n=1,a=1,s=1;return i&&o===i.xExtent&&r===i.yExtent&&n===i.zExtent&&a===i.tileX&&s===i.tileY?i:l("box",{},function(){return new t(o,r,n,a,s)})},s.createSphere=function(t,e){t=t||{},t.zSamples=t.zSamples||8,t.radialSamples=t.radialSamples||8,t.textureMode=t.textureMode||"Projected";var o=1;return e&&t.zSamples===e.zSamples-1&&t.radialSamples===e.radialSamples&&t.textureMode===e.textureMode.name&&o===e.radius?e:l("sphere",t,function(){return new i(t.zSamples,t.radialSamples,o,t.textureMode)})},s.createCylinder=function(t,e){t=t||{},t.radialSamples=t.radialSamples||8;var i=1;return e&&t.radialSamples===e.radialSamples&&i===e.radius?e:l("cylinder",t,function(){return new o(t.radialSamples,i)})},s.createTorus=function(t,e){t=t||{},t.radialSamples=t.radialSamples||8,t.circleSamples=t.circleSamples||12,t.tubeRadius=t.tubeRadius||.2;var i=1;return e&&t.radialSamples===e._radialSamples&&t.circleSamples===e._circleSamples&&t.tubeRadius===e._tubeRadius&&i===e._centerRadius?e:new r(t.circleSamples,t.radialSamples,t.tubeRadius,i)},s.createDisk=function(t,e){t=t||{},t.radialSamples=t.radialSamples||8,t.pointiness="undefined"==typeof t.pointiness?0:t.pointiness;var i=1;return e&&t.radialSamples===e.nSegments&&t.pointiness===e.pointiness&&i===e.radius?e:t.pointiness===Math.floor(t.pointiness)?l("disk",t,function(){return new n(t.radialSamples,i,t.pointiness)}):new n(t.radialSamples,i,t.pointiness)},s.createCone=function(t,e){t=t||{},t.radialSamples=t.radialSamples||8,t.height="undefined"==typeof t.height?0:t.height;var i=1;return e&&t.radialSamples===e.radialSamples&&t.height===e.height&&i===e.radius?e:t.height===Math.floor(t.height)?l("cone",t,function(){return new a(t.radialSamples,i,t.height)}):new a(t.radialSamples,i,t.height)},s}),define("goo/loaders/handlers/MeshDataComponentHandler",["goo/loaders/handlers/ComponentHandler","goo/entities/components/MeshDataComponent","goo/renderer/bounds/BoundingBox","goo/util/ShapeCreatorMemoized","goo/util/rsvp","goo/util/PromiseUtil","goo/util/ObjectUtil","goo/util/StringUtil"],function(t,e,i,o,r,n,a,s){"use strict";function c(){t.apply(this,arguments)}return c.prototype=Object.create(t.prototype),t._registerClass("meshData",c),c.prototype.constructor=c,c.prototype._prepare=function(t){return a.defaults(t,{})},c.prototype._create=function(){},c.prototype.update=function(a,c){var l,h,u=this;t.prototype.update.call(this,a,c);var d;if(c.shape&&(d=o["create"+s.capitalize(c.shape)]),d instanceof Function){var p=d(c.shapeOptions,a.meshDataComponent?a.meshDataComponent.meshData:null);l=n.createDummyPromise(p),h=n.createDummyPromise()}else{var f=c.meshRef;f||console.error("No meshRef in meshDataComponent for "+a.ref),l=this.getConfig(f).then(function(t){return u.updateObject(f,t)});var m=c.poseRef||c.pose;h=m?this.getConfig(m).then(function(t){return u.updateObject(m,t)}):n.createDummyPromise()}return r.all([l,h]).then(function(t){var o=t[0],r=t[1],n=new e(o);if(o.boundingBox){var s=o.boundingBox.min,c=o.boundingBox.max,l=[c[0]-s[0],c[1]-s[1],c[2]-s[2]],h=[.5*(c[0]+s[0]),.5*(c[1]+s[1]),.5*(c[2]+s[2])],u=new i;u.xExtent=l[0]/2,u.yExtent=l[1]/2,u.zExtent=l[2]/2,u.center.seta(h),n.modelBound=u,n.autoCompute=!1}return r&&(n.currentPose=r),a.clearComponent("MeshDataComponent"),a.setComponent(n),n})},c}),define("goo/loaders/JsonUtils",["goo/renderer/BufferUtils","goo/math/Transform","goo/math/Matrix3x3","goo/math/Matrix4x4","goo/math/Vector3","goo/math/Quaternion"],function(t,e,i,o,r,n){"use strict";function a(){}a.fillAttributeBufferFromCompressedString=function(t,e,i,o,r){var n,s,c,l,h,u=e.getAttributeBuffer(i),d=o.length,p=t.length/o.length;for(h=0;d>h;h++)if(0===o[h])return;for(h=0;d>h;h++)for(n=0,l=0;p>l;l++){s=t.charCodeAt(l+h*p),c=l*d+h,n+=a.unzip(s);var f=(n+r[h])*o[h];u[c]=f}},a.fillAttributeBuffer=function(t,e,i){for(var o=e.getAttributeBuffer(i),r=0;r<t.length;r++)o[r]=t[r]},a.getIntBuffer=function(e,i){var o=t.createIndexBuffer(e.length,i);return o.set(e),o};var s=61404;return a.rewrap=function(t){var e=t%s;return 0>e&&(e+=s),e},a.getIntBufferFromCompressedString=function(e,i){for(var o=0,r=t.createIndexBuffer(e.length,i),n=0;n<e.length;++n){var s=e.charCodeAt(n),c=o+a.unzip(s);o=c,r[n]=this.rewrap(c)}return r},a.unzip=function(t){return t>=57344&&(t-=2048),t-=35,t=t>>1^-(1&t)},a.parseTransform=function(t){var i=new e;return i.translation=a.parseVector3(t.translation),i.scale=a.parseVector3(t.scale),i.rotation=a.parseMatrix3(t.rotation),i},a.parseTransformQuat=function(t){var i=new e;return i.translation=a.parseVector3(t.translation),i.scale=a.parseVector3(t.scale),i.rotation=a.parseQuaternion(t.rotation).toRotationMatrix(),i},a.parseTransformEuler=function(t){var i=new e;i.translation=a.parseVector3(t.translation),i.scale=a.parseVector3(t.scale);var o=a.parseVector3(t.rotation);return i.setRotationXYZ(o.x,o.y,o.z),i},a.parseTransformMatrix=function(t){var i=new e;return i.matrix=a.parseMatrix4(t.matrix),i},a.parseMatrix3=function(t){var e=new i;return e.e00=t[0],e.e01=t[1],e.e02=t[2],e.e10=t[3],e.e11=t[4],e.e12=t[5],e.e20=t[6],e.e21=t[7],e.e22=t[8],e},a.parseMatrix4=function(t){var e=new o;return e.e00=t[0],e.e01=t[1],e.e02=t[2],e.e03=t[3],e.e10=t[4],e.e11=t[5],e.e12=t[6],e.e13=t[7],e.e20=t[8],e.e21=t[9],e.e22=t[10],e.e23=t[11],e.e30=t[12],e.e31=t[13],e.e32=t[14],e.e33=t[15],e},a.parseQuaternion=function(t){var e=new n;return e.x=t[0],e.y=t[1],e.z=t[2],e.w=t[3],e},a.parseVector3=function(t){return new r(t[0],t[1],t[2])},a.parseChannelTimes=function(t,e){var i=t.times;if(i){if(e){var o=t.timeOffsetScale,r=o[0],n=o[1];return a.parseFloatArrayFromCompressedString(i,[n],[r])}return i}return null},a.parseFloatLERPValues=function(t,e){var i=t.values;if(i){if(e){var o=t.offsetScale,r=o[0],n=o[1];return a.parseFloatArrayFromCompressedString(i,[n],[r])}return i}return null},a.parseRotationSamples=function(t,e,i){var o=t.rotationSamples;if(o){if(i){var r=1-(e+1>>1),n=1/-r;return a.parseFloatArrayFromCompressedString(o,[n,n,n,n],[r,r,r,r])}return a.parseQuaternionSamples(o)}return null},a.parseTranslationSamples=function(t,e,i){var o=t.uniformTranslation;if(o){for(var r=o,n=r[0],s=r[1],c=r[2],l=[],h=0;e>h;h++)l[3*h+0]=n,l[3*h+1]=s,l[3*h+2]=c;return l}var u=t.translationSamples;if(u){if(i){var d=t.translationOffsetScale,p=d[0],f=d[1],m=d[2],g=d[3];return a.parseFloatArrayFromCompressedString(u,[g,g,g],[p,f,m])}return a.parseVector3Samples(u)}return null},a.parseScaleSamples=function(t,e,i){var o=t.uniformScale;if(o){for(var r=o,n=r[0],s=r[1],c=r[2],l=[],h=0;e>h;h++)l[3*h+0]=n,l[3*h+1]=s,l[3*h+2]=c;return l}var u=t.scaleSamples;if(u){if(i){var d=t.scaleOffsetScale,p=d[0],f=d[1],m=d[2],r=d[3];return a.parseFloatArrayFromCompressedString(u,[r,r,r],[p,f,m])}return a.parseVector3Samples(u)}return null},a.parseQuaternionSamples=function(t){var e=t;if(!e)return null;for(var i=[],o=new n,r=0,a=e.length;a>r;r++){var s=e[r];if("*"===s)i[4*r+0]=o.x,i[4*r+1]=o.y,i[4*r+2]=o.z,i[4*r+3]=o.w;else if(s instanceof Array&&4===s.length){var c=s[0],l=s[1],h=s[2],u=s[3];o.set(c,l,h,u),i[4*r+0]=o.x,i[4*r+1]=o.y,i[4*r+2]=o.z,i[4*r+3]=o.w}}return i},a.parseVector3Samples=function(t){var e=t;if(!e)return null;for(var i=[],o=new r,n=0,a=e.length;a>n;n++){var s=e[n];if("*"===s)i[3*n+0]=o.x,i[3*n+1]=o.y,i[3*n+2]=o.z;else if(s instanceof Array&&3===s.length){var c=s[0],l=s[1],h=s[2];o.set(c,l,h),i[3*n+0]=o.x,i[3*n+1]=o.y,i[3*n+2]=o.z}}return i},a.parseFloatArrayFromCompressedString=function(t,e,i){var o,r,n,s,c,l=t,h=[],u=e.length,d=l.length/e.length;for(c=0;u>c;c++)for(o=0,s=0;d>s;s++){r=l.charCodeAt(s+c*d),n=s*u+c,o+=a.unzip(r);var p=(o+i[c])*e[c];h[n]=p}return h},a}),define("goo/loaders/handlers/MeshDataHandler",["goo/loaders/handlers/ConfigHandler","goo/renderer/MeshData","goo/animation/SkeletonPose","goo/loaders/JsonUtils","goo/util/PromiseUtil","goo/util/ArrayUtil"],function(t,e,i,o,r,n){"use strict";function a(){t.apply(this,arguments),this._objects={}}return a.prototype=Object.create(t.prototype),t._registerClass("mesh",a),a.prototype.update=function(t,e){var i=this;return this._objects[t]?r.createDummyPromise(this._objects[t]):e.binaryRef?this.getConfig(e.binaryRef).then(function(o){if(!o)throw new Error("Binary mesh data was empty");return i._createMeshData(e,o).then(function(e){return i._objects[t]=e})}):this._createMeshData(e,null).then(function(e){return i._objects[t]=e})},a.prototype.remove=function(){},a.prototype._createMeshData=function(t,e){var i;t.compression&&t.compression.compressed&&(i={compressedVertsRange:t.compression.compressedVertsRange||16383,compressedColorsRange:t.compression.compressedColorsRange||255,compressedUnitVectorRange:t.compression.compressedUnitVectorRange||1023});var o=this._createMeshDataObject(t);return this._fillMeshData(o,t,e,i),r.createDummyPromise(o)},a.prototype._createMeshDataObject=function(t){var i,o,r,n,a,s,c=t.data||t;if("SkinnedMesh"===t.type?(s=4,n=e.SKINMESH):(s=0,n=e.MESH),a=c.vertexCount,0===a)return null;if(o=null!=c.indexLengths?c.indexLengths[0]:null!=c.indices?c.indices.length:0,i={},c.vertices&&c.vertices.length>0&&(i.POSITION=e.createAttribute(3,"Float")),c.normals&&c.normals.length>0&&(i.NORMAL=e.createAttribute(3,"Float")),c.tangents&&c.tangents.length>0&&(i.TANGENT=e.createAttribute(4,"Float")),c.colors&&c.colors.length>0&&(i.COLOR=e.createAttribute(4,"Float")),s>0&&c.weights&&(i.WEIGHTS=e.createAttribute(4,"Float")),s>0&&c.joints&&(i.JOINTIDS=e.createAttribute(4,"Float")),c.textureCoords&&c.textureCoords.length>0)for(var l=0;l<c.textureCoords.length;l++)i["TEXCOORD"+l]=e.createAttribute(2,"Float");return r=new e(i,a,o),r.type=n,r},a.prototype._fillMeshData=function(t,i,r,a){var s,c=this,l=i.data||i;s=t.type===e.SKINMESH?4:0;var h=function(e,s){var l;(null!=s?s.length:void 0)&&(a&&"string"==typeof s?(l=c._getCompressionOptions(e,i,a),o.fillAttributeBufferFromCompressedString(s,t,e,l.scale,l.offset)):r?t.getAttributeBuffer(e).set(n.getTypedArray(r,s)):o.fillAttributeBuffer(s,t,e))};if(h(e.POSITION,l.vertices),h(e.NORMAL,l.normals),h(e.TANGENT,l.tangents),h(e.COLOR,l.colors),t.type===e.SKINMESH&&h(e.WEIGHTS,l.weights),null!=l.textureCoords&&l.textureCoords.length>0)for(var u=l.textureCoords,d=0;d<u.length;d++){var p=u[d],f="TEXCOORD"+d;h(f,p.UVs||p)}if(s>0&&null!=l.joints&&l.joints.length>0){var m=t.getAttributeBuffer(e.JOINTIDS),g=this._getIntBuffer(l.joints,32767,r,a);if(t.type===e.SKINMESH){for(var v=[],y=0,x=0;x<g.length;x++){var w=g[x];void 0===v[w]&&(v[w]=y++),m.set([v[w]],x)}for(var _=[],w=0;w<v.length;w++){var y=v[w];null!==y&&(_[y]=w)}t.paletteMap=_,t.weightsPerVertex=s}else for(var b=0;0<g.capacity();b++)m.putCast(b,g.get(b))}if(l.indices&&t.getIndexBuffer().set(this._getIntBuffer(l.indices,l.vertexCount,r,a)),l.indexModes&&(t.indexModes=l.indexModes.slice(0)),l.indexLengths&&(t.indexLengths=l.indexLengths.slice(0)),l.boundingVolume){if("BoundingBox"!==l.boundingVolume.type)throw new Error("Bounding volume was not BoundingBox");t.boundingBox={min:l.boundingVolume.min,max:l.boundingVolume.max}}return t},a.prototype._getIntBuffer=function(t,e,i,r){return t?r?o.getIntBufferFromCompressedString(t,e):i?n.getTypedArray(i,t):o.getIntBuffer(t,e):null},a.prototype._getCompressionOptions=function(t,i,o){var r,n,a,s,c=i.data||i;if(t===e.POSITION)n=c.vertexOffsets,a={offset:[n.xOffset,n.yOffset,n.zOffset],scale:[c.vertexScale,c.vertexScale,c.vertexScale]};else if(t===e.WEIGHTS)r=0,s=1/o.compressedVertsRange,a={offset:[r],scale:[s]};else if(t===e.NORMAL)r=1-(o.compressedUnitVectorRange+1>>1),s=1/-r,a={offset:[r,r,r],scale:[s,s,s]};else if(t===e.TANGENT)r=1-(o.compressedUnitVectorRange+1>>1),s=1/-r,a={offset:[r,r,r,r],scale:[s,s,s,s]};else if(t===e.COLOR)r=0,s=1/(o.compressedColorsRange+1),a={offset:[r,r,r,r],scale:[s,s,s,s]};else if("TEXCOORD"===t.substr(0,8)){var l=parseInt(t.substr(8),10),h=c.textureCoords[l];a={offset:h.UVOffsets,scale:h.UVScales}}return a},a}),define("goo/loaders/handlers/MeshRendererComponentHandler",["goo/loaders/handlers/ComponentHandler","goo/entities/components/MeshRendererComponent","goo/renderer/Material","goo/renderer/shaders/ShaderLib","goo/util/rsvp","goo/util/PromiseUtil","goo/util/ObjectUtil"],function(t,e,i,o,r,n,a){"use strict";function s(){t.apply(this,arguments)}return s.prototype=Object.create(t.prototype),t._registerClass("meshRenderer",s),s.prototype.constructor=s,s.prototype._prepare=function(t){return a.defaults(t,{materialRefs:[],cullMode:"Dynamic",castShadows:!0,receiveShadows:!0,hidden:!1})},s.prototype._create=function(t){var i=new e;return t.setComponent(i),i},s.prototype.update=function(e,s){var c,l=this,h=t.prototype.update.call(this,e,s),u=s.materialRefs;if(u&&0!==u.length){for(var d=[],p=function(t){return d.push(l._getMaterial(t))},f=0;f<u.length;f++)p(u[f]);c=r.all(d)}else{var m=i.createShader(o.uber,"DefaultShader"),g=new i;g.shader=m,c=n.createDummyPromise([g])}return c.then(function(t){var e,i;if(h.materials&&h.materials.length){for(var o,r=0;r<h.materials.length;r++){var n=h.materials[r];if("gooSelectionIndicator"===n.name){o=n;break}}o&&t.push(o)}h.materials=t;for(e in s)i=s[e],"materials"!==e&&"hidden"!==e&&h.hasOwnProperty(e)&&(h[e]=a.clone(i));return h}).then(null,function(t){return console.error("Error handling materials "+t)})},s.prototype._getMaterial=function(t){var e=this;return this.getConfig(t).then(function(i){return e.updateObject(t,i,e.options)})},s}),define("goo/loaders/handlers/SceneHandler",["goo/loaders/handlers/ConfigHandler","goo/util/rsvp"],function(t,e){"use strict";function i(){t.apply(this,arguments)}return i.prototype=Object.create(t.prototype),t._registerClass("scene",i),i.prototype._prepare=function(){},i.prototype._create=function(){},i.prototype.update=function(t,i){var o=this,r=[];if(null!=i.entityRefs&&i.entityRefs.length){for(var n=function(t){return r.push(o.getConfig(t).then(function(e){return o.updateObject(t,e,o.options)}))},a=0;a<i.entityRefs.length;a++)n(i.entityRefs[a]);return e.all(r).then(function(t){for(var e=0;e<t.length;e++){var i=t[e];(null==o.options.beforeAdd||null==o.options.beforeAdd.apply||o.options.beforeAdd(i))&&i.addToWorld()}}).then(null,function(t){return console.error("Error updating entities: "+t)})}return console.warn("No entity refs in scene "+t),i},i.prototype.remove=function(){},i}),define("goo/loaders/handlers/ShaderHandler",["goo/loaders/handlers/ConfigHandler","goo/renderer/Material","goo/renderer/MeshData","goo/renderer/Shader","goo/renderer/shaders/ShaderBuilder","goo/util/rsvp","goo/util/ObjectUtil"],function(t,e,i,o,r,n,a){"use strict";function s(){t.apply(this,arguments)}return s.prototype=Object.create(t.prototype),t._registerClass("shader",s),s.prototype._create=function(){},s.prototype.update=function(t,i){var o;if(null!=i&&null!=i.attributes&&null!=i.uniforms){o={attributes:i.attributes,uniforms:i.uniforms};for(var s in o.uniforms){var c=o.uniforms[s];if("string"==typeof c){var l=/^function\s?\(([^\)]*)\)\s*\{(.*)\}$/,h=c.match(l);if(3===(null!=h?h.length:void 0)){var u=h[1].replace(" ","").split(","),d=h[2];o.uniforms[s]=new Function(u,d)}}}if(i.processors){o.processors=[];for(var p=0;p<i.processors.length;p++){var f=i.processors[p];if(!r[f])throw new Error("Unknown processor: "+f);o.processors.push(r[f].processor)}}i.defines&&(o.defines=i.defines)}else o=this._getDefaultShaderDefinition();var m=[this.getConfig(i.vshaderRef),this.getConfig(i.fshaderRef)];return n.all(m).then(function(r){var n,s;return s=r[0],n=r[1],s?n?(a.extend(o,{attributes:i.attributes||{},uniforms:i.uniforms||{},vshader:s,fshader:n}),e.createShader(o,t)):(console.warn("Fragment shader",i.fshaderRef,"in shader",t,"not found"),void 0):(console.warn("Vertex shader",i.vshaderRef,"in shader",t,"not found"),void 0)})},s.prototype.remove=function(){},s.prototype._getDefaultShaderDefinition=function(){return{attributes:{vertexPosition:i.POSITION,vertexNormal:i.NORMAL,vertexUV0:i.TEXCOORD0},uniforms:{viewMatrix:o.VIEW_MATRIX,projectionMatrix:o.PROJECTION_MATRIX,worldMatrix:o.WORLD_MATRIX,cameraPosition:o.CAMERA,lightPosition:o.LIGHT0,diffuseMap:o.DIFFUSE_MAP,materialAmbient:o.AMBIENT,materialDiffuse:o.DIFFUSE,materialSpecular:o.SPECULAR,materialSpecularPower:o.SPECULAR_POWER}}},s}),define("goo/loaders/handlers/SkeletonHandler",["goo/loaders/handlers/ConfigHandler","goo/animation/Joint","goo/animation/Skeleton","goo/animation/SkeletonPose","goo/loaders/JsonUtils","goo/util/PromiseUtil"],function(t,e,i,o,r,n){"use strict";function a(){t.apply(this,arguments)}return a.prototype=Object.create(t.prototype),t._registerClass("skeleton",a),a.prototype._create=function(t){for(var n=[],a=0;a<t.joints.length;a++){var s=t.joints[a],c=new e(s.name);c._index=Math.round(s.index),c._parentIndex=Math.round(s.parentIndex);var l;l=s.inverseBindPose.matrix?r.parseTransformMatrix:4===s.inverseBindPose.rotation.length?r.parseTransformQuat:3===s.inverseBindPose.rotation.length?r.parseTransformEuler:r.parseTransform,c._inverseBindPose.copy(l(s.inverseBindPose)),s.inverseBindPose.matrix||c._inverseBindPose.update(),n.push(c)}var h=new i(t.name,n),u=new o(h);return u.setToBindPose(),u},a.prototype.update=function(t,e){var i=this._create(e);return n.createDummyPromise(i)},a.prototype.remove=function(){},a}),define("goo/loaders/handlers/TextureHandler",["goo/loaders/handlers/ConfigHandler","goo/renderer/TextureCreator","goo/renderer/Texture","goo/loaders/dds/DdsLoader","goo/loaders/crunch/CrunchLoader","goo/loaders/tga/TgaLoader","goo/util/rsvp","goo/util/PromiseUtil","goo/renderer/Util","goo/util/ObjectUtil"],function(t,e,i,o,r,n,a,s,c,l){"use strict";function h(){t.apply(this,arguments),this._objects={}}return h.prototype=Object.create(t.prototype),t._registerClass("texture",h),h.prototype.constructor=h,h.minFilters=["NearestNeighborNoMipMaps","NearestNeighborNearestMipMap","NearestNeighborLinearMipMap","BilinearNoMipMaps","BilinearNearestMipMap","Trilinear"],h.magFilters=["NearestNeighbor","Bilinear"],h.loaders={dds:o,crn:r,tga:n},h.prototype._prepare=function(t){l.defaults(t,{wrapU:"Repeat",wrapV:"Repeat",magFilter:"Bilinear",minFilter:"Trilinear",anisotropy:1,offset:[0,0],repeat:[1,1],flipY:!0})},h.prototype._create=function(t){var o=this._objects[t]=new i(c.clone(e.DEFAULT_TEXTURE_2D.image));return o.image.dataReady=!1,o},h.prototype.update=function(t,i,o){var r,n,c=i.url,u=c?c.split(".").pop().toLowerCase():void 0,d=o&&o.texture&&void 0!==o.texture.reload;if("mp4"===u){n=new a.Promise;var p=new e;return r=p.loadTextureVideo(i.url,!0),s.createDummyPromise(r)}if(r=this._objects[t]||this._create(t),this._prepare(i),r.wrapS=i.wrapU,r.wrapT=i.wrapV,-1!==h.magFilters.indexOf(i.magFilter)&&(r.magFilter=i.magFilter),-1!==h.minFilters.indexOf(i.minFilter)&&(r.minFilter=i.minFilter),r.anisotropy=Math.max(i.anisotropy,1),r.offset.set(i.offset),r.repeat.set(i.repeat),r.flipY=i.flipY,r.setNeedsUpdate(),!i.url)return console.log("Texture "+t+" has no url"),r.setImage(),s.createDummyPromise(r);if(!d&&(i.url===r.a||r.image&&r.image.src&&i.url===r.image.src.slice(-i.url.length)))return s.createDummyPromise(r);if(u in h.loaders){var f=new h.loaders[u];r.a=c,n=this.getConfig(c).then(function(t){if(t&&t.preloaded)l.extend(r.image,t.image),r.format=t.format,r.needsUpdate=!0;else{if(!f.load)throw new Error("Loader for type "+u+" has no load() function");f.load(t,r,i.flipY,0,t.byteLength)}return r}).then(null,function(t){console.error("Error loading texture: ",t)})}else{if("jpg"!==u&&"jpeg"!==u&&"png"!==u&&"gif"!==u)throw new Error("Unknown texture type "+u);n=this.getConfig(c,!1).then(function(t){return r.setImage(t),r}).then(null,function(t){console.error("Error loading texture: ",t)})}return this.options&&this.options.dontWaitForTextures?s.createDummyPromise(r):n},h.prototype.remove=function(t){return console.log("Deleting texture "+t),delete this._objects[t]},h}),define("goo/loaders/handlers/TransformComponentHandler",["goo/loaders/handlers/ComponentHandler","goo/entities/components/TransformComponent","goo/math/MathUtils","goo/math/Quaternion","goo/util/PromiseUtil","goo/util/ObjectUtil","goo/util/ArrayUtil"],function(t,e,i,o,r,n,a){"use strict";function s(){t.apply(this,arguments)}return s.prototype=Object.create(t.prototype),s.prototype.constructor=s,t._registerClass("transform",s),s.prototype._prepare=function(t){return n.defaults(t,{translation:[0,0,0],rotation:[0,0,0],scale:[1,1,1]})
},s.prototype._create=function(t){var i=new e;return t.setComponent(i),i},s.prototype.update=function(e,n){var s=this,c=t.prototype.update.call(this,e,n);if(c.transform.translation.set(n.translation),3===n.rotation.length?c.transform.setRotationXYZ(i.radFromDeg(n.rotation[0]),i.radFromDeg(n.rotation[1]),i.radFromDeg(n.rotation[2])):4===n.rotation.length?new o(n.rotation).toRotationMatrix(c.transform.rotation):c.transform.rotation.set(n.rotation),c.transform.scale.set(n.scale),null!=n.parentRef){var l=this.getConfig(n.parentRef).then(function(t){return s.updateObject(n.parentRef,t,s.options).then(function(t){if(null==t)return console.warn("Could not find parent with ref "+n.parentRef);var e=c.parent;return null==e||e.entity!==t?t.transformComponent.attachChild(c):void 0})});return l.then(function(){return c.setUpdated(),c})}return c.parent&&(console.log("Orphaned entity"),a.remove(c.parent.children,c),c.parent.setUpdated(),c.parent=null),c.setUpdated(),r.createDummyPromise(c)},s.prototype.remove=function(t){var e=t.transformComponent;e.transform.translation.set(0,0,0),e.transform.setRotationXYZ(0,0,0),e.transform.scale.set(1,1,1),e.setUpdated()},s}),define("goo/loaders/handlers/AnimationComponentHandler",["goo/loaders/handlers/ComponentHandler","goo/entities/components/AnimationComponent","goo/math/MathUtils","goo/util/rsvp","goo/util/PromiseUtil"],function(t,e,i,o,r){"use strict";function n(){t.apply(this,arguments)}return n.prototype=Object.create(t.prototype),n.prototype.constructor=n,t._registerClass("animation",n),n.prototype._prepare=function(){},n.prototype._create=function(t){var i=new e;return t.setComponent(i),i},n.prototype.update=function(e,i,n){var a,s,c=this,l=t.prototype.update.call(this,e,i);n&&n.animation&&void 0!==n.animation.paused&&(n.animation.paused?l.stop():l.resume());var h=i.layersRef,u=i.poseRef,d=[];return a=u?this.getConfig(u).then(function(t){c.updateObject(u,t,c.options).then(function(t){return l._skeletonPose=t})}):r.createDummyPromise(),d.push(a),h?s=this._getAnimationLayers(h).then(function(t){return l.layers=t}):(console.warn("No animation tree ref"),s=r.createDummyPromise([])),d.push(s),o.all(d).then(function(){return l})},n.prototype._getAnimationLayers=function(t){var e=this;return this.getConfig(t).then(function(i){return e.updateObject(t,i,e.options)})},n}),define("goo/loaders/handlers/AnimationStateHandler",["goo/loaders/handlers/ConfigHandler","goo/animation/state/SteadyState","goo/animation/blendtree/ClipSource","goo/animation/blendtree/ManagedTransformSource","goo/animation/blendtree/BinaryLERPSource","goo/animation/blendtree/FrozenClipSource","goo/util/rsvp","goo/util/PromiseUtil"],function(t,e,i,o,r,n,a,s){"use strict";function c(){t.apply(this,arguments),this._objects={}}return c.prototype=Object.create(t),c.prototype.constructor=c,t._registerClass("animstate",c),c.prototype.update=function(t,e){var i=this._objects[t]||this._create(t);return i._name=e.name,this._parseClipSource(e.clipSource,i._sourceTree).then(function(t){return i._sourceTree=t,i})},c.prototype.remove=function(t){this._objects[t]&&delete this._objects[t]},c.prototype._create=function(t){return this._objects[t]=new e},c.prototype._parseClipSource=function(t,e){var c=this;switch(t.type){case"Clip":return this.getConfig(t.clipRef).then(function(o){return c.updateObject(t.clipRef,o,c.options).then(function(o){return!e||!e instanceof i?e=new i(o,t.filter,t.channels):(e._clip=o,e.setFilter(t.filter,t.channels)),t.loopCount&&(e._clipInstance._loopCount=+t.loopCount),t.timeScale&&(e._clipInstance._timeScale=t.timeScale),e})});case"Managed":(!e||!e instanceof o)&&(e=new o);var l=e;return t.clipRef?this.getConfig(t.clipRef).then(function(e){return c.updateObject(t.clipRef,e,c.options)}).then(function(e){return l.initFromClip(e,t.filter,t.channels),l}):s.createDummyPromise(l);case"Lerp":var h=[this._parseClipSource(t.clipSourceA),this._parseClipSource(t.clipSourceB)];return a.all(h).then(function(e){var i=new r(e[0],e[1]);return t.blendWeight&&(i.blendWeight=t.blendWeight),i});case"Frozen":return this._parseClipSource(t.clipSource).then(function(i){return e&&e instanceof n?(e._source=i,e._time=t.frozenTime||0):e=new n(i,t.frozenTime||0),e});default:return console.error("Unable to parse clip source"),s.createDummyPromise()}},c}),define("goo/loaders/handlers/AnimationLayersHandler",["goo/loaders/handlers/ConfigHandler","goo/animation/layer/AnimationLayer","goo/animation/layer/LayerLERPBlender","goo/animation/state/FadeTransitionState","goo/animation/state/SyncFadeTransitionState","goo/animation/state/FrozenTransitionState","goo/util/rsvp","goo/util/PromiseUtil","goo/util/ObjectUtil"],function(t,e,i,o,r,n,a,s,c){"use strict";function l(){t.apply(this,arguments),this._objects={}}return l.prototype=Object.create(t),t._registerClass("animation",l),l.prototype.update=function(t,e,i){var o=this._objects[t]||this._create(t),r=[];if(i&&i.animation&&i.animation.shallow){for(var n=0;n<e.layers.length;n++){var c=o[n];c._layerBlender&&(c._layerBlender._blendWeight=e.layers[n].blendWeight),e.layers[n].defaultState&&c._steadyStates[e.layers[n].defaultState]?c._currentState!==c._steadyStates[e.layers[n].defaultState]&&c.setCurrentStateByName(e.layers[n].defaultState,!0):c.setCurrentState()}return s.createDummyPromise(o)}if(e.layers instanceof Array)for(var n=0;n<e.layers.length;n++){var l=e.layers[n];r.push(this._parseLayer(l,o[n]))}else{var n=1;r.push(this._parseLayer(e.layers.DEFAULT,o[0]));for(var h in e.layers){var l=e.layers[h];"DEFAULT"!==h&&r.push(this._parseLayer(l,o[n++]))}}return a.all(r).then(function(t){o.length=0;for(var e=0;e<t.length;e++)o.push(t[e]);return o})},l.prototype.remove=function(t){this._objects[t]&&delete this._objects[t]},l.prototype._create=function(t){return this._objects[t]=[]},l.prototype._parseLayer=function(t,o){function r(t,e,i){return n.getConfig(e).then(function(o){return n.updateObject(e,o,n.options).then(function(r){return{state:r,ref:e,config:o,key:t,transitions:i}})})}var n=this;void 0===t.blendWeight&&(t.blendWeight=1),o?o._name=t.name:(o=new e(t.name),o._layerBlender=new i),o._layerBlender&&(o._layerBlender._blendWeight=void 0!==t.blendWeight?t.blendWeight:1);var s=[];for(var l in t.states)s.push(r(l,t.states[l].stateRef,t.states[l].transitions));return a.all(s).then(function(t){o._steadyStates={};for(var e=0;e<t.length;e++){var i=t[e];o._steadyStates[i.key]=i.state}for(var e=0;e<t.length;e++){var r=t[e].transitions,a=t[e].state;if(a._transitions={},r)for(var s in r){var l=r[s];if(o._steadyStates[s]||"*"===s){var h=c.clone(l);a._transitions[s]=h,o._transitionStates[h.type]||(o._transitionStates[h.type]=n._getTransitionByType(h.type))}}}}).then(function(){if(o._transitions={},t.transitions)for(var e in t.transitions){var i=t.transitions[e];if(o._steadyStates[e]||"*"===e){var r=c.clone(i);o._transitions[e]=r,o._transitionStates[r.type]||(o._transitionStates[r.type]=n._getTransitionByType(r.type))}}return t.defaultState&&o._steadyStates[t.defaultState]?o._currentState!==o._steadyStates[t.defaultState]&&o.setCurrentStateByName(t.defaultState,!0):o.setCurrentState(),o})},l.prototype._getTransitionByType=function(t){switch(t){case"Fade":return new o;case"SyncFade":return new r;case"Frozen":return new n;default:return console.log("Defaulting to frozen transition type"),new n}},l}),define("goo/loaders/handlers/AnimationClipHandler",["goo/loaders/handlers/ConfigHandler","goo/animation/clip/AnimationClip","goo/loaders/JsonUtils","goo/animation/clip/JointChannel","goo/animation/clip/TransformChannel","goo/animation/clip/InterpolatedFloatChannel","goo/animation/clip/TriggerChannel","goo/util/PromiseUtil","goo/util/ArrayUtil"],function(t,e,i,o,r,n,a,s,c){"use strict";function l(){t.apply(this,arguments),this._objects={}}return l.prototype=Object.create(t.prototype),t._registerClass("clip",l),l.prototype._create=function(t){return this._objects[t]=new e},l.prototype.update=function(t,e){var i=this._objects[t]||this._create(t);i._name=e.name;var o,r=this;return e.binaryRef?this.getConfig(e.binaryRef).then(function(t){if(!t)throw new Error("Binary clip data was empty");return r._updateAnimationClip(e,t,i)}):(o=this._updateAnimationClip(e,null,i),s.createDummyPromise(o))},l.prototype._updateAnimationClip=function(t,e,s){s._channels=[];var l=t.useCompression||!1,h=null;if(l&&(h=t.compressedRange||32767),t.channels&&t.channels.length)for(var u=0;u<t.channels.length;u++){var d,p,f,m,g,v,y=t.channels[u];p=e?c.getTypedArray(e,y.times):new Float32Array(i.parseChannelTimes(y,l));var v=y.blendType,x=y.type;if(("Joint"===x||"Transform"===x)&&(e?(f=c.getTypedArray(e,y.rotationSamples),m=c.getTypedArray(e,y.translationSamples),g=c.getTypedArray(e,y.scaleSamples)):(f=i.parseRotationSamples(y,h,l),m=i.parseTranslationSamples(y,p.length,l),g=i.parseScaleSamples(y,p.length,l))),"Joint"===x)d=new o(y.jointName,y.jointIndex,p,f,m,g,v);else if("Transform"===y.type)d=new r(y.name,p,f,m,g,v);else if("FloatLERP"===y.type)d=new n(y.name,p,i.parseFloatLERPValues(y,l),v);else{if("Trigger"!==y.type){console.warn("Unhandled channel type: "+y.type);continue}d=new a(y.name,p,y.keys),y.guarantee&&(d.guarantee=!0)}s.addChannel(d)}return s},l}),define("goo/util/Skybox",["goo/shapes/ShapeCreator","goo/shapes/Sphere","goo/renderer/MeshData","goo/renderer/Material","goo/renderer/Shader","goo/renderer/TextureCreator","goo/math/Transform"],function(t,e,i,o,r,n,a){"use strict";function s(i,l,h,u){var d;if(i===s.SPHERE)this.meshData=t.createSphere(48,48,1,h||e.TextureModes.Projected),l instanceof Array&&(l=l[0]),l&&(d=(new n).loadTexture2D(l));else{if(i!==s.BOX)throw new Error("Unknown geometry type");this.meshData=t.createBox(1,1,1),l.length&&(d=(new n).loadTextureCube(l,{flipY:!1}))}var p=o.createMaterial(c[i],"Skybox material");p.setTexture(r.DIFFUSE_MAP,d),p.cullState.cullFace="Front",p.depthState.enabled=!1,p.renderQueue=1,this.materials=[p],this.transform=new a;var f=i===s.SPHERE?Math.PI/2:0;this.transform.rotation.fromAngles(f,u,0),this.transform.update(),this.active=!0}s.SPHERE="sphere",s.BOX="box";var c={};return c.box={attributes:{vertexPosition:i.POSITION},uniforms:{viewMatrix:r.VIEW_MATRIX,projectionMatrix:r.PROJECTION_MATRIX,worldMatrix:r.WORLD_MATRIX,cameraPosition:r.CAMERA,near:r.NEAR_PLANE,diffuseMap:r.DIFFUSE_MAP},vshader:["attribute vec3 vertexPosition;","uniform mat4 viewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 worldMatrix;","uniform vec3 cameraPosition;","uniform float near;","varying vec3 eyeVec;","void main(void) {","	vec4 worldPos = worldMatrix * vec4(vertexPosition * near * 10.0, 1.0);"," worldPos += vec4(cameraPosition, 0.0);","	gl_Position = projectionMatrix * viewMatrix * worldPos;","	eyeVec = worldPos.xyz - cameraPosition;"," eyeVec.x = -eyeVec.x;"," eyeVec = (worldMatrix * vec4(eyeVec, 0.0)).xyz;","}"].join("\n"),fshader:["precision mediump float;","uniform samplerCube diffuseMap;","varying vec3 eyeVec;","void main(void)","{","	vec4 cube = textureCube(diffuseMap, eyeVec);","	gl_FragColor = cube;","}"].join("\n")},c.sphere={attributes:{vertexPosition:i.POSITION,vertexUV0:i.TEXCOORD0},uniforms:{viewMatrix:r.VIEW_MATRIX,projectionMatrix:r.PROJECTION_MATRIX,worldMatrix:r.WORLD_MATRIX,cameraPosition:r.CAMERA,near:r.NEAR_PLANE,diffuseMap:r.DIFFUSE_MAP},vshader:["attribute vec3 vertexPosition;","attribute vec2 vertexUV0;","uniform mat4 viewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 worldMatrix;","uniform vec3 cameraPosition;","uniform float near;","varying vec2 texCoord0;","varying vec3 eyeVec;","void main(void) {","	texCoord0 = vertexUV0;","	vec4 worldPos = worldMatrix * vec4(vertexPosition * near * 10.0, 1.0);"," worldPos += vec4(cameraPosition, 0.0);","	gl_Position = projectionMatrix * viewMatrix * worldPos;","	eyeVec = cameraPosition - worldPos.xyz;","}"].join("\n"),fshader:["precision mediump float;","uniform sampler2D diffuseMap;","varying vec2 texCoord0;","void main(void)","{","	gl_FragColor = texture2D(diffuseMap, texCoord0);","}"].join("\n")},s}),define("goo/renderer/pass/Composer",["goo/renderer/pass/RenderTarget","goo/renderer/pass/FullscreenPass","goo/renderer/shaders/ShaderLib","goo/entities/SystemBus"],function(t,e,i,o){"use strict";function r(r){if(this.writeBuffer=r,void 0===this.writeBuffer){var n=window.innerWidth||1,a=window.innerHeight||1;this.writeBuffer=new t(n,a)}this.readBuffer=this.writeBuffer.clone(),this.passes=[],this._clearColor=[0,0,0,1],this.copyPass=new e(i.copy),this.size=null,this.dirty=!1,o.addListener("goo.viewportResize",function(t){this.dirty=!0,this.size=t}.bind(this),!0)}var n=window.WebGLRenderingContext;return r.prototype.swapBuffers=function(){var t=this.readBuffer;this.readBuffer=this.writeBuffer,this.writeBuffer=t},r.prototype._checkPassResize=function(t,e){return t.viewportSize&&t.viewportSize.x===e.x&&t.viewportSize.y===e.y&&t.viewportSize.width===e.width&&t.viewportSize.height===e.height?!1:!0},r.prototype.addPass=function(t){this.passes.push(t),t.updateSize&&this.size&&this._checkPassResize(t,this.size)&&(t.updateSize(this.size),t.viewportSize=this.size)},r.prototype.setClearColor=function(t){this._clearColor[0]=t[0],this._clearColor[1]=t[1],this._clearColor[2]=t[2],this._clearColor[3]=t[3]},r.prototype.updateSize=function(){var e=this.size;if(e){var i=e.width,o=e.height;this.writeBuffer=new t(i,o),this.readBuffer=this.writeBuffer.clone();for(var r=0,n=this.passes.length;n>r;r++){var a=this.passes[r];a.updateSize&&this._checkPassResize(a,e)&&(a.updateSize(e),a.viewportSize=e)}}},r.prototype.render=function(t,e,i,o){this.dirty&&(this.updateSize(),this.dirty=!1);var r,a,s=!1,c=this.passes.length;for(a=0;c>a;a++)if(r=this.passes[a],r.enabled&&(r.render(t,this.writeBuffer,this.readBuffer,e,s,i,o,this._clearColor),r.needsSwap)){if(s){var l=this.renderer.context;l.stencilFunc(n.NOTEQUAL,1,4294967295),this.copyPass.render(t,this.writeBuffer,this.readBuffer,e,i,o),l.stencilFunc(n.EQUAL,1,4294967295)}this.swapBuffers()}},r}),define("goo/renderer/pass/RenderPass",["goo/renderer/Renderer","goo/math/Vector4"],function(t,e){"use strict";function i(t,i){this.renderList=t,this.filter=i,this.clearColor=new e(0,0,0,0),this.oldClearColor=new e,this.renderToScreen=!1,this.overrideMaterial=null,this.enabled=!0,this.clear=!0,this.needsSwap=!1}return i.prototype.render=function(e,i,o,r,n,a,s,c){if(a=a||t.mainCamera){s=s||[],c&&(this.oldClearColor.setv(e.clearColor),e.setClearColor(c[0],c[1],c[2],c[3]));var l;if(l=this.filter?this.renderList.filter(this.filter):this.renderList,this.renderToScreen?e.render(l,a,s,null,this.clear,this.overrideMaterial):e.render(l,a,s,o,this.clear,this.overrideMaterial),this.clearColor){var h=this.oldClearColor.data;e.setClearColor(h[0],h[1],h[2],h[3])}}},i}),define("goo/particles/ParticleLib",[],function(){"use strict";var t={};return t.getSmoke=function(t){return t=t||{},t.scale="undefined"!=typeof t.scale?t.scale:1,t.spread="undefined"!=typeof t.spread?t.spread:2,t.rate="undefined"!=typeof t.spread?t.rate:25,t.velocity="undefined"!=typeof t.velocity?t.velocity:function(e){var i=e.velocity;return i.data[0]=2*(Math.random()-.5)*t.spread*t.scale,i.data[1]=2*(Math.random()+4)*t.scale,i.data[2]=2*(Math.random()-.5)*t.spread*t.scale,i},t.color=t.color||[0,0,0],{totalParticlesToSpawn:-1,releaseRatePerSecond:t.rate,minLifetime:.5,maxLifetime:4,getEmissionVelocity:t.velocity,timeline:[{timeOffset:0,spin:0,mass:1,size:3*t.scale,color:[t.color[0],t.color[1],t.color[2],1]},{timeOffset:1,size:6*t.scale,color:[t.color[0],t.color[1],t.color[2],0]}]}},t.getFire=function(t){return t=t||{},t.scale="undefined"!=typeof t.scale?t.scale:1,t.spread="undefined"!=typeof t.spread?t.spread:2,t.velocity="undefined"!=typeof t.velocity?t.velocity:10,t.startColor=t.startColor||[1,1,0],t.endColor=t.endColor||[1,0,0],{totalParticlesToSpawn:-1,releaseRatePerSecond:30,minLifetime:.5,maxLifetime:2,getEmissionVelocity:function(e){var i=e.velocity;return i.data[0]=2*(Math.random()-.5)*t.spread*t.scale,i.data[1]=(Math.random()+1)*t.velocity*t.scale,i.data[2]=2*(Math.random()-.5)*t.spread*t.scale,i},timeline:[{timeOffset:0,spin:0,mass:1,size:2*t.scale,color:[t.startColor[0],t.startColor[1],t.startColor[2],0]},{timeOffset:.05,color:[t.startColor[0],t.startColor[1],t.startColor[2],1]},{timeOffset:.45,color:[t.endColor[0],t.endColor[1],t.endColor[2],.8]},{timeOffset:.5,size:3*t.scale,color:[0,0,0,0]}]}},t.getSnow=function(t){return t=t||{},t.scale="undefined"!=typeof t.scale?t.scale:2,t.spread="undefined"!=typeof t.spread?t.spread:50,t.velocity="undefined"!=typeof t.velocity?t.velocity:3,t.color=t.color||[1,1,1],{particleCount:1e3,totalParticlesToSpawn:-1,releaseRatePerSecond:50,minLifetime:15,maxLifetime:25,getEmissionPoint:function(e){var i=e.position;return t.getEmissionPoint(i),i},getEmissionVelocity:function(e){var i=e.velocity;return t.getEmissionVelocity(i),i},timeline:[{timeOffset:0,spin:0,mass:1,size:1*t.scale,color:[t.color[0],t.color[1],t.color[2],0]},{timeOffset:.05,color:[t.color[0],t.color[1],t.color[2],1]},{timeOffset:.7,color:[t.color[0],t.color[1],t.color[2],.8]},{timeOffset:.25,spin:5,size:.5*t.scale,color:[t.color[0],t.color[1],t.color[2],0]}]}},t}),define("goo/util/ParticleSystemUtils",["goo/entities/components/ParticleComponent","goo/entities/components/MeshRendererComponent","goo/entities/components/MeshDataComponent","goo/renderer/Texture","goo/particles/ParticleEmitter"],function(t,e,i,o,r){"use strict";function n(){}return n.createParticleSystemEntity=function(o,n,a){var s=o.world.createEntity(),c=new t({particleCount:n.particleCount||500});c.emitters.push(new r(n)),s.setComponent(c);var l=new i(c.meshData);s.setComponent(l);var h=new e;return h.materials.push(a),h.cullMode="Never",s.setComponent(h),s},n.createFlareTexture=function(t,e){t=t||64,e=e||{},e.startRadius="undefined"!=typeof e.startRadius?e.startRadius:0,e.endRadius="undefined"!=typeof e.endRadius?e.endRadius:t/2,e.steps=e.steps||[{fraction:0,value:1},{fraction:1,value:0}];var i=document.createElement("canvas");i.width=t,i.height=t;for(var r=i.getContext("2d"),n=r.createRadialGradient(t/2,t/2,e.startRadius,t/2,t/2,e.endRadius),a=0;a<e.steps.length;a++){var s=e.steps[a];n.addColorStop(s.fraction,"rgba(255, 255, 255, "+s.value+")")}r.fillStyle=n,r.fillRect(0,0,t,t);var c=r.getImageData(0,0,t,t).data;c=new Uint8Array(c);var l=new o(c,null,t,t);return l},n.createSplashTexture=function(t,e){function i(t,e,i){var o=s.createRadialGradient(t,e,0,t,e,i);o.addColorStop(0,"rgba(255, 255, 255, 0.5)"),o.addColorStop(1,"rgba(255, 255, 255, 0)"),s.fillStyle=o,s.fillRect(t-i,e-i,2*i,2*i)}function r(t,e,o,r,n,a){for(var s=(o-t)/c,l=(r-e)/c,h=(a-n)/c,u=0,d=t,p=e,f=n;c>u;u++,d+=s,p+=l,f+=h)i(d,p,f)}function n(t,e,i,o,n,a,s){for(var c=0;s>c;c++){var l=2*Math.random()*Math.PI,h=4*Math.random()+i,u=4*Math.random()-o;r(t+Math.cos(l)*h,e+Math.sin(l)*h,t+Math.cos(l)*u,e+Math.sin(l)*u,n,a)}}t=t||64,e=e||{},e.nTrails="undefined"!=typeof e.nTrails?e.nTrails:8,e.trailStartRadius="undefined"!=typeof e.trailStartRadius?e.trailStartRadius:1,e.trailEndRadius="undefined"!=typeof e.trailEndRadius?e.trailEndRadius:4;var a=document.createElement("canvas");a.width=t,a.height=t;var s=a.getContext("2d"),c=30;n(t/2,t/2,1*(t/2/10),9*(t/2/10),e.trailStartRadius,e.trailEndRadius,e.nTrails);var l=s.getImageData(0,0,t,t).data;l=new Uint8Array(l);var h=new o(l,null,t,t);return h},n.createPlanktonTexture=function(t,e){function i(t,e,i){var o=a.createRadialGradient(t,e,0,t,e,i);o.addColorStop(0,"rgba(255, 255, 255, 1)"),o.addColorStop(.3,"rgba(255, 255, 255, 1)"),o.addColorStop(1,"rgba(255, 255, 255, 0)"),a.fillStyle=o,a.fillRect(t-i,e-i,2*i,2*i)}function r(o){for(var r=0;o>r;r++){var n=Math.random()*(t-2*e.maxRadius)+e.maxRadius,a=Math.random()*(t-2*e.maxRadius)+e.maxRadius;i(n,a,Math.random()*(e.maxRadius-e.minRadius)+e.minRadius)}}t=t||64,e=e||{},e.nPoints="undefined"!=typeof e.nPoints?e.nPoints:10,e.minRadius="undefined"!=typeof e.minRadius?e.minRadius:2,e.maxRadius="undefined"!=typeof e.maxRadius?e.maxRadius:5;var n=document.createElement("canvas");n.width=t,n.height=t;var a=n.getContext("2d");r(e.nPoints);var s=a.getImageData(0,0,t,t).data;s=new Uint8Array(s);var c=new o(s,null,t,t);return c},n.createSnowflakeTexture=function(t,e){function i(t,e){for(var i=2*Math.PI/t,o=0;t>o;o++)a.rotate(i),e()}function r(){a.beginPath(),a.moveTo(0,0),a.lineTo(0,90);for(var t=0;6>t;t++)a.moveTo(0,25+10*t),a.lineTo(16-1.5*t,35+10*t),a.moveTo(0,25+10*t),a.lineTo(-(16-1.5*t),35+10*t);a.stroke()}t=t||64,e=e||{};var n=document.createElement("canvas");n.width=t,n.height=t;var a=n.getContext("2d");a.strokeStyle="#FFF",a.lineWidth=4,a.lineCap="round",a.translate(t/2,t/2),a.scale(t/100/2,t/100/2),i(7,r);var s=a.getImageData(0,0,t,t).data;s=new Uint8Array(s);var c=new o(s,null,t,t);return c},n}),define("goo/util/Snow",["goo/entities/SystemBus","goo/renderer/Material","goo/renderer/shaders/ShaderLib","goo/renderer/TextureCreator","goo/particles/ParticleLib","goo/util/ParticleSystemUtils","goo/renderer/Renderer","goo/math/Vector3"],function(t,e,i,o,r,n,a,s){"use strict";function c(t){this.velocity=10,this.height=25,this.material=e.createMaterial(i.particles);var o=n.createFlareTexture(64);o.generateMipmaps=!0,this.material.setTexture("DIFFUSE_MAP",o),this.material.blendState.blending="AdditiveBlending",this.material.cullState.enabled=!1,this.material.depthState.write=!1,this.material.renderQueue=2002;var c=this;this.particleCloudEntity=n.createParticleSystemEntity(t,r.getSnow({getEmissionPoint:function(t){t.copy(a.mainCamera?a.mainCamera.translation:new s),t.data[0]+=1e3*Math.random()-500,t.data[1]+=c.height,t.data[2]+=1e3*Math.random()-500},getEmissionVelocity:function(t){t.data[0]=2*(Math.random()-.5),t.data[1]=-(Math.random()+1)*c.velocity,t.data[2]=2*(Math.random()-.5)}}),this.material),this.particleCloudEntity.name="_ParticleSystemSnow",this.onCameraChange=function(t){t.entity.attachChild(this.particleCloudEntity)}.bind(this),this.particleCloudEntity.transformComponent.transform.translation.copy(a.mainCamera?a.mainCamera.translation:new s),this.particleCloudEntity.addToWorld()}return c.prototype.setEmissionVelocity=function(t){if(t){this.velocity=t;for(var e=this.particleCloudEntity.particleComponent,i=e.particles,o=0;o<i.length;o++)i[o].velocity[1]=-(Math.random()+1)*this.velocity}},c.prototype.setEmissionHeight=function(t){t&&(this.height=t)},c.prototype.setReleaseRatePerSecond=function(t){if(t){var e=this.particleCloudEntity.particleComponent,i=e.emitters[0];i.releaseRatePerSecond=t}},c.prototype.remove=function(){this.particleCloudEntity.removeFromWorld()},c}),define("goo/loaders/handlers/ProjectHandler",["goo/loaders/handlers/ConfigHandler","goo/util/rsvp","goo/util/PromiseUtil","goo/util/Skybox","goo/math/MathUtils","goo/shapes/Sphere","goo/renderer/Renderer","goo/renderer/pass/Composer","goo/renderer/pass/RenderPass","goo/math/Vector4","goo/renderer/shaders/ShaderLib","goo/renderer/shaders/ShaderBuilder","goo/renderer/pass/FullscreenPass","goo/renderer/Util","goo/renderer/Texture","goo/entities/EntityUtils","goo/entities/SystemBus","goo/util/ArrayUtil","goo/util/ObjectUtil","goo/util/Snow"],function(t,e,i,o,r,n,a,s,c,l,h,u,d,p,f,m,g,v,y,x){"use strict";function w(){t.apply(this,arguments),this._skybox=null,this._skyboxTexture=null,this._skyboxGeographic=!1,this._composer=null,this._passes=[],this.weatherState={}}return w.prototype=Object.create(t.prototype),t._registerClass("project",w),w.prototype._prepare=function(t){t.skybox=t.skybox||{},y.defaults(t.skybox,{shape:"Box",imageUrls:["","","","","",""],rotation:0,environmentType:1}),t.backgroundColor=t.backgroundColor||[.75,.76,.78,1],t.globalAmbient=t.globalAmbient||[0,0,0],t.useFog=t.useFog||!1,t.fogColor=t.fogColor||[1,1,1],t.fogNear=t.fogNear||0,t.fogFar=null==t.fogFar?1e3:t.fogFar},w.prototype._create=function(){},w.prototype._createSkybox=function(t,e,i,r,a){var a=a?n.TextureModes.Projected:n.TextureModes.Chromeball,s=new o(e,[],a,r),c=this._skybox=m.createTypicalEntity(t.world,s.meshData,s.materials[0],s.transform);c.name="Skybox_"+e,c.isSkybox=!0,c.transformComponent.updateWorldTransform(),c.meshRendererComponent.hidden=!0,t.world.getSystem("RenderSystem").added(c)},w.prototype._updateSkybox=function(t,n){if(t){var a=t.shape.toLowerCase(),s=t.rotation*r.DEG_TO_RAD,c=t.imageUrls,l=this._skybox?this._skybox.name.split("_")[1]:null;(!a||l!==a||"sphere"===l&&t.environmentType!==this._skyboxGeographic)&&(this._skybox&&this.world.getSystem("RenderSystem").removed(this._skybox),this._createSkybox(this.world.gooRunner,a,c,s,t.environmentType),this._skyboxTexture=null,l=a,this._skyboxGeographic=t.environmentType);var h=0;l===o.SPHERE&&(h=t.environmentType?Math.PI/2:Math.PI),this._skybox.transformComponent.transform.rotation.fromAngles(h,s,0),this._skybox.transformComponent.updateTransform(),this._skybox.transformComponent.updateWorldTransform();var d=this._skybox,p=d.meshRendererComponent.materials[0],m=this._skyboxTexture,v=!m;if(!v&&n&&n.skybox&&n.skybox.reload&&(v=!0),!v)if(m.image.data)for(var y=0;y<c.length;y++){var x=m.image.data[y];if(x&&x.getAttribute("data-ref")!==c[y]){v=!0;break}}else m.image&&m.image.getAttribute("data-ref")!==c[0]&&(v=!0);if(u.ENVIRONMENT_TYPE=t.environmentType?1:0,!v)return i.createDummyPromise();for(var w=[],y=0;y<c.length;y++)c[y]&&""!==c[y]&&w.push(this.getConfig(c[y]));if(!w.length)return d.meshRendererComponent.hidden=!0,p.setTexture("DIFFUSE_MAP",null),u.SKYBOX=null,u.SKYSPHERE=null,i.createDummyPromise();var _=this;return e.all(w).then(function(e){if(l===o.SPHERE){if(""===c[0])return g.emit("goo.error.skybox",{type:"Sphere",message:"The skysphere needs an image to display."}),u.SKYBOX=null,u.SKYSPHERE=null,void 0;e=e[0],e.setAttribute("data-ref",c[0])}else{if(e.length<6)return g.emit("goo.error.skybox",{type:"Box",message:"The skybox needs six images of the same size to display"}),d.meshRendererComponent.hidden=!0,p.setTexture("DIFFUSE_MAP",null),u.SKYBOX=null,u.SKYSPHERE=null,void 0;for(var i=e[0].width,r=e[0].height,n=0;6>n;n++){var a=e[n];if(i!==a.width||r!==a.height)return g.emit("goo.error.skybox",{type:"Box",message:"The skybox needs six images of the same size to display"}),d.meshRendererComponent.hidden=!0,p.setTexture("DIFFUSE_MAP",null),u.SKYBOX=null,u.SKYSPHERE=null,void 0;a.setAttribute("data-ref",c[n])}}m||(m=_._skyboxTexture=new f(null,{flipY:!1}),l===o.BOX&&(m.variant="CUBE")),m.setImage(e),l===o.BOX&&e.length&&(m.image.width=e[0].width,m.image.height=e[0].height,m.image.dataReady=!0),m.setNeedsUpdate(),(l===o.BOX&&e.length||e)&&(p.setTexture("DIFFUSE_MAP",m),l===o.BOX?(u.SKYBOX=m,u.SKYSPHERE=null):(u.SKYBOX=null,u.SKYSPHERE=m,u.ENVIRONMENT_TYPE=t.environmentType?1:0),d.meshRendererComponent.hidden=!1)})}},w.prototype._updateEntities=function(t){var o=this,r=[];if(t.entityRefs&&Array.isArray(t.entityRefs)&&t.entityRefs.length>0){for(var n=function(t){return r.push(o.getConfig(t).then(function(e){return o.updateObject(t,e,o.options)}))},a=0;a<t.entityRefs.length;a++)n(t.entityRefs[a]);return e.all(r).then(function(t){for(var e=0;e<t.length;e++){var i=t[e];null!=o.options.beforeAdd&&null!=o.options.beforeAdd.apply&&!o.options.beforeAdd(i)||o.world.entityManager.containsEntity(i)||o.world._addedEntities.filter(function(t){return t.id===i.id}).length>0||i.addToWorld()}}).then(null,function(t){return console.error("Error updating entities: "+t)})}return console.warn("No entity refs in project"),i.createDummyPromise(t)},w.prototype._updatePosteffects=function(t){var o=this,r=[],n=o.world.getSystem("RenderSystem");if(t.posteffectRefs&&Array.isArray(t.posteffectRefs)&&t.posteffectRefs.length>0){for(var a=function(t){return o.getConfig(t).then(function(e){return o.updateObject(t,e,o.options)})},l=0;l<t.posteffectRefs.length;l++)t.posteffectRefs[l]&&r.push(a(t.posteffectRefs[l]));return e.all(r).then(function(t){for(var e=!1,i=0;i<t.length;i++)if(t[i]){var r=t[i];r.enabled&&!e&&(e=!0)}if(e){var a,l,u;if(o._composer)a=o._composer,l=a.passes[0],u=a.passes[a.passes.length-1];else{a=o._composer=new s,l=new c(n.renderList);var u=new d(p.clone(h.copy));u.renderToScreen=!0}a.passes=[],a.addPass(l);for(var i=0;i<t.length;i++)if(t[i]){var r=t[i];r.enabled&&a.addPass(r)}a.addPass(u),-1===n.composers.indexOf(a)&&n.composers.push(a)}else o._composer&&v.remove(n.composers,o._composer)}).then(null,function(t){return console.error("Error updating posteffects: "+t)})}return n.composers.length=0,i.createDummyPromise(t)},w.weatherHandlers={snow:{update:function(t,e){t.enabled?e.snow&&e.snow.enabled?(e.snow.snow.setEmissionVelocity(t.velocity),e.snow.snow.setReleaseRatePerSecond(t.rate),e.snow.snow.setEmissionHeight(t.height)):(e.snow=e.snow||{},e.snow.enabled=!0,e.snow.snow=new x(this.world.gooRunner)):e.snow&&e.snow.enabled&&(e.snow.snow.remove(),e.snow.enabled=!1,delete e.snow.snow)},remove:function(t){t.snow.snow&&(t.snow.snow.remove(),t.snow.enabled=!1,delete t.snow.snow)}}},w.prototype._updateWeather=function(t){for(var e in t)w.weatherHandlers[e].update.bind(this)(t[e],this.weatherState)},w.prototype._removeWeather=function(){for(var t in this.weatherState)w.weatherHandlers[t].remove.bind(this)(this.weatherState)},w.prototype.update=function(t,i,o){var r=this;this._prepare(i);var n=[];return n.push(this._updateSkybox(i.skybox,o)),o&&o.shallow||n.push(this._updateEntities(i)),n.push(this._updatePosteffects(i)),i.weather?this._updateWeather(i.weather):this._removeWeather(),e.all(n).then(function(t){var e=r.world.gooRunner.renderer;return e.setClearColor.apply(e,i.backgroundColor),r._composer&&r._composer.setClearColor(i.backgroundColor),u.GLOBAL_AMBIENT=i.globalAmbient,u.USE_FOG=i.useFog,u.FOG_SETTINGS=[i.fogNear,i.fogFar],u.FOG_COLOR=i.fogColor,t})},w.prototype.remove=function(){this._skybox&&this.world.getSystem("RenderSystem").removed(this._skybox),this._skybox=null,this._skyboxTexture=null,this._skyboxGeographic=!1,this._composer=null,this._passes=[]},w}),define("goo/loaders/handlers/ScriptComponentHandler",["goo/loaders/handlers/ComponentHandler","goo/entities/components/ScriptComponent","goo/util/rsvp","goo/util/PromiseUtil"],function(t,e,i,o){"use strict";function r(){t.apply(this,arguments)}return r.prototype=Object.create(t.prototype),r.prototype.constructor=r,t._registerClass("script",r),r.prototype._prepare=function(){},r.prototype._create=function(t){var i=new e;return t.setComponent(i),i},r.prototype.update=function(e,r){function n(t){return a.getConfig(t).then(function(e){return a.updateObject(t,e)})}var a=this,s=[],c=t.prototype.update.call(this,e,r);if(r.scriptRefs&&r.scriptRefs.length)for(var l=r.scriptRefs,h=0;h<l.length;h++)s.push(n(l[h]));return s.length>0?i.all(s).then(function(t){c.scripts=t[0]?t:[]}):o.createDummyPromise(c)},r}),define("goo/scripts/OrbitCamControlScript",["goo/math/Vector2","goo/math/Vector3","goo/math/MathUtils"],function(t,e,i){"use strict";function o(i){i=i||{};for(var o in n)this[o]="boolean"==typeof n[o]?void 0!==i[o]?i[o]===!0:n[o]:isNaN(n[o])?n[o]instanceof e?i[o]?new e(i[o]):(new e).set(n[o]):i[o]||n[o]:isNaN(i[o])?n[o]:i[o];this.name="OrbitCamControlScript",this.timeSamples=[0,0,0,0,0],this.xSamples=[0,0,0,0,0],this.ySamples=[0,0,0,0,0],this.sample=0,this.velocity=new t(0,0),this.targetSpherical=new e(this.spherical),this.cartesian=new e,this.dirty=!0,this.detailZoom=i.detailZoom||.15,this.zoomDistanceFactor=i.zoomDistanceFactor||.035,this.mouseState={buttonDown:!1,lastX:0/0,lastY:0/0},this.domElement&&this.setupMouseControls(),i.demoMode&&(this.demoMode=!0,this.moveInterval=i.moveInterval,this.lastTimeMoved=Date.now()+(i.moveInitialDelay-this.moveInterval))}function r(t,e,o){var r=(e+o)/2+(o>e?Math.PI:0),n=i.moduloPositive(t-r,i.TWO_PI),a=i.moduloPositive(e-r,i.TWO_PI),s=i.moduloPositive(o-r,i.TWO_PI);return 0>t&&e>0?e-=i.TWO_PI:t>0&&0>e&&(e+=i.TWO_PI),t>i.TWO_PI&&o<i.TWO_PI&&(o+=i.TWO_PI),a>n?e:n>s?o:t}var n={domElement:null,turnSpeedHorizontal:.005,turnSpeedVertical:.005,zoomSpeed:.2,dragOnly:!0,dragButton:-1,worldUpVector:new e(0,1,0),baseDistance:15,minZoomDistance:1,maxZoomDistance:1e3,minAscent:-89.95*i.DEG_TO_RAD,maxAscent:89.95*i.DEG_TO_RAD,clampAzimuth:!1,minAzimuth:90*i.DEG_TO_RAD,maxAzimuth:270*i.DEG_TO_RAD,releaseVelocity:!0,invertedX:!1,invertedY:!1,invertedWheel:!0,drag:5,maxSampleTimeMS:200,lookAtPoint:new e(0,0,0),spherical:new e(15,0,0),interpolationSpeed:7,onRun:null};
return o.prototype.updateButtonState=function(t,e){this.domElement!==document&&this.domElement.focus(),!this.dragOnly||-1!==this.dragButton&&this.dragButton!==t||(this.mouseState.buttonDown=e,e?(this.mouseState.lastX=0/0,this.mouseState.lastY=0/0,this.velocity.set(0,0),this.spherical.y=i.moduloPositive(this.spherical.y,i.TWO_PI),this.targetSpherical.copy(this.spherical)):this.applyReleaseDrift())},o.prototype.updateDeltas=function(t,e){var i=0,o=0;isNaN(this.mouseState.lastX)||isNaN(this.mouseState.lastY)?(this.mouseState.lastX=t,this.mouseState.lastY=e):(i=-(t-this.mouseState.lastX),o=e-this.mouseState.lastY,this.mouseState.lastX=t,this.mouseState.lastY=e),this.dragOnly&&!this.mouseState.buttonDown||0===i&&0===o||(this.timeSamples[this.sample]=Date.now(),this.xSamples[this.sample]=i,this.ySamples[this.sample]=o,this.sample++,this.sample>this.timeSamples.length-1&&(this.sample=0),this.velocity.set(0,0),this.move(this.turnSpeedHorizontal*i,this.turnSpeedVertical*o))},o.prototype.move=function(t,e){var o=this.invertedX?-t:t,n=this.invertedY?-e:e;this.targetSpherical.y=this.clampAzimuth?r(this.targetSpherical.y-o,this.minAzimuth,this.maxAzimuth):this.targetSpherical.y-o,this.targetSpherical.z=i.clamp(this.targetSpherical.z+n,this.minAscent,this.maxAscent),this.dirty=!0},o.prototype.applyWheel=function(t){var e=(this.invertedWheel?-1:1)*Math.max(-1,Math.min(1,t.wheelDelta||-t.detail));e*=this.zoomDistanceFactor*this.targetSpherical.x,this.zoom(this.zoomSpeed*e)},o.prototype.zoom=function(t){var e=t*this.baseDistance;this.targetSpherical.x=i.clamp(this.targetSpherical.x+e,this.minZoomDistance,this.maxZoomDistance),this.dirty=!0},o.prototype.applyReleaseDrift=function(){for(var t=Date.now(),e=0,i=0,o=!1,r=0,n=this.timeSamples.length;n>r;r++)t-this.timeSamples[r]<this.maxSampleTimeMS&&(e+=this.xSamples[r],i+=this.ySamples[r],o=!0);o?this.velocity.set(e*this.turnSpeedHorizontal/this.timeSamples.length,i*this.turnSpeedVertical/this.timeSamples.length):this.velocity.set(0,0)},o.prototype.setupMouseControls=function(){var t=this;this.domElement.addEventListener("mousedown",function(e){t.updateButtonState(e.button,!0)},!1),document.addEventListener("mouseup",function(e){t.updateButtonState(e.button,!1)},!1),document.addEventListener("mousemove",function(e){t.updateDeltas(e.clientX,e.clientY),t.lastTimeMoved=Date.now()},!1),this.domElement.addEventListener("mousewheel",function(e){t.applyWheel(e),t.lastTimeMoved=Date.now()},!1),this.domElement.addEventListener("DOMMouseScroll",function(e){t.applyWheel(e)},!1),this.domElement.addEventListener("dragstart",function(t){t.preventDefault()},!1),this.domElement.oncontextmenu=function(){return!1};var e=0;this.domElement.addEventListener("touchstart",function(){t.updateButtonState(0,!0)}),this.domElement.addEventListener("touchend",function(){t.updateButtonState(0,!1),e=0}),this.domElement.addEventListener("touchmove",function(i){var o,r,n,a=i.targetTouches,s=a[0].clientX,c=a[0].clientY;if(2===a.length){var l=a[1].clientX,h=a[1].clientY;o=(s+l)/2,r=(c+h)/2,n=(s-l)*(s-l)+(c-h)*(c-h)}else o=s,r=c,t.updateDeltas(o,r);var u=(n-e)/Math.max(t.domElement.height,t.domElement.width);u/=3,0===e?e=n:2===a.length&&Math.abs(u)>.3&&(t.applyWheel({wheelDelta:u}),e=n)})},o.prototype.updateVelocity=function(t){this.velocity.lengthSquared()>1e-6?(this.move(this.velocity.x,this.velocity.y),this.velocity.mul(i.clamp(i.lerp(t,1,1-this.drag),0,1)),this.dirty=!0):this.velocity.set(0,0,0)},o.prototype.run=function(t,e,o){if(this.demoMode){var r=Date.now();r-this.lastTimeMoved>this.moveInterval&&(this.lastTimeMoved=r,this.move(Math.round(Math.random())-.5,Math.round(Math.random())-.5))}o&&!this.domElement&&o.domElement&&(this.domElement=o.domElement,this.setupMouseControls());var n=t.transformComponent;if(n){var a=n.transform;if(this.releaseVelocity&&this.updateVelocity(t._world.tpf),this.dirty){var s=i.clamp(this.interpolationSpeed*t._world.tpf,0,1);this.spherical.y=this.clampAzimuth?i.lerp(s,this.spherical.y,this.targetSpherical.y):i.lerp(s,this.spherical.y,this.targetSpherical.y),this.spherical.x=i.lerp(s,this.spherical.x,this.targetSpherical.x),this.spherical.z=i.lerp(s,this.spherical.z,this.targetSpherical.z),i.sphericalToCartesian(this.spherical.x,this.spherical.y,this.spherical.z,this.cartesian),a.translation.set(this.cartesian.add(this.lookAtPoint)),a.translation.equals(this.lookAtPoint)||a.lookAt(this.lookAtPoint,this.worldUpVector),this.spherical.distanceSquared(this.targetSpherical)<1e-6&&(this.dirty=!1,this.spherical.y=i.moduloPositive(this.spherical.y,i.TWO_PI),this.targetSpherical.copy(this.spherical)),n.setUpdated()}}},o}),define("goo/scripts/OrbitNPanControlScript",["goo/scripts/OrbitCamControlScript","goo/renderer/Renderer","goo/math/Vector3","goo/math/MathUtils"],function(t,e,i,o){"use strict";function r(e){e=e||{},t.call(this,e),this.name="OrbitNPanControlScript",this.panState={buttonDown:!1,lastX:0/0,lastY:0/0,lastPos:new i},this.viewportWidth=0,this.viewportHeight=0,this.shiftKey=!1,this.altKey=!1,this.goingToLookAt=(new i).setv(this.lookAtPoint)}var n={LEFT:0,MIDDLE:1,RIGHT:2};return r.prototype=Object.create(t.prototype),r.prototype.setupMouseControls=function(){var t=this;this.domElement.addEventListener("mousedown",function(e){t.shiftKey=e.shiftKey,t.altKey=e.altKey,t.updateButtonState(e.button,!0,e)},!1),document.addEventListener("mouseup",function(e){t.updateButtonState(e.button,!1,e)},!1),document.addEventListener("mousemove",function(e){t.updateDeltas(e.clientX,e.clientY)},!1),this.domElement.addEventListener("mousewheel",function(e){t.shiftKey=e.shiftKey,t.applyWheel(e.wheelDelta||-e.detail)},!1),this.domElement.addEventListener("DOMMouseScroll",function(e){t.shiftKey=e.shiftKey,t.applyWheel(e.wheelDelta||-e.detail)},!1),this.domElement.addEventListener("dragstart",function(t){t.preventDefault()},!1),this.domElement.oncontextmenu=function(){return!1},this.domElement.addEventListener("touchstart",function(e){var i=2===e.targetTouches.length,o=1===e.targetTouches.length;t.updateButtonState(n.MIDDLE,i),t.updateButtonState(n.RIGHT,o)}),this.domElement.addEventListener("touchend",function(e){var i=2===e.targetTouches.length,o=1===e.targetTouches.length;t.updateButtonState(n.MIDDLE,i),t.updateButtonState(n.RIGHT,o)});var e=0;this.domElement.addEventListener("touchmove",function(i){var o,r,n,a=i.targetTouches,s=a[0].clientX,c=a[0].clientY;if(2===a.length){var l=a[1].clientX,h=a[1].clientY;o=(s+l)/2,r=(c+h)/2,n=(s-l)*(s-l)+(c-h)*(c-h)}else o=s,r=c;t.updateDeltas(o,r);var u=(n-e)/Math.max(t.domElement.height,t.domElement.width);u/=3,2===a.length&&Math.abs(u)>.3&&(t.applyWheel(t.zoomSpeed*u),e=n)})},r.prototype.updateButtonState=function(e,i){e===n.RIGHT||e===n.LEFT&&this.altKey?t.prototype.updateButtonState.call(this,0,i):(1===e||0===e&&this.shiftKey)&&(this.panState.buttonDown=i,i&&(this.panState.lastX=0/0,this.panState.lastY=0/0,this.panState.lastPos.setv(this.lookAtPoint)))},r.prototype.resetLookAt=function(t,e,i,r){this.goingToLookAt.setv(t),this.lookAtPoint.setv(t),this.panState.lastX=0/0,this.panState.lastY=0/0,this.panState.lastPos.setv(t),this.velocity.set(0),o.cartesianToSpherical(e,i,r,this.spherical),this.targetSpherical.setv(this.spherical),o.sphericalToCartesian(this.spherical.x,this.spherical.y,this.spherical.z,this.cartesian)},r.prototype.updateDeltas=function(o,r){t.prototype.updateDeltas.call(this,o,r);var n=new i,a=new i;if((isNaN(this.panState.lastX)||isNaN(this.panState.lastY))&&(this.panState.lastX=o,this.panState.lastY=r),this.panState.buttonDown){var s=e.mainCamera;if(!s)return;s.getScreenCoordinates(this.panState.lastPos,1,1,a),a.x-=(o-this.panState.lastX)/this.viewportWidth,a.y+=(r-this.panState.lastY)/this.viewportHeight,s.getWorldCoordinates(a.x,a.y,1,1,a.z,n),this.lookAtPoint.setv(n),this.goingToLookAt.setv(this.lookAtPoint),this.dirty=!0}},r.prototype.applyWheel=function(t){var t=(this.invertedWheel?-1:1)*o.clamp(t,-1,1);this.shiftKey&&(t*=this.detailZoom),t*=this.zoomDistanceFactor*this.targetSpherical.x,this.zoom(this.zoomSpeed*t)},r.prototype.run=function(e,i,o){if(!this.goingToLookAt.equals(this.lookAtPoint)){var r=7*i;this.lookAtPoint.lerp(this.goingToLookAt,r),this.dirty=!0}t.prototype.run.call(this,e,i,o),o&&(this.viewportWidth=o.viewportWidth,this.viewportHeight=o.viewportHeight)},r}),define("goo/scripts/FlyControlScript",["goo/math/Vector3","goo/math/Matrix3x3","goo/math/MathUtils"],function(t,e,i){"use strict";function o(o){o=o||{},this.name="FlyControlScript",this.domElement=o.domElement||null,this.turnSpeedHorizontal=isNaN(o.turnSpeedHorizontal)?.005:o.turnSpeed,this.turnSpeedVertical=isNaN(o.turnSpeedVertical)?.005:o.turnSpeed,this.dragOnly=void 0!==o.dragOnly?o.dragOnly===!0:!0,this.dragButton=isNaN(o.dragButton)?2:o.dragButton,this.worldUpVector=new t(o.worldUpVector)||new t(0,1,0),this.localLeftVector=new t(o.localLeftVector)||new t(-1,0,0),this.onRun=o.onRun,this.maxAscent=void 0!==o.maxAscent?o.maxAscent:89.95*i.DEG_TO_RAD,this.minAscent=void 0!==o.minAscent?o.minAscent:-89.95*i.DEG_TO_RAD,this.calcVector=new t,this.calcMat1=new e,this.calcMat2=new e,this.rotX=0,this.rotY=0,this.walkSpeed=isNaN(o.walkSpeed)?400:o.walkSpeed,this.crawlSpeed=isNaN(o.crawlSpeed)?40:o.crawlSpeed,this.fwdVector=o.fwdVector||new t(0,0,-1),this.leftVector=o.leftVector||new t(-1,0,0),this.crawlKey=isNaN(o.crawlKey)?16:o.crawlKey,this.forwardKey=isNaN(o.forwardKey)?87:o.forwardKey,this.backKey=isNaN(o.backKey)?83:o.backKey,this.strafeLeftKey=isNaN(o.strafeLeftKey)?65:o.strafeLeftKey,this.strafeRightKey=isNaN(o.strafeRightKey)?68:o.strafeRightKey,this.XZ=o.XZ||!1,this.maxSpeed=o.maxSpeed||30,this.onRun=o.onRun,this.moveState={strafeLeft:0,strafeRight:0,forward:0,back:0,crawling:!1},this.moveVector=new t(0,0,0),this.calcVector=new t,this.baseMultiplier=1,this.movementMultiplier=this.baseMultiplier,this.domElement&&this.setupKeyControls(),this.resetMouseState(),this.domElement&&this.setupMouseControls()}o.prototype.updateMovementVector=function(){this.moveVector.x=this.moveState.strafeLeft-this.moveState.strafeRight,this.moveVector.z=this.moveState.forward-this.moveState.back},o.prototype.updateKeys=function(t,e){if(!t.altKey){if(this.dragOnly&&!this.mouseState.buttonDown)return this.movementMultiplier=this.baseMultiplier,this.moveState.forward=0,this.moveState.back=0,this.moveState.strafeLeft=0,this.moveState.strafeRight=0,this.updateMovementVector(),void 0;var i=!1;switch(t.keyCode){case this.crawlKey:this.moveState.crawling=e;break;case this.forwardKey:this.moveState.forward=e?1:0,i=!0;break;case this.backKey:this.moveState.back=e?1:0,i=!0;break;case this.strafeLeftKey:this.moveState.strafeLeft=e?1:0,i=!0;break;case this.strafeRightKey:this.moveState.strafeRight=e?1:0,i=!0}i&&this.updateMovementVector()}},o.prototype.resetMouseState=function(){this.mouseState={buttonDown:!1,lastX:0/0,lastY:0/0,dX:0,dY:0}},o.prototype.updateButtonState=function(t,e){!this.dragOnly||-1!==this.dragButton&&this.dragButton!==t.button||(this.mouseState.buttonDown=e,t.preventDefault())},o.prototype.updateDeltas=function(t){isNaN(this.mouseState.lastX)||isNaN(this.mouseState.lastY)?(this.mouseState.dX=0,this.mouseState.dY=0,this.mouseState.lastX=t.clientX,this.mouseState.lastY=t.clientY):(this.mouseState.dX=t.clientX-this.mouseState.lastX,this.mouseState.dY=t.clientY-this.mouseState.lastY,this.mouseState.lastX=t.clientX,this.mouseState.lastY=t.clientY)};var r=function(t){this.updateKeys(t,!0)},n=function(t){this.updateKeys(t,!1)};o.prototype.setupKeyControls=function(){this.domElement.setAttribute("tabindex",-1);var t=r.bind(this),e=n.bind(this);this.domElement.addEventListener("keydown",t,!1),this.domElement.addEventListener("keyup",e,!1)},o.prototype.tearDownKeyControls=function(){var t=r.bind(this),e=n.bind(this);this.domElement.removeEventListener("keydown",t,!1),this.domElement.removeEventListener("keyup",e,!1)};var a=function(t){this.setupKeyControls(),this.domElement.focus(),this.resetMouseState(),this.updateButtonState(t,!0)},s=function(t){this.updateDeltas(t)},c=function(t){this.updateButtonState(t,!1),this.tearDownKeyControls()};return o.prototype.setupMouseControls=function(){var t=a.bind(this),e=s.bind(this),i=c.bind(this);this.domElement.addEventListener("mousedown",t,!1),this.domElement.addEventListener("mousemove",e,!1),this.domElement.addEventListener("mouseup",i,!1),this.domElement.addEventListener("dragstart",function(t){t.preventDefault()},!1),this.domElement.oncontextmenu=function(){return!1}},o.prototype.run=function(t,e,i){i&&!this.domElement&&i.domElement&&(this.domElement=i.domElement,this.setupMouseControls());var o=t.transformComponent;if(o){var r=o.transform,n=r.rotation;if(n.toAngles(this.calcVector),this.rotY=this.calcVector.x,this.rotX=this.calcVector.y,this.dragOnly&&!this.mouseState.buttonDown)return this.mouseState.dX=0,this.mouseState.dY=0,this.movementMultiplier=this.baseMultiplier,this.moveState.forward=0,this.moveState.back=0,this.moveState.strafeLeft=0,this.moveState.strafeRight=0,this.updateMovementVector(),void 0;0!==this.moveVector.x||0!==this.moveVector.z?(this.movementMultiplier+=1*e*this.movementMultiplier,this.movementMultiplier=Math.min(this.movementMultiplier,this.maxSpeed)):this.movementMultiplier=this.baseMultiplier;var a=this.turnSpeedHorizontal,s=this.turnSpeedVertical;0!==this.mouseState.dX&&(this.rotX-=a*this.mouseState.dX),0!==this.mouseState.dY&&(this.rotY-=s*this.mouseState.dY,this.rotY>this.maxAscent?this.rotY=this.maxAscent:this.rotY<this.minAscent&&(this.rotY=this.minAscent)),r.rotation.fromAngles(this.rotY,this.rotX,0),this.calcVector.set(this.fwdVector.x*this.moveVector.z+this.leftVector.x*this.moveVector.x,this.fwdVector.y*this.moveVector.z+this.leftVector.y*this.moveVector.x,this.fwdVector.z*this.moveVector.z+this.leftVector.z*this.moveVector.x),this.calcVector.normalize();var c=(this.moveState.crawling?this.crawlSpeed:this.walkSpeed)*this.movementMultiplier,l=t._world.tpf*c;this.calcVector.mul(l);var n=r.rotation;n.applyPost(this.calcVector),this.XZ&&(this.calcVector.data[1]=0),r.translation.add(this.calcVector),o.setUpdated(),this.mouseState.dX=0,this.mouseState.dY=0}},o}),define("goo/scripts/WASDControlScript",["goo/math/Vector","goo/math/Vector3"],function(t,e){"use strict";function i(t){t=t||{},this.name="WASDControlScript",this.domElement=t.domElement||null,this.walkSpeed=isNaN(t.walkSpeed)?100:t.walkSpeed,this.crawlSpeed=isNaN(t.crawlSpeed)?10:t.crawlSpeed,this.fwdVector=t.fwdVector||new e(0,0,-1),this.leftVector=t.leftVector||new e(-1,0,0),this.crawlKey=isNaN(t.crawlKey)?16:t.crawlKey,this.forwardKey=isNaN(t.forwardKey)?87:t.forwardKey,this.backKey=isNaN(t.backKey)?83:t.backKey,this.strafeLeftKey=isNaN(t.strafeLeftKey)?65:t.strafeLeftKey,this.strafeRightKey=isNaN(t.strafeRightKey)?68:t.strafeRightKey,this.XZ=t.XZ||!1,this.onRun=t.onRun,this.moveState={strafeLeft:0,strafeRight:0,forward:0,back:0,crawling:!1},this.moveVector=new e(0,0,0),this.calcVector=new e,this.domElement&&this.setupKeyControls()}return i.prototype.updateMovementVector=function(){this.moveVector.x=this.moveState.strafeLeft-this.moveState.strafeRight,this.moveVector.z=this.moveState.forward-this.moveState.back},i.prototype.updateKeys=function(t,e){if(!t.altKey){var i=!1;switch(t.keyCode){case this.crawlKey:this.moveState.crawling=e;break;case this.forwardKey:this.moveState.forward=e?1:0,i=!0;break;case this.backKey:this.moveState.back=e?1:0,i=!0;break;case this.strafeLeftKey:this.moveState.strafeLeft=e?1:0,i=!0;break;case this.strafeRightKey:this.moveState.strafeRight=e?1:0,i=!0}i&&this.updateMovementVector()}},i.prototype.setupKeyControls=function(){var t=this;this.domElement.setAttribute("tabindex",-1),this.domElement.addEventListener("keydown",function(e){t.updateKeys(e,!0)},!1),this.domElement.addEventListener("keyup",function(e){t.updateKeys(e,!1)},!1)},i.prototype.run=function(i,o,r){r&&!this.domElement&&r.domElement&&(this.domElement=r.domElement,this.setupKeyControls());var n=i.transformComponent,a=n.transform;if(!t.equals(this.moveVector,e.ZERO)){this.calcVector.set(this.fwdVector.x*this.moveVector.z+this.leftVector.x*this.moveVector.x,this.fwdVector.y*this.moveVector.z+this.leftVector.y*this.moveVector.x,this.fwdVector.z*this.moveVector.z+this.leftVector.z*this.moveVector.x),this.calcVector.normalize();var s=i._world.tpf*(this.moveState.crawling?this.crawlSpeed:this.walkSpeed);this.calcVector.mul(s);var c=a.rotation;c.applyPost(this.calcVector),this.XZ&&(this.calcVector.data[1]=0),a.translation.add(this.calcVector),n.setUpdated()}},i}),define("goo/scripts/BasicControlScript",["goo/math/Vector3","goo/math/Matrix3x3"],function(t,e){"use strict";function i(i){i=i||{},this.domElement=void 0===i.domElement?null:i.domElement.domElement||i.domElement,this.name="BasicControlScript",this.movementSpeed=10,this.rollSpeed=2,this.movementSpeedMultiplier=1,this.mouseStatus=0,this.moveState={up:0,down:0,left:0,right:0,forward:0,back:0,pitchUp:0,pitchDown:0,yawLeft:0,yawRight:0,rollLeft:0,rollRight:0},this.moveVector=new t(0,0,0),this.rotationVector=new t(0,0,0),this.multiplier=new t(1,1,1),this.rotationMatrix=new e,this.tmpVec=new t,this.handleEvent=function(t){"function"==typeof this[t.type]&&this[t.type](t)},this.keydown=function(t){if(!t.altKey){switch(t.keyCode){case 16:this.movementSpeedMultiplier=.1;break;case 87:this.moveState.forward=1;break;case 83:this.moveState.back=1;break;case 65:this.moveState.left=1;break;case 68:this.moveState.right=1;break;case 82:this.moveState.up=1;break;case 70:this.moveState.down=1;break;case 38:this.moveState.pitchUp=1;break;case 40:this.moveState.pitchDown=1;break;case 37:this.moveState.yawLeft=1;break;case 39:this.moveState.yawRight=1;break;case 81:this.moveState.rollLeft=1;break;case 69:this.moveState.rollRight=1}this.updateMovementVector(),this.updateRotationVector()}},this.keyup=function(t){switch(t.keyCode){case 16:this.movementSpeedMultiplier=1;break;case 87:this.moveState.forward=0;break;case 83:this.moveState.back=0;break;case 65:this.moveState.left=0;break;case 68:this.moveState.right=0;break;case 82:this.moveState.up=0;break;case 70:this.moveState.down=0;break;case 38:this.moveState.pitchUp=0;break;case 40:this.moveState.pitchDown=0;break;case 37:this.moveState.yawLeft=0;break;case 39:this.moveState.yawRight=0;break;case 81:this.moveState.rollLeft=0;break;case 69:this.moveState.rollRight=0}this.updateMovementVector(),this.updateRotationVector()},this.mousedown=function(t){this.domElement!==document&&this.domElement.focus(),t.preventDefault(),t=t.touches&&1===t.touches.length?t.touches[0]:t,this.mouseDownX=t.pageX,this.mouseDownY=t.pageY,this.mouseStatus=1,document.addEventListener("mousemove",this.mousemove,!1),document.addEventListener("mouseup",this.mouseup,!1),document.addEventListener("touchmove",this.mousemove,!1),document.addEventListener("touchend",this.mouseup,!1)}.bind(this),this.mousemove=function(t){this.mouseStatus>0&&(t=t.touches&&1===t.touches.length?t.touches[0]:t,this.moveState.yawLeft=t.pageX-this.mouseDownX,this.moveState.pitchDown=t.pageY-this.mouseDownY,this.updateRotationVector(),this.mouseDownX=t.pageX,this.mouseDownY=t.pageY)}.bind(this),this.mouseup=function(t){this.mouseStatus&&(t.preventDefault(),this.mouseStatus=0,this.moveState.yawLeft=this.moveState.pitchDown=0,this.updateRotationVector(),document.removeEventListener("mousemove",this.mousemove),document.removeEventListener("mouseup",this.mouseup),document.removeEventListener("touchmove",this.mousemove),document.removeEventListener("touchend",this.mouseup))}.bind(this),this.updateMovementVector=function(){var t=this.moveState.forward||this.autoForward&&!this.moveState.back?1:0;this.moveVector.x=-this.moveState.left+this.moveState.right,this.moveVector.y=-this.moveState.down+this.moveState.up,this.moveVector.z=-t+this.moveState.back},this.updateRotationVector=function(){this.rotationVector.x=-this.moveState.pitchDown+this.moveState.pitchUp,this.rotationVector.y=-this.moveState.yawRight+this.moveState.yawLeft,this.rotationVector.z=-this.moveState.rollRight+this.moveState.rollLeft},this.getContainerDimensions=function(){return this.domElement!==document?{size:[this.domElement.offsetWidth,this.domElement.offsetHeight],offset:[this.domElement.offsetLeft,this.domElement.offsetTop]}:{size:[window.innerWidth,window.innerHeight],offset:[0,0]}},this.domElement&&this.setupMouseControls(),this.updateMovementVector(),this.updateRotationVector()}return i.prototype.setupMouseControls=function(){this.domElement.setAttribute("tabindex",-1),this.domElement.addEventListener("mousedown",this.mousedown,!1),this.domElement.addEventListener("touchstart",this.mousedown,!1),this.domElement.addEventListener("keydown",this.keydown.bind(this),!1),this.domElement.addEventListener("keyup",this.keyup.bind(this),!1)},i.prototype.externals=function(){return[{variable:"movementSpeed",type:"number"},{variable:"rollSpeed",type:"number"}]},i.prototype.run=function(e,i,o){o&&!this.domElement&&o.domElement&&(this.domElement=o.domElement,this.setupMouseControls());var r=e.transformComponent,n=r.transform,a=e._world.tpf,s=a*this.movementSpeed*this.movementSpeedMultiplier,c=a*this.rollSpeed*this.movementSpeedMultiplier;(!this.moveVector.equals(t.ZERO)||!this.rotationVector.equals(t.ZERO)||this.mouseStatus>0)&&(n.translation.x+=this.moveVector.x*s,n.translation.y+=this.moveVector.y*s,n.translation.z+=this.moveVector.z*s,this.tmpVec.x+=-this.rotationVector.x*c*this.multiplier.x,this.tmpVec.y+=this.rotationVector.y*c*this.multiplier.y,this.tmpVec.z+=this.rotationVector.z*c*this.multiplier.z,n.rotation.fromAngles(this.tmpVec.x,this.tmpVec.y,this.tmpVec.z),this.mouseStatus>0&&(this.moveState.yawLeft=0,this.moveState.pitchDown=0,this.updateRotationVector()),r.setUpdated())},i}),define("goo/loaders/handlers/ScriptHandler",["goo/loaders/handlers/ConfigHandler","goo/util/rsvp","goo/scripts/OrbitCamControlScript","goo/scripts/OrbitNPanControlScript","goo/scripts/FlyControlScript","goo/scripts/WASDControlScript","goo/scripts/BasicControlScript","goo/util/PromiseUtil"],function(t,e,i,o,r,n,a,s){"use strict";function c(){t.apply(this,arguments)}return c.scripts={OrbitCamControlScript:i,OrbitNPanControlScript:o,FlyControlScript:r,WASDControlScript:n,BasicControlScript:a},c.prototype=Object.create(t.prototype),c.prototype.constructor=c,t._registerClass("script",c),c.prototype._prepare=function(){},c.prototype._create=function(){},c.prototype.update=function(t,e){var i=e.className,o=null;return c.scripts[i]instanceof Function&&(o=new c.scripts[i](e.options)),s.createDummyPromise(o)},c}),define("goo/statemachine/FSMComponent",["goo/entities/components/Component","goo/util/ArrayUtil","goo/entities/SystemBus"],function(t,e,i){"use strict";function o(){this.type="FSMComponent",this._machines=[],this.entity=null,this.vars={},this.system=null,this.time=0,this.active=!0}return o.prototype=Object.create(t.prototype),o.vars={},o.getVariable=function(t){return o.vars[t]},o.prototype.getVariable=function(t){return void 0!==this.vars[t]?this.vars[t]:o.getVariable(t)},o.applyOnVariable=function(t,e){o.vars[t]=e(o.vars[t])},o.prototype.applyOnVariable=function(t,e){void 0!==this.vars[t]?this.vars[t]=e(this.vars[t]):o.applyOnVariable(t,e)},o.prototype.defineVariable=function(t,e){this.vars[t]=e},o.prototype.removeVariable=function(t){delete this.vars[t]},o.applyOnVariable=function(t,e){this.vars[t]?this.vars[t]=e(this.vars[t]):o.vars[t]&&o.applyOnVariable(t,e)},o.prototype.addMachine=function(t){t._fsm=this,t.parent=this,this._machines.push(t)},o.prototype.removeMachine=function(t){t.recursiveRemove(),e.remove(this._machines,t)},o.prototype.init=function(){for(var t=0;t<this._machines.length;t++){var e=this._machines[t];e.setRefs(this),e.reset(),e.ready()}},o.prototype.doEnter=function(){for(var t=0;t<this._machines.length;t++){var e=this._machines[t];e.enter()}},o.prototype.kill=function(){for(var t=0;t<this._machines.length;t++){var e=this._machines[t];e.kill()}},o.prototype.cleanup=function(){for(var t=0;t<this._machines.length;t++){var e=this._machines[t];e.cleanup()}},o.prototype.update=function(){if(this.active)for(var t=0;t<this._machines.length;t++){var e=this._machines[t];e.update()}},o.prototype.pause=function(){this.active=!1,i.emit("goo.entity."+this.entity.name+".fsm.pause")},o.prototype.play=function(){this.active=!0,i.emit("goo.entity."+this.entity.name+".fsm.play")},o}),define("goo/loaders/handlers/FSMComponentHandler",["goo/loaders/handlers/ComponentHandler","goo/statemachine/FSMComponent","goo/util/rsvp","goo/util/PromiseUtil","goo/util/ArrayUtil"],function(t,e,i,o,r){"use strict";function n(){t.apply(this,arguments)}return n.prototype=Object.create(t.prototype),n.prototype.constructor=n,t._registerClass("stateMachine",n),n._type="fSM",n.prototype._prepare=function(){},n.prototype._create=function(t){var i=new e;return t.setComponent(i),i},n.prototype.update=function(e,n){function a(t){return s.getConfig(t).then(function(e){return s.updateObject(t,e)})}var s=this,c=[],l=t.prototype.update.call(this,e,n);if(n.machineRefs&&n.machineRefs.length)for(var h=n.machineRefs,u=0;u<h.length;u++)c.push(a(h[u]));return c.length>0?i.all(c).then(function(t){var e=l._machines;l._machines=[];for(var i=0;i<t.length;i++)l.addMachine(t[i]),r.remove(e,t[i]);for(var i=0;i<e.length;i++)l.removeMachine(e[i]);return l}):o.createDummyPromise(l)},n}),define("goo/statemachine/State",["goo/util/ArrayUtil"],function(t){"use strict";function e(t){this.uuid=t,this._fsm=null,this.parent=null,this._actions=[],this._machines=[],this._transitions={},this.vars={},this.transitionTarget=null,this.proxy={getTpf:function(){return this._fsm.entity._world.tpf}.bind(this),getTime:function(){return this._fsm.system.time}.bind(this),getState:function(){return this}.bind(this),getFsm:function(){return this._fsm}.bind(this),getOwnerEntity:function(){return this._fsm.entity}.bind(this),send:function(t){t&&"string"==typeof t&&this._transitions[t]&&this.requestTransition(this._transitions[t])}.bind(this),addListener:function(t,e){this._fsm._bus.addListener(t,e)}.bind(this),removeListener:function(t,e){this._fsm._bus.removeListener(t,e)}.bind(this),defineVariable:function(t,e){this.vars[t]=e}.bind(this),removeVariable:function(t){delete this.vars[t]}.bind(this),getVariable:function(t){return void 0!==this.vars[t]?this.vars[t]:this._fsm.getVariable(t)}.bind(this),applyOnVariable:function(t,e){void 0!==this.vars[t]?this.vars[t]=e(this.vars[t]):this._fsm.applyOnVariable(t,e)}.bind(this),getEvalProxy:function(){return this._fsm.system.evalProxy}.bind(this)}}return e.prototype.setRefs=function(t){this._fsm=t;for(var e=0;e<this._machines.length;e++){var i=this._machines[e];i.setRefs(t)}},e.prototype.isCurrentState=function(){return this===this.parent.getCurrentState()},e.prototype.requestTransition=function(t){this.isCurrentState()&&(this.transitionTarget=t)},e.prototype.setTransition=function(t,e){this._transitions[t]=e},e.prototype.clearTransition=function(t){delete this._transitions[t]},e.prototype.update=function(){for(var t=0;t<this._actions.length;t++)if(this._actions[t].update(this.proxy),this.transitionTarget){var e=this.transitionTarget;return this.transitionTarget=null,e}for(var i,t=0;t<this._machines.length;t++){var o=this._machines[t];if(i=o.update())return i}},e.prototype.reset=function(){for(var t=0;t<this._machines.length;t++)this._machines[t].reset()},e.prototype.kill=function(){for(var t=0;t<this._machines.length;t++)this._machines[t].kill();for(var t=0;t<this._actions.length;t++)this._actions[t].exit(this.proxy)},e.prototype.ready=function(){for(var t=0;t<this._machines.length;t++)this._machines[t].ready();for(var t=0;t<this._actions.length;t++)this._actions[t].ready(this.proxy)},e.prototype.cleanup=function(){for(var t=0;t<this._machines.length;t++)this._machines[t].cleanup();for(var t=0;t<this._actions.length;t++)this._actions[t].cleanup(this.proxy)},e.prototype.enter=function(){for(var t=0;t<this._actions.length;t++)this._actions[t].enter(this.proxy);for(var t=0;t<this._machines.length;t++)this._machines[t].enter()},e.prototype.getAction=function(t){if(!this._actions)return void 0;for(var e=0;e<this._actions.length;e++){var i=this._actions[e];if(void 0!==t&&i.id===t)return i}return void 0},e.prototype.addAction=function(t){this._actions[t.id]||(t.onCreate&&t.onCreate(this.proxy),this._actions.push(t))},e.prototype.recursiveRemove=function(){this.removeAllActions();for(var t=0;t<this._machines.length;t++)this._machines[t].recursiveRemove();this._machines=[]},e.prototype.removeAllActions=function(){for(var t=0;t<this._actions.length;t++){var e=this._actions[t];e.onDestroy&&e.onDestroy(this.proxy)}this._actions=[]},e.prototype.removeAction=function(e){e.onDestroy&&e.onDestroy(this.proxy),t.remove(this._actions,e)},e.prototype.addMachine=function(t){var e=this._machines.indexOf(t);-1===e&&(t._fsm=this._fsm,t.parent=this,this._machines.push(t))},e.prototype.removeMachine=function(e){e.recursiveRemove(),t.remove(this._machines,e)},e}),define("goo/statemachine/Machine",[],function(){"use strict";function t(t){this.name=t,this._fsm=null,this._states=null,this.initialState="entry",this.currentState=null,this.parent=null}return t.prototype.setRefs=function(t){this._fsm=t;for(var e=Object.keys(this._states),i=0;i<e.length;i++){var o=this._states[e[i]];o.setRefs(t)}},t.prototype.update=function(){if(this.currentState){var t=this.currentState.update();return t&&this.contains(t)&&(this.currentState.kill(),this.setState(this._states[t])),t}},t.prototype.contains=function(t){return!!this._states[t]},t.prototype.setState=function(t){this.currentState=t,this.currentState.reset(),this.currentState.enter()},t.prototype.reset=function(){this.currentState=this._states[this.initialState],this.currentState&&this.currentState.reset()},t.prototype.kill=function(){this.currentState&&this.currentState.kill()},t.prototype.ready=function(){for(var t=Object.keys(this._states),e=0;e<t.length;e++){var i=this._states[t[e]];i.ready()}},t.prototype.cleanup=function(){for(var t=Object.keys(this._states),e=0;e<t.length;e++){var i=this._states[t[e]];i.cleanup()}},t.prototype.enter=function(){this.currentState&&this.currentState.enter()},t.prototype.getCurrentState=function(){return this.currentState},t.prototype.addState=function(t){this._states||(this._states={},this.initialState=t.uuid),t.parent=this,t._fsm=this._fsm,this._states[t.uuid]=t},t.prototype.removeFromParent=function(){this.parent&&this.parent.removeMachine(this)},t.prototype.recursiveRemove=function(){for(var t=Object.keys(this._states),e=0;e<t.length;e++){var i=this._states[t[e]];i.recursiveRemove()}this._states={}},t.prototype.removeState=function(t){if(this._states[t]){if(this.initialState===t)throw new Error("Cannot remove initial state");this.currentState===this._states[t]&&this.reset(),delete this._states[t]}},t.prototype.setInitialState=function(t){this.initialState=t},t}),define("goo/statemachine/FSMUtil",[],function(){"use strict";function t(){}function e(t){for(var e=[],i=Object.keys(t),o=0;o<i.length;o++)e[t[i[o]]]=i[o];return e}t.setParameters=function(t,e){for(var i=0;i<e.length;i++){var o=e[i],r=o.key;this[r]="undefined"!=typeof t[r]?t[r]:o["default"]}},t.setTransitions=function(t,e){for(var i=0;i<e.length;i++){var o=e[i],r=o.key;this.transitions=this.transitions||{},this.transitions[r]=t.transitions[r]}},t.getKey=function(e){return t.keys[e]?t.keys[e]:e.charCodeAt(0)},t.keys={Backspace:8,Tab:9,Enter:13,Shift:16,Ctrl:17,Alt:18,Pause:19,Capslock:20,Esc:27,Space:32,Pageup:33,Pagedown:34,End:35,Home:36,Leftarrow:37,Uparrow:38,Rightarrow:39,Downarrow:40,Insert:45,Delete:46,0:48,1:49,2:50,3:51,4:52,5:53,6:54,7:55,8:56,9:57,a:65,b:66,c:67,d:68,e:69,f:70,g:71,h:72,i:73,j:74,k:75,l:76,m:77,n:78,o:79,p:80,q:81,r:82,s:83,t:84,u:85,v:86,w:87,x:88,y:89,z:90,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,"0numpad":96,"1numpad":97,"2numpad":98,"3numpad":99,"4numpad":100,"5numpad":101,"6numpad":102,"7numpad":103,"8numpad":104,"9numpad":105,Multiply:106,Plus:107,Minus:109,Dot:110,Slash1:111,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,Equals:187,Comma:188,Slash:191,Backslash:220},t.keyInverse=[],t.keyInverse=e(t.keys),t.keyForCode=function(e){return t.keyInverse[e]?t.keyInverse[e]:"FSMUtil.keyForCode: key not found for code "+e
};var i=function(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)};return t.guid=function(){return i()+i()+"-"+i()+"-"+i()+"-"+i()+"-"+i()+i()+i()},t.getValue=function(t,e){return"number"==typeof t?t:e.getVariable(t)},t.createComposableTween=function(t,e,i,o,r,n){var a=new window.TWEEN.Tween,s=i;return a.from({v:i}).to({v:o}).onUpdate(function(){t[e]+=this.v-s,s=this.v,n&&n()})},t}),define("goo/statemachine/actions/Action",["goo/statemachine/FSMUtil"],function(t){"use strict";function e(t,e){this.id=t,this.configure(e||{})}return e.prototype._setup=function(){},e.prototype._run=function(){},e.prototype.configure=function(e){t.setParameters.call(this,e,this.constructor.external.parameters),t.setTransitions.call(this,e,this.constructor.external.transitions)},e.prototype.enter=function(t){this._setup(t),this.everyFrame||this._run(t)},e.prototype.update=function(t){this.everyFrame&&this._run(t)},e.prototype.ready=function(){},e.prototype.cleanup=function(){},e.prototype.exit=function(){},e}),define("goo/statemachine/actions/MoveAction",["goo/statemachine/actions/Action","goo/math/Vector3"],function(t,e){"use strict";function i(){t.apply(this,arguments)}return i.prototype=Object.create(t.prototype),i.prototype.constructor=i,i.external={name:"Move",description:"Moves the entity",parameters:[{name:"Translation",key:"translation",type:"position",description:"Move","default":[0,0,0]},{name:"Oriented",key:"oriented",type:"boolean",description:"If true translate with rotation","default":!0},{name:"Relative",key:"relative",type:"boolean",description:"If true add to current translation","default":!0},{name:"On every frame",key:"everyFrame",type:"boolean",description:"Repeat this action every frame","default":!0}],transitions:[]},i.prototype._setup=function(t){var i=t.getOwnerEntity(),o=i.transformComponent.transform;this.forward=(new e).seta(this.translation);var r=o.rotation;r.applyPost(this.forward)},i.prototype._run=function(t){var i=t.getOwnerEntity(),o=i.transformComponent.transform,r=o.translation;if(this.oriented)if(this.relative){var n=(new e).seta(this.translation),a=o.rotation;a.applyPost(n),this.everyFrame?(n.scale(10*t.getTpf()),r.add(n)):r.add(n)}else r.set(this.forward);else if(this.relative)if(this.everyFrame){var s=10*t.getTpf();r.data[0]+=this.translation[0]*s,r.data[1]+=this.translation[1]*s,r.data[2]+=this.translation[2]*s}else r.add(this.translation);else r.set(this.translation);i.transformComponent.setUpdated()},i}),define("goo/statemachine/actions/RotateAction",["goo/statemachine/actions/Action","goo/math/MathUtils"],function(t,e){"use strict";function i(){t.apply(this,arguments)}return i.prototype=Object.create(t.prototype),i.prototype.constructor=i,i.external={name:"Rotate",description:"Rotates the entity",parameters:[{name:"Rotation",key:"rotation",type:"rotation",description:"Rotate","default":[0,0,0]},{name:"Relative",key:"relative",type:"boolean",description:"If true add to current rotation","default":!0},{name:"On every frame",key:"everyFrame",type:"boolean",description:"Repeat this action every frame","default":!0}],transitions:[]},i.prototype._run=function(t){var i=t.getOwnerEntity(),o=i.transformComponent.transform;if(this.relative)if(this.everyFrame){var r=t.getTpf();o.rotation.rotateX(this.rotation[0]*e.DEG_TO_RAD*r),o.rotation.rotateY(this.rotation[1]*e.DEG_TO_RAD*r),o.rotation.rotateZ(this.rotation[2]*e.DEG_TO_RAD*r)}else o.rotation.rotateX(this.rotation[0]*e.DEG_TO_RAD),o.rotation.rotateY(this.rotation[1]*e.DEG_TO_RAD),o.rotation.rotateZ(this.rotation[2]*e.DEG_TO_RAD);else if(this.everyFrame){var r=t.getTpf();o.setRotationXYZ(this.rotation[0]*e.DEG_TO_RAD*r,this.rotation[1]*e.DEG_TO_RAD*r,this.rotation[2]*e.DEG_TO_RAD*r)}else o.setRotationXYZ(this.rotation[0]*e.DEG_TO_RAD,this.rotation[1]*e.DEG_TO_RAD,this.rotation[2]*e.DEG_TO_RAD);i.transformComponent.setUpdated()},i}),define("goo/statemachine/actions/ScaleAction",["goo/statemachine/actions/Action"],function(t){"use strict";function e(){t.apply(this,arguments)}return e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.external={name:"Scale",description:"Scales the entity",parameters:[{name:"Scale",key:"scale",type:"position",description:"Move","default":[0,0,0]},{name:"Relative",key:"relative",type:"boolean",description:"If true add/multiply the current scaling","default":!0},{name:"Multiply",key:"multiply",type:"boolean",description:"If true multiply, otherwise add","default":!1},{name:"On every frame",key:"everyFrame",type:"boolean",description:"Repeat this action every frame","default":!1}],transitions:[]},e.prototype._run=function(t){var e=t.getOwnerEntity(),i=e.transformComponent.transform;if(this.relative)if(this.multiply)if(this.everyFrame){var o=10*t.getTpf();i.scale.data[0]*=this.scale[0]*o,i.scale.data[1]*=this.scale[1]*o,i.scale.data[2]*=this.scale[2]*o}else i.scale.mul(this.scale);else if(this.everyFrame){var o=10*t.getTpf();i.scale.data[0]+=this.scale[0]*o,i.scale.data[1]+=this.scale[1]*o,i.scale.data[2]+=this.scale[2]*o}else i.scale.add(this.scale);else i.scale.set(this.scale);e.transformComponent.setUpdated()},e}),define("goo/statemachine/actions/LookAtAction",["goo/statemachine/actions/Action","goo/math/Vector3"],function(t,e){"use strict";function i(){t.apply(this,arguments)}return i.prototype=Object.create(t.prototype),i.prototype.constructor=i,i.external={name:"Look At",description:"Reorients an entity so that it's facing a specific point",parameters:[{name:"Look at position",key:"lookAt",type:"position",description:"Position to look at","default":[0,0,0]},{name:"On every frame",key:"everyFrame",type:"boolean",description:"Repeat this action every frame","default":!0}],transitions:[]},i.prototype._run=function(t){var i=t.getOwnerEntity(),o=i.transformComponent;o.transform.lookAt(new e(this.lookAt),e.UNIT_Y),o.setUpdated()},i}),define("goo/statemachine/actions/TweenMoveAction",["goo/statemachine/actions/Action","goo/math/Vector3"],function(t,e){"use strict";function i(){t.apply(this,arguments)}return i.prototype=Object.create(t.prototype),i.prototype.constructor=i,i.external={name:"Tween Move",description:"Smoothly transitions between two locations",canTransition:!0,parameters:[{name:"Translation",key:"to",type:"position",description:"Move","default":[0,0,0]},{name:"Relative",key:"relative",type:"boolean",description:"If true add, otherwise set","default":!0},{name:"Time",key:"time",type:"number",description:"Time it takes for this movement to complete","default":1e3},{name:"Easing type",key:"easing1",type:"dropdown",description:"Easing type","default":"Linear",options:["Linear","Quadratic","Exponential","Circular","Elastic","Back","Bounce"]},{name:"Direction",key:"easing2",type:"dropdown",description:"Easing direction","default":"In",options:["In","Out","InOut"]}],transitions:[{key:"complete",name:"On Completion",description:"State to transition to when the movement completes"}]},i.prototype.configure=function(t){this.to=t.to,this.relative=t.relative,this.time=t.time,this.easing="Linear"===t.easing1?window.TWEEN.Easing.Linear.None:window.TWEEN.Easing[t.easing1][t.easing2],this.eventToEmit={channel:t.transitions.complete}},i.prototype._setup=function(){this.tween=new window.TWEEN.Tween},i.prototype.cleanup=function(){this.tween&&this.tween.stop()},i.prototype._run=function(t){var i,o=t.getOwnerEntity(),r=o.transformComponent,n=r.transform.translation,a=(new e).copy(n),s={x:a.x,y:a.y,z:a.z},c={x:s.x,y:s.y,z:s.z};if(this.relative){var l=e.add(a,this.to);i={x:l.x,y:l.y,z:l.z},this.tween.from(s).to(i,+this.time).easing(this.easing).onUpdate(function(){n.data[0]+=this.x-c.x,n.data[1]+=this.y-c.y,n.data[2]+=this.z-c.z,c.x=this.x,c.y=this.y,c.z=this.z,r.setUpdated()}).onComplete(function(){t.send(this.eventToEmit.channel)}.bind(this)).start(1e3*t.getTime())}else i={x:this.to[0],y:this.to[1],z:this.to[2]},this.tween.from(s).to(i,+this.time).easing(this.easing).onUpdate(function(){n.data[0]+=this.x-c.x,n.data[1]+=this.y-c.y,n.data[2]+=this.z-c.z,c.x=this.x,c.y=this.y,c.z=this.z,r.setUpdated()}).onComplete(function(){t.send(this.eventToEmit.channel)}.bind(this)).start(1e3*t.getTime())},i}),define("goo/statemachine/actions/TweenRotationAction",["goo/statemachine/actions/Action","goo/math/Quaternion","goo/math/Matrix3x3","goo/math/MathUtils"],function(t,e,i,o){"use strict";function r(){t.apply(this,arguments)}return r.prototype=Object.create(t.prototype),r.prototype.constructor=r,r.external={name:"Tween Rotation",description:"Smoothly transitions between two orientations",canTransition:!0,parameters:[{name:"Rotation",key:"to",type:"rotation",description:"Rotation","default":[0,0,0]},{name:"Relative",key:"relative",type:"boolean",description:"If true add, otherwise set","default":!0},{name:"Time",key:"time",type:"number",description:"Time it takes for this movement to complete","default":1e3},{name:"Easing type",key:"easing1",type:"dropdown",description:"Easing type","default":"Linear",options:["Linear","Quadratic","Exponential","Circular","Elastic","Back","Bounce"]},{name:"Direction",key:"easing2",type:"dropdown",description:"Easing direction","default":"In",options:["In","Out","InOut"]}],transitions:[{key:"complete",name:"On Completion",description:"State to transition to when the rotation completes"}]},r.prototype.configure=function(t){this.to=t.to,this.relative=t.relative,this.time=t.time,this.easing="Linear"===t.easing1?window.TWEEN.Easing.Linear.None:window.TWEEN.Easing[t.easing1][t.easing2],this.eventToEmit={channel:t.transitions.complete}},r.prototype._setup=function(){this.tween=new window.TWEEN.Tween},r.prototype.cleanup=function(){this.tween&&this.tween.stop()},r.prototype._run=function(t){var r=t.getOwnerEntity(),n=r.transformComponent,a=n.transform.rotation,s=(new e).fromRotationMatrix(a),c=(new e).fromRotationMatrix((new i).fromAngles(this.to[0]*o.DEG_TO_RAD,this.to[1]*o.DEG_TO_RAD,this.to[2]*o.DEG_TO_RAD)),l=new e;this.relative&&e.mul2(s,c,c),this.tween.from({t:0}).to({t:1},+this.time).easing(this.easing).onUpdate(function(){e.slerp(s,c,this.t,l),a.copyQuaternion(l),n.setUpdated()}).onComplete(function(){t.send(this.eventToEmit.channel)}.bind(this)).start(1e3*t.getTime())},r}),define("goo/statemachine/actions/TweenScaleAction",["goo/statemachine/actions/Action","goo/math/Vector3"],function(t,e){"use strict";function i(){t.apply(this,arguments)}return i.prototype=Object.create(t.prototype),i.prototype.constructor=i,i.external={name:"Tween Scale",description:"Smoothly scales the entity",canTransition:!0,parameters:[{name:"Scale",key:"to",type:"position",description:"Scale","default":[0,0,0]},{name:"Relative",key:"relative",type:"boolean",description:"If true add, otherwise set","default":!0},{name:"Time",key:"time",type:"number",description:"Time it takes for this movement to complete","default":1e3},{name:"Easing type",key:"easing1",type:"dropdown",description:"Easing type","default":"Linear",options:["Linear","Quadratic","Exponential","Circular","Elastic","Back","Bounce"]},{name:"Direction",key:"easing2",type:"dropdown",description:"Easing direction","default":"In",options:["In","Out","InOut"]}],transitions:[{key:"complete",name:"On Completion",description:"State to transition to when the scaling completes"}]},i.prototype.configure=function(t){this.to=t.to,this.relative=t.relative,this.time=t.time,this.easing="Linear"===t.easing1?window.TWEEN.Easing.Linear.None:window.TWEEN.Easing[t.easing1][t.easing2],this.eventToEmit={channel:t.transitions.complete}},i.prototype._setup=function(){this.tween=new window.TWEEN.Tween},i.prototype.cleanup=function(){this.tween&&this.tween.stop()},i.prototype._run=function(t){var i,o=t.getOwnerEntity(),r=o.transformComponent,n=r.transform.scale,a=(new e).copy(n),s={x:a.x,y:a.y,z:a.z};if(this.relative){var c=e.add(a,this.to);i={x:c.x,y:c.y,z:c.z},this.tween.from(s).to(i,+this.time).easing(this.easing).onUpdate(function(){n.setd(this.x,this.y,this.z),r.setUpdated()}).onComplete(function(){t.send(this.eventToEmit.channel)}.bind(this)).start(1e3*t.getTime())}else i={x:this.to[0],y:this.to[1],z:this.to[2]},this.tween.from(s).to(i,+this.time).easing(this.easing).onUpdate(function(){n.setd(this.x,this.y,this.z),r.setUpdated()}).onComplete(function(){t.send(this.eventToEmit.channel)}.bind(this)).start(1e3*t.getTime())},i}),define("goo/statemachine/actions/TweenLookAtAction",["goo/statemachine/actions/Action","goo/math/Vector3"],function(t,e){"use strict";function i(){t.apply(this,arguments)}return i.prototype=Object.create(t.prototype),i.prototype.constructor=i,i.external={name:"Tween Look At",description:"Smoothly transitions between two look at points",canTransition:!0,parameters:[{name:"Position",key:"to",type:"position",description:"Look at point","default":[0,0,0]},{name:"Time",key:"time",type:"number",description:"Time it takes for this movement to complete","default":1e3},{name:"Easing type",key:"easing1",type:"dropdown",description:"Easing type","default":"Linear",options:["Linear","Quadratic","Exponential","Circular","Elastic","Back","Bounce"]},{name:"Direction",key:"easing2",type:"dropdown",description:"Easing direction","default":"In",options:["In","Out","InOut"]}],transitions:[{key:"complete",name:"On completion",description:"State to transition to when the transition completes"}]},i.prototype.configure=function(t){this.to=t.to,this.relative=t.relative,this.time=t.time,this.easing="Linear"===t.easing1?window.TWEEN.Easing.Linear.None:window.TWEEN.Easing[t.easing1][t.easing2],this.eventToEmit={channel:t.transitions.complete}},i.prototype._setup=function(){this.tween=new window.TWEEN.Tween},i.prototype.cleanup=function(){this.tween&&this.tween.stop()},i.prototype._run=function(t){var i=t.getOwnerEntity(),o=i.transformComponent,r=o.transform,n=e.distance(new e(this.to),r.translation),a=new e(0,0,1),s=r.rotation;s.applyPost(a),a.scale(n);var c={x:a.x,y:a.y,z:a.z},l={x:this.to[0],y:this.to[1],z:this.to[2]},h=new e;this.tween.from(c).to(l,+this.time).easing(this.easing).onUpdate(function(){h.data[0]=this.x,h.data[1]=this.y,h.data[2]=this.z,r.lookAt(h,e.UNIT_Y),o.setUpdated()}).onComplete(function(){t.send(this.eventToEmit.channel)}.bind(this)).start(1e3*t.getTime())},i}),define("goo/statemachine/actions/HideAction",["goo/statemachine/actions/Action","goo/entities/EntityUtils"],function(t,e){"use strict";function i(){t.apply(this,arguments)}return i.prototype=Object.create(t.prototype),i.prototype.constructor=i,i.external={name:"Hide",description:"Hides an entity and its children",parameters:[],transitions:[]},i.prototype._run=function(t){var i=t.getOwnerEntity();e.hide(i)},i}),define("goo/statemachine/actions/ShowAction",["goo/statemachine/actions/Action","goo/entities/EntityUtils"],function(t,e){"use strict";function i(){t.apply(this,arguments)}return i.prototype=Object.create(t.prototype),i.prototype.constructor=i,i.external={name:"Show",description:"Makes an entity visible",parameters:[],transitions:[]},i.prototype._run=function(t){var i=t.getOwnerEntity();e.show(i)},i}),define("goo/statemachine/actions/RemoveAction",["goo/statemachine/actions/Action"],function(t){"use strict";function e(){t.apply(this,arguments)}return e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.external={name:"Remove",description:"Removes the entity from the world",parameters:[{name:"Recursive",key:"recursive",type:"boolean",description:"Remove children too","default":!1}],transitions:[]},e.prototype._run=function(t){var e=t.getOwnerEntity();e.removeFromWorld(this.recursive)},e}),define("goo/statemachine/actions/AddLightAction",["goo/statemachine/actions/Action","goo/entities/components/LightComponent","goo/renderer/light/PointLight"],function(t,e,i){"use strict";function o(){t.apply(this,arguments)}return o.prototype=Object.create(t.prototype),o.prototype.constructor=o,o.external={name:"Add Light",description:"Adds a light on the entity",parameters:[{name:"Color",key:"color",type:"color",description:"Color of the light","default":[1,1,1]},{name:"Range",key:"range",type:"int",control:"slider",min:0,max:5e3,description:"Range of the light","default":200}],transitions:[]},o.prototype._run=function(t){var o=new i;o.range=+this.range,o.color.setd(this.color[0],this.color[1],this.color[2]);var r=t.getOwnerEntity();r.setComponent(new e(o))},o.prototype.cleanup=function(t){var e=t.getOwnerEntity();e.hasComponent("LightComponent")&&e.clearComponent("LightComponent")},o}),define("goo/statemachine/actions/RemoveLightAction",["goo/statemachine/actions/Action"],function(t){"use strict";function e(){t.apply(this,arguments)}return e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.external={name:"Remove Light",description:"Removes the light attached to the entity",parameters:[],transitions:[]},e.prototype._run=function(t){var e=t.getOwnerEntity();e.hasComponent("LightComponent")&&e.clearComponent("LightComponent")},e}),define("goo/statemachine/actions/InBoxAction",["goo/statemachine/actions/Action"],function(t){"use strict";function e(){t.apply(this,arguments)}function i(t,e,i){var o=!1,r=function(t,e,i){if(e>i){if(e>t&&t>i)return!0}else if(i>e){if(i>t&&t>e)return!0}else if(t===i)return!0;return!1},n=r(t[0],e[0],i[0]),a=r(t[1],e[1],i[1]),s=r(t[2],e[2],i[2]);return n&&a&&s&&(o=!0),o}return e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.external={name:"In Box",description:"Performs a transition based on whether an entity is inside a user defined box or not",canTransition:!0,parameters:[{name:"Point1",key:"point1",type:"position",description:"First box point","default":[-1,-1,-1]},{name:"Point2",key:"point2",type:"position",description:"Second box point","default":[1,1,1]},{name:"On every frame",key:"everyFrame",type:"boolean",description:"Repeat this action every frame","default":!0}],transitions:[{key:"inside",name:"Inside",description:"State to transition to if the entity is inside the box"},{key:"outside",name:"Outside",description:"State to transition to if the entity is outside the box"}]},e.prototype._run=function(t){var e=t.getOwnerEntity(),o=e.transformComponent.worldTransform.translation,r=i(o.data,this.point1,this.point2);r?t.send(this.transitions.inside):t.send(this.transitions.outside)},e}),define("goo/statemachine/actions/CompareDistanceAction",["goo/statemachine/actions/Action","goo/math/Vector3","goo/renderer/Renderer"],function(t,e,i){"use strict";function o(){t.apply(this,arguments)}return o.prototype=Object.create(t.prototype),o.prototype.constructor=o,o.external={name:"Compare Distance",description:"Performs a transition based on the distance to the main camera or to a location",canTransition:!0,parameters:[{name:"Current camera",key:"camera",type:"boolean",description:"Measure the distance to the current camera or to an arbitrary point","default":!0},{name:"Position",key:"position",type:"position",description:"Position to measure the distance to; Will be ignored if previous option is selected","default":[0,0,0]},{name:"Value",key:"value",type:"number",description:"Value to compare to","default":0},{name:"Tolerance",key:"tolerance",type:"number","default":.1},{name:"Type",key:"distanceType",type:"dropdown",description:"The type of distance","default":"Euclidean",options:["Euclidean","Manhattan"]},{name:"On every frame",key:"everyFrame",type:"boolean",description:"Repeat this action every frame","default":!0}],transitions:[{key:"less",name:"Less",description:"State to transition to if the measured distance is smaller than the specified value"},{key:"equal",name:"Equal",description:"State to transition to if the measured distance is about the same as the specified value"},{key:"greater",name:"Greater",description:"State to transition to if the measured distance is greater than the specified value"}]},o.prototype._run=function(t){var o,r=t.getOwnerEntity(),n=r.transformComponent.worldTransform.translation;o=this.camera?e.sub(n,i.mainCamera.translation):e.sub(n,new e(this.position));var a;a="Euclidean"===this.type?o.length():Math.abs(o.x)+Math.abs(o.y)+Math.abs(o.z);var s=this.value-a;Math.abs(s)<=this.tolerance?t.send(this.transitions.equal):s>0?t.send(this.transitions.less):t.send(this.transitions.greater)},o}),define("goo/statemachine/actions/SetClearColorAction",["goo/statemachine/actions/Action"],function(t){"use strict";function e(){t.apply(this,arguments)}return e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.external={name:"Set Clear Color",description:"Sets the clear color",parameters:[{name:"Color",key:"color",type:"color",description:"Color","default":[1,1,1]}],transitions:[]},e.prototype._run=function(t){var e=t.getOwnerEntity(),i=e._world.gooRunner;i.renderer.setClearColor(this.color[0],this.color[1],this.color[2],1)},e}),define("goo/statemachine/actions/InFrustumAction",["goo/statemachine/actions/Action","goo/renderer/Camera","goo/renderer/bounds/BoundingSphere"],function(t,e,i){"use strict";function o(){t.apply(this,arguments)}return o.prototype=Object.create(t.prototype),o.prototype.constructor=o,o.external={name:"In Frustum",description:"Performs a transition based on whether the entity is in a camera's frustum or not",canTransition:!0,parameters:[{name:"Current camera",key:"current",type:"boolean",description:"Check this to always use the current camera","default":!0},{name:"Camera",key:"cameraEntityRef",type:"cameraEntity",description:"Other camera; Will be ignored if the previous option is checked","default":null},{name:"On every frame",key:"everyFrame",type:"boolean",description:"Repeat this action every frame","default":!0}],transitions:[{key:"inside",name:"Inside",description:"State to transition to if entity is in the frustum"},{key:"outside",name:"Outside",description:"State to transition to if entity is outside the frustum"}]},o.prototype._setup=function(t){if(!this.current){var e=t.getOwnerEntity()._world,i=e.entityManager.getEntityByName(this.cameraEntityRef);this.camera=i.cameraComponent.camera}},o.prototype._run=function(t){var o=t.getOwnerEntity();if(this.current)o.isVisible?t.send(this.transitions.inside):t.send(this.transitions.outside);else{var r=o.meshRendererComponent?o.meshRendererComponent.worldBound:new i(o.transformComponent.worldTransform.translation,.001);this.camera.contains(r)===e.Outside?t.send(this.transitions.outside):t.send(this.transitions.inside)}},o}),define("goo/statemachine/actions/TransitionAction",["goo/statemachine/actions/Action"],function(t){"use strict";function e(){t.apply(this,arguments)}return e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.external={name:"Transition",description:"Performs a transition",canTransition:!0,parameters:[],transitions:[{key:"transition",name:"To",description:"State to transition to"}]},e.prototype._run=function(t){t.send(this.transitions.transition)},e}),define("goo/statemachine/actions/EmitAction",["goo/statemachine/actions/Action","goo/entities/SystemBus"],function(t,e){"use strict";function i(){t.apply(this,arguments)}return i.prototype=Object.create(t.prototype),i.prototype.constructor=i,i.external={name:"Emit message",description:"Emits a message on the bus",parameters:[{name:"Channel",key:"channel",type:"string",description:"Channel to transmit on","default":""}],transitions:[]},i.prototype._run=function(){e.emit(this.channel,this.data)},i}),define("goo/statemachine/actions/EvalAction",["goo/statemachine/actions/Action"],function(t){"use strict";function e(){t.apply(this,arguments),this.expressionFunction=null}return e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.external={name:"Eval",description:"Evaluates a JS expression",parameters:[{name:"expression",key:"expression",type:"string",description:"JavaScript expression to evaluate","default":""}],transitions:[]},e.prototype._setup=function(){this.expressionFunction=new Function("goo",this.expression)},e.prototype._run=function(t){if(this.expressionFunction)try{this.expressionFunction(t.getEvalProxy())}catch(e){console.warn("Eval code error: "+e.message)}},e}),define("goo/statemachine/actions/SwitchCameraAction",["goo/statemachine/actions/Action","goo/entities/SystemBus","goo/renderer/Renderer"],function(t,e,i){"use strict";function o(){t.apply(this,arguments),this._camera=null}return o.prototype=Object.create(t.prototype),o.prototype.constructor=o,o.external={name:"Switch Camera",description:"Switches between cameras",parameters:[{name:"Camera",key:"cameraEntityRef",type:"cameraEntity",description:"Camera to switch to","default":null}],transitions:[]},o.prototype.ready=function(){this._camera=i.mainCamera},o.prototype._run=function(t){var i=t.getOwnerEntity()._world,o=i.entityManager.getEntityByName(this.cameraEntityRef);o&&o.cameraComponent&&e.emit("goo.setCurrentCamera",{camera:o.cameraComponent.camera,entity:o})},o.prototype.cleanup=function(){e.emit("goo.setCurrentCamera",{camera:this._camera,entity:null})},o}),define("goo/statemachine/actions/LogMessageAction",["goo/statemachine/actions/Action"],function(t){"use strict";function e(){t.apply(this,arguments)}return e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.external={name:"Log Message",description:"Prints a message in the debug console of your browser",parameters:[{name:"Message",key:"message",type:"string",description:"Message to print","default":"hello"},{name:"On every frame",key:"everyFrame",type:"boolean",description:"Repeat this action every frame","default":!1}],transitions:[]},e.prototype._run=function(){console.log(this.message)},e}),define("goo/statemachine/actions/PauseAnimationAction",["goo/statemachine/actions/Action"],function(t){"use strict";function e(){t.apply(this,arguments)}return e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.external={name:"Pause Animation",description:"Pauses animations",parameters:[{name:"On all",key:"onAll",type:"boolean",description:"Pause animation on all entities or just one","default":!1}],transitions:[]},e.prototype._run=function(t){if(this.onAll){var e=t.getWorld(),i=e.getSystem("AnimationSystem");i.pause()}else{var o=t.getOwnerEntity();o.animationComponent&&o.animationComponent.pause()}},e}),define("goo/statemachine/actions/ResumeAnimationAction",["goo/statemachine/actions/Action"],function(t){"use strict";function e(){t.apply(this,arguments)}return e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.external={name:"Resume Animation",description:"Continues playing an animation",parameters:[{name:"On all",key:"onAll",type:"boolean",description:"Resume animation on all entities or just one","default":!1}],transitions:[]},e.prototype._run=function(t){if(this.onAll){var e=t.getWorld(),i=e.getSystem("AnimationSystem");i.resume()}else{var o=t.getOwnerEntity();o.animationComponent&&o.animationComponent.resume()}},e}),define("goo/statemachine/actions/SetAnimationAction",["goo/statemachine/actions/Action"],function(t){"use strict";function e(){t.apply(this,arguments),this.everyFrame=!1}return e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.external={name:"Set Animation",description:"Transitions between animations",parameters:[{name:"Animation",key:"animation",type:"animstate"}],transitions:[]},e.prototype._run=function(t){var e=t.getOwnerEntity();"string"==typeof this.animation&&e.animationComponent&&e.animationComponent.transitionTo(this.animation,!0)},e}),define("goo/statemachine/actions/MouseUpAction",["goo/statemachine/actions/Action"],function(t){"use strict";function e(){t.apply(this,arguments),this.everyFrame=!0,this.updated=!1,this.eventListener=function(t){this.button=t.button,this.updated=!0}.bind(this)}return e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.external={name:"Mouse Up",description:"Listens for a mouse button release and performs a transition",canTransition:!0,parameters:[],transitions:[{key:"mouseLeftUp",name:"Left mouse up",description:"State to transition to when the left mouse button is released"},{key:"middleMouseUp",name:"Middle mouse up",description:"State to transition to when the middle mouse button is released"},{key:"rightMouseUp",name:"Right mouse up",description:"State to transition to when the right mouse button is released"}]},e.prototype._setup=function(){document.addEventListener("mouseup",this.eventListener)},e.prototype._run=function(t){this.updated&&(this.updated=!1,t.send([this.transitions.mouseLeftUp,this.transitions.middleMouseUp,this.transitions.rightMouseUp][this.button]))},e.prototype.exit=function(){document.removeEventListener("mouseup",this.eventListener)},e}),define("goo/statemachine/actions/MouseDownAction",["goo/statemachine/actions/Action"],function(t){"use strict";function e(){t.apply(this,arguments),this.everyFrame=!0,this.updated=!1,this.eventListener=function(t){this.button=t.button,this.updated=!0}.bind(this)}return e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.external={name:"Mouse Down",description:"Listens for a mouse button press and performs a transition",canTransition:!0,parameters:[],transitions:[{key:"mouseLeftDown",name:"Left mouse down",description:"State to transition to when the left mouse button is pressed"},{key:"middleMouseDown",name:"Middle mouse down",description:"State to transition to when the middle mouse button is pressed"},{key:"rightMouseDown",name:"Right mouse down",description:"State to transition to when the right mouse button is pressed"}]},e.prototype._setup=function(){document.addEventListener("mousedown",this.eventListener)},e.prototype._run=function(t){this.updated&&(this.updated=!1,t.send([this.transitions.mouseLeftDown,this.transitions.middleMouseDown,this.transitions.rightMouseDown][this.button]))},e.prototype.exit=function(){document.removeEventListener("mousedown",this.eventListener)},e}),define("goo/statemachine/actions/MouseMoveAction",["goo/statemachine/actions/Action"],function(t){"use strict";function e(){t.apply(this,arguments),this.everyFrame=!0,this.updated=!1,this.eventListener=function(){this.updated=!0}.bind(this)}return e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.external={name:"Mouse Move",description:"Listens for mouse movement and performs a transition",canTransition:!0,parameters:[],transitions:[{key:"mousemove",name:"Mouse move",description:"State to transition to on mouse movement"}]},e.prototype._setup=function(){document.addEventListener("mousemove",this.eventListener)},e.prototype._run=function(t){this.updated&&(this.updated=!1,t.send(this.transitions.mousemove))},e.prototype.exit=function(){document.removeEventListener("mousemove",this.eventListener)},e}),define("goo/statemachine/actions/KeyUpAction",["goo/statemachine/actions/Action","goo/statemachine/FSMUtil"],function(t,e){"use strict";function i(){t.apply(this,arguments),this.everyFrame=!0,this.updated=!1,this.eventListener=function(t){this.key&&t.which!==+this.key||(this.updated=!0)}.bind(this)}return i.prototype=Object.create(t.prototype),i.prototype.constructor=i,i.external={name:"Key Up",description:"Listens for a key release and performs a transition",canTransition:!0,parameters:[{name:"Key",key:"key",type:"key",description:"Key to listen for","default":"A"}],transitions:[{key:"keyup",name:"Key up",description:"State to transition to when the key is released"}]},i.prototype.configure=function(t){this.key=t.key?e.getKey(t.key):null,this.transitions={keyup:t.transitions.keyup}},i.prototype._setup=function(){document.addEventListener("keyup",this.eventListener)},i.prototype._run=function(t){this.updated&&(this.updated=!1,t.send(this.transitions.keyup))},i.prototype.exit=function(){document.removeEventListener("keyup",this.eventListener)},i}),define("goo/statemachine/actions/KeyDownAction",["goo/statemachine/actions/Action","goo/statemachine/FSMUtil"],function(t,e){"use strict";function i(){t.apply(this,arguments),this.everyFrame=!0,this.updated=!1,this.eventListener=function(t){this.key&&t.which===+this.key&&(this.updated=!0)}.bind(this)}return i.prototype=Object.create(t.prototype),i.prototype.constructor=i,i.external={name:"Key Down",description:"Listens for a key press and performs a transition",canTransition:!0,parameters:[{name:"Key",key:"key",type:"key",description:"Key to listen for","default":"A"}],transitions:[{key:"keydown",name:"Key down",description:"State to transition to when the key is pressed"}]},i.prototype.configure=function(t){this.key=t.key?e.getKey(t.key):null,this.transitions={keydown:t.transitions.keydown}
},i.prototype._setup=function(){document.addEventListener("keydown",this.eventListener)},i.prototype._run=function(t){this.updated&&(this.updated=!1,t.send(this.transitions.keydown))},i.prototype.exit=function(){document.removeEventListener("keydown",this.eventListener)},i}),define("goo/statemachine/actions/KeyPressedAction",["goo/statemachine/actions/Action","goo/statemachine/FSMUtil"],function(t,e){"use strict";function i(){t.apply(this,arguments),this.everyFrame=!0,this.keyIsDown=!1,this.eventListenerDown=function(t){t.which===+this.key&&(this.keyIsDown=!0)}.bind(this),this.eventListenerUp=function(t){t.which===+this.key&&(document.removeEventListener("keydown",this.eventListenerUp),this.keyIsDown=!1)}.bind(this)}return i.prototype=Object.create(t.prototype),i.prototype.constructor=i,i.external={name:"Key Pressed",description:"Listens for a key press and performs a transition. Works over transition boundaries.",canTransition:!0,parameters:[{name:"Key",key:"key",type:"key",description:"Key to listen for"}],transitions:[{key:"keydown",name:"Key pressed",description:"State to transition to when the key is pressed"}]},i.prototype.configure=function(t){this.key=t.key?e.getKey(t.key):null,this.transitions={keydown:t.transitions.keydown}},i.prototype._setup=function(){document.addEventListener("keydown",this.eventListenerDown),document.addEventListener("keyup",this.eventListenerUp)},i.prototype._run=function(t){this.keyIsDown&&t.send(this.transitions.keydown)},i.prototype.exit=function(){document.removeEventListener("keydown",this.eventListenerDown)},i}),define("goo/statemachine/actions/WASDAction",["goo/statemachine/actions/Action"],function(t){"use strict";function e(){t.apply(this,arguments),this.updated=!1,this.keysPressed={},this.eventListener=function(t){var i=e._keys[t.which];void 0!==i&&(this.updated=!0,this.keysPressed[i]=!0)}.bind(this)}return e.prototype=Object.create(t.prototype),e.prototype.configure=function(t){this.everyFrame=!0,this.targets=t.transitions},e._keys={87:"w",65:"a",83:"s",68:"d"},e.external=function(){var t=[];for(var i in e._keys){var o=e._keys[i];t.push({key:o,name:"Key "+o.toUpperCase(),description:"Key '"+o+"' pressed"})}return{name:"WASD Keys Listener",description:"A 4-in-1 key down listener",canTransition:!0,parameters:[],transitions:t}}(),e.prototype._setup=function(){document.addEventListener("keydown",this.eventListener)},e.prototype._run=function(t){if(this.updated){this.updated=!1;for(var e in this.keysPressed){var i=this.targets[e];"string"==typeof i&&t.send(i)}this.keysPressed=[]}},e.prototype.exit=function(){document.removeEventListener("keydown",this.eventListener)},e}),define("goo/statemachine/actions/ArrowsAction",["goo/statemachine/actions/Action"],function(t){"use strict";function e(){t.apply(this,arguments),this.updated=!1,this.keysPressed={},this.eventListener=function(t){var i=e._keys[t.which];void 0!==i&&(this.updated=!0,this.keysPressed[i]=!0)}.bind(this)}return e.prototype=Object.create(t.prototype),e.prototype.configure=function(t){this.everyFrame=!0,this.targets=t.transitions},e._keys={38:"up",37:"left",40:"down",39:"right"},e.external=function(){var t=[];for(var i in e._keys){var o=e._keys[i];t.push({name:"Key "+o.toUpperCase(),key:o,description:"Key '"+o+"' pressed"})}return{name:"Arrow Keys Listener",description:"A 4-in-1 key down listener",canTransition:!0,parameters:[],transitions:t}}(),e.prototype._setup=function(){document.addEventListener("keydown",this.eventListener)},e.prototype._run=function(t){if(this.updated){this.updated=!1;for(var e in this.keysPressed){var i=this.targets[e];"string"==typeof i&&t.send(i)}this.keysPressed=[]}},e.prototype.exit=function(){document.removeEventListener("keydown",this.eventListener)},e}),define("goo/statemachine/actions/SetRenderTargetAction",["goo/statemachine/actions/Action","goo/entities/components/PortalComponent","goo/entities/systems/PortalSystem","goo/math/Vector3","goo/entities/components/CameraComponent","goo/renderer/Camera","goo/renderer/Material","goo/renderer/shaders/ShaderLib"],function(t,e,i,o,r,n,a,s){"use strict";function c(){t.apply(this,arguments)}return c.prototype=Object.create(t.prototype),c.prototype.constructor=c,c.external={name:"Set Render Target",description:"Renders what a camera sees on the current entity's texture",parameters:[{name:"Camera",key:"cameraEntityRef",type:"cameraEntity",description:"Camera to use as source","default":null}],transitions:[]},c.prototype.ready=function(t){var e=t.getOwnerEntity(),o=e._world;if(!o.getSystem("PortalSystem")){var r=o.getSystem("RenderSystem"),n=o.gooRunner.renderer;o.setSystem(new i(n,r))}},c.prototype._run=function(t){var i=t.getOwnerEntity(),o=i._world,r=o.entityManager.getEntityByName(this.cameraEntityRef);if(r&&r.cameraComponent&&r.cameraComponent.camera){var n=r.cameraComponent.camera,c=a.createMaterial(s.textured,"");if(i.meshRendererComponent){this.oldMaterials=i.meshRendererComponent.materials,i.meshRendererComponent.materials=[c];var l=new e(n,500,{preciseRecursion:!0});i.setComponent(l)}}},c.prototype.cleanup=function(t){var e=t.getOwnerEntity();this.oldMaterials&&(e.meshRendererComponent.materials=this.oldMaterials),this.oldMaterials=null,e.clearComponent("portalComponent")},c}),define("goo/statemachine/actions/WaitAction",["goo/statemachine/actions/Action"],function(t){"use strict";function e(){t.apply(this,arguments),this.everyFrame=!0,this.currentTime=0,this.totalWait=0}return e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.external={name:"Wait",description:"Performs a transition after a specified amount of time",canTransition:!0,parameters:[{name:"Base Time",key:"waitTime",type:"number",description:"Base time in seconds before transition fires","default":5},{name:"Random Time",key:"randomTime",type:"number",description:"Add up to this much Random time to the base time","default":0}],transitions:[{key:"timeUp",name:"Time up",description:"State to transition to when time up"}]},e.prototype._setup=function(){this.currentTime=0,this.totalWait=parseFloat(this.waitTime)+Math.random()*parseFloat(this.randomTime)},e.prototype._run=function(t){this.currentTime+=t.getTpf(),this.currentTime>=this.totalWait&&t.send(this.transitions.timeUp)},e}),define("goo/statemachine/actions/RandomTransitionAction",["goo/statemachine/actions/Action"],function(t){"use strict";function e(){t.apply(this,arguments)}return e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.external={name:"Random Transition",description:"Performs a random transition",canTransition:!0,parameters:[{name:"Skewness",key:"skewness",type:"float",control:"slider",min:0,max:1,description:"Determines the chance that the first destination is picked over the second","default":1}],transitions:[{key:"transition1",name:"Destination 1",description:"First choice"},{key:"transition2",name:"Destination 2",description:"Second choice"}]},e.prototype._run=function(t){Math.random()<+this.skewness?t.send(this.transitions.transition1):t.send(this.transitions.transition2)},e}),define("goo/statemachine/actions/ShakeAction",["goo/statemachine/actions/Action","goo/math/Vector3"],function(t,e){"use strict";function i(){t.apply(this,arguments)}return i.prototype=Object.create(t.prototype),i.prototype.constructor=i,i.external={name:"Shake",description:"Shakes the entity",canTransition:!0,parameters:[{name:"Start level",key:"startLevel",type:"number",description:"Shake amount at start","default":0},{name:"End level",key:"endLevel",type:"number",description:"Shake amount at the end","default":10},{name:"Time",key:"time",type:"number",description:"Shake time amount","default":1e3},{name:"Speed",key:"speed",type:"dropdown",description:"Speed of shaking","default":"Fast",options:["Fast","Medium","Slow"]}],transitions:[{key:"complete",name:"On Completion",description:"State to transition to when the shake completes"}]},i.prototype.configure=function(t){this.startLevel=t.startLevel,this.endLevel=t.endLevel,this.time=t.time,this.speed={Fast:1,Medium:2,Slow:4}[t.speed],this.easing=window.TWEEN.Easing.Quadratic.InOut,this.eventToEmit={channel:t.transitions.complete}},i.prototype._setup=function(){this.tween=new window.TWEEN.Tween},i.prototype.cleanup=function(){this.tween&&this.tween.stop()},i.prototype._run=function(t){var i=t.getOwnerEntity(),o=i.transformComponent,r=o.transform.translation,n=new e,a=new e,s=new e,c=this,l=0;this.tween.from({level:+this.startLevel}).to({level:+this.endLevel},+this.time).easing(this.easing).onUpdate(function(){l++,l>c.speed&&(l=0,a.setd(-n.data[0]+2*(Math.random()-.5)*this.level,-n.data[1]+2*(Math.random()-.5)*this.level,-n.data[2]+2*(Math.random()-.5)*this.level)),s.setd(.98*s.data[0]+.1*a.data[0],.98*s.data[1]+.1*a.data[1],.98*s.data[2]+.1*a.data[2]),r.add(s).sub(n),n.copy(s),o.setUpdated()}).onComplete(function(){r.sub(n),o.setUpdated(),t.send(this.eventToEmit.channel)}.bind(this)).start(1e3*t.getTime())},i}),define("goo/statemachine/actions/SmokeAction",["goo/statemachine/actions/Action","goo/renderer/Material","goo/renderer/shaders/ShaderLib","goo/renderer/TextureCreator","goo/particles/ParticleLib","goo/util/ParticleSystemUtils","goo/entities/EntityUtils"],function(t,e,i,o,r,n,a){"use strict";function s(){t.apply(this,arguments)}return s.material=null,s.prototype=Object.create(t.prototype),s.prototype.constructor=s,s.external={name:"Smoke",description:'Makes the entity emit smoke. To cancel the smoke emitter use the "Remove Particles" action',parameters:[{name:"Color",key:"color",type:"color",description:"Smoke color","default":[0,0,0]}],transitions:[]},s.prototype._run=function(t){var o=t.getOwnerEntity(),a=o._world.gooRunner;if(!s.material){s.material=e.createMaterial(i.particles);var c=n.createFlareTexture();c.generateMipmaps=!0,s.material.setTexture("DIFFUSE_MAP",c),s.material.blendState.blending="AlphaBlending",s.material.cullState.enabled=!1,s.material.depthState.write=!1,s.material.renderQueue=2001}var l=o.transformComponent.worldTransform.scale,h=(l.data[0]+l.data[1]+l.data[2])/3,u=n.createParticleSystemEntity(a,r.getSmoke({scale:h,color:this.color}),s.material);u.name="_ParticleSystemSmoke",o.transformComponent.attachChild(u.transformComponent),u.addToWorld()},s.prototype.cleanup=function(t){for(var e=t.getOwnerEntity(),i=a.getChildren(e),o=0;o<i.length;o++){var r=i[o];-1!==r.name.indexOf("_ParticleSystem")&&r.hasComponent("ParticleComponent")&&r.removeFromWorld()}},s}),define("goo/statemachine/actions/FireAction",["goo/statemachine/actions/Action","goo/renderer/Material","goo/renderer/shaders/ShaderLib","goo/particles/ParticleLib","goo/util/ParticleSystemUtils","goo/entities/EntityUtils"],function(t,e,i,o,r,n){"use strict";function a(){t.apply(this,arguments)}return a.material=null,a.prototype=Object.create(t.prototype),a.prototype.constructor=a,a.external={name:"Fire",description:'Makes the entity emit fire. To "extinguish" the fire use the "Remove Particles" action',parameters:[{name:"Start Color",key:"startColor",type:"color",description:"Flame color at source","default":[1,1,0]},{name:"End color",key:"endColor",type:"color",description:"Color near the end of a flame's life","default":[1,0,0]}],transitions:[]},a.prototype._run=function(t){var n=t.getOwnerEntity(),s=n._world.gooRunner;if(!a.material){a.material=e.createMaterial(i.particles);var c=r.createFlareTexture();c.generateMipmaps=!0,a.material.setTexture("DIFFUSE_MAP",c),a.material.blendState.blending="AdditiveBlending",a.material.cullState.enabled=!1,a.material.depthState.write=!1,a.material.renderQueue=2002}var l=n.transformComponent.worldTransform.scale,h=(l.data[0]+l.data[1]+l.data[2])/3,u=r.createParticleSystemEntity(s,o.getFire({scale:h,startColor:this.startColor,endColor:this.endColor}),a.material);u.name="_ParticleSystemFire",n.transformComponent.attachChild(u.transformComponent),u.addToWorld()},a.prototype.cleanup=function(t){for(var e=t.getOwnerEntity(),i=n.getChildren(e),o=0;o<i.length;o++){var r=i[o];-1!==r.name.indexOf("_ParticleSystem")&&r.hasComponent("ParticleComponent")&&r.removeFromWorld()}},a}),define("goo/statemachine/actions/RemoveParticlesAction",["goo/statemachine/actions/Action","goo/entities/EntityUtils"],function(t,e){"use strict";function i(){t.apply(this,arguments)}return i.prototype=Object.create(t.prototype),i.prototype.constructor=i,i.external={name:"Remove Particles",description:"Removes any particle emitter attached to the entity",parameters:[],transitions:[]},i.prototype._run=function(t){for(var i=t.getOwnerEntity(),o=e.getChildren(i),r=0;r<o.length;r++){var n=o[r];-1!==n.name.indexOf("_ParticleSystem")&&n.hasComponent("ParticleComponent")&&n.removeFromWorld()}},i}),define("goo/statemachine/actions/DollyZoomAction",["goo/statemachine/actions/Action","goo/math/Vector3"],function(t,e){"use strict";function i(){t.apply(this,arguments)}return i.prototype=Object.create(t.prototype),i.prototype.constructor=i,i.external={name:"Dolly Zoom",description:"Performs dolly zoom",parameters:[{name:"Forward",key:"forward",type:"number",description:"Number of units to move towards the focus point; Enter negative values to move away","default":100},{name:"Focus point",key:"lookAt",type:"position",description:"Point to focus on while transitioning","default":[0,0,0]},{name:"Time",key:"time",type:"number",description:"Time","default":1e4},{name:"Easing type",key:"easing1",type:"dropdown",description:"Easing","default":"Linear",options:["Linear","Quadratic","Exponential","Circular","Elastic","Back","Bounce"]},{name:"Direction",key:"easing2",type:"dropdown",description:"Easing direction","default":"In",options:["In","Out","InOut"]}],transitions:[{key:"complete",name:"On Completion",description:"State to transition to when the transition completes"}]},i.prototype.configure=function(t){this.forward=t.forward,this.lookAt=t.lookAt,this.time=t.time,this.easing="Linear"===t.easing1?window.TWEEN.Easing.Linear.None:window.TWEEN.Easing[t.easing1][t.easing2],this.eventToEmit={channel:t.transitions.complete}},i.prototype._setup=function(t){this.tween=new window.TWEEN.Tween;var i=t.getOwnerEntity();if(i.cameraComponent&&i.cameraComponent.camera){var o=i.cameraComponent.camera;this.initialDistance=new e(this.lookAt).distance(o.translation),this.eyeTargetScale=Math.tan(o.fov*(Math.PI/180)/2)*this.initialDistance}else this.eyeTargetScale=null},i.prototype.cleanup=function(){this.tween&&this.tween.stop()},i.prototype._run=function(t){if(this.eyeTargetScale){var i=t.getOwnerEntity(),o=i.transformComponent,r=o.transform.translation,n=(new e).copy(r),a=i.cameraComponent.camera,s=new e(this.lookAt).sub(n).normalize().scale(this.forward).add(n),c={x:n.x,y:n.y,z:n.z,d:this.initialDistance},l={x:s.x,y:s.y,z:s.z,d:+this.initialDistance-+this.forward},h={x:c.x,y:c.y,z:c.z},u=this;this.tween.from(c).to(l,+this.time).easing(this.easing).onUpdate(function(){r.data[0]+=this.x-h.x,r.data[1]+=this.y-h.y,r.data[2]+=this.z-h.z,h.x=this.x,h.y=this.y,h.z=this.z,o.setUpdated();var t=2*(180/Math.PI)*Math.atan(u.eyeTargetScale/this.d);a.setFrustumPerspective(t)}).onComplete(function(){t.send(this.eventToEmit.channel)}.bind(this)).start(1e3*t.getTime())}},i}),define("goo/statemachine/actions/TweenTextureOffsetAction",["goo/statemachine/actions/Action"],function(t){"use strict";function e(){t.apply(this,arguments)}return e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.external={name:"Tween Texture Offset",description:"Smoothly changes the texture offset of the entity",canTransition:!0,parameters:[{name:"X Offset",key:"toX",type:"float",control:"slider",min:0,max:1,description:"X Offset","default":1},{name:"Y Offset",key:"toY",type:"float",control:"slider",min:0,max:1,description:"Y Offset","default":1},{name:"Time",key:"time",type:"number",description:"Time it takes for this transition to complete","default":1e3},{name:"Easing type",key:"easing1",type:"dropdown",description:"Easing type","default":"Linear",options:["Linear","Quadratic","Exponential","Circular","Elastic","Back","Bounce"]},{name:"Direction",key:"easing2",type:"dropdown",description:"Easing direction","default":"In",options:["In","Out","InOut"]}],transitions:[{key:"complete",name:"On Completion",description:"State to transition to when the transition completes"}]},e.prototype.configure=function(t){this.toX=+t.toX,this.toY=+t.toY,this.time=+t.time,this.easing="Linear"===t.easing1?window.TWEEN.Easing.Linear.None:window.TWEEN.Easing[t.easing1][t.easing2],this.eventToEmit={channel:t.transitions.complete}},e.prototype._setup=function(){this.tween=new window.TWEEN.Tween},e.prototype.cleanup=function(){this.tween&&this.tween.stop()},e.prototype._run=function(t){var e=t.getOwnerEntity();if(e.meshRendererComponent&&e.meshRendererComponent.materials.length>0){var i=e.meshRendererComponent,o=i.materials[0],r=o.getTexture("DIFFUSE_MAP"),n=r.offset,a={x:n.x,y:n.y},s={x:this.toX,y:this.toY};this.tween.from(a).to(s,this.time).easing(this.easing).onUpdate(function(){r.offset.setd(this.x,this.y)}).onComplete(function(){t.send(this.eventToEmit.channel)}.bind(this)).start(1e3*t.getTime())}},e}),define("goo/statemachine/actions/PickAction",["goo/statemachine/actions/Action"],function(t){"use strict";function e(){t.apply(this,arguments),this.everyFrame=!0,this.updated=!1,this.eventListener=function(t){t.entity===this.ownerEntity&&(this.updated=!0)}.bind(this)}return e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.external={name:"Pick",description:"Listens for a picking event and performs a transition",canTransition:!0,parameters:[],transitions:[{key:"pick",name:"Pick",description:"State to transition to when entity is picked"}]},e.prototype._setup=function(t){this.ownerEntity=t.getOwnerEntity(),this.goo=this.ownerEntity._world.gooRunner,this.goo.addEventListener("click",this.eventListener)},e.prototype._run=function(t){this.updated&&(this.updated=!1,t.send(this.transitions.pick))},e.prototype.exit=function(){this.goo&&this.goo.removeEventListener("click",this.eventListener)},e}),define("goo/statemachine/actions/SoundFadeInAction",["goo/statemachine/actions/Action"],function(t){"use strict";function e(){t.apply(this,arguments)}return e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.external={name:"Sound Fade In",descriptions:"Starts playing a sound",canTransition:!0,parameters:[{name:"Sound",key:"sound",type:"sound",description:"Sound","default":0},{name:"Time",key:"time",type:"number",description:"Time it takes for the fading to complete","default":1e3}],transitions:[{key:"complete",name:"On Completion",description:"State to transition to when the movement completes"}]},e.prototype._run=function(t){var e=t.getOwnerEntity();if(e.hasComponent("HowlerComponent")){var i=e.howlerComponent.sounds[this.sound];i&&i.fadeIn(i.volume(),this.time,function(){t.send(this.transitions.complete)}.bind(this))}},e}),define("goo/statemachine/actions/SoundFadeOutAction",["goo/statemachine/actions/Action"],function(t){"use strict";function e(){t.apply(this,arguments)}return e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.external={name:"Sound Fade Out",descriptions:"Fades out a sound and stops it",canTransition:!0,parameters:[{name:"Sound",key:"sound",type:"sound",description:"Sound","default":0},{name:"Time",key:"time",type:"number",description:"Time it takes for the fading to complete","default":1e3}],transitions:[{key:"complete",name:"On Completion",description:"State to transition to when the movement completes"}]},e.prototype._run=function(t){var e=t.getOwnerEntity();if(e.hasComponent("HowlerComponent")){var i=e.howlerComponent.sounds[this.sound];i&&i.fadeOut(0,this.time,function(){t.send(this.transitions.complete)}.bind(this))}},e}),define("goo/statemachine/actions/TransitionOnMessageAction",["goo/statemachine/actions/Action","goo/entities/SystemBus"],function(t,e){"use strict";function i(){t.apply(this,arguments),this.everyFrame=!0,this.updated=!1,this.eventListener=function(){this.updated=!0}.bind(this)}return i.prototype=Object.create(t.prototype),i.prototype.constructor=i,i.external={name:"Transition on Message",description:"Performs a transition on receiving a message",canTransition:!0,parameters:[{name:"Message channel",key:"channel",type:"string",description:"Channel to listen to","default":""}],transitions:[{key:"transition",name:"To",description:"State to transition to"}]},i.prototype._setup=function(){e.addListener(this.channel,this.eventListener)},i.prototype._run=function(t){this.updated&&(this.updated=!1,t.send(this.transitions.transition))},i.prototype.exit=function(){e.removeListener(this.channel,this.eventListener)},i}),define("goo/statemachine/actions/TweenLightColorAction",["goo/statemachine/actions/Action"],function(t){"use strict";function e(){t.apply(this,arguments)}return e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.external={name:"Tween Light Color",description:"Tweens the color of the light",parameters:[{name:"Color",key:"to",type:"color",description:"Color of the light","default":[1,1,1]},{name:"Time",key:"time",type:"number",description:"Time it takes for the transition to complete","default":1e3},{name:"Easing type",key:"easing1",type:"dropdown",description:"Easing type","default":"Linear",options:["Linear","Quadratic","Exponential","Circular","Elastic","Back","Bounce"]},{name:"Direction",key:"easing2",type:"dropdown",description:"Easing direction","default":"In",options:["In","Out","InOut"]}],transitions:[{key:"complete",name:"On Completion",description:"State to transition to when the transition completes"}]},e.prototype.configure=function(t){this.to=t.to,this.time=t.time,this.easing="Linear"===t.easing1?window.TWEEN.Easing.Linear.None:window.TWEEN.Easing[t.easing1][t.easing2],this.eventToEmit={channel:t.transitions.complete}},e.prototype._setup=function(){this.tween=new window.TWEEN.Tween},e.prototype.cleanup=function(){this.tween&&this.tween.stop()},e.prototype._run=function(t){var e=t.getOwnerEntity();if(e.lightComponent){var i=e.lightComponent,o=i.light.color,r={x:o.x,y:o.y,z:o.z},n={x:this.to[0],y:this.to[1],z:this.to[2]},a={x:r.x,y:r.y,z:r.z};this.tween.from(r).to(n,+this.time).easing(this.easing).onUpdate(function(){o.data[0]+=this.x-a.x,o.data[1]+=this.y-a.y,o.data[2]+=this.z-a.z,a.x=this.x,a.y=this.y,a.z=this.z}).onComplete(function(){t.send(this.eventToEmit.channel)}.bind(this)).start(1e3*t.getTime())}},e}),define("goo/statemachine/actions/CollidesAction",["goo/statemachine/actions/Action","goo/entities/systems/ProximitySystem","goo/entities/EntityUtils"],function(t,e,i){"use strict";function o(){t.apply(this,arguments),this.everyFrame=!0}return o.prototype=Object.create(t.prototype),o.prototype.constructor=o,o.external={name:"Collides",description:"Checks for collisions with other entities. Collisions are based on the entities' bounding volumes. Before using collisions you first need to tag objects using the 'Tag' action",canTransition:!0,parameters:[{name:"Tag",key:"tag",type:"dropdown",description:"Checks for collisions with other objects having this tag","default":"red",options:["red","blue","green","yellow"]}],transitions:[{key:"collides",name:"On Collision",description:"States to transition to when a collision occurs"},{key:"notCollides",name:"On Divergence",description:"States to transition to when a collision is not occurring"}]},o.prototype.ready=function(t){var i=t.getOwnerEntity(),o=i._world;o.getSystem("ProximitySystem")||o.setSystem(new e)},o.prototype._run=function(t){var e=t.getOwnerEntity(),o=e._world,r=o.getSystem("ProximitySystem"),n=r.getFor(this.tag),a=!1;i.traverse(e,function(t){var e;if(t.meshRendererComponent){e=t.meshRendererComponent.worldBound;for(var o=0;o<n.length;o++)if(i.traverse(n[o],function(t){return t.meshRendererComponent&&t.meshRendererComponent.worldBound&&e.intersects(t.meshRendererComponent.worldBound)?(a=!0,!1):void 0}),a)return!1}}),a?t.send(this.transitions.collides):t.send(this.transitions.notCollides)},o}),define("goo/statemachine/actions/TagAction",["goo/statemachine/actions/Action","goo/entities/components/ProximityComponent"],function(t,e){"use strict";function i(){t.apply(this,arguments)}return i.prototype=Object.create(t.prototype),i.prototype.constructor=i,i.external={name:"Tag",description:"Sets a tag on the entity. Use tags to be able to capture collision events with the 'Collides' action",parameters:[{name:"Tag",key:"tag",type:"dropdown",description:"Checks for collisions with other ojects having this tag","default":"red",options:["red","blue","green","yellow"]}],transitions:[]},i.prototype._run=function(t){var i=t.getOwnerEntity();i.proximityComponent?i.proximityComponent.tag!==this.tag&&(i.clearComponent("ProximityComponent"),i.setComponent(new e(this.tag))):i.setComponent(new e(this.tag))},i}),define("goo/statemachine/actions/Actions",["goo/statemachine/actions/MoveAction","goo/statemachine/actions/RotateAction","goo/statemachine/actions/ScaleAction","goo/statemachine/actions/LookAtAction","goo/statemachine/actions/TweenMoveAction","goo/statemachine/actions/TweenRotationAction","goo/statemachine/actions/TweenScaleAction","goo/statemachine/actions/TweenLookAtAction","goo/statemachine/actions/HideAction","goo/statemachine/actions/ShowAction","goo/statemachine/actions/RemoveAction","goo/statemachine/actions/AddLightAction","goo/statemachine/actions/RemoveLightAction","goo/statemachine/actions/InBoxAction","goo/statemachine/actions/CompareDistanceAction","goo/statemachine/actions/SetClearColorAction","goo/statemachine/actions/InFrustumAction","goo/statemachine/actions/TransitionAction","goo/statemachine/actions/EmitAction","goo/statemachine/actions/EvalAction","goo/statemachine/actions/SwitchCameraAction","goo/statemachine/actions/LogMessageAction","goo/statemachine/actions/PauseAnimationAction","goo/statemachine/actions/ResumeAnimationAction","goo/statemachine/actions/SetAnimationAction","goo/statemachine/actions/MouseUpAction","goo/statemachine/actions/MouseDownAction","goo/statemachine/actions/MouseMoveAction","goo/statemachine/actions/KeyUpAction","goo/statemachine/actions/KeyDownAction","goo/statemachine/actions/KeyPressedAction","goo/statemachine/actions/WASDAction","goo/statemachine/actions/ArrowsAction","goo/statemachine/actions/SetRenderTargetAction","goo/statemachine/actions/WaitAction","goo/statemachine/actions/RandomTransitionAction","goo/statemachine/actions/ShakeAction","goo/statemachine/actions/SmokeAction","goo/statemachine/actions/FireAction","goo/statemachine/actions/RemoveParticlesAction","goo/statemachine/actions/DollyZoomAction","goo/statemachine/actions/TweenTextureOffsetAction","goo/statemachine/actions/PickAction","goo/statemachine/actions/SoundFadeInAction","goo/statemachine/actions/SoundFadeOutAction","goo/statemachine/actions/TransitionOnMessageAction","goo/statemachine/actions/TweenLightColorAction","goo/statemachine/actions/CollidesAction","goo/statemachine/actions/TagAction"],function(){"use strict";function t(t){for(var e=0,o=e;o<t.length;o++){var r=t[o];i.register(r.external.name,r)}}var e={},i={};return i.register=function(t,i){e[t]=i},i.actionForType=function(t){return e[t]},i.allActions=function(){for(var t={},i=Object.keys(e),o=0;o<i.length;o++){var r=i[o];t[r]=e[r]}return t},t(arguments),i}),define("goo/loaders/handlers/MachineHandler",["goo/loaders/handlers/ConfigHandler","goo/renderer/MeshData","goo/animation/SkeletonPose","goo/loaders/JsonUtils","goo/util/PromiseUtil","goo/statemachine/State","goo/statemachine/Machine","goo/statemachine/actions/Actions","goo/util/rsvp"],function(t,e,i,o,r,n,a,s,c){"use strict";function l(){t.apply(this,arguments),this._objects={}}return l.prototype=Object.create(t.prototype),t._registerClass("machine",l),l.prototype.remove=function(t){var e=this._objects[t];e&&e.removeFromParent(),delete this._objects[t]},l.prototype._updateActions=function(t,e){for(var i=0;i<t._actions.length;i++){var o=t._actions[i],r=e.actions.some(function(t){return t.id===o.id});r||(t._actions.splice(i,1),i--)}for(var n=0;n<e.actions.length;n++){var a=e.actions[n],o=t.getAction(a.id);if(void 0===o){var c=s.actionForType(a.type);c instanceof Function&&(o=new c(a.id,a.options),t.addAction(o))}else o.configure(a.options)}},l.prototype._updateTransitions=function(t,e){for(var i=e.transitions,o=0;o<i.length;o++){var r=i[o];t.setTransition(r.id,r.targetState)}},l.prototype._updateState=function(t,e){function i(t){return a.getConfig(t).then(function(e){return a.updateObject(t,e)})}var o=t._states?t._states[e.id]:void 0;void 0===o&&(o=new n(e.id),t.addState(o)),o.name=e.name,this._updateActions(o,e),this._updateTransitions(o,e);for(var a=this,s=[],l=0;l<e.machineRefs.length;l++){var h=e.machineRefs[l];s.push(i(h))}return s.length>0?c.all(s).then(function(t){t.forEach(function(t){o.addMachine(t)})}):r.createDummyPromise(o)},l.prototype.update=function(t,e){var i=this._objects[t];if(i||(i=this._objects[t]=new a(e.name)),i.setInitialState(e.initialState),i._states)for(var o=Object.keys(i._states),r=0;r<o.length;r++){var n=i._states[o[r]],s=e.states.some(function(t){return t.id===n.uuid});s||i.removeState(n.uuid)}for(var l=[],r=0;r<e.states.length;r++)l.push(this._updateState(i,e.states[r]));return c.all(l).then(function(){return i})},l}),define("goo/loaders/handlers/SoundComponentHandler",["goo/loaders/handlers/ComponentHandler","goo/addons/howler/components/HowlerComponent","goo/util/rsvp","goo/util/PromiseUtil"],function(t,e,i,o){"use strict";function r(){t.apply(this,arguments)}return r.prototype=Object.create(t.prototype),t._registerClass("sound",r),r._type="howler",r.prototype.constructor=r,r.prototype._create=function(t){var i=new e;return t.setComponent(i),i},r.prototype.update=function(e,r){if(!window.Howl)throw new Error("Howler is missing");for(var n=t.prototype.update.call(this,e,r),a=0;a<n.sounds.length;a++)n.sounds[a].stop();n.sounds=[];var s=r.soundRefs;if(s){for(var c=[],a=0;a<s.length;a++)c.push(this._getSound(s[a]));return i.all(c).then(function(t){return n.sounds=t,n})}return o.createDummyPromise(n)},r.prototype._getSound=function(t){var e=this;return this.getConfig(t).then(function(i){return e.updateObject(t,i)})},r}),define("goo/loaders/handlers/SoundHandler",["goo/loaders/handlers/ConfigHandler","goo/util/rsvp","goo/util/PromiseUtil","goo/util/ObjectUtil"],function(t,e,i,o){"use strict";function r(){t.apply(this,arguments),this._objects={}}function n(t,e){var i=t.length;if(i!==e.length)return!1;for(;i--;)if(t[i]!==e[i])return!1;return!0}return r.prototype=Object.create(t.prototype),t._registerClass("sound",r),r.prototype.constructor=r,r.prototype._prepare=function(t){o.defaults(t,{loop:!1,urls:[],volume:1,name:"A Sound"})},r.prototype._create=function(t){var e=new window.Howl({});return e._loaded=!0,this._objects[t]=e},r.prototype.update=function(t,i){if(!window.Howl)throw new Error("Howler is missing");this._prepare(i);var o=this._objects[t]||this._create(t,i),r=[];for(var a in i)"urls"!==a&&o[a]instanceof Function&&o[a](i[a]);for(var s=0;s<i.urls.length;s++)r.push(this.getConfig(i.urls[s]));return e.all(r).then(function(i){if(!n(i,o._urls)){var r=new e.Promise;return o.on("load",function(){r.resolve(o)}),o.on("loaderror",function(){r.reject("Error loading sound for "+t)}),o.urls(i),r}return o})},r.prototype.remove=function(t){this._objects[t]&&this._objects[t].stop(),delete this._objects[t]},r}),define("goo/renderer/pass/BloomPass",["goo/renderer/Material","goo/renderer/pass/FullscreenUtil","goo/renderer/pass/RenderTarget","goo/renderer/Util","goo/renderer/shaders/ShaderLib"],function(t,e,i,o,r){"use strict";function n(i){i=i||{},this.target=void 0!==i.target?i.target:null;var a=void 0!==i.strength?i.strength:0,s=void 0!==i.sigma?i.sigma:4,c=2*Math.ceil(3*s)+1;this.downsampleAmount=void 0!==i.downsampleAmount?Math.max(i.downsampleAmount,1):4;var l=window.innerWidth||1024,h=window.innerHeight||1024;this.updateSize({x:0,y:0,width:l,height:h}),this.renderable={meshData:e.quad,materials:[]},this.copyMaterial=t.createMaterial(r.copyPure),this.copyMaterial.uniforms.opacity=a,this.copyMaterial.blendState.blending="AdditiveBlending",this.convolutionShader=o.clone(r.convolution),this.convolutionShader.defines={KERNEL_SIZE_FLOAT:c.toFixed(1),KERNEL_SIZE_INT:c.toFixed(0)},this.convolutionMaterial=t.createMaterial(this.convolutionShader),this.convolutionMaterial.uniforms.uImageIncrement=n.blurX,this.convolutionMaterial.uniforms.cKernel=this.convolutionShader.buildKernel(s),this.bcMaterial=t.createMaterial(r.brightnesscontrast),this.bcMaterial.uniforms.brightness=0,this.bcMaterial.uniforms.contrast=0,this.enabled=!0,this.clear=!1,this.needsSwap=!1
}return n.prototype.updateSize=function(t){var e=t.width/this.downsampleAmount,o=t.height/this.downsampleAmount;this.renderTargetX=new i(e,o),this.renderTargetY=new i(e,o)},n.prototype.render=function(t,i,o){this.renderable.materials[0]=this.bcMaterial,this.bcMaterial.setTexture("DIFFUSE_MAP",o),t.render(this.renderable,e.camera,[],this.renderTargetY,!0),this.renderable.materials[0]=this.convolutionMaterial,this.convolutionMaterial.setTexture("DIFFUSE_MAP",this.renderTargetY),this.convolutionMaterial.uniforms.uImageIncrement=n.blurY,t.render(this.renderable,e.camera,[],this.renderTargetX,!0),this.convolutionMaterial.setTexture("DIFFUSE_MAP",this.renderTargetX),this.convolutionMaterial.uniforms.uImageIncrement=n.blurX,t.render(this.renderable,e.camera,[],this.renderTargetY,!0),this.renderable.materials[0]=this.copyMaterial,this.copyMaterial.setTexture("DIFFUSE_MAP",this.renderTargetY),null!==this.target?t.render(this.renderable,e.camera,[],this.target,this.clear):t.render(this.renderable,e.camera,[],o,this.clear)},n.blurX=[.001953125,0],n.blurY=[0,.001953125],n}),define("goo/renderer/pass/BlurPass",["goo/renderer/Material","goo/renderer/pass/FullscreenUtil","goo/renderer/pass/RenderTarget","goo/renderer/Util","goo/renderer/shaders/ShaderLib"],function(t,e,i,o,r){"use strict";function n(i){i=i||{},this.target=void 0!==i.target?i.target:null;var n=void 0!==i.strength?i.strength:1,a=void 0!==i.sigma?i.sigma:4,s=2*Math.ceil(3*a)+1;this.downsampleAmount=void 0!==i.downsampleAmount?Math.max(i.downsampleAmount,1):4,this.blurX=[.001953125,0],this.blurY=[0,.001953125];var c=window.innerWidth||1024,l=window.innerHeight||1024;this.updateSize({x:0,y:0,width:c,height:l}),this.renderable={meshData:e.quad,materials:[]},this.copyMaterial=t.createMaterial(r.copyPure),this.copyMaterial.uniforms.opacity=n,this.copyMaterial.blendState.blending="CustomBlending",this.convolutionShader=o.clone(r.convolution),this.convolutionShader.defines={KERNEL_SIZE_FLOAT:s.toFixed(1),KERNEL_SIZE_INT:s.toFixed(0)},this.convolutionShader.uniforms.uImageIncrement=this.blurX,this.convolutionShader.uniforms.cKernel=this.convolutionShader.buildKernel(a),this.convolutionMaterial=t.createMaterial(this.convolutionShader),this.enabled=!0,this.clear=!1,this.needsSwap=!1}return n.prototype.updateSize=function(t){var e=t.width/this.downsampleAmount,o=t.height/this.downsampleAmount;this.renderTargetX=new i(e,o),this.renderTargetY=new i(e,o)},n.prototype.render=function(t,i,o){this.renderable.materials[0]=this.convolutionMaterial,this.convolutionMaterial.setTexture("DIFFUSE_MAP",o),this.convolutionMaterial.uniforms.uImageIncrement=this.blurY,t.render(this.renderable,e.camera,[],this.renderTargetX,!0),this.convolutionMaterial.setTexture("DIFFUSE_MAP",this.renderTargetX),this.convolutionMaterial.uniforms.uImageIncrement=this.blurX,t.render(this.renderable,e.camera,[],this.renderTargetY,!0),this.renderable.materials[0]=this.copyMaterial,this.copyMaterial.setTexture("DIFFUSE_MAP",this.renderTargetY),null!==this.target?t.render(this.renderable,e.camera,[],this.target,this.clear):t.render(this.renderable,e.camera,[],o,this.clear)},n}),define("goo/renderer/pass/PassLib",["goo/renderer/shaders/ShaderLib","goo/renderer/pass/FullscreenPass","goo/renderer/pass/BloomPass","goo/renderer/pass/BlurPass","goo/renderer/Util"],function(t,e,i,o,r){"use strict";function n(){i.call(this,arguments)}function a(){o.call(this,arguments)}function s(){e.call(this,r.clone(t.vignette))}function c(){e.call(this,r.clone(t.sepia))}function l(){e.call(this,r.clone(t.film))}function h(){e.call(this,r.clone(t.noise))}function u(){e.call(this,r.clone(t.rgbshift))}function d(){e.call(this,r.clone(t.bleachbypass))}function p(){e.call(this,r.clone(t.hsb))}function f(){e.call(this,r.clone(t.colorify))}function m(){e.call(this,r.clone(t.hatch))}function g(){e.call(this,r.clone(t.dotscreen))}function v(){e.call(this,r.clone(t.brightnesscontrast))}return n.prototype=Object.create(i.prototype),n.prototype.constructor=n,n.prototype.update=function(t){var e=t.options||{};void 0!==e.opacity&&(this.copyMaterial.uniforms.opacity=e.opacity/100),void 0!==e.size&&(this.convolutionMaterial.uniforms.size=e.size),void 0!==e.brightness&&(this.bcMaterial.uniforms.brightness=e.brightness/100),void 0!==e.contrast&&(this.bcMaterial.uniforms.contrast=e.contrast/100),void 0!==t.enabled&&(this.enabled=t.enabled)},n.label="Bloom",n.options=[{key:"opacity",name:"Opacity",type:"int",control:"slider",min:0,max:100,"default":100},{key:"size",name:"Size",type:"float",control:"slider",min:0,max:10,decimals:1,"default":2},{key:"brightness",name:"Gain",type:"int",control:"slider",min:-100,max:100,"default":0},{key:"contrast",name:"Intensity",type:"int",control:"slider",min:-100,max:100,"default":0}],a.prototype=Object.create(o.prototype),a.prototype.constructor=a,a.prototype.update=function(t){var e=t.options||{};void 0!==e.opacity&&(this.copyMaterial.uniforms.opacity=e.opacity/100),void 0!==e.size&&(this.blurX=[.001953125*e.size,0],this.blurY=[0,.001953125*e.size]),void 0!==t.enabled&&(this.enabled=t.enabled)},a.label="Blur",a.options=[{key:"opacity",name:"Amount",type:"int",control:"slider",min:0,max:100,"default":100},{key:"size",name:"Size",type:"float",control:"slider",min:0,max:5,decimals:1,"default":1}],s.prototype=Object.create(e.prototype),s.prototype.construcor=s,s.prototype.update=function(t){var e=t.options,i=this.material.shader;void 0!==e.offset&&(i.uniforms.offset=e.offset),void 0!==e.darkness&&(i.uniforms.darkness=e.darkness),void 0!==t.enabled&&(this.enabled=t.enabled)},s.label="Vignette",s.options=[{key:"offset",type:"float",control:"slider",name:"Offset",min:0,max:10,decimals:1,"default":1},{key:"darkness",type:"float",control:"slider",name:"Darkness",min:0,max:2,decimals:2,"default":1.5}],c.prototype=Object.create(e.prototype),c.prototype.constructor=c,c.prototype.update=function(t){var e=t.options;void 0!==e.amount&&(this.material.uniforms.amount=e.amount/100),void 0!==t.enabled&&(this.enabled=t.enabled)},c.label="Sepia",c.options=[{key:"amount",name:"Amount",type:"int",control:"slider",min:0,max:100,"default":100}],l.prototype=Object.create(e.prototype),l.prototype.constructor=l,l.prototype.update=function(t){var e=t.options,i=this.material.shader;void 0!==e.nIntensity&&(i.uniforms.nIntensity=e.nIntensity/100),void 0!==e.sIntensity&&(i.uniforms.sIntensity=e.sIntensity/100),void 0!==e.sCount&&(i.uniforms.sCount=e.sCount),void 0!==t.enabled&&(this.enabled=t.enabled)},l.label="Film Grain",l.options=[{key:"nIntensity",type:"int",control:"slider",name:"Noise",min:0,max:100,"default":50},{key:"sIntensity",type:"int",control:"slider",name:"Line Intensity",min:0,max:100,"default":50},{key:"sCount",type:"int",control:"slider",name:"Line Count",min:1,max:4096,"default":1024}],h.prototype=Object.create(e.prototype),h.prototype.constructor=h,h.prototype.update=function(t){var e=t.options,i=this.material.shader;void 0!==e.nIntensity&&(i.uniforms.nIntensity=e.nIntensity/100),void 0!==t.enabled&&(this.enabled=t.enabled)},h.label="Noise",h.options=[{key:"nIntensity",type:"int",control:"slider",name:"Noise",min:0,max:100,"default":50}],u.prototype=Object.create(e.prototype),u.prototype.constructor=u,u.prototype.update=function(t){var e=t.options,i=this.material.shader;void 0!==e.amount&&(i.uniforms.amount=e.amount),void 0!==e.angle&&(i.uniforms.angle=e.angle),void 0!==t.enabled&&(this.enabled=t.enabled)},u.label="RgbShift",u.options=[{key:"amount",type:"float",control:"slider",name:"Amount",min:0,max:.05,decimals:3,"default":.005},{key:"angle",type:"float",control:"slider",name:"Angle",min:0,max:6.28,decimals:1,"default":0}],d.prototype=Object.create(e.prototype),d.prototype.constructor=d,d.prototype.update=function(t){var e=t.options,i=this.material.shader;void 0!==e.opacity&&(i.uniforms.opacity=e.opacity),void 0!==t.enabled&&(this.enabled=t.enabled)},d.label="Bleach",d.options=[{key:"opacity",type:"float",control:"slider",name:"Opacity",min:0,max:1,decimals:2,"default":1}],p.prototype=Object.create(e.prototype),p.prototype.constructor=p,p.prototype.update=function(t){var e=t.options,i=this.material.shader;void 0!==e.hue&&(i.uniforms.hue=e.hue),void 0!==e.saturation&&(i.uniforms.saturation=e.saturation),void 0!==e.brightness&&(i.uniforms.brightness=e.brightness),void 0!==t.enabled&&(this.enabled=t.enabled)},p.label="HSB",p.options=[{key:"hue",type:"float",control:"slider",name:"Hue",min:-1,max:1,decimals:2,"default":0},{key:"saturation",type:"float",control:"slider",name:"Saturation",min:-1,max:1,decimals:2,"default":0},{key:"brightness",type:"float",control:"slider",name:"Brightness",min:-1,max:1,decimals:2,"default":0}],f.prototype=Object.create(e.prototype),f.prototype.constructor=f,f.prototype.update=function(t){var e=t.options,i=this.material.shader;void 0!==e.color&&(i.uniforms.color=e.color),void 0!==e.amount&&(i.uniforms.amount=e.amount),void 0!==t.enabled&&(this.enabled=t.enabled)},f.label="Tint",f.options=[{key:"color",type:"color",name:"Color","default":[1,1,1]},{key:"amount",type:"float",control:"slider",name:"Amount",min:0,max:1,decimals:2,"default":1}],m.prototype=Object.create(e.prototype),m.prototype.constructor=m,m.prototype.update=function(t){var e=t.options,i=this.material.shader;void 0!==e.width&&(i.uniforms.width=e.width),void 0!==e.spread&&(i.uniforms.spread=e.spread),void 0!==t.enabled&&(this.enabled=t.enabled)},m.label="Hatch",m.options=[{key:"width",type:"float",control:"slider",name:"Width",min:0,max:10,decimals:1,"default":2},{key:"spread",type:"int",control:"slider",name:"Spread",min:1,max:50,"default":8}],g.prototype=Object.create(e.prototype),g.prototype.constructor=g,g.prototype.update=function(t){var e=t.options,i=this.material.shader;void 0!==e.angle&&(i.uniforms.angle=e.angle),void 0!==e.scale&&(i.uniforms.scale=e.scale),void 0!==e.sizex&&(i.uniforms.tSize[0]=e.sizex),void 0!==e.sizey&&(i.uniforms.tSize[1]=e.sizey),void 0!==t.enabled&&(this.enabled=t.enabled)},g.label="Dot",g.options=[{key:"angle",type:"float",control:"slider",name:"Angle",min:0,max:10,decimals:2,"default":1.57},{key:"scale",type:"float",control:"slider",name:"Scale",min:0,max:10,decimals:2,"default":1},{key:"sizex",type:"int",control:"slider",name:"SizeX",min:0,max:1024,"default":256},{key:"sizey",type:"int",control:"slider",name:"SizeY",min:0,max:1024,"default":256}],v.prototype=Object.create(e.prototype),v.prototype.constructor=v,v.prototype.update=function(t){var e=t.options,i=this.material.shader;void 0!==e.brightness&&(i.uniforms.brightness=e.brightness),void 0!==e.contrast&&(i.uniforms.contrast=e.contrast),void 0!==e.saturation&&(i.uniforms.saturation=e.saturation),void 0!==t.enabled&&(this.enabled=t.enabled)},v.label="Contrast",v.options=[{key:"brightness",type:"float",control:"slider",name:"Brightness",min:-1,max:1,decimals:2,"default":0},{key:"contrast",type:"float",control:"slider",name:"Contrast",min:0,max:1,"default":0},{key:"saturation",type:"float",control:"slider",name:"Saturation",min:-1,max:1,decimals:2,"default":0}],{Bloom:n,Blur:a,Vignette:s,Sepia:c,Grain:l,Noise:h,RgbShift:u,Bleach:d,HSB:p,Colorify:f,Hatch:m,Dot:g,Contrast:v}}),define("goo/loaders/handlers/PosteffectHandler",["goo/loaders/handlers/ConfigHandler","goo/util/rsvp","goo/util/PromiseUtil","goo/renderer/Util","goo/renderer/pass/PassLib","goo/renderer/shaders/ShaderLib","goo/renderer/pass/FullscreenPass","goo/renderer/pass/BloomPass","goo/util/ObjectUtil"],function(t,e,i,o,r,n,a,s,c){"use strict";function l(){t.apply(this,arguments),this._objects={}}return l.prototype=Object.create(t.prototype),l.prototype.constructor=l,t._registerClass("posteffect",l),l.prototype._prepare=function(t){if(!t.name||!r[t.name])return console.error("Unknown posteffect name: "+t.name),void 0;var e=r[t.name];c.defaults(t,{enabled:!0,options:{}}),t.label=e.label||t.name;for(var i=e.options,o=0;o<i.length;o++){var n=i[o];void 0===t.options[n.key]&&(t.options[n.key]=n["default"])}},l.prototype._create=function(t,e){return e.name&&r[e.name]?(this._objects[t]=new r[e.name],this._objects[t]):(console.error("Unknown posteffect name: "+e.name),void 0)},l.prototype.update=function(t,e){if(!e.name||!r[e.name])return console.error("Unknown posteffect name: "+e.name),i.createDummyPromise();var o=this._objects[t]||this._create(t,e);return this._prepare(e),o.update(e),i.createDummyPromise(o)},l}),define("goo/loaders/DynamicLoader",["goo/loaders/handlers/ConfigHandler","goo/loaders/handlers/ComponentHandler","goo/util/Ajax","goo/renderer/TextureCreator","goo/util/rsvp","goo/util/StringUtil","goo/util/PromiseUtil","goo/util/ObjectUtil","goo/loaders/handlers/CameraComponentHandler","goo/loaders/handlers/EntityHandler","goo/loaders/handlers/LightComponentHandler","goo/loaders/handlers/LogicComponentHandler","goo/loaders/handlers/MaterialHandler","goo/loaders/handlers/MeshDataComponentHandler","goo/loaders/handlers/MeshDataHandler","goo/loaders/handlers/MeshRendererComponentHandler","goo/loaders/handlers/SceneHandler","goo/loaders/handlers/ShaderHandler","goo/loaders/handlers/SkeletonHandler","goo/loaders/handlers/TextureHandler","goo/loaders/handlers/TransformComponentHandler","goo/loaders/handlers/AnimationComponentHandler","goo/loaders/handlers/AnimationStateHandler","goo/loaders/handlers/AnimationLayersHandler","goo/loaders/handlers/AnimationClipHandler","goo/loaders/handlers/ProjectHandler","goo/loaders/handlers/ScriptComponentHandler","goo/loaders/handlers/ScriptHandler","goo/loaders/handlers/FSMComponentHandler","goo/loaders/handlers/MachineHandler","goo/loaders/handlers/SoundComponentHandler","goo/loaders/handlers/SoundHandler","goo/loaders/handlers/PosteffectHandler"],function(t,e,i,o,r,n,a,s){"use strict";function c(t){if(this.options=t,this._objects={},s.defaults(this.options,{ajax:!0}),!this.options.world)throw new Error("World argument cannot be null");if(this._world=this.options.world,!this.options.rootPath)throw new Error("parameters.rootPath must be defined");this.setRootPath(this.options.rootPath),this._configs={},this.options.ajax&&(this._ajax=new i)}var l=["shader","script","entity","material","scene","mesh","texture","skeleton","animation","clip","bundle","project","machine","posteffect","animstate","sound"],h=s.keys(t.getHandler("texture").loaders),u=["jpg","jpeg","png","gif"],d=["dat","bin"],p=["mp3","wav"],f=h.concat(u,d,p),m=t.getHandler("material").ENGINE_SHADER_PREFIX;return c.prototype.preloadCache=function(t,e){return null==e&&(e=!1),e?this._configs=t:s.extend(this._configs,t)},c.prototype.loadFromConfig=function(t,e,i){if(null==i&&(i={}),s.defaults(i,this.options),null!=e&&(i.noCache?this._configs=e:s.extend(this._configs,e)),this._configs[t])throw new Error(""+t+" not found in the supplied configs Available keys: \n"+s.keys(this._configs).join("\n"));return this.load(t,i)},c.prototype.loadFromBundle=function(t,e,i){var o=this;null==i&&(i={}),s.defaults(i,this.options);var r=o._loadRef(e).then(function(r){if(i.noCache?o._configs=r:s.extend(o._configs,r),null==o._configs[t])throw new Error(t+" not found in bundle "+e+". Available keys: \n"+s.keys(o._configs).join("\n"));return i.preloadBinaries===!0?o._preloadBinariesFromRef(t,i).then(function(){return i.preloadBinaries=!1,o.load(t,i)}):o.load(t,i)});return r},c.prototype.load=function(t,e){var i=this;if(null==e)e={};else if(e.preloadBinaries===!0)return this._preloadBinariesFromRef(t,e).then(function(){return i.update(t,null,e)});return this.update(t,null,e)},c.prototype._loadBinariesFromRefs=function(t,e){for(var i=this,o=[],n=0,a=function(t){return i._loadRef(t).then(function(){n++,"function"==typeof e.progressCallback&&e.progressCallback(n,o.length)})},s=function(t){var e=[],n=[],a=function(t){var r=i._loadRef(t).then(function(t){for(var r=i._getRefsFromConfig(t),n=0,s=r.length;s>n;n++){var l=r[n];c.isAssetRef(l)?-1===o.indexOf(l)&&o.push(l):c.isJSONRef(l)&&-1===e.indexOf(l)&&(a(l),e.push(l))}});n.push(r)};return a(t),r.all(n)},l=[],h=0,u=t.length;u>h;h++)l.push(s(t[h]));return r.all(l).then(function(){for(var t=[],e=0,i=o.length;i>e;e++)t.push(a(o[e]));return r.all(t)})},c.prototype._preloadBinariesFromRef=function(t,e){s.defaults(e,this.options);var i=this;return i._loadRef(t).then(function(o){var r;if("project.project"===t){if(r=o.entityRefs,0===r.length)return console.warn("No entity refs in project:",o),a.createDummyPromise(null)}else r=i._getRefsFromConfig(o);return i._loadBinariesFromRefs(r,e)})},c.prototype.update=function(e,i,o){var n=this;return null==o&&(o={}),s.defaults(o,this.options,{recursive:!0}),i&&(this._configs[e]=i),delete this._objects[e],this._loadRef(e).then(function(i){var a=0,s=[];if(o.recursive&&t.getHandler(c.getTypeForRef(e)))for(var l=n._getRefsFromConfig(i),h=function(t){return s.push(n._loadRef(t).then(function(e){return a++,o.progressCallback&&o.progressCallback.call&&o.progressCallback.call(null,a,s.length),n._handle(t,e,o)}))},u=0;u<l.length;u++)h(l[u]);return r.all(s.concat(n._handle(e,i,o)))}).then(function(){return n._configs}).then(null,function(t){return console.error("Error updating "+e+" "+t)})},c.prototype.remove=function(t){return delete this._objects[t],this._handle(t,null)},c.prototype._handle=function(e,i,o){var n,l,h,u=this;null==o&&(o={});var d=this._objects[e];return!d||d.isRejected?(h=c.getTypeForRef(e),l=t.getHandler(h),l?(null==this._handlers&&(this._handlers={}),n=this._handlers[h],n?s.extend(n,{world:this._world,getConfig:this._loadRef.bind(this),updateObject:this._handle.bind(this),options:s.clone(o)}):n=this._handlers[h]=new l(this._world,this._loadRef.bind(this),this._handle.bind(this),o),null!=i?this._objects[e]=n.update(e,i,o).then(function(t){return u._objects[e]=t}):(n.remove(e),a.createDummyPromise(null))):(console.warn("No handler for type "+h),a.createDummyPromise(null))):d instanceof r.Promise?this._objects[e]:o.noCache?void 0:a.createDummyPromise(this._objects[e])},c.prototype._loadRef=function(t,e){var o,r,n=this;if(0===t.indexOf(m)&&(o=a.createDummyPromise(null),this._configs[t]=o),null==e&&(e=!1),this._configs[t]){if(this._configs[t].then)return this._configs[t];if(!e)return a.createDummyPromise(this._configs[t])}return this._ajax?(r=this._rootPath+window.escape(t),o=c.isImageRef(t)?this._ajax.loadImage(r):c.isBinaryRef(t)?this._ajax.load(r,i.ARRAY_BUFFER):c.isAudioRef(t)?a.createDummyPromise(r):this._ajax.load(r),o=o.then(function(e){return n._configs[t]=c.isJSONRef(t)?JSON.parse(e):e}).then(null,function(e){return delete n._configs[t],e}),this._configs[t]=o,o):a.createDummyPromise(null)},c.prototype._getRefsFromConfig=function(t){var e=[],i=function(t,o){var r;if(/(^url|[\S]+ref)s?|Urls$/i.test(t))null!==o&&void 0!==o&&(e=e.concat(o));else if(o instanceof Object)for(r in o)o.hasOwnProperty(r)&&i(r,o[r])};return i("",t),e},c.getTypeForRef=function(t){return t.split(".").pop().toLowerCase()},c.isJSONRef=function(t){var e=c.getTypeForRef(t);return s.indexOf(l,e)>=0},c.isAssetRef=function(t){var e=c.getTypeForRef(t);return s.indexOf(f,e)>=0},c.isImageRef=function(t){var e=c.getTypeForRef(t);return s.indexOf(u,e)>=0},c.isBinaryRef=function(t){var e=c.getTypeForRef(t);return s.indexOf(h,e)>=0||s.indexOf(d,e)>=0},c.isAudioRef=function(t){var e=c.getTypeForRef(t);return s.indexOf(p,e)>=0},c.prototype.getCachedObjectForRef=function(t){return this._objects?this._objects[t]:void 0},c.prototype.setRootPath=function(t){this._rootPath=t,t.length>1&&"/"!==t.charAt(t.length-1)&&(this._rootPath+="/")},c}),define("goo/math/Matrix2x2",["goo/math/MathUtils","goo/math/Matrix"],function(t,e){"use strict";function i(){e.call(this,2,2),0===arguments.length?this.setIdentity():this.set(arguments)}return i.prototype=Object.create(e.prototype),i.prototype.setupAliases([["e00"],["e10"],["e01"],["e11"]]),i.IDENTITY=new i(1,0,0,1),i.add=function(t,e,o){return o||(o=new i),e instanceof i?(o.e00=t.e00+e.e00,o.e10=t.e10+e.e10,o.e01=t.e01+e.e01,o.e11=t.e11+e.e11):(o.e00=t.e00+e,o.e10=t.e10+e,o.e01=t.e01+e,o.e11=t.e11+e),o},i.prototype.add=function(t){return i.add(this,t,this)},i.sub=function(t,e,o){return o||(o=new i),e instanceof i?(o.e00=t.e00-e.e00,o.e10=t.e10-e.e10,o.e01=t.e01-e.e01,o.e11=t.e11-e.e11):(o.e00=t.e00-e,o.e10=t.e10-e,o.e01=t.e01-e,o.e11=t.e11-e),o},i.prototype.sub=function(t){return i.sub(this,t,this)},i.mul=function(t,e,o){return o||(o=new i),e instanceof i?(o.e00=t.e00*e.e00,o.e10=t.e10*e.e10,o.e01=t.e01*e.e01,o.e11=t.e11*e.e11):(o.e00=t.e00*e,o.e10=t.e10*e,o.e01=t.e01*e,o.e11=t.e11*e),o},i.prototype.mul=function(t){return i.mul(this,t,this)},i.div=function(t,e,o){return o||(o=new i),e instanceof i?(o.e00=t.e00/e.e00,o.e10=t.e10/e.e10,o.e01=t.e01/e.e01,o.e11=t.e11/e.e11):(e=1/e,o.e00=t.e00*e,o.e10=t.e10*e,o.e01=t.e01*e,o.e11=t.e11*e),o},i.prototype.div=function(t){return i.div(this,t,this)},i.combine=function(t,o,r){return r||(r=new i),r===t||r===o?e.copy(i.combine(t,o),r):(r.e00=t.e00*o.e00+t.e01*o.e10,r.e10=t.e10*o.e00+t.e11*o.e10,r.e01=t.e00*o.e01+t.e01*o.e11,r.e11=t.e10*o.e01+t.e11*o.e11,r)},i.prototype.combine=function(t){return i.combine(this,t,this)},i.transpose=function(t,o){return o||(o=new i),o===t?e.copy(i.transpose(t),o):(o.e00=t.e00,o.e10=t.e01,o.e01=t.e10,o.e11=t.e11,o)},i.prototype.transpose=function(){return i.transpose(this,this)},i.invert=function(o,r){if(r||(r=new i),r===o)return e.copy(i.invert(o),r);var n=o.determinant();if(Math.abs(n)<t.EPSILON)throw{name:"Singular Matrix",message:"The matrix is singular and cannot be inverted."};return n=1/n,r.e00=o.e11*n,r.e10=0-o.e10*n,r.e01=0-o.e01*n,r.e11=o.e00*n,r},i.prototype.invert=function(){return i.invert(this,this)},i.prototype.isOrthogonal=function(){var e;return e=this.e00*this.e01+this.e10*this.e11,Math.abs(e)>t.EPSILON?!1:!0},i.prototype.isNormal=function(){var e;return e=this.e00*this.e00+this.e10*this.e10,Math.abs(e-1)>t.EPSILON?!1:(e=this.e01*this.e01+this.e11*this.e11,Math.abs(e-1)>t.EPSILON?!1:!0)},i.prototype.isOrthonormal=function(){return this.isOrthogonal()&&this.isNormal()},i.prototype.determinant=function(){return this.e00*this.e11-this.e01*this.e10},i.prototype.setIdentity=function(){return this.set(i.IDENTITY),this},i}),define("goo/noise/Noise",["goo/math/MathUtils"],function(t){"use strict";function e(){}return e.shifter=[37,91,12,128,216,96,51,153,39,231,223,180,160,157,135,179,74,50,205,151,4,213,196,58,212,120,53,45,10,195,137,159,103,144,109,170,202,48,121,13,245,68,232,28,210,174,197,80,107,206,156,116,155,240,162,79,41,59,147,117,0,242,118,164,129,101,98,126,214,105,89,26,130,254,85,199,8,165,76,75,187,166,64,143,217,149,78,7,172,230,87,119,42,247,84,139,16,141,134,86,154,71,253,60,99,235,168,30,34,55,113,140,191,69,31,106,40,82,73,33,81,14,234,131,255,88,169,136,248,148,220,138,219,102,44,127,36,200,95,208,54,152,47,20,23,15,52,123,177,224,122,171,215,173,211,188,190,133,244,167,236,35,63,145,221,104,65,24,70,100,56,150,49,77,110,228,112,209,198,1,237,185,250,225,93,201,124,108,218,72,243,21,22,6,114,38,125,29,66,249,222,111,241,11,186,61,176,183,17,163,229,161,57,238,227,132,67,83,207,226,46,189,115,193,194,233,182,192,18,27,25,2,3,252,97,62,184,239,175,92,246,142,251,204,203,32,146,90,19,9,178,158,181,94,43,5],e.split=function(e){var i=Math.floor(e),o=t.scurve5(e-i);return{i0:i+0,i1:i+1,f0:1-o,f1:0+o}},e.fractal1d=function(t,e,i,o,r,n){for(var a=0,s=1,c=0,l=0;i>l;l++)a+=s*n.evaluate1d(t,e),c+=s,s*=o,t*=r;return a/c},e.fractal2d=function(t,e,i,o,r,n,a){for(var s=0,c=1,l=0,h=0;o>h;h++)s+=c*a.evaluate2d(t,e,i),l+=c,c*=r,t*=n,e*=n;return s/l},e.fractal3d=function(t,e,i,o,r,n,a,s){for(var c=0,l=1,h=0,u=0;r>u;u++)c+=l*s.evaluate3d(t,e,i,o),h+=l,l*=n,t*=a,e*=a,i*=a;return c/h},e.fractal4d=function(t,e,i,o,r,n,a,s,c){for(var l=0,h=1,u=0,d=0;n>d;d++)l+=h*c.evaluate4d(t,e,i,o,r),u+=h,h*=a,t*=s,e*=s,i*=s,o*=s;return l/u},e}),define("goo/noise/ValueNoise",["goo/noise/Noise"],function(t){"use strict";function e(){t.call(this)}return e.prototype=Object.create(t.prototype),e.sources=[0,1/15,2/15,.2,4/15,5/15,.4,7/15,8/15,.6,10/15,11/15,.8,13/15,14/15,1],e.evaluate1d=function(i,o){var r=t.split(i/o),n=15&t.shifter[255&r.i0],a=15&t.shifter[255&r.i1],s=0;return s+=r.f0*e.sources[n],s+=r.f1*e.sources[a]},e.evaluate2d=function(i,o,r){var n=t.split(i/r),a=t.split(o/r),s=15&t.shifter[255&t.shifter[255&a.i0]+n.i0],c=15&t.shifter[255&t.shifter[255&a.i0]+n.i1],l=15&t.shifter[255&t.shifter[255&a.i1]+n.i0],h=15&t.shifter[255&t.shifter[255&a.i1]+n.i1],u=0;return u+=a.f0*n.f0*e.sources[s],u+=a.f0*n.f1*e.sources[c],u+=a.f1*n.f0*e.sources[l],u+=a.f1*n.f1*e.sources[h]},e.evaluate3d=function(i,o,r,n){var a=t.split(i/n),s=t.split(o/n),c=t.split(r/n),l=15&t.shifter[255&t.shifter[255&t.shifter[255&c.i0]+s.i0]+a.i0],h=15&t.shifter[255&t.shifter[255&t.shifter[255&c.i0]+s.i0]+a.i1],u=15&t.shifter[255&t.shifter[255&t.shifter[255&c.i0]+s.i1]+a.i0],d=15&t.shifter[255&t.shifter[255&t.shifter[255&c.i0]+s.i1]+a.i1],p=15&t.shifter[255&t.shifter[255&t.shifter[255&c.i1]+s.i0]+a.i0],f=15&t.shifter[255&t.shifter[255&t.shifter[255&c.i1]+s.i0]+a.i1],m=15&t.shifter[255&t.shifter[255&t.shifter[255&c.i1]+s.i1]+a.i0],g=15&t.shifter[255&t.shifter[255&t.shifter[255&c.i1]+s.i1]+a.i1],v=0;return v+=c.f0*s.f0*a.f0*e.sources[l],v+=c.f0*s.f0*a.f1*e.sources[h],v+=c.f0*s.f1*a.f0*e.sources[u],v+=c.f0*s.f1*a.f1*e.sources[d],v+=c.f1*s.f0*a.f0*e.sources[p],v+=c.f1*s.f0*a.f1*e.sources[f],v+=c.f1*s.f1*a.f0*e.sources[m],v+=c.f1*s.f1*a.f1*e.sources[g]},e.evaluate4d=function(i,o,r,n,a){var s=t.split(i/a),c=t.split(o/a),l=t.split(r/a),h=t.split(n/a),u=15&t.shifter[255&t.shifter[255&t.shifter[255&t.shifter[255&h.i0]+l.i0]+c.i0]+s.i0],d=15&t.shifter[255&t.shifter[255&t.shifter[255&t.shifter[255&h.i0]+l.i0]+c.i0]+s.i1],p=15&t.shifter[255&t.shifter[255&t.shifter[255&t.shifter[255&h.i0]+l.i0]+c.i1]+s.i0],f=15&t.shifter[255&t.shifter[255&t.shifter[255&t.shifter[255&h.i0]+l.i0]+c.i1]+s.i1],m=15&t.shifter[255&t.shifter[255&t.shifter[255&t.shifter[255&h.i0]+l.i1]+c.i0]+s.i0],g=15&t.shifter[255&t.shifter[255&t.shifter[255&t.shifter[255&h.i0]+l.i1]+c.i0]+s.i1],v=15&t.shifter[255&t.shifter[255&t.shifter[255&t.shifter[255&h.i0]+l.i1]+c.i1]+s.i0],y=15&t.shifter[255&t.shifter[255&t.shifter[255&t.shifter[255&h.i0]+l.i1]+c.i1]+s.i1],x=15&t.shifter[255&t.shifter[255&t.shifter[255&t.shifter[255&h.i1]+l.i0]+c.i0]+s.i0],w=15&t.shifter[255&t.shifter[255&t.shifter[255&t.shifter[255&h.i1]+l.i0]+c.i0]+s.i1],_=15&t.shifter[255&t.shifter[255&t.shifter[255&t.shifter[255&h.i1]+l.i0]+c.i1]+s.i0],b=15&t.shifter[255&t.shifter[255&t.shifter[255&t.shifter[255&h.i1]+l.i0]+c.i1]+s.i1],S=15&t.shifter[255&t.shifter[255&t.shifter[255&t.shifter[255&h.i1]+l.i1]+c.i0]+s.i0],M=15&t.shifter[255&t.shifter[255&t.shifter[255&t.shifter[255&h.i1]+l.i1]+c.i0]+s.i1],C=15&t.shifter[255&t.shifter[255&t.shifter[255&t.shifter[255&h.i1]+l.i1]+c.i1]+s.i0],T=15&t.shifter[255&t.shifter[255&t.shifter[255&t.shifter[255&h.i1]+l.i1]+c.i1]+s.i1],E=0;return E+=h.f0*l.f0*c.f0*s.f0*e.sources[u],E+=h.f0*l.f0*c.f0*s.f1*e.sources[d],E+=h.f0*l.f0*c.f1*s.f0*e.sources[p],E+=h.f0*l.f0*c.f1*s.f1*e.sources[f],E+=h.f0*l.f1*c.f0*s.f0*e.sources[m],E+=h.f0*l.f1*c.f0*s.f1*e.sources[g],E+=h.f0*l.f1*c.f1*s.f0*e.sources[v],E+=h.f0*l.f1*c.f1*s.f1*e.sources[y],E+=h.f1*l.f0*c.f0*s.f0*e.sources[x],E+=h.f1*l.f0*c.f0*s.f1*e.sources[w],E+=h.f1*l.f0*c.f1*s.f0*e.sources[_],E+=h.f1*l.f0*c.f1*s.f1*e.sources[b],E+=h.f1*l.f1*c.f0*s.f0*e.sources[S],E+=h.f1*l.f1*c.f0*s.f1*e.sources[M],E+=h.f1*l.f1*c.f1*s.f0*e.sources[C],E+=h.f1*l.f1*c.f1*s.f1*e.sources[T]},e}),define("goo/particles/ParticleInfluence",[],function(){"use strict";function t(t){t=t||{},this.prepare=t.prepare?t.prepare:function(){},this.apply=t.apply?t.apply:function(){},this.enabled=void 0!==t.enabled?t.enabled===!0:!0}return t}),define("goo/picking/BoundingTree",["goo/renderer/bounds/BoundingBox","goo/renderer/bounds/BoundingSphere","goo/math/Vector3"],function(t,e,i){"use strict";function o(t){this.leftTree=null,this.rightTree=null,this.localBound=null,this.worldBound=null,this.boundType=t?t:o.BOUNDTYPE_BOX}return o.BOUNDTYPE_SPHERE="sphere",o.BOUNDTYPE_BOX="box",o.MAX_PRIMITIVES_PER_LEAF=16,o.prototype.construct=function(t){if(!t.meshRendererComponent||!t.meshDataComponent||!t.transformComponent)return console.warn("Entity missing required components for boundingtree construction: ",t),void 0;var e=t.meshDataComponent.meshData;if(e.updatePrimitiveCounts(),1===e.getSectionCount()){this.primitiveIndices=[];for(var i=0,o=e.getPrimitiveCount(0);o>i;i++)this.primitiveIndices.push(i);this.createTree(t,0,0,this.primitiveIndices.length)}else this.split(t,0,e.getSectionCount())},o.prototype.createTree=function(t,e,i,r){var n=t.meshDataComponent.meshData;this.section=e,this.start=i,this.end=r,this.primitiveIndices&&(this.createBounds(),this.localBound.computeFromPrimitives(n,e,this.primitiveIndices,i,r),r-i+1<=o.MAX_PRIMITIVES_PER_LEAF||(this.leftTree||(this.leftTree=new o(this.boundType)),this.leftTree.primitiveIndices=this.primitiveIndices,this.leftTree.createTree(t,e,i,Math.floor((i+r)/2)),this.rightTree||(this.rightTree=new o(this.boundType)),this.rightTree.primitiveIndices=this.primitiveIndices,this.rightTree.createTree(t,e,Math.floor((i+r)/2),r)))},o.prototype.split=function(t,e,i){var r=i-e,n=Math.floor(r/2);if(1===n){var a=e;this.leftTree=new o(this.boundType),this.leftTree.primitiveIndices=[];for(var s=0;s<this.leftTree.primitiveIndices.length;s++)this.leftTree.primitiveIndices.push(s);this.leftTree.createTree(t,a,0,this.leftTree.primitiveIndices.length)}else this.leftTree=new o(this.boundType),this.leftTree.split(t,e,e+n);if(1===r-n){var a=e+1;this.rightTree=new o(this.boundType),this.rightTree._primitiveIndices=[];for(var s=0;s<this.rightTree.primitiveIndices.length;s++)this.rightTree.primitiveIndices.push(s);this.rightTree.createTree(t,a,0,this.rightTree.primitiveIndices.length)}else this.rightTree=new o(this.boundType),this.rightTree.split(t,e+n,i);this.localBound=this.leftTree.localBound.clone(this.localBound),this.localBound.merge(this.rightTree.localBound),this.worldBound=this.localBound.clone(this.worldBound)},o.prototype.createBounds=function(){switch(this.boundType){case o.BOUNDTYPE_BOX:this.localBound=new t,this.worldBound=new t;break;case o.BOUNDTYPE_SPHERE:this.localBound=new e,this.worldBound=new e}},o.prototype.findPick=function(t,e,o){var r=o;r||(r={});var n=e.transformComponent.worldTransform;if(this.localBound.transform(n,this.worldBound),!this.worldBound.intersectsRay(t))return r;if(this.leftTree&&this.leftTree.findPick(t,e,r),this.rightTree)this.rightTree.findPick(t,e,r);else if(!this.leftTree)for(var a=e.meshDataComponent.meshData,s=null,c=new i,l=this.start;l<this.end;l++){s=a.getPrimitiveVertices(this.primitiveIndices[l],this.section,s);for(var h=0;h<s.length;h++)n.matrix.applyPostPoint(s[h]);if(t.intersects(s,!1,c)){r.distances=r.distances||[],r.distances.push(t.origin.distance(c)),r.points=r.points||[];var u=new i;u.setv(c),r.points.push(u),r.vertices=r.vertices||[],r.vertices.push(s)}}return r},o}),define("goo/picking/PrimitivePickLogic",["goo/picking/BoundingTree"],function(t){"use strict";function e(){}return e.prototype.getPickResult=function(t,e){var i=e.meshDataComponent.meshData.__boundingTree;return i?i.findPick(t,e,{}):null},e.prototype.added=function(t){this.isConstructed(t)||this.rebuild(t)},e.prototype.removed=function(t){t.meshDataComponent.meshData.__boundingTree=null},e.prototype.isConstructed=function(t){return!!t.meshDataComponent.meshData.__boundingTree},e.prototype.rebuild=function(e){e.meshDataComponent.meshData.__boundingTree=new t,e.meshDataComponent.meshData.__boundingTree.construct(e)},e}),define("goo/renderer/scanline/Edge",[],function(){"use strict";function t(){this.x0=0,this.x1=0,this.y0=0,this.y1=0,this.z0=0,this.z1=0,this.dx=0,this.dy=0,this.dz=0,this.xIncrement=0,this.zIncrement=0,this.betweenFaces=!1}return t.prototype.setData=function(t,e){var i=t.data[1],o=e.data[1];o>i?(this.x0=t.data[0],this.x1=e.data[0],this.y0=i,this.y1=o,this.z0=t.data[2],this.z1=e.data[2]):(this.x0=e.data[0],this.x1=t.data[0],this.y0=o,this.y1=i,this.z0=e.data[2],this.z1=t.data[2]),this.betweenFaces=!1},t.prototype.computeDerivedData=function(){var t=this.x1-this.x0,e=this.y1-this.y0,i=this.z1-this.z0;
this.dy=e,this.dx=t,this.dz=i,this.xIncrement=t/e,this.zIncrement=i/e},t.prototype.roundOccludeeCoordinates=function(){this.y0=Math.round(this.y0),this.y1=Math.round(this.y1)},t}),define("goo/renderer/scanline/EdgeData",[],function(){"use strict";function t(){var t=2,e=8,i=t*Int16Array.BYTES_PER_ELEMENT,o=e*Float32Array.BYTES_PER_ELEMENT;this._dataBuffer=new ArrayBuffer(i+o),this.floatData=new Float32Array(this._dataBuffer,0,e),this.integerData=new Int16Array(this._dataBuffer,o,t)}return t.prototype.setData=function(t){this.integerData[0]=t[0],this.integerData[1]=t[1],this.floatData[0]=t[2],this.floatData[1]=t[3],this.floatData[2]=t[4],this.floatData[3]=t[5],this.floatData[4]=t[6],this.floatData[5]=t[7],this.floatData[6]=t[8],this.floatData[7]=t[9]},t.prototype.getStartLine=function(){return this.integerData[0]},t.prototype.getStopLine=function(){return this.integerData[1]},t.prototype.getLongX=function(){return this.floatData[0]},t.prototype.setLongX=function(t){this.floatData[0]=t},t.prototype.getShortX=function(){return this.floatData[1]},t.prototype.setShortX=function(t){this.floatData[1]=t},t.prototype.getLongZ=function(){return this.floatData[2]},t.prototype.getShortZ=function(){return this.floatData[3]},t.prototype.getLongXIncrement=function(){return this.floatData[4]},t.prototype.getShortXIncrement=function(){return this.floatData[5]},t.prototype.getLongZIncrement=function(){return this.floatData[6]},t.prototype.getShortZIncrement=function(){return this.floatData[7]},t}),define("goo/renderer/scanline/OccludeeTriangleData",[],function(){"use strict";function t(t){var e=t.numberOfPositions,i=t.numberOfIndices;this.indexCount=0;var o=e*Float32Array.BYTES_PER_ELEMENT,r=i*Uint8Array.BYTES_PER_ELEMENT;this._dataBuffer=new ArrayBuffer(o+r),this.positions=new Float32Array(this._dataBuffer,0,e),this.indices=new Uint8Array(this._dataBuffer,o,i)}return t.prototype.addIndices=function(t){var e=this.indexCount;this.indices[e]=t[0],e++,this.indices[e]=t[1],e++,this.indices[e]=t[2],e++,this.indexCount=e},t.prototype.clear=function(){this.indexCount=0},t}),define("goo/renderer/scanline/BoundingBoxOcclusionChecker",["goo/math/Matrix4x4","goo/math/Vector4","goo/math/Vector2","goo/renderer/scanline/OccludeeTriangleData"],function(t,e,i,o){"use strict";function r(t){this.renderer=t,this._clipY=t.height-1,this._clipX=t.width-1,this._halfClipX=this._clipX/2,this._halfClipY=this._clipY/2}var n=0,a=1,s=2,c=4,l=8,h=new Uint8Array(8),u=new Float32Array(32),d=new Float32Array(5),p=new Uint8Array([0,3,4,3,7,4,0,4,5,0,5,1,2,1,5,2,5,6,3,2,6,3,6,7,0,1,2,0,2,3,5,4,6,7,6,4]),f=new Uint8Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,0,0,4,1,5,2,6,3,7]),m=new o({numberOfPositions:32,numberOfIndices:18}),g=new e(0,0,0,1),v=new e(0,0,0,1),y=new e(0,0,0,1),x=new Uint8Array(3),w=new t;return r.prototype.occlusionCull=function(t,e){return this._doSSAABBOcclusionTest(t,e)},r.prototype._doRenderedBoundingBoxOcclusionTest=function(t,e){if(this._copyEntityVerticesToPositionArray(t),!this._projectionTransformTriangleData(t,e))return!1;this._addVisibleTrianglesToTriangleData(),this._screenSpaceTransformTriangleData();for(var i=m.indexCount,o=0;i>o;)if(x[0]=m.indices[o++],x[1]=m.indices[o++],x[2]=m.indices[o++],!this.renderer.isRenderedTriangleOccluded(x,m.positions))return!1;return!0},r.prototype._doSSAABBOcclusionTest=function(e,i){this._copyEntityVerticesToPositionArray(e);var o=e.transformComponent.worldTransform.matrix;t.combine(i,o,w);for(var r=0;32>r;){var n=r++,a=r++,s=r++,c=r++;g.data[0]=u[n],g.data[1]=u[a],g.data[2]=u[s],g.data[3]=u[c],w.applyPost(g);var l=g.data[3];if(l<this.renderer.camera.near)return!1;var h=1/l;g.data[0]*=h,g.data[1]*=h,u[n]=(g.data[0]+1)*this._halfClipX,u[a]=(g.data[1]+1)*this._halfClipY,u[c]=h}return this._clipBox(u),d[0]=Math.floor(d[0]),d[1]=Math.ceil(d[1]),d[2]=Math.floor(d[2]),d[3]=Math.ceil(d[3]),this._isBoundingBoxScanlineOccluded(d)},r.prototype._copyEntityVerticesToPositionArray=function(t){u.set(t.occludeeComponent.positionArray)},r.prototype._clipBox=function(t){var e,i,o,r,u;e=1/0,i=-1/0,o=1/0,r=-1/0,u=-1/0;for(var p,m=0;8>m;m++){p=4*m,g.data[0]=t[p],g.data[1]=t[p+1],g.data[3]=t[p+3];var x=this._calculateOutCode(g);if(h[m]=x,x===n){u=Math.max(u,g.data[3]);var w=g.data[0];e=Math.min(e,w),i=Math.max(i,w);var _=g.data[1];o=Math.min(o,_),r=Math.max(r,_)}}for(var b,S,M,C=0;24>C;C++)for(M=f[C],p=4*M,g.data[0]=t[p],g.data[1]=t[p+1],g.data[3]=t[p+3],b=h[M],C++,M=f[C],p=4*M,v.data[0]=t[p],v.data[1]=t[p+1],v.data[3]=t[p+3],S=h[M];b|S&&!(b&S);){var T,E,P=b?b:S;if(P&l){if(T=(this._clipY-g.data[1])/(v.data[1]-g.data[1]),y.data[0]=g.data[0]+(v.data[0]-g.data[0])*T,y.data[1]=this._clipY,E=this._calculateOutCode(y),E===n){r=this._clipY;var w=y.data[0];e=Math.min(e,w),i=Math.max(i,w)}}else if(P&c){if(T=-g.data[1]/(v.data[1]-g.data[1]),y.data[0]=g.data[0]+(v.data[0]-g.data[0])*T,y.data[1]=0,E=this._calculateOutCode(y),E===n){o=0;var w=y.data[0];e=Math.min(e,w),i=Math.max(i,w)}}else if(P&s){if(T=(this._clipX-g.data[0])/(v.data[0]-g.data[0]),y.data[1]=g.data[1]+(v.data[1]-g.data[1])*T,y.data[0]=this._clipX,E=this._calculateOutCode(y),E===n){i=this._clipX;var _=y.data[1];o=Math.min(o,_),r=Math.max(r,_)}}else if(P&a&&(T=-g.data[0]/(v.data[0]-g.data[0]),y.data[1]=g.data[1]+(v.data[1]-g.data[1])*T,y.data[0]=0,E=this._calculateOutCode(y),E===n)){e=0;var _=y.data[1];o=Math.min(o,_),r=Math.max(r,_)}var D;P===b?(b=E,D=(1-T)*g.data[3]+T*v.data[3]):(S=E,D=(1-T)*v.data[3]+T*g.data[3]),u=Math.max(u,D)}d[0]=e,d[1]=i,d[2]=o,d[3]=r,d[4]=u},r.prototype._calculateOutCode=function(t){var e=n;return t.data[0]<0?e|=a:t.data[0]>this._clipX&&(e|=s),t.data[1]<0?e|=c:t.data[1]>this._clipY&&(e|=l),e},r.prototype._isBoundingBoxScanlineOccluded=function(t){for(var e=t[0],i=t[1],o=t[2],r=t[3],n=t[4],a=this.renderer.width,s=r;s>=o;s--)for(var c=s*a+e,l=e;i>=l;l++){if(this.renderer._depthData[c]<n)return!1;c++}return!0},r.prototype._projectionTransformTriangleData=function(e,i){m.clear();var o=e.transformComponent.worldTransform.matrix;t.combine(i,o,w);for(var r,n,a,s,c,l=u.length,h=0;l>h;h++){if(r=h+1,n=h+2,a=h+3,g.data[0]=u[h],g.data[1]=u[r],g.data[2]=u[n],g.data[3]=1,w.applyPost(g),s=g.data[3],s<this.renderer.camera.near)return!1;c=1/s,g.data[0]*=c,g.data[1]*=c,m.positions[h]=g.data[0],m.positions[r]=g.data[1],m.positions[a]=c,h=a}return!0},r.prototype._addVisibleTrianglesToTriangleData=function(){for(var t,e=0;e<p.length;e++)x=[p[e],p[++e],p[++e]],t=4*x[0],g.data[0]=m.positions[t],g.data[1]=m.positions[t+1],t=4*x[1],v.data[0]=m.positions[t],v.data[1]=m.positions[t+1],t=4*x[2],y.data[0]=m.positions[t],y.data[1]=m.positions[t+1],this.renderer._isBackFacingProjected(g,v,y)||m.addIndices(x)},r.prototype._screenSpaceTransformTriangleData=function(){for(var t=m.positions.length,e=0;t>e;e+=4){m.positions[e]=(m.positions[e]+1)*this._halfClipX;var i=e+1;m.positions[i]=(m.positions[i]+1)*this._halfClipY}},r}),define("goo/renderer/scanline/BoundingSphereOcclusionChecker",["goo/math/Matrix4x4","goo/math/Vector4"],function(t,e){"use strict";function i(t){this.renderer=t,this._clipY=t.height-1,this._clipX=t.width-1,this._halfClipX=this._clipX/2,this._halfClipY=this._clipY/2}var o=new e(0,0,0,1),r=new t,n=new Float32Array(20),a=[0,255,0],s=[0,190,190];return i.prototype.occlusionCull=function(e,i,a,s){var c=e.transformComponent.worldTransform.matrix;t.combine(i,c,r);var l=e.meshDataComponent.modelBound;o.data[0]=0,o.data[1]=0,o.data[2]=0,o.data[3]=1,r.applyPost(o);var h=e.transformComponent.transform.scale,u=h.maxAxis()*l.radius,d=o.data[0],p=o.data[1],f=o.data[2],m=Math.sqrt(d*d+p*p+f*f);if(u>=m)return!1;var g=m*Math.tan(Math.asin(u/m)),v=f+g;if(v>s)return!1;n[0]=d,n[1]=p,n[2]=v,n[4]=d-g,n[5]=p,n[6]=f,n[8]=d+g,n[9]=p,n[10]=f,n[12]=d,n[13]=p+g,n[14]=f,n[16]=d,n[17]=p-g,n[18]=f;for(var y=0;20>y;){var x=y++,w=y++,_=y++,b=y++;o.data[0]=n[x],o.data[1]=n[w],o.data[2]=n[_],o.data[3]=1,a.applyPost(o);var S=1/o.data[3];o.data[0]*=S,o.data[1]*=S,n[x]=(o.data[0]+1)*this._halfClipX,n[w]=(o.data[1]+1)*this._halfClipY,n[b]=S}return this._isSSAABBScanlineOccluded()},i.prototype._isSSAABBScanlineOccluded=function(){var t=n[3],e=n[4],i=n[8],o=n[13],r=n[17];e=Math.floor(e),i=Math.ceil(i),o=Math.ceil(o),r=Math.floor(r),0>e&&(e=0),i>this._clipX&&(i=this._clipX),o>this._clipY&&(o=this._clipY),0>r&&(r=0);for(var s,c=this.renderer.width,l=o;l>=r;l--){s=l*c+e;for(var h=e;i>=h;h++){if(this.renderer._colorData.set(a,4*s),this.renderer._depthData[s]<t)return!1;s++}}return!0},i.prototype._isPythagorasCircleScanlineOccluded=function(t,e,i,o,r,n){var a=t.y-i.y,c=i.y-e.y,l=i.x-t.x,h=l*l,u=this.renderer.width,d=u/this.renderer.height,p=t.y-1;if(1>=a&&1>=c||t.y<=0||e.y>=this._clipY){var f;return this._isCoordinateInsideScreen(t)&&(f=t.y*u+t.x,this.renderer._colorData.set(s,4*f)),this._isCoordinateInsideScreen(e)&&(f=e.y*u+e.x,this.renderer._colorData.set(s,4*f)),this._isCoordinateInsideScreen(o)&&(f=o.y*u+o.x,this.renderer._colorData.set(s,4*f)),this._isCoordinateInsideScreen(i)&&(f=i.y*u+i.x,this.renderer._colorData.set(s,4*f)),!0}var m=1;if(i.y>=this._clipY)a=0,p=this._clipY;else{var g=p-this._clipY;g>0&&(a-=g,m+=g,p=this._clipY);var v=-(i.y+1);v>0&&(a-=v)}a-=1;for(var y=0;a>y;y++){var x=l-d*m,w=Math.sqrt(h-x*x),_=Math.ceil(t.x+w),b=Math.floor(t.x-w);0>b&&(b=0),_>this._clipX&&(_=this._clipX);for(var f=p*this.width+b,S=b;_>=S;S++){if(this.renderer._colorData.set(n,4*f),this.renderer._depthData[f]<r)return!1;f++}p--,m++}if(0>p)return!0;if(a>=-1&&i.y<=this._clipY){var b=o.x+1;0>b&&(b=0);var _=i.x-1;_>this._clipX&&(_=this._clipX);for(var M=p*this.width+b,y=b;_>=y;y++){if(this.renderer._colorData.set(n,4*M),this.renderer._depthData[M]<r)return!1;M++}p--}m=c-1;var g=i.y-p-1;g>0&&(c-=g,m-=g);var C=-(e.y+1);C>0&&(c-=C),c-=1,l=i.x-e.x;for(var y=0;c>y;y++){var x=l-d*m,w=Math.sqrt(h-x*x),_=Math.ceil(t.x+w),b=Math.floor(t.x-w);0>b&&(b=0),_>this._clipX&&(_=this._clipX);for(var f=p*this.width+b,S=b;_>=S;S++){if(this.renderer._colorData.set(n,4*f),this.renderer._depthData[f]<r)return!1;f++}p--,m--}return!0},i.prototype._isOccluded=function(t,e,i){if(this._isCoordinateInsideScreen(t)){var o=t.y*this.renderer.width+t.x;return this.renderer._colorData.set(e,4*o),i<this.renderer._depthData[o]}return!0},i.prototype._isCoordinateInsideScreen=function(t){return t.data[0]>=0&&t.data[0]<=this._clipX&&t.data[1]<=this._clipY&&t.data[1]>=0},i}),define("goo/renderer/scanline/OccluderTriangleData",[],function(){"use strict";function t(t){var e=t.vertCount,i=t.indexCount,o=i/3,r=4*e,n=r+8*o,a=2*i;this.posCount=0,this.largestIndex=-1,this.indexCount=0;var s=n*Float32Array.BYTES_PER_ELEMENT,c=a*Uint8Array.BYTES_PER_ELEMENT;this._dataBuffer=new ArrayBuffer(s+c),this.positions=new Float32Array(this._dataBuffer,0,n),this.indices=new Uint8Array(this._dataBuffer,s,a)}return t.prototype.addVertex=function(t){var e=this.posCount;return this.positions[e]=t[0],e++,this.positions[e]=t[1],e++,this.positions[e]=t[2],e++,this.positions[e]=t[3],e++,this.posCount=e,this.largestIndex++,this.largestIndex},t.prototype.setCountersToNewEntity=function(t){this.indexCount=0;var e=t/3;this.posCount=4*e,this.largestIndex=e-1},t.prototype.addIndices=function(t){var e=this.indexCount;this.indices[e]=t[0],e++,this.indices[e]=t[1],e++,this.indices[e]=t[2],e++,this.indexCount=e},t}),define("goo/renderer/scanline/EdgeMap",["goo/renderer/scanline/Edge"],function(t){"use strict";function e(e){this._edges=new Array(e),this._edgeCount=0;for(var i=0;e>i;i++)this._edges[i]=new t;this._map={},this.numberOfSharedEdges=0}return e.prototype.addEdge=function(t,e,i,o){var r=this._indicesToKey(t,e);if(this._contains(r)){var n=this._map[r];this._edges[n].betweenFaces=!0,this.numberOfSharedEdges++}else{var a=this._indicesToKey(e,t),n=this._edgeCount,s=this._edges[n];s.setData(i,o,t,e),s.computeDerivedData(),this._map[r.toString()]=n,this._map[a.toString()]=n,this._edgeCount++}},e.prototype._contains=function(t){return this._map.hasOwnProperty(t)},e.prototype.getEdge=function(t,e){var i=this._indicesToKey(t,e),o=this._map[i];return this._edges[o]},e.prototype.clear=function(){this._map={},this._edgeCount=0,this.numberOfSharedEdges=0},e.prototype._indicesToKey=function(t,e){return(t<<8)+e},e}),define("goo/renderer/scanline/SoftwareRenderer",["goo/math/Vector4","goo/math/Matrix4x4","goo/renderer/scanline/Edge","goo/renderer/bounds/BoundingSphere","goo/renderer/bounds/BoundingBox","goo/renderer/scanline/EdgeData","goo/renderer/scanline/BoundingBoxOcclusionChecker","goo/renderer/scanline/BoundingSphereOcclusionChecker","goo/renderer/scanline/OccluderTriangleData","goo/renderer/scanline/EdgeMap"],function(t,e,i,o,r,n,a,s,c,l){"use strict";function h(t){t=t||{},this.width=t.width,this.height=t.height,this._clipY=this.height-1,this._clipX=this.width-1,this._halfClipX=this._clipX/2,this._halfClipY=this._clipY/2,this.camera=t.camera;var e=this.width*this.height,i=4*e*Uint8Array.BYTES_PER_ELEMENT,o=e*Float32Array.BYTES_PER_ELEMENT;this._frameBuffer=new ArrayBuffer(i+2*o),this._colorData=new Uint8Array(this._frameBuffer,0,4*e),this._depthData=new Float32Array(this._frameBuffer,i,e),this._depthClear=new Float32Array(this._frameBuffer,i+o,e);for(var r=0;e>r;r++)this._depthClear[r]=0;this._triangleData=new c({vertCount:t.maxVertCount,indexCount:t.maxIndexCount}),this.edgeMap=new l(t.maxVertCount),this.boundingBoxModule=new a(this),this.boundingSphereModule=new s(this),g.data[2]=-this.camera.near}var u=new Uint8Array(4),d=new Uint16Array(3),p=new t(0,0,0,1),f=new t(0,0,0,1),m=new t(0,0,0,1),g=new t(0,0,0,1),v=[p,f,m],y=new Uint8Array(3),x=new Uint8Array(3),w=new Uint8Array(3),_=new e,b=new e,S=new n,M=[new i,new i,new i];return h.prototype._clearDepthData=function(){this._depthData.set(this._depthClear)},h.prototype.render=function(t){this._clearDepthData();for(var e,i=this.camera.getViewMatrix(),o=this.camera.getProjectionMatrix(),r=0;r<t.length;r++){this._setupTriangleDataForEntity(t[r],i,o),this._fillEdgeMap(),e=this._triangleData.indexCount;for(var n=0;e>n;n++)u[0]=this._triangleData.indices[n],u[1]=this._triangleData.indices[++n],u[2]=this._triangleData.indices[++n],this._renderTriangle(u)}},h.prototype._fillEdgeMap=function(){this.edgeMap.clear();for(var t=this._triangleData.indexCount,e=0;t>e;e++){var i=this._triangleData.indices[e],o=this._triangleData.indices[++e],r=this._triangleData.indices[++e],n=4*i;p.data[0]=this._triangleData.positions[n],p.data[1]=this._triangleData.positions[n+1],p.data[2]=this._triangleData.positions[n+3],n=4*o,f.data[0]=this._triangleData.positions[n],f.data[1]=this._triangleData.positions[n+1],f.data[2]=this._triangleData.positions[n+3],n=4*r,m.data[0]=this._triangleData.positions[n],m.data[1]=this._triangleData.positions[n+1],m.data[2]=this._triangleData.positions[n+3],this.edgeMap.addEdge(i,o,p,f),this.edgeMap.addEdge(o,r,f,m),this.edgeMap.addEdge(r,i,m,p)}},h.prototype.performOcclusionCulling=function(t){var i=this.camera.getViewMatrix(),n=this.camera.getProjectionMatrix();e.combine(n,i,_);for(var a=-this.camera.near,s=[],c=0,l=t.length;l>c;c++){var h=t[c],u=h.occludeeComponent;if(u){var d=!1,p=u.modelBound;p instanceof o?d=this.boundingSphereModule.occlusionCull(h,i,n,a):p instanceof r&&(d=this.boundingBoxModule.occlusionCull(h,_)),d||s.push(h)}else s.push(h)}return s},h.prototype._viewSpaceTransformAndCopyVertices=function(t,i){var o=t.occluderComponent.meshData.dataViews.POSITION,r=t.transformComponent.worldTransform.matrix;e.combine(i,r,b),p.data[3]=1;for(var n=o.length,a=0,s=0;n>s;s++)p.data[0]=o[s],s++,p.data[1]=o[s],s++,p.data[2]=o[s],b.applyPost(p),this._triangleData.positions[a]=p.data[0],a++,this._triangleData.positions[a]=p.data[1],a++,this._triangleData.positions[a]=p.data[2],a+=2;this._triangleData.setCountersToNewEntity(n)},h.prototype._nearPlaneClipAndAddTriangle=function(t){var e,i,o,r,n,a,s,c,l=this._categorizeVertices(-t);switch(l){case 0:this._triangleData.addIndices(u);break;case 3:break;case 1:e=y[0],i=v[e],o=i.data[0],r=i.data[1],n=v[x[0]],c=this._calculateIntersectionRatio(i,n,t),g.data[0]=o+c*(n.data[0]-o),g.data[1]=r+c*(n.data[1]-r),u[e]=this._triangleData.addVertex(g.data),n=v[x[1]],c=this._calculateIntersectionRatio(i,n,t),g.data[0]=o+c*(n.data[0]-o),g.data[1]=r+c*(n.data[1]-r),u[3]=this._triangleData.addVertex(g.data);var h=x[0],d=u[3];w[0]=u[e],w[1]=u[h],w[2]=d,this._triangleData.addIndices(w),w[0]=d,w[2]=u[x[1]],this._triangleData.addIndices(w);break;case 2:n=v[x[0]],a=n.data[0],s=n.data[1],e=y[0],i=v[e],o=i.data[0],r=i.data[1],c=this._calculateIntersectionRatio(i,n,t),g.data[0]=o+c*(a-o),g.data[1]=r+c*(s-r),u[e]=this._triangleData.addVertex(g.data),e=y[1],i=v[e],o=i.data[0],r=i.data[1],c=this._calculateIntersectionRatio(i,n,t),g.data[0]=o+c*(a-o),g.data[1]=r+c*(s-r),u[e]=this._triangleData.addVertex(g.data),this._triangleData.addIndices(u)}},h.prototype._screenSpaceTransformTriangleData=function(t){for(var e=this._triangleData.posCount,i=0;e>i;){var o=i++,r=i++,n=i++,a=i++;p.data[0]=this._triangleData.positions[o],p.data[1]=this._triangleData.positions[r],p.data[2]=this._triangleData.positions[n],p.data[3]=1,t.applyPost(p);var s=1/p.data[3],c=p.data[0]*s,l=p.data[1]*s;this._triangleData.positions[o]=(c+1)*this._halfClipX,this._triangleData.positions[r]=(l+1)*this._halfClipY,this._triangleData.positions[a]=s}},h.prototype._setupTriangleDataForEntity=function(t,e,i){this._viewSpaceTransformAndCopyVertices(t,e);for(var o=t.occluderComponent.meshData.indexData.data,r=o.length,n=this.camera.near,a=0;r>a;a++){u[0]=o[a],u[1]=o[++a],u[2]=o[++a],d[0]=4*u[0],d[1]=4*u[1],d[2]=4*u[2];var s=d[0];p.data[0]=this._triangleData.positions[s],p.data[1]=this._triangleData.positions[s+1],p.data[2]=this._triangleData.positions[s+2],s=d[1],f.data[0]=this._triangleData.positions[s],f.data[1]=this._triangleData.positions[s+1],f.data[2]=this._triangleData.positions[s+2],s=d[2],m.data[0]=this._triangleData.positions[s],m.data[1]=this._triangleData.positions[s+1],m.data[2]=this._triangleData.positions[s+2],this._isBackFacingCameraViewSpace(p,f,m)||this._nearPlaneClipAndAddTriangle(n)}this._screenSpaceTransformTriangleData(i)},h.prototype._categorizeVertices=function(t){for(var e=0,i=0,o=0;3>o;o++)v[o].data[2]<=t?(x[i]=o,i++):(y[e]=o,e++);return e},h.prototype._calculateIntersectionRatio=function(t,e,i){var o=t.data[2];return(o+i)/(o-e.data[2])},h.prototype._isBackFacingCameraViewSpace=function(t,e,i){var o=t.data[0],r=t.data[1],n=t.data[2],a=e.data[0]-o,s=e.data[1]-r,c=e.data[2]-n,l=i.data[0]-o,h=i.data[1]-r,u=i.data[2]-n,d=u*s-h*c,p=l*c-u*a,f=h*a-l*s,m=d*o+p*r+f*n;return m>0},h.prototype._isBackFacingProjected=function(t,e,i){var o=t.data[0],r=t.data[1],n=e.data[0]-o,a=e.data[1]-r,s=i.data[0]-o,c=i.data[1]-r,l=c*n-s*a;return 0>l},h.prototype._createOccludeeEdges=function(t,e){var i=4*t[0];p.data[0]=e[i],p.data[1]=e[i+1],p.data[2]=e[i+3],i=4*t[1],f.data[0]=e[i],f.data[1]=e[i+1],f.data[2]=e[i+3],i=4*t[2],m.data[0]=e[i],m.data[1]=e[i+1],m.data[2]=e[i+3],M[0].setData(p,f),M[1].setData(f,m),M[2].setData(m,p),M[0].roundOccludeeCoordinates(),M[1].roundOccludeeCoordinates(),M[2].roundOccludeeCoordinates(),M[0].computeDerivedData(),M[1].computeDerivedData(),M[2].computeDerivedData()},h.prototype._getLongEdgeAndShortEdgeIndices=function(){for(var t=M[0].dy,e=0,i=1;3>i;i++){var o=M[i].dy;o>t&&(t=o,e=i)}var r=(e+1)%3,n=(e+2)%3;return[e,r,n]},h.prototype._calculateOrientationData=function(t,e){var i=S.getShortX(),o=S.getLongX();return[o>i,e.z1<t.z0]},h.prototype.isRenderedTriangleOccluded=function(t,e){this._createOccludeeEdges(t,e);var i=this._getLongEdgeAndShortEdgeIndices(),o=M[i[0]],r=i[1],n=i[2];if(this._verticalLongEdgeCull(o))return console.log("renderingocclusion : vertical cull"),!0;var a=M[r],s=null;if(this._createEdgeData(o,a)){if(s=this._calculateOrientationData(S,a,o),this._horizontalLongEdgeCull(o,s))return console.log("renderingocclusion : horizontal cull"),!0;if(!this._isEdgeOccluded(S,s))return!1}if(a=M[n],this._createEdgeData(o,a)){if(null===s&&(s=this._calculateOrientationData(S,a,o),this._horizontalLongEdgeCull(o,s)))return console.log("renderingocclusion : horizontal cull"),!0;if(!this._isEdgeOccluded(S,s))return!1}return!0},h.prototype._renderTriangle=function(t){var e=t[0],i=t[1],o=t[2];M[0]=this.edgeMap.getEdge(e,i),M[1]=this.edgeMap.getEdge(i,o),M[2]=this.edgeMap.getEdge(o,e);var r=this._getLongEdgeAndShortEdgeIndices(),n=M[r[0]],a=r[1],s=r[2];if(!this._verticalLongEdgeCull(n)){var c=M[a],l=[n.betweenFaces,c.betweenFaces],h=null;if(this._createEdgeData(n,c)){if(h=this._calculateOrientationData(c,n),this._horizontalLongEdgeCull(n,h))return;this._drawEdges(S,h,l)}if(c=M[s],l=[n.betweenFaces,c.betweenFaces],this._createEdgeData(n,c)){if(h=this._calculateOrientationData(c,n),this._horizontalLongEdgeCull(n,h))return;this._drawEdges(S,h,l)}}},h.prototype._verticalLongEdgeCull=function(t){return t.y1<0||t.y0>this._clipY},h.prototype._horizontalLongEdgeCull=function(t,e){return e[0]?t.x1<0&&t.x0<0:t.x1>this._clipX&&t.x0>this._clipX},h.prototype._isEdgeOccluded=function(t,e){var i,o,r,n,a,s,c,l,h,u=t.getStartLine(),d=t.getStopLine(),p=t.getLongXIncrement(),f=t.getShortXIncrement(),m=t.getLongZIncrement(),g=t.getShortZIncrement();if(e[0])if(e[1])for(l=u;d>=l;l++){if(i=t.getShortX(),o=t.getLongX(),a=Math.floor(i),s=Math.ceil(o),r=t.getShortZ(),n=t.getLongZ(),c=s-a,h=.5/(c+1),n=(1-h)*n+h*r,!this._isScanlineOccluded(a,s,l,r,n))return!1;t.floatData[0]+=p,t.floatData[1]+=f,t.floatData[2]+=m,t.floatData[3]+=g}else for(l=u;d>=l;l++){if(i=t.getShortX(),o=t.getLongX(),a=Math.floor(i),s=Math.ceil(o),r=t.getShortZ(),n=t.getLongZ(),c=s-a,h=.5/(c+1),r=(1-h)*r+h*n,!this._isScanlineOccluded(a,s,l,r,n))return!1;t.floatData[0]+=p,t.floatData[1]+=f,t.floatData[2]+=m,t.floatData[3]+=g}else if(e[1])for(l=u;d>=l;l++){if(i=t.getLongX(),o=t.getShortX(),a=Math.floor(i),s=Math.ceil(o),r=t.getLongZ(),n=t.getShortZ(),c=s-a,h=.5/(c+1),n=(1-h)*n+h*r,!this._isScanlineOccluded(a,s,l,r,n))return!1;t.floatData[0]+=p,t.floatData[1]+=f,t.floatData[2]+=m,t.floatData[3]+=g}else for(l=u;d>=l;l++){if(i=t.getLongX(),o=t.getShortX(),a=Math.floor(i),s=Math.ceil(o),r=t.getLongZ(),n=t.getShortZ(),c=s-a,h=.5/(c+1),r=(1-h)*r+h*n,!this._isScanlineOccluded(a,s,l,r,n))return!1;t.floatData[0]+=p,t.floatData[1]+=f,t.floatData[2]+=m,t.floatData[3]+=g}return!0},h.prototype._drawEdges=function(t,e,i){var o,r,n,a,s,c,l,h,u,d,p,f,m,g,v,y=t.getStartLine(),x=t.getStopLine(),w=t.getLongXIncrement(),_=t.getShortXIncrement(),b=t.getLongZIncrement(),S=t.getShortZIncrement(),M=i[0],C=i[1],T=.5,E=T,P=.5;if(e[0])if(e[1])for(p=M,o=t.getShortX(),r=t.getLongX(),n=t.getShortZ(),a=t.getLongZ(),u=_,d=w,l=o+Math.abs(.5*u),p?(h=r+Math.abs(P*d),E=-T):h=r-Math.abs(.5*d),s=l+T,c=h-E,t.setLongX(c+d),t.setShortX(s+u),s=Math.ceil(s),c=Math.floor(c),t.floatData[3]+=S,t.floatData[2]+=b,this._fillPixels(s,c,y,n,a),y++,f=y;x>=f;f++)o=t.getShortX(),r=t.getLongX(),n=t.getShortZ(),a=t.getLongZ(),s=Math.ceil(o),c=Math.floor(r),m=s-o,g=r-o,v=m/g,n=(1-v)*n+v*a,g=c-s+1,v=.5/g,n=(1-v)*n+v*a,this._fillPixels(s,c,f,n,a),t.floatData[0]+=w,t.floatData[1]+=_,t.floatData[2]+=b,t.floatData[3]+=S;else for(p=M,o=t.getShortX(),r=t.getLongX(),n=t.getShortZ(),a=t.getLongZ(),u=_,d=w,l=o+Math.abs(.5*u),p?(h=r+Math.abs(P*d),E=-T):h=r-Math.abs(.5*d),s=l+T,c=h-E,t.setLongX(c+d),t.setShortX(s+u),s=Math.ceil(s),c=Math.floor(c),t.floatData[3]+=S,t.floatData[2]+=b,this._fillPixels(s,c,y,n,a),y++,f=y;x>=f;f++)o=t.getShortX(),r=t.getLongX(),n=t.getShortZ(),a=t.getLongZ(),s=Math.ceil(o),c=Math.floor(r),m=r-c,g=r-o,v=m/g,a=(1-v)*a+v*n,g=c-s+1,v=.5/g,a=(1-v)*a+v*n,this._fillPixels(s,c,f,n,a),t.floatData[0]+=w,t.floatData[1]+=_,t.floatData[2]+=b,t.floatData[3]+=S;else if(e[1])for(p=C,o=t.getLongX(),r=t.getShortX(),n=t.getLongZ(),a=t.getShortZ(),u=w,d=_,l=o+Math.abs(.5*u),p?(h=r+Math.abs(P*d),E=-T):h=r-Math.abs(.5*d),s=l+T,c=h-E,t.setShortX(c+d),t.setLongX(s+u),s=Math.ceil(s),c=Math.floor(c),t.floatData[2]+=S,t.floatData[3]+=b,this._fillPixels(s,c,y,n,a),y++,f=y;x>=f;f++)o=t.getLongX(),r=t.getShortX(),n=t.getLongZ(),a=t.getShortZ(),s=Math.ceil(o),c=Math.floor(r),m=s-o,g=r-o,v=m/g,n=(1-v)*n+v*a,g=c-s+1,v=.5/g,n=(1-v)*n+v*a,this._fillPixels(s,c,f,n,a),t.floatData[0]+=w,t.floatData[1]+=_,t.floatData[2]+=b,t.floatData[3]+=S;else for(p=C,o=t.getLongX(),r=t.getShortX(),n=t.getLongZ(),a=t.getShortZ(),u=w,d=_,l=o+Math.abs(.5*u),p?(h=r+Math.abs(P*d),E=-T):h=r-Math.abs(.5*d),s=l+T,c=h-E,t.setShortX(c+d),t.setLongX(s+u),s=Math.ceil(s),c=Math.floor(c),t.floatData[2]+=S,t.floatData[3]+=b,this._fillPixels(s,c,y,n,a),y++,f=y;x>=f;f++)o=t.getLongX(),r=t.getShortX(),n=t.getLongZ(),a=t.getShortZ(),s=Math.ceil(o),c=Math.floor(r),m=r-c,g=r-o,v=m/g,a=(1-v)*a+v*n,g=c-s+1,v=.5/g,a=(1-v)*a+v*n,this._fillPixels(s,c,f,n,a),t.floatData[0]+=w,t.floatData[1]+=_,t.floatData[2]+=b,t.floatData[3]+=S},h.prototype._createEdgeData=function(t,e){var i=Math.ceil(e.y0),o=Math.floor(e.y1),r=t.zIncrement,n=e.zIncrement,a=e.xIncrement,s=t.xIncrement;if(i>o)return!1;if(i===o){if(!e.betweenFaces)return!1;a=0,s=0}var c=(e.y0-t.y0)/t.dy,l=t.x0+t.dx*c,h=t.z0+t.dz*c,u=e.x0,d=e.z0,p=i-e.y0;return l+=p*s,u+=p*a,h+=p*r,d+=p*n,0>i&&(l+=-i*s,u+=-i*a,h+=-i*r,d+=-i*n,i=0),o=Math.min(this._clipY,o),S.setData([i,o,l,u,h,d,s,a,r,n]),!0},h.prototype._isScanlineOccluded=function(t,e,i,o,r){if(t>e||0>e||t>this._clipX)return!0;var n;0>t&&(n=-t/(e-t+1),o=(1-n)*o+n*r,t=0);var a=e-this._clipX+1;a>0&&(n=a/(e-t+1),r=(1-n)*r+n*o,e=this._clipX);for(var s=i*this.width+t,c=o,l=(r-o)/(e-t),h=t;e>=h;h++){if(this._colorData.set([Math.min(255*c+50,255),0,0],4*s),c>this._depthData[s])return!1;s++,c+=l}return!0},h.prototype._fillPixels=function(t,e,i,o,r){if(!(0>e||t>this._clipX||t>e)){var n;0>t&&(n=-t/(e-t+1),o=(1-n)*o+n*r,t=0);var a=e-this._clipX+1;a>0&&(n=a/(e-t+1),r=(1-n)*r+n*o,e=this._clipX);for(var s=i*this.width+t,c=o,l=(r-o)/(e-t),h=t;e>=h;h++)c>this._depthData[s]&&(this._depthData[s]=c),s++,c+=l}},h.prototype.copyDepthToColor=function(){for(var t=0,e=0;e<this._depthData.length;e++){var i=this._depthData[e];i>0?(i*=255,this._colorData[t]=i,this._colorData[++t]=i,this._colorData[++t]=i,this._colorData[++t]=255):(this._colorData[t]=0,this._colorData[++t]=0,this._colorData[++t]=0,this._colorData[++t]=0),t++}},h.prototype.getColorData=function(){return this._colorData},h.prototype.getDepthData=function(){return this._depthData},h.prototype.calculateDifference=function(t,e){for(var i=0;i<this._depthData.length;i++){var o=this._depthData[i],r=4*i,n=t[r],a=t[r+1],s=t[r+2],c=t[r+3];o>0&&!(n>256*e[0]||a>256*e[1]||s>256*e[2]||c>256*e[3])&&(this._colorData[r]=255,this._colorData[r+1]=0,this._colorData[r+2]=0,this._colorData[r+3]=255)}},h}),define("goo/renderer/OcclusionPartitioner",["goo/renderer/SimplePartitioner","goo/renderer/scanline/SoftwareRenderer"],function(t,e){"use strict";function i(i){this._viewFrustumCuller=new t,this.occluderList=[],this.renderer=new e(i),void 0!==i.debugContext?(this.debugContext=i.debugContext,this.imagedata=this.debugContext.createImageData(i.width,i.height),this.processFunc=function(t,e,i){this._viewFrustumCuller.process(t,e,i),this._addVisibleOccluders(i),this.renderer.render(this.occluderList),this.renderer.copyDepthToColor();var o=this.renderer.performOcclusionCulling(i);i.length=0;for(var r=0;r<o.length;r++)i[r]=o[r];this._writeDebugData()}):this.processFunc=function(t,e,i){this._viewFrustumCuller.process(t,e,i),this._addVisibleOccluders(i),this.renderer.render(this.occluderList);var o=this.renderer.performOcclusionCulling(i);i.length=0;for(var r=0;r<o.length;r++)i[r]=o[r]}}return i.prototype.added=function(t){this._viewFrustumCuller.added(t)},i.prototype.removed=function(t){this._viewFrustumCuller.added(t)},i.prototype.process=function(t,e,i){this.processFunc(t,e,i)},i.prototype._writeDebugData=function(){this.imagedata.data.set(this.renderer.getColorData()),this.debugContext.putImageData(this.imagedata,0,0)},i.prototype._addVisibleOccluders=function(t){this.occluderList.length=0;for(var e=0;e<t.length;e++){var i=t[e];i.occluderComponent&&this.occluderList.push(i)}},i}),define("goo/renderer/pass/DOFPass",["goo/renderer/Material","goo/renderer/pass/RenderTarget","goo/renderer/MeshData","goo/renderer/Shader","goo/renderer/shaders/ShaderFragment","goo/renderer/pass/RenderPass","goo/renderer/pass/FullscreenPass","goo/renderer/pass/BlurPass","goo/renderer/Util","goo/util/Skybox"],function(t,e,i,o,r,n,a,s,c,l){"use strict";function h(i,o){this.depthPass=new n(i,function(t){return!(t instanceof l)}),this.regularPass=new n(i);var r=t.createMaterial(u);this.depthPass.overrideMaterial=r;var s=o||d;this.outPass=new a(s),this.outPass.useReadBuffer=!1,this.outPass.renderToScreen=!0;var h=window.innerWidth||1,p=window.innerHeight||1,f=c.nearestPowerOfTwo(Math.max(h,p));this.depthTarget=new e(h,p),this.regularTarget=new e(f/2,f/2),this.regularTarget2=new e(h,p),this.regularTarget.generateMipmaps=!0,this.regularTarget.minFilter="Trilinear",this.enabled=!0,this.clear=!1,this.needsSwap=!0}h.prototype.render=function(t,e,i,r){this.depthPass.render(t,null,this.depthTarget,r),this.regularPass.render(t,null,this.regularTarget,r),this.regularPass.render(t,null,this.regularTarget2,r),this.outPass.material.setTexture(o.DEPTH_MAP,this.depthTarget),this.outPass.material.setTexture(o.DIFFUSE_MAP,this.regularTarget),this.outPass.material.setTexture("DIFFUSE_MIP",this.regularTarget2),this.outPass.render(t,e,i,r)};var u={attributes:{vertexPosition:i.POSITION},uniforms:{viewMatrix:o.VIEW_MATRIX,projectionMatrix:o.PROJECTION_MATRIX,worldMatrix:o.WORLD_MATRIX,farPlane:o.FAR_PLANE},vshader:["attribute vec3 vertexPosition;","uniform mat4 viewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 worldMatrix;","varying vec4 vPosition;","void main(void) {","	vPosition = viewMatrix * worldMatrix * vec4(vertexPosition, 1.0);","	gl_Position = projectionMatrix * vPosition;","}"].join("\n"),fshader:["precision mediump float;","uniform float farPlane;",r.methods.packDepth,"varying vec4 vPosition;","void main(void)","{","	float linearDepth = min(-vPosition.z, farPlane) / farPlane;","	gl_FragColor = packDepth(linearDepth);","}"].join("\n")},d={attributes:{vertexPosition:i.POSITION,vertexUV0:i.TEXCOORD0},uniforms:{worldMatrix:o.WORLD_MATRIX,viewProjectionMatrix:o.VIEW_PROJECTION_MATRIX,depthMap:o.DEPTH_MAP,diffuseMap:o.DIFFUSE_MAP,diffuseMip:"DIFFUSE_MIP",zfar:o.FAR_PLANE,focalDepth:100,fStop:2,CoC:.003,focalLength:75,maxBlur:16},vshader:["attribute vec3 vertexPosition;","attribute vec2 vertexUV0;","uniform mat4 viewProjectionMatrix;","uniform mat4 worldMatrix;","varying vec2 texCoord0;","void main(void) {","	texCoord0 = vertexUV0;","	gl_Position = viewProjectionMatrix * worldMatrix * vec4(vertexPosition, 1.0);","}"].join("\n"),fshader:"uniform sampler2D diffuseMap;\nuniform sampler2D diffuseMip;\nuniform sampler2D depthMap;\nuniform float zfar; //camera clipping end\nuniform float focalDepth;\nuniform float focalLength;\nuniform float fStop;\nuniform float CoC;\nuniform float maxBlur;\nvarying vec2 texCoord0;\n"+r.methods.unpackDepth+"void main() \n"+"{\n"+"	float depth = unpackDepth(texture2D(depthMap,texCoord0)) * zfar;\n"+"	float f = focalLength; //focal length in mm\n"+"	float d = focalDepth*1000.0; //focal plane in mm\n"+"	float o = depth*1000.0; //depth in mm\n"+"	float a = (o*f)/(o-f); \n"+"	float b = (d*f)/(d-f); \n"+"	float c = (d-f)/(d*fStop*CoC); \n"+"	float blur = clamp(abs(a-b)*c, 0.0, maxBlur);\n"+" if (blur < 0.3) {\n"+"   gl_FragColor = texture2D(diffuseMip, texCoord0);\n"+" } else { \n"+"   gl_FragColor = texture2D(diffuseMap, texCoord0, log2(blur));\n"+" }\n"+" gl_FragColor.a = 1.0;"+"}"};return h}),define("goo/renderer/pass/DepthPass",["goo/renderer/Material","goo/renderer/pass/RenderTarget","goo/renderer/MeshData","goo/renderer/Shader","goo/renderer/shaders/ShaderFragment","goo/renderer/pass/RenderPass","goo/renderer/pass/FullscreenPass","goo/renderer/pass/BlurPass"],function(t,e,i,o,r,n,a,s){"use strict";function c(i,o){this.depthPass=new n(i);var r=t.createMaterial(l);this.depthPass.overrideMaterial=r,this.blurTarget=new e(256,256),this.blurPass=new s({target:this.blurTarget});var c=o||h;this.outPass=new a(c),this.outPass.useReadBuffer=!1;
var u=window.innerWidth||1,d=window.innerHeight||1;this.depthTarget=new e(u,d),this.enabled=!0,this.clear=!1,this.needsSwap=!0}c.prototype.render=function(t,e,i,r){this.depthPass.render(t,null,this.depthTarget,r),this.blurPass.render(t,e,i,r),this.outPass.material.setTexture(o.DEPTH_MAP,this.depthTarget),this.outPass.material.setTexture(o.DIFFUSE_MAP,i),this.outPass.material.setTexture("BLUR_MAP",this.blurTarget),this.outPass.render(t,e,i,r)};var l={attributes:{vertexPosition:i.POSITION},uniforms:{viewMatrix:o.VIEW_MATRIX,projectionMatrix:o.PROJECTION_MATRIX,worldMatrix:o.WORLD_MATRIX,farPlane:o.FAR_PLANE},vshader:["attribute vec3 vertexPosition;","uniform mat4 viewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 worldMatrix;","varying vec4 vPosition;","void main(void) {","	vPosition = viewMatrix * worldMatrix * vec4(vertexPosition, 1.0);","	gl_Position = projectionMatrix * vPosition;","}"].join("\n"),fshader:["precision mediump float;","uniform float farPlane;",r.methods.packDepth,"varying vec4 vPosition;","void main(void)","{","	float linearDepth = min(length(vPosition), farPlane) / farPlane;","	gl_FragColor = packDepth(linearDepth);","}"].join("\n")},h={attributes:{vertexPosition:i.POSITION,vertexUV0:i.TEXCOORD0},uniforms:{viewMatrix:o.VIEW_MATRIX,projectionMatrix:o.PROJECTION_MATRIX,worldMatrix:o.WORLD_MATRIX,depthMap:o.DEPTH_MAP,diffuseMap:o.DIFFUSE_MAP},vshader:["attribute vec3 vertexPosition;","attribute vec2 vertexUV0;","uniform mat4 viewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 worldMatrix;","varying vec2 texCoord0;","void main(void) {","	texCoord0 = vertexUV0;","	gl_Position = projectionMatrix * viewMatrix * worldMatrix * vec4(vertexPosition, 1.0);","}"].join("\n"),fshader:["precision mediump float;","uniform sampler2D depthMap;","uniform sampler2D diffuseMap;","varying vec2 texCoord0;",r.methods.unpackDepth,"void main(void)","{","	vec4 depthCol = texture2D(depthMap, texCoord0);","	vec4 diffuseCol = texture2D(diffuseMap, texCoord0);","	float depth = unpackDepth(depthCol);","	gl_FragColor = diffuseCol * vec4(depth);","}"].join("\n")};return c}),define("goo/renderer/pass/DoGPass",["goo/renderer/Material","goo/renderer/pass/FullscreenUtil","goo/renderer/pass/RenderTarget","goo/renderer/Util","goo/renderer/shaders/ShaderLib"],function(t,e,i,o,r){"use strict";function n(n){n=n||{},this.target=void 0!==n.target?n.target:null;var a=void 0!==n.width?n.width:512,s=void 0!==n.height?n.height:512,c=void 0!==n.sigma?n.sigma:.6,l=void 0!==n.threshold?n.threshold:.005;c>2.5&&(c=2.5),this.renderTargetX=new i(a,s),this.gaussian1=new i(a,s),this.gaussian2=new i(a,s),this.renderable={meshData:e.quad,materials:[]},this.convolutionShader1=o.clone(r.convolution),this.convolutionShader2=o.clone(r.convolution),this.differenceShader=o.clone(r.differenceOfGaussians),this.differenceShader.uniforms.threshold=l,this.differenceMaterial=t.createMaterial(this.differenceShader);var h=this.convolutionShader1.buildKernel(c),u=this.convolutionShader2.buildKernel(1.6*c),d=h.length;this.convolutionShader1.defines={KERNEL_SIZE_FLOAT:d.toFixed(1),KERNEL_SIZE_INT:d.toFixed(0)},d=u.length,this.convolutionShader2.defines={KERNEL_SIZE_FLOAT:d.toFixed(1),KERNEL_SIZE_INT:d.toFixed(0)},this.convolutionShader1.uniforms.cKernel=h,this.convolutionShader2.uniforms.cKernel=u,this.blurX=[.5/a,0],this.blurY=[0,.5/s],this.convolutionMaterial1=t.createMaterial(this.convolutionShader1),this.convolutionMaterial2=t.createMaterial(this.convolutionShader2),this.enabled=!0,this.clear=!1,this.needsSwap=!1}return n.prototype.render=function(t,i,o){this.renderable.materials[0]=this.convolutionMaterial1,this.convolutionMaterial1.setTexture("DIFFUSE_MAP",o),this.convolutionShader1.uniforms.uImageIncrement=this.blurX,t.render(this.renderable,e.camera,[],this.renderTargetX,!0),this.convolutionMaterial1.setTexture("DIFFUSE_MAP",this.renderTargetX),this.convolutionShader1.uniforms.uImageIncrement=this.blurY,t.render(this.renderable,e.camera,[],this.gaussian1,!0),this.renderable.materials[0]=this.convolutionMaterial2,this.convolutionMaterial2.setTexture("DIFFUSE_MAP",o),this.convolutionShader2.uniforms.uImageIncrement=this.blurX,t.render(this.renderable,e.camera,[],this.renderTargetX,!0),this.convolutionMaterial2.setTexture("DIFFUSE_MAP",this.renderTargetX),this.convolutionShader2.uniforms.uImageIncrement=this.blurY,t.render(this.renderable,e.camera,[],this.gaussian2,!0),this.renderable.materials[0]=this.differenceMaterial,this.differenceMaterial.setTexture("BLUR1",this.gaussian1),this.differenceMaterial.setTexture("BLUR2",this.gaussian2),this.differenceMaterial.setTexture("ORIGINAL",o),null!==this.target?t.render(this.renderable,e.camera,[],this.target,this.clear):t.render(this.renderable,e.camera,[],o,this.clear)},n}),define("goo/renderer/pass/NesPass",["goo/renderer/TextureCreator","goo/renderer/Material","goo/renderer/pass/FullscreenUtil","goo/renderer/shaders/ShaderLib"],function(t,e,i,o){"use strict";function r(o){this.material=e.createMaterial(n),this.renderToScreen=!1,this.renderable={meshData:i.quad,materials:[this.material]},this.mapping=(new t).loadTexture2D(o),this.mapping.minFilter="NearestNeighborNoMipMaps",this.mapping.magFilter="NearestNeighbor",this.mapping.generateMipmaps=!1,this.enabled=!0,this.clear=!1,this.needsSwap=!0}r.prototype.render=function(t,e,o){this.material.setTexture("DIFFUSE_MAP",o),this.material.setTexture("COLOR_MAPPING",this.mapping),this.renderToScreen?t.render(this.renderable,i.camera,[],null,this.clear):t.render(this.renderable,i.camera,[],e,this.clear)};var n={attributes:o.copy.attributes,uniforms:{diffuse:"DIFFUSE_MAP",mapping:"COLOR_MAPPING",$link:o.copy.uniforms},vshader:o.copy.vshader,fshader:["precision mediump float;","uniform sampler2D diffuse;","uniform sampler2D mapping;","varying vec2 texCoord0;","void main() {","	vec4 texCol = texture2D( diffuse, texCoord0 );","	float r = floor(texCol.r * 31.0);","	float g = floor(texCol.g * 31.0);","	float b = floor(texCol.b * 31.0);","	vec4 texPalette = texture2D( mapping, vec2((r * 32.0 + g)/1024.0, b / 32.0) );","	gl_FragColor = vec4( texPalette.rgb, 1.0 );","}"].join("\n")};return r}),define("goo/renderer/pass/SSAOPass",["goo/renderer/Material","goo/renderer/pass/RenderTarget","goo/renderer/Util","goo/renderer/MeshData","goo/renderer/Shader","goo/renderer/shaders/ShaderFragment","goo/renderer/pass/RenderPass","goo/renderer/pass/FullscreenPass","goo/renderer/pass/BlurPass","goo/renderer/shaders/ShaderLib"],function(t,e,i,o,r,n,a,s,c,l){"use strict";function h(e){this.depthPass=new a(e),this.depthPass.clearColor.set(1,1,1,1);var i=t.createMaterial(u);this.depthPass.overrideMaterial=i,this.downsampleAmount=4;var o=window.innerWidth||1024,r=window.innerHeight||1024;this.updateSize({x:0,y:0,width:o,height:r}),this.enabled=!0,this.clear=!1,this.needsSwap=!0}h.prototype.updateSize=function(t){var o=Math.floor(t.width/this.downsampleAmount),r=Math.floor(t.height/this.downsampleAmount),n=i.clone(l.ssao);n.uniforms.size=[o,r],this.outPass=new s(n),this.outPass.useReadBuffer=!1,this.blurPass=new c({sizeX:o,sizeY:r}),this.depthTarget=new e(o,r,{magFilter:"NearestNeighbor",minFilter:"NearestNeighborNoMipMaps"}),console.log("UPDATE SSAOPASS: ",o,r)},h.prototype.render=function(t,e,i,o){this.depthPass.render(t,null,this.depthTarget,o),this.outPass.material.setTexture(r.DIFFUSE_MAP,i),this.outPass.material.setTexture(r.DEPTH_MAP,this.depthTarget),this.outPass.render(t,e,i,o)};var u={attributes:{vertexPosition:o.POSITION},uniforms:{viewMatrix:r.VIEW_MATRIX,projectionMatrix:r.PROJECTION_MATRIX,worldMatrix:r.WORLD_MATRIX},vshader:["attribute vec3 vertexPosition;","uniform mat4 viewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 worldMatrix;","void main(void) {","	gl_Position = projectionMatrix * viewMatrix * worldMatrix * vec4(vertexPosition, 1.0);","}"].join("\n"),fshader:["precision mediump float;",n.methods.packDepth,"void main(void) {","	gl_FragColor = packDepth(gl_FragCoord.z);","}"].join("\n")};return h}),define("goo/scripts/FPCamControlScript",["goo/math/Vector3","goo/math/Matrix3x3","goo/math/MathUtils","goo/util/GameUtils"],function(t,e,i,o){"use strict";function r(e){e=e||{},this.name="FPCamControlScript",this.domElement=e.domElement||null,this.turnSpeedHorizontal=isNaN(e.turnSpeedHorizontal)?.01:e.turnSpeedHorizontal,this.turnSpeedVertical=isNaN(e.turnSpeedVertical)?.01:e.turnSpeedVertical,this.maxAscent=void 0!==e.maxAscent?e.maxAscent:89.95*i.DEG_TO_RAD,this.minAscent=void 0!==e.minAscent?e.minAscent:-89.95*i.DEG_TO_RAD,this.calcVector=new t,this.rotX=0,this.rotY=0,this.pointerLocked=!1,this.mouseState={dX:0,dY:0},this.domElement&&this.setupMouseControls()}var n=function(){o.requestPointerLock()},a=function(t){this.pointerLocked&&(this.mouseState.dX+=t.movementX,this.mouseState.dY+=t.movementY)},s=function(){this.pointerLocked=!!document.pointerLockElement},c=function(){this.pointerLocked=!!document.pointerLockElement};return r.prototype.setupMouseControls=function(){this.domElement.addEventListener("mousedown",n.bind(this),!1),document.addEventListener("mousemove",a.bind(this)),document.addEventListener("pointerlockchange",s.bind(this)),document.addEventListener("pointerlockerror",c.bind(this)),o.requestPointerLock()},r.prototype.run=function(t,e,i){i&&!this.domElement&&i.domElement&&(this.domElement=i.domElement,this.setupMouseControls());var o=t.transformComponent,r=o.transform,n=r.rotation;n.toAngles(this.calcVector),this.rotY=this.calcVector.x,this.rotX=this.calcVector.y,0!==this.mouseState.dX&&(this.rotX-=this.turnSpeedHorizontal*this.mouseState.dX),0!==this.mouseState.dY&&(this.rotY-=this.turnSpeedVertical*this.mouseState.dY,this.rotY>this.maxAscent?this.rotY=this.maxAscent:this.rotY<this.minAscent&&(this.rotY=this.minAscent)),r.rotation.fromAngles(this.rotY,this.rotX,0),o.setUpdated(),this.mouseState.dX=0,this.mouseState.dY=0},r}),define("goo/scripts/GroundBoundMovementScript",["goo/math/Vector3"],function(t){"use strict";function e(e){e=e||{};for(var i in o)this[i]="boolean"==typeof o[i]?void 0!==e[i]?e[i]===!0:o[i]:isNaN(o[i])?o[i]instanceof t?e[i]?new t(e[i]):(new t).set(o[i]):e[i]||o[i]:isNaN(e[i])?o[i]:e[i];this.groundContact=1,this.targetVelocity=new t,this.targetHeading=new t,this.acceleration=new t,this.torque=new t,this.groundHeight=0,this.groundNormal=new t,this.controlState={run:0,strafe:0,jump:0,yaw:0,roll:0,pitch:0}}var i=new t,o={gravity:-9.81,worldFloor:-1/0,jumpImpulse:95,accLerp:.1,rotLerp:.1,modForward:1,modStrafe:.7,modBack:.4,modTurn:.3};return e.prototype.setTerrainSystem=function(t){this.terrainScript=t},e.prototype.getTerrainSystem=function(){return this.terrainScript},e.prototype.getTerrainHeight=function(t){var e=this.getTerrainSystem().getTerrainHeightAt(t.data);return null===e&&(e=this.worldFloor),e},e.prototype.getTerrainNormal=function(t){return this.getTerrainSystem().getTerrainNormalAt(t.data)},e.prototype.applyForward=function(t){this.controlState.run=t},e.prototype.applyStrafe=function(t){this.controlState.strafe=t},e.prototype.applyJump=function(t){this.controlState.jump=t},e.prototype.applyTurn=function(t){this.controlState.yaw=t},e.prototype.applyJumpImpulse=function(t){return this.groundContact&&(this.controlState.jump?(t=this.jumpImpulse,this.controlState.jump=0):t=0),t},e.prototype.applyDirectionalModulation=function(t,e,i){t*=this.modStrafe,i*=i>0?this.modForward:this.modBack,this.targetVelocity.set(t,this.applyJumpImpulse(e),i)},e.prototype.applyTorqueModulation=function(t,e,i){this.targetHeading.set(t,e*this.modTurn,i)},e.prototype.applyGroundNormalInfluence=function(){var t=Math.abs(Math.cos(this.groundNormal.data[0])),e=Math.abs(Math.cos(this.groundNormal.data[2]));this.targetVelocity.data[0]*=t,this.targetVelocity.data[2]*=e},e.prototype.updateTargetVectors=function(t){this.applyDirectionalModulation(this.controlState.strafe,this.gravity,this.controlState.run),t.rotation.applyPost(this.targetVelocity),this.applyGroundNormalInfluence(),this.applyTorqueModulation(this.controlState.pitch,this.controlState.yaw,this.controlState.roll)},e.prototype.computeAcceleration=function(t,e,o){return i.set(o),t.transformComponent.transform.rotation.applyPost(i),i.sub(e),i.lerp(o,this.accLerp),i.data[1]=o.data[1],i},e.prototype.computeTorque=function(t,e){return i.set(e),i.sub(t),i.lerp(e,this.rotLerp),i},e.prototype.updateVelocities=function(t){var e=t.movementComponent.getVelocity(),i=t.movementComponent.getRotationVelocity();this.acceleration.set(this.computeAcceleration(t,e,this.targetVelocity)),this.torque.set(this.computeTorque(i,this.targetHeading))},e.prototype.applyAccelerations=function(t){t.movementComponent.addVelocity(this.acceleration),t.movementComponent.addRotationVelocity(this.torque)},e.prototype.updateGroundNormal=function(t){this.groundNormal.set(this.getTerrainNormal(t.translation))},e.prototype.checkGroundContact=function(t,e){this.groundHeight=this.getTerrainHeight(e.translation),e.translation.data[1]<=this.groundHeight?(this.groundContact=1,this.updateGroundNormal(e)):this.groundContact=0},e.prototype.applyGroundContact=function(t,e){this.groundHeight>=e.translation.data[1]&&(e.translation.data[1]=this.groundHeight,t.movementComponent.velocity.data[1]<0&&(t.movementComponent.velocity.data[1]=0))},e.prototype.run=function(t){var e=t.transformComponent.transform;this.checkGroundContact(t,e),this.updateTargetVectors(e),this.updateVelocities(t),this.applyAccelerations(t),this.applyGroundContact(t,e)},e}),define("goo/scripts/HeightMapBoundingScript",["goo/math/MathUtils"],function(t){"use strict";function e(t){this.matrixData=t,this.width=t.length-1}return e.prototype.getMatrixData=function(){return this.matrixData},e.prototype.getPointInMatrix=function(t,e){return this.matrixData[t][e]},e.prototype.getAt=function(t,e){return 0>t||t>this.width||0>e||e>this.width?0:this.getPointInMatrix(t,e)},e.prototype.getInterpolated=function(t,e){var i=this.getAt(Math.ceil(t),Math.ceil(e)),o=this.getAt(Math.ceil(t),Math.floor(e)),r=this.getAt(Math.floor(t),Math.ceil(e)),n=this.getAt(Math.floor(t),Math.floor(e)),a=t-Math.floor(t),s=e-Math.floor(e),c=i*a+r*(1-a),l=o*a+n*(1-a),h=c*s+l*(1-s);return h},e.prototype.getTriangleAt=function(t,e){var i,o=Math.ceil(t),r=Math.floor(t),n=Math.ceil(e),a=Math.floor(e),s=t-r,c=e-a,l={x:r,y:n,z:this.getAt(r,n)},h={x:o,y:a,z:this.getAt(o,a)};return i=1-c>s?{x:r,y:a,z:this.getAt(r,a)}:{x:o,y:n,z:this.getAt(o,n)},[l,h,i]},e.prototype.getPreciseHeight=function(e,i){var o=this.getTriangleAt(e,i),r=t.barycentricInterpolation(o[0],o[1],o[2],{x:e,y:i,z:0});return r.z},e.prototype.run=function(t){var e=t.transformComponent.transform.translation;e.data[1]=this.getInterpolated(e.data[0],e.data[2])},e}),define("goo/scripts/MouseLookControlScript",["goo/math/Vector3","goo/math/Matrix3x3","goo/math/MathUtils"],function(t,e,i){"use strict";function o(o){o=o||{},this.name="MouseLookControlScript",this.domElement=o.domElement||null,this.turnSpeedHorizontal=isNaN(o.turnSpeedHorizontal)?.01:o.turnSpeedHorizontal,this.turnSpeedVertical=isNaN(o.turnSpeedVertical)?.01:o.turnSpeedVertical,this.dragOnly=void 0!==o.dragOnly?o.dragOnly===!0:!0,this.dragButton=isNaN(o.dragButton)?-1:o.dragButton,this.worldUpVector=new t(o.worldUpVector)||new t(0,1,0),this.localLeftVector=new t(o.localLeftVector)||new t(-1,0,0),this.onRun=o.onRun,this.maxAscent=void 0!==o.maxAscent?o.maxAscent:89.95*i.DEG_TO_RAD,this.minAscent=void 0!==o.minAscent?o.minAscent:-89.95*i.DEG_TO_RAD,this.calcVector=new t,this.calcMat1=new e,this.calcMat2=new e,this.rotX=0,this.rotY=0,this.resetMouseState(),this.domElement&&this.setupMouseControls()}o.prototype.resetMouseState=function(){this.mouseState={buttonDown:!1,lastX:0/0,lastY:0/0,dX:0,dY:0}},o.prototype.updateButtonState=function(t,e){this.domElement!==document&&this.domElement.focus(),!this.dragOnly||-1!==this.dragButton&&this.dragButton!==t.button||(this.mouseState.buttonDown=e,t.preventDefault())},o.prototype.updateDeltas=function(t){isNaN(this.mouseState.lastX)||isNaN(this.mouseState.lastY)?(this.mouseState.dX=0,this.mouseState.dY=0,this.mouseState.lastX=t.clientX,this.mouseState.lastY=t.clientY):(this.mouseState.dX=t.clientX-this.mouseState.lastX,this.mouseState.dY=t.clientY-this.mouseState.lastY,this.mouseState.lastX=t.clientX,this.mouseState.lastY=t.clientY)};var r,n,a,s=function(t){this.resetMouseState(),this.updateButtonState(t,!0),n=c.bind(this),a=l.bind(this),document.addEventListener("mousemove",n,!1),document.addEventListener("mouseup",a,!1),document.addEventListener("mouseout",a,!1)},c=function(t){this.updateDeltas(t)},l=function(t){this.updateButtonState(t,!1),document.removeEventListener("mousemove",n),document.removeEventListener("mouseup",a),document.removeEventListener("mouseout",a)};return o.prototype.setupMouseControls=function(){r=s.bind(this),this.domElement.addEventListener("mousedown",r,!1)},o.prototype.run=function(t,e,i){i&&!this.domElement&&i.domElement&&(this.domElement=i.domElement,this.setupMouseControls());var o=t.transformComponent;if(o){var r=o.transform,n=r.rotation;if(n.toAngles(this.calcVector),this.rotY=this.calcVector.x,this.rotX=this.calcVector.y,this.dragOnly&&!this.mouseState.buttonDown||0===this.mouseState.dX&&0===this.mouseState.dY)return this.mouseState.dX=0,this.mouseState.dY=0,void 0;var a=this.turnSpeedHorizontal,s=this.turnSpeedVertical;0!==this.mouseState.dX&&(this.rotX-=a*this.mouseState.dX),0!==this.mouseState.dY&&(this.rotY-=s*this.mouseState.dY,this.rotY>this.maxAscent?this.rotY=this.maxAscent:this.rotY<this.minAscent&&(this.rotY=this.minAscent)),r.rotation.fromAngles(this.rotY,this.rotX,0),o.setUpdated(),this.mouseState.dX=0,this.mouseState.dY=0}},o}),define("goo/scripts/RotationControlScript",["goo/math/Matrix3x3"],function(t){"use strict";function e(t){t=t||{},this.bindings={attach:i.bind(this),update:null,remove:null},this.element=t.domElement||null,this.name="RotationControlScript",this.states={dirty:!1,x:null,y:null,dx:null,dy:null},this.element&&this.setupMouseControls()}var i=function(t){t=t.touches&&1===t.touches.length?t.touches[0]:t,this.states.dx=0,this.states.dy=0,this.states.x=t.pageX,this.states.y=t.pageY,this.bindings.update=o.bind(this),this.bindings.remove=r.bind(this),document.addEventListener("mousemove",this.bindings.update,!1),document.addEventListener("touchmove",this.bindings.update,!1),document.addEventListener("mouseup",this.bindings.remove,!1),document.addEventListener("touchend",this.bindings.remove,!1)},o=function(t){t=t.touches&&1===t.touches.length?t.touches[0]:t,this.states.dirty=!0,this.states.dx+=t.pageX-this.states.x,this.states.dy+=t.pageY-this.states.y,this.states.x=t.pageX,this.states.y=t.pageY},r=function(){document.removeEventListener("mousemove",this.bindings.update),document.removeEventListener("touchmove",this.bindings.update),document.removeEventListener("mouseup",this.bindings.remove),document.removeEventListener("touchend",this.bindings.remove)};return e.prototype.setupMouseControls=function(){this.element.addEventListener("mousedown",this.bindings.attach,!1),this.element.addEventListener("touchstart",this.bindings.attach,!1)},e.prototype.run=function(e,i,o){if(o&&!this.element&&o.domElement&&(this.element=o.domElement,this.setupMouseControls()),this.states.dirty){var r=Math.PI*this.states.dy/this.element.clientHeight,n=Math.PI*this.states.dx/this.element.clientWidth,a=Math.cos(r),s=Math.sin(r),c=Math.cos(n),l=Math.sin(n),h=new t(c,s*l,0-a*l,0,a,s,l,0-s*c,a*c);t.combine(h,e.transformComponent.transform.rotation,e.transformComponent.transform.rotation),e.transformComponent.setUpdated(),this.states.dirty=!1,this.states.dx=0,this.states.dy=0}},e}),define("goo/scripts/SparseHeightMapBoundingScript",[],function(){"use strict";function t(t){this.elevationData=t}return t.prototype.getClosest=function(t,e){for(var i=Number.MAX_VALUE,o=-1,r=0;r<this.elevationData.length;r+=3){var n=Math.pow(this.elevationData[r+0]-t,2)+Math.pow(this.elevationData[r+2]-e,2);i>n&&(i=n,o=r)}return this.elevationData[o+1]},t.prototype.run=function(t){var e=t.transformComponent.transform.translation,i=this.getClosest(e.data[0],e.data[2]),o=e.data[1]-i;e.data[1]-=.1*o},t}),define("goo/scripts/SplineInterpolator",["goo/math/Matrix4x4","goo/math/Vector4"],function(t,e){"use strict";function i(t){t=t||{},this.controlPoint=0,this.controlPoints=t.controlPoints||[],this.elapsedTime=0,this.enabled=t.enabled||!0,this.firstIteration=!0,this.tolerance=t.tolerance||.01,this.beforeFunction=t.beforeFunction||function(t){return t.transformComponent.transform.translation.clone().data},this.updateFunction=t.updateFunction||function(t,e){t.transformComponent.transform.translation.set(e),t.transformComponent.setUpdated()},this.afterFunction=t.afterFunction||function(){}}var o=function(t,e,i){return Math.min(Math.max(t,e),i)};return i.CATMULL_ROM=new t(-.5,1,-.5,0,1.5,-2.5,0,1,-1.5,2,.5,0,.5,-.5,0,0),i.UNIFORM_CUBIC=new t(-.16667,.5,-.5,.16667,.5,-1,0,.66667,-.5,.5,.5,.16667,.16667,0,0,0),i.prototype.run=function(t,r){if(this.firstIteration){this.firstIteration=!1;try{this.controlPoints.unshift({time:0,value:this.beforeFunction(t)})}catch(n){return this.enabled=!1,void 0}}for(var a=o(this.controlPoint-1,0,this.controlPoints.length-1),s=o(this.controlPoint+0,0,this.controlPoints.length-1),c=o(this.controlPoint+1,0,this.controlPoints.length-1),l=o(this.controlPoint+2,0,this.controlPoints.length-1),h=this.controlPoints[c].time>this.controlPoints[s].time?(this.elapsedTime-this.controlPoints[s].time)/(this.controlPoints[c].time-this.controlPoints[s].time):0,u=i.CATMULL_ROM.applyPre(new e(h*h*h,h*h,h,1)),d=new Array(this.controlPoints[0].value.length),p=0,f=0;f<d.length;f++)d[f]=0,d[f]+=this.controlPoints[a].value[f]*u[0],d[f]+=this.controlPoints[s].value[f]*u[1],d[f]+=this.controlPoints[c].value[f]*u[2],d[f]+=this.controlPoints[l].value[f]*u[3],p+=Math.abs(this.controlPoints[this.controlPoints.length-1].value[f]-d[f]);try{this.updateFunction(t,d)}catch(n){return this.enabled=!1,void 0}if(this.elapsedTime+=r,this.elapsedTime>=this.controlPoints[c].time&&this.controlPoint++,this.controlPoint>=this.controlPoints.length||p<this.tolerance){try{this.afterFunction(t)}catch(n){}return this.enabled=!1,void 0}},i}),define("goo/scripts/WorldFittedTerrainScript",["goo/scripts/HeightMapBoundingScript","goo/math/Vector3"],function(t,e){"use strict";function i(t,e){if(t.minX>t.maxX)throw{name:"Terrain Exception",message:"minX is larger than maxX"};if(t.minY>t.maxY)throw{name:"Terrain Exception",message:"minY is larger than maxY"};if(t.minZ>t.maxZ)throw{name:"Terrain Exception",message:"minZ is larger than maxZ"};if(!e)throw{name:"Terrain Exception",message:"No heightmap data specified"};if(e.length!==e[0].length)throw{name:"Terrain Exception",message:"Heightmap data is not a square"};return!0}function o(e,o,r){o=o||s,i(o,e,r);var n={dimensions:o,sideQuadCount:e.length-1,script:new t(e)};return n}function r(){this.heightMapData=[],this.yMargin=1}var n=new e,a=new e,s={minX:0,maxX:100,minY:0,maxY:50,minZ:0,maxZ:100};return r.prototype.addHeightData=function(t,e){var i=o(t,e,this.heightMapData);return this.heightMapData.push(i),i},r.prototype.getHeightDataForPosition=function(t){for(var e=0;e<this.heightMapData.length;e++){var i=this.heightMapData[e].dimensions;if(t[0]<=i.maxX&&t[0]>=i.minX&&t[1]<i.maxY+this.yMargin&&t[1]>i.minY-this.yMargin&&t[2]<=i.maxZ&&t[2]>=i.minZ)return this.heightMapData[e]}return null},r.prototype.displaceAxisDimensions=function(t,e,i,o){var r=t-e;return o*r/(i-e)},r.prototype.returnToWorldDimensions=function(t,e,i,o){var r=(i-e)/o,n=t*r;return e+n},r.prototype.getTerrainHeightAt=function(t){var e=this.getHeightDataForPosition(t);if(null===e)return null;var i=e.dimensions,o=this.displaceAxisDimensions(t[0],i.minX,i.maxX,e.sideQuadCount),r=this.displaceAxisDimensions(t[2],i.minZ,i.maxZ,e.sideQuadCount),n=e.script.getPreciseHeight(o,r);return n*(i.maxY-i.minY)+i.minY},r.prototype.getTerrainNormalAt=function(t){var e=this.getHeightDataForPosition(t);if(!e)return null;for(var i=e.dimensions,o=this.displaceAxisDimensions(t[0],i.minX,i.maxX,e.sideQuadCount),r=this.displaceAxisDimensions(t[2],i.minZ,i.maxZ,e.sideQuadCount),s=e.script.getTriangleAt(o,r),c=0;c<s.length;c++)s[c].x=this.returnToWorldDimensions(s[c].x,i.minX,i.maxX,e.sideQuadCount),s[c].z=this.returnToWorldDimensions(s[c].z,i.minY,i.maxY,1),s[c].y=this.returnToWorldDimensions(s[c].y,i.minZ,i.maxZ,e.sideQuadCount);return n.set(s[1].x-s[0].x,s[1].z-s[0].z,s[1].y-s[0].y),a.set(s[2].x-s[0].x,s[2].z-s[0].z,s[2].y-s[0].y),n.cross(a),n.data[1]<0&&n.muld(-1,-1,-1),n.normalize(),n},r}),define("goo/shapes/FilledPolygon",["goo/renderer/MeshData","goo/math/MathUtils"],function(t,e){"use strict";function i(e,i){this.verts=e,this.indices=i?i:o(e);var r=t.defaultMap([t.POSITION,t.NORMAL,t.TEXCOORD0]);t.call(this,r,this.verts.length/3,this.indices.length),this.rebuild()}function o(t){var e=t.length/3;if(3>e)return[];for(var i=[],o=[],a=0;e>a;a++)o.push(a);for(var a=0,s=e;s>3;){var c=o[(a+0)%s],l=o[(a+1)%s],h=o[(a+2)%s],u=t[3*c],d=t[3*c+1],p=t[3*l],f=t[3*l+1],m=t[3*h],g=t[3*h+1],v=!1;if(n(u,d,p,f,m,g)){v=!0;for(var y=0;s>y;y++){var x=o[y];if(x!==c&&x!==l&&x!==h&&r(t[3*x],t[3*x+1],u,d,p,f,m,g)){v=!1;break}}}if(v)i.push(c,l,h),o.splice((a+1)%s,1),s--,a=0;else if(a++>3*s)break}return i.push(o[0],o[1],o[2]),i}function r(t,e,i,o,r,n,a,s){var c=a-i,l=s-o,h=r-i,u=n-o,d=t-i,p=e-o,f=c*c+l*l,m=c*h+l*u,g=c*d+l*p,v=h*h+u*u,y=h*d+u*p,x=1/(f*v-m*m),w=(v*g-m*y)*x,_=(f*y-m*g)*x;return w>=0&&_>=0&&1>w+_}function n(t,e,i,o,r,n){return(e-o)*(r-i)+(i-t)*(n-o)>=0}function a(t){for(var e=t[0],i=t[0],o=t[1],r=t[1],n=3;n<t.length;n+=3)e=e<t[n+0]?e:t[n+0],i=i>t[n+0]?i:t[n+0],o=o<t[n+1]?o:t[n+1],r=r>t[n+1]?r:t[n+1];return{minX:e,maxX:i,minY:o,maxY:r}}return i.prototype=Object.create(t.prototype),i.prototype.rebuild=function(){this.getAttributeBuffer(t.POSITION).set(this.verts);for(var i=[],o=0;o<this.indices.length;o+=3){var r=e.getTriangleNormal(this.verts[3*this.indices[o+0]+0],this.verts[3*this.indices[o+0]+1],this.verts[3*this.indices[o+0]+2],this.verts[3*this.indices[o+1]+0],this.verts[3*this.indices[o+1]+1],this.verts[3*this.indices[o+1]+2],this.verts[3*this.indices[o+2]+0],this.verts[3*this.indices[o+2]+1],this.verts[3*this.indices[o+2]+2]);i[3*this.indices[o+0]+0]=r[0],i[3*this.indices[o+0]+1]=r[1],i[3*this.indices[o+0]+2]=r[2],i[3*this.indices[o+1]+0]=r[0],i[3*this.indices[o+1]+1]=r[1],i[3*this.indices[o+1]+2]=r[2],i[3*this.indices[o+2]+0]=r[0],i[3*this.indices[o+2]+1]=r[1],i[3*this.indices[o+2]+2]=r[2]}this.getAttributeBuffer(t.NORMAL).set(i),this.getIndexBuffer().set(this.indices);for(var n=[],s=a(this.verts),c=s.maxX-s.minX,l=s.maxY-s.minY,o=0;o<this.verts.length;o+=3){var h=(this.verts[o+0]-s.minX)/c,u=(this.verts[o+1]-s.minY)/l;n.push(h,u)}return this.getAttributeBuffer(t.TEXCOORD0).set(n),this},i}),define("goo/shapes/Surface",["goo/renderer/MeshData","goo/math/MathUtils"],function(t,e){"use strict";function i(e,i,o){this.verts=e,this.vertsPerLine=i||2,this.verticallyClosed=!!o;var r=t.defaultMap([t.POSITION,t.NORMAL,t.TEXCOORD0]),n=this.verts.length/3,a=n/this.vertsPerLine;t.call(this,r,n,6*(a-1)*(this.vertsPerLine-1)),this.rebuild()}function o(t){for(var e=t[0],i=t[0],o=t[1],r=t[1],n=3;n<t.length;n+=3)e=e<t[n+0]?e:t[n+0],i=i>t[n+0]?i:t[n+0],o=o<t[n+2]?o:t[n+2],r=r>t[n+2]?r:t[n+2];return{minX:e,maxX:i,minY:o,maxY:r}}return i.prototype=Object.create(t.prototype),i.prototype.rebuild=function(){this.getAttributeBuffer(t.POSITION).set(this.verts);for(var i=[],r=[],n=[],a=this.verts.length/3,s=a/this.vertsPerLine,c=0;s-1>c;c++){for(var l=0;l<this.vertsPerLine-1;l++){var h=(c+0)*this.vertsPerLine+(l+0),u=(c+1)*this.vertsPerLine+(l+0),d=(c+1)*this.vertsPerLine+(l+1),p=(c+0)*this.vertsPerLine+(l+1);i.push(h,u,p,p,u,d),n=e.getTriangleNormal(this.verts[3*h+0],this.verts[3*h+1],this.verts[3*h+2],this.verts[3*u+0],this.verts[3*u+1],this.verts[3*u+2],this.verts[3*p+0],this.verts[3*p+1],this.verts[3*p+2]),r.push(n[0],n[1],n[2])}if(this.verticallyClosed){var h=(c+0)*this.vertsPerLine+0,u=(c+1)*this.vertsPerLine+0,p=(c+0)*this.vertsPerLine+1;n=e.getTriangleNormal(this.verts[3*h+0],this.verts[3*h+1],this.verts[3*h+2],this.verts[3*u+0],this.verts[3*u+1],this.verts[3*u+2],this.verts[3*p+0],this.verts[3*p+1],this.verts[3*p+2]),r.push(n[0],n[1],n[2])}else r.push(n[0],n[1],n[2])}c--;for(var l=0;l<this.vertsPerLine-1;l++){var h=(c+0)*this.vertsPerLine+(l+0),u=(c+1)*this.vertsPerLine+(l+0),p=(c+0)*this.vertsPerLine+(l+1);n=e.getTriangleNormal(this.verts[3*h+0],this.verts[3*h+1],this.verts[3*h+2],this.verts[3*u+0],this.verts[3*u+1],this.verts[3*u+2],this.verts[3*p+0],this.verts[3*p+1],this.verts[3*p+2]),r.push(n[0],n[1],n[2])}r.push(n[0],n[1],n[2]),this.getAttributeBuffer(t.NORMAL).set(r),this.getIndexBuffer().set(i);for(var f=[],m=o(this.verts),g=m.maxX-m.minX,v=m.maxY-m.minY,c=0;c<this.verts.length;c+=3){var y=(this.verts[c+0]-m.minX)/g,x=(this.verts[c+2]-m.minY)/v;f.push(y,x)}return this.getAttributeBuffer(t.TEXCOORD0).set(f),this},i.createFromHeightMap=function(t,e,o,r){e=e||1,o=o||1,r=r||1;for(var n=[],a=0;a<t.length;a++)for(var s=0;s<t[a].length;s++)n.push(a*e,t[a][s]*o,s*r);return n.reverse(),new i(n,t[0].length)},i.createTessellatedFlat=function(t,e,o,r){for(var n=[],a=0;o>a;a++)for(var s=0;r>s;s++)n.push(a*t/o-.5*t,s*e/r-.5*e,0);var c=new i(n,o);return c},i}),define("goo/shapes/PolyLine",["goo/renderer/MeshData","goo/shapes/Surface"],function(t,e){"use strict";function i(e,i){this.verts=e,this.closed=!!i;var o=t.defaultMap([t.POSITION]);t.call(this,o,this.verts.length/3,this.verts.length/3),this.indexModes=this.closed?["LineLoop"]:["LineStrip"],this.rebuild()}function o(t,e,i,o){var r=Math.sqrt(t*t+e*e),n=t/r,a=e/r,s=Math.sqrt(i*i+o*o),c=i/s,l=o/s;return Math.atan2(a+l,n+c)-Math.PI/2}function r(t,e){var i,r,n,a,s,c,l=t.length/3;return 0===e?(n=t[0],a=t[2],s=t[3],c=t[5],Math.atan2(c-a,s-n)-Math.PI/2):e===l-1?(i=t[3*(l-2)+0],r=t[3*(l-2)+2],n=t[3*(l-1)+0],a=t[3*(l-1)+2],Math.atan2(a-r,n-i)-Math.PI/2):(i=t[3*(e-1)+0],r=t[3*(e-1)+2],n=t[3*e+0],a=t[3*e+2],s=t[3*(e+1)+0],c=t[3*(e+1)+2],o(n-i,a-r,s-n,c-a))}return i.prototype=Object.create(t.prototype),i.prototype.rebuild=function(){this.getAttributeBuffer(t.POSITION).set(this.verts);for(var e=[],i=this.verts.length/3,o=0;i>o;o++)e.push(o);return this.getIndexBuffer().set(e),this},i.prototype.mul=function(t){if(t instanceof i){for(var o=t.verts.length/3,r=[],n=0;n<this.verts.length;n+=3)for(var a=0;a<t.verts.length;a+=3)r.push(this.verts[n+0]+t.verts[a+0],this.verts[n+1]+t.verts[a+1],this.verts[n+2]+t.verts[a+2]);return new e(r,o)}},i.prototype.pipe=function(t){if(!(t instanceof i))return console.error("pipe operation can only be applied to PolyLines"),void 0;for(var o=t.verts.length/3,n=[],a=0;a<this.verts.length;a+=3)for(var s=r(this.verts,a/3),c=0;c<t.verts.length;c+=3)n.push(this.verts[a+0]+t.verts[c+2]*Math.cos(s),this.verts[a+1]+t.verts[c+1],this.verts[a+2]+t.verts[c+2]*Math.sin(s));return new e(n,o)},i.prototype.lathe=function(t){t=t||8;for(var i=2*Math.PI/t,o=[],r=0;r<this.verts.length;r+=3)for(var n=0,a=0;t>=n;n++,a+=i)o.push(Math.cos(a)*this.verts[r+0],this.verts[r+1],Math.sin(a)*this.verts[r+0]);return new e(o,t+1,!0)},i.prototype.concat=function(t,e){return t instanceof i?new i(this.verts.concat(t.verts),e):(console.error("concat operation can only be applied to PolyLines"),void 0)},i.fromCubicBezier=function(t,e,o){if(12!==t.length)return console.error("PolyLine.fromCubicBezier takes an array of exactly 12 coordinates"),void 0;e=e||16,o=o||0;for(var r=[],n=[],a=[],s=[],c=[],l=[],h=[],u=o;e>=u;u++){var d=u/e;n[0]=t[0]+(t[3]-t[0])*d,n[1]=t[1]+(t[4]-t[1])*d,n[2]=t[2]+(t[5]-t[2])*d,a[0]=t[3]+(t[6]-t[3])*d,a[1]=t[4]+(t[7]-t[4])*d,a[2]=t[5]+(t[8]-t[5])*d,s[0]=t[6]+(t[9]-t[6])*d,s[1]=t[7]+(t[10]-t[7])*d,s[2]=t[8]+(t[11]-t[8])*d,c[0]=n[0]+(a[0]-n[0])*d,c[1]=n[1]+(a[1]-n[1])*d,c[2]=n[2]+(a[2]-n[2])*d,l[0]=a[0]+(s[0]-a[0])*d,l[1]=a[1]+(s[1]-a[1])*d,l[2]=a[2]+(s[2]-a[2])*d,h[0]=c[0]+(l[0]-c[0])*d,h[1]=c[1]+(l[1]-c[1])*d,h[2]=c[2]+(l[2]-c[2])*d,r.push(h[0],h[1],h[2])
}return new i(r)},i.fromCubicSpline=function(t,e,o){if(o){if(0!==t.length%3&&0!==t.length/3%3)return console.error("Wrong number of coordinates supplied in first argument to PolyLine.fromCubicSpline"),void 0;for(var r=t.length/3,n=r/3,a=i.fromCubicBezier(t.slice(0,12),e,1),s=1;n-1>s;s++){var c=i.fromCubicBezier(t.slice(9*s,9*s+12),e,1);a=a.concat(c)}var c=i.fromCubicBezier(t.slice(9*s,9*s+9).concat(t.slice(0,3)),e,1);return a=a.concat(c)}if(0!==t.length%3&&1!==t.length/3%3)return console.error("Wrong number of coordinates supplied in first argument to PolyLine.fromCubicSpline"),void 0;for(var r=t.length/3,n=(r-1)/3,a=i.fromCubicBezier(t.slice(0,12),e,1),s=1;n>s;s++){var c=i.fromCubicBezier(t.slice(9*s,9*s+12),e,1);a=a.concat(c)}return a},i}),define("goo/shapes/ProjectedGrid",["goo/renderer/MeshData","goo/math/Vector2","goo/math/Vector3","goo/math/Vector4","goo/math/Matrix4x4","goo/renderer/Camera","goo/math/MathUtils"],function(t,e,i,o,r,n,a){"use strict";function s(a,s){this.densityX=void 0!==a?a:20,this.densityY=void 0!==s?s:20,this.projectorCamera=new n(45,1,.1,2e3),this.mainCamera=new n(45,1,.1,2e3),this.freezeProjector=!1,this.upperBound=20,this.origin=new o,this.direction=new o,this.source=new e,this.rangeMatrix=new r,this.intersectBottomLeft=new o,this.intersectTopLeft=new o,this.intersectTopRight=new o,this.intersectBottomRight=new o,this.planeIntersection=new i,this.freezeProjector=!1,this.projectorMinHeight=50,this.intersections=[];for(var c=0;24>c;c++)this.intersections.push(new i);this.connections=[0,3,1,2,0,4,1,5,2,6,3,7,4,7,5,6];var l=this.densityX*this.densityY,h=6*(this.densityX-1)*(this.densityY-1),u=t.defaultMap([t.POSITION,t.TEXCOORD0]);t.call(this,u,l,h),this.rebuild()}return s.prototype=Object.create(t.prototype),s.prototype.update=function(t){var e=this.upperBound,n=this.mainCamera;if(n){this.freezeProjector||n.copy(t);var s=n.translation;s.y>0&&s.y<e+n.near?n.translation.setd(s.x,e+n.near,s.z):s.y<0&&s.y>-e-n.near&&n.translation.setd(s.x,-e-n.near,s.z);for(var c=n.calculateFrustumCorners(),l=0,h=new i,u=0;8>u;u++){var d=this.connections[2*u],p=this.connections[2*u+1];(c[d].y>e&&c[p].y<e||c[d].y<e&&c[p].y>e)&&this.getWorldIntersectionSimple(e,c[d],c[p],this.intersections[l++],h),(c[d].y>-e&&c[p].y<-e||c[d].y<-e&&c[p].y>-e)&&this.getWorldIntersectionSimple(-e,c[d],c[p],this.intersections[l++],h)}for(var u=0;8>u;u++)c[u].y<e&&c[u].y>-e&&this.intersections[l++].set(c[u]);if(0===l)return!1;var f=this.projectorCamera;if(f.copy(n),f.translation.y>0&&f._direction.y>0||f.translation.y<0&&f._direction.y<0){f._direction.y=-f._direction.y;var m=new i;m.setv(f._direction).cross(f._left).normalize(),f._up.setv(m)}var d=this.source,g=this.planeIntersection;d.set(.5,.5),this.getWorldIntersection(0,d,f.getViewProjectionInverseMatrix(),g);var v=f.translation;if(v.y>0&&v.y<2*this.projectorMinHeight){var y=(2*this.projectorMinHeight-v.y)/(2*this.projectorMinHeight);f.translation.setd(v.x,2*this.projectorMinHeight-this.projectorMinHeight*y,v.z)}else if(v.y<0&&v.y>2*-this.projectorMinHeight){var y=(2*-this.projectorMinHeight-v.y)/(2*-this.projectorMinHeight);f.translation.setd(v.x,2*-this.projectorMinHeight+this.projectorMinHeight*y,v.z)}g.subv(f.translation),g.y=0;var x=g.length();x>Math.abs(f.translation.y)?(g.normalize(),g.mul(Math.abs(f.translation.y))):x<a.EPSILON&&(g.addv(f._up),g.y=0,g.normalize(),g.mul(.1)),g.addv(f.translation),g.y=0,f.lookAt(g,i.UNIT_Y);for(var w=f.getViewProjectionMatrix(),_=new o,b=this.intersections,u=0;l>u;u++)_.set(b[u].x,0,this.intersections[u].z,1),w.applyPost(_),b[u].set(_.x,_.y,0),b[u].div(_.w);for(var S=Number.MAX_VALUE,M=-Number.MAX_VALUE,C=Number.MAX_VALUE,T=-Number.MAX_VALUE,u=0;l>u;u++)b[u].x<S&&(S=b[u].x),b[u].x>M&&(M=b[u].x),b[u].y<C&&(C=b[u].y),b[u].y>T&&(T=b[u].y);var E=this.rangeMatrix;E.setIdentity(),E.e00=M-S,E.e11=T-C,E.e03=S,E.e13=C;var P=f.getViewProjectionInverseMatrix();return r.combine(P,E,E),d.set(.5,.5),this.getWorldIntersectionHomogenous(0,d,E,this.intersectBottomLeft),d.set(.5,1),this.getWorldIntersectionHomogenous(0,d,E,this.intersectTopLeft),d.set(1,1),this.getWorldIntersectionHomogenous(0,d,E,this.intersectTopRight),d.set(1,.5),this.getWorldIntersectionHomogenous(0,d,E,this.intersectBottomRight),!0}},s.prototype.getWorldIntersectionHomogenous=function(t,e,i,o){this.calculateIntersection(t,e,i),o.setv(this.origin)},s.prototype.getWorldIntersection=function(t,e,i,o){this.calculateIntersection(t,e,i),o.setd(this.origin.x,this.origin.y,this.origin.z).div(this.origin.w)},s.prototype.getWorldIntersectionSimple=function(t,e,i,o,r){var n=o.setv(e),a=r.setv(i).sub(n),s=(t-n.y)/a.y;return a.mul(s),n.addv(a),s>=0&&1>=s},s.prototype.calculateIntersection=function(t,e,i){if(this.origin.setd(2*e.x-1,2*e.y-1,-1,1),this.direction.setd(2*e.x-1,2*e.y-1,1,1),i.applyPost(this.origin),i.applyPost(this.direction),this.direction.sub(this.origin),Math.abs(this.direction.y)>a.EPSILON){var o=(t-this.origin.y)/this.direction.y;this.direction.mul(o)}else this.direction.normalize(),this.direction.mul(this.mainCamera._frustumFar);this.origin.add(this.direction)},s.prototype.rebuild=function(){for(var e=this.getAttributeBuffer(t.POSITION),i=this.getAttributeBuffer(t.TEXCOORD0),o=this.getIndexBuffer(),r=this.densityX,n=this.densityY,a=0;r>a;a++)for(var s=0;n>s;s++)e[3*(a+s*r)+0]=a,e[3*(a+s*r)+1]=0,e[3*(a+s*r)+2]=s,i[2*(a+s*r)+0]=a/(r-1),i[2*(a+s*r)+1]=s/(n-1);for(var c=0,l=0;r*(n-1)>l;l++)(0!==l%(r*(Math.floor(l/r)+1)-1)||0===l)&&(o[c++]=l,o[c++]=1+r+l,o[c++]=1+l,o[c++]=l,o[c++]=r+l,o[c++]=1+r+l);return this},s}),define("goo/shapes/RegularPolygon",["goo/renderer/MeshData","goo/shapes/PolyLine"],function(t,e){"use strict";function i(t,i){this.nSegments=t||5,this.radius=i||1;for(var o=[],r=2*Math.PI/t,n=0,a=0;n<this.nSegments;n++,a+=r)o.push(Math.cos(a)*this.radius,Math.sin(a)*this.radius,0);e.call(this,o,!0),this.rebuild()}return i.prototype=Object.create(e.prototype),i}),define("goo/shapes/SimpleBox",["goo/renderer/MeshData"],function(t){"use strict";function e(e,i,o){this.xExtent=void 0!==e?.5*e:.5,this.yExtent=void 0!==i?.5*i:.5,this.zExtent=void 0!==o?.5*o:.5;var r=t.defaultMap([t.POSITION]);t.call(this,r,8,36),this.rebuild()}return e.prototype=Object.create(t.prototype),e.prototype.rebuild=function(){var e=this.xExtent,i=this.yExtent,o=this.zExtent;return this.getAttributeBuffer(t.POSITION).set([-e,-i,-o,e,-i,-o,e,i,-o,-e,i,-o,-e,-i,o,e,-i,o,e,i,o,-e,i,o]),this.getIndexBuffer().set([0,1,2,2,3,0,7,6,5,5,4,7,0,3,7,7,4,0,1,2,6,6,5,1,3,2,6,6,7,3,0,1,5,5,4,0]),this},e}),define("goo/shapes/TerrainSurface",["goo/renderer/MeshData","goo/math/MathUtils"],function(t,e){"use strict";function i(e,i,o,r){for(var n=[],a=0;a<e.length;a++)for(var s=0;s<e[a].length;s++)n.push(a*i/(e.length-1),e[a][s]*o,s*r/(e.length-1));this.verts=n,this.vertsPerLine=e[0].length;var c=t.defaultMap([t.POSITION,t.NORMAL,t.TEXCOORD0]),l=this.verts.length/3,h=l/this.vertsPerLine;t.call(this,c,l,6*(h-1)*(this.vertsPerLine-1)),this.rebuild()}return i.prototype=Object.create(t.prototype),i.prototype.rebuild=function(){this.getAttributeBuffer(t.POSITION).set(this.verts);for(var i=[],o=[],r=[],n=this.verts.length/3,a=n/this.vertsPerLine,s=0;a-1>s;s++){for(var c=0;c<this.vertsPerLine-1;c++){var l=(s+0)*this.vertsPerLine+(c+0),h=(s+1)*this.vertsPerLine+(c+0),u=(s+1)*this.vertsPerLine+(c+1),d=(s+0)*this.vertsPerLine+(c+1);i.push(h,l,d,h,d,u),r=e.getTriangleNormal(this.verts[3*l+0],this.verts[3*l+1],this.verts[3*l+2],this.verts[3*d+0],this.verts[3*d+1],this.verts[3*d+2],this.verts[3*h+0],this.verts[3*h+1],this.verts[3*h+2]),o.push(r[0],r[1],r[2])}o.push(r[0],r[1],r[2])}s--;for(var c=0;c<this.vertsPerLine-1;c++){var l=(s+0)*this.vertsPerLine+(c+0),h=(s+1)*this.vertsPerLine+(c+0),d=(s+0)*this.vertsPerLine+(c+1);r=e.getTriangleNormal(this.verts[3*l+0],this.verts[3*l+1],this.verts[3*l+2],this.verts[3*d+0],this.verts[3*d+1],this.verts[3*d+2],this.verts[3*h+0],this.verts[3*h+1],this.verts[3*h+2]),o.push(r[0],r[1],r[2])}o.push(r[0],r[1],r[2]),this.getAttributeBuffer(t.NORMAL).set(o),this.getIndexBuffer().set(i);for(var p=[],f=this.verts[this.verts.length-3],m=this.verts[this.verts.length-1],s=0;s<this.verts.length;s+=3){var g=this.verts[s+0]/f,v=this.verts[s+2]/m;p.push(g,v)}return this.getAttributeBuffer(t.TEXCOORD0).set(p),this},i}),define("goo/shapes/Triangle",["goo/renderer/MeshData","goo/math/MathUtils"],function(t,e){"use strict";function i(e){this.verts=e;var i=t.defaultMap([t.POSITION,t.NORMAL]);t.call(this,i,3,3),this.rebuild()}return i.prototype=Object.create(t.prototype),i.prototype.rebuild=function(){this.getAttributeBuffer(t.POSITION).set(this.verts);var i=e.getTriangleNormal(this.verts[0],this.verts[1],this.verts[2],this.verts[3],this.verts[4],this.verts[5],this.verts[6],this.verts[7],this.verts[8]);return this.getAttributeBuffer(t.NORMAL).set([i[0],i[1],i[2],i[0],i[1],i[2],i[0],i[1],i[2]]),this.getIndexBuffer().set([0,1,2]),this},i}),define("goo/statemachine/FSMSystem",["goo/entities/systems/System","goo/statemachine/actions/Actions"],function(t){"use strict";function e(e){t.call(this,"FSMSystem",["FSMComponent"]),this.engine=e,this.resetRequest=!1,this.passive=!1,this.entered=!0,this.paused=!1,this.time=0,this.evalProxy={test:function(){console.log("test")}},this.priority=1e3}return e.prototype=Object.create(t.prototype),e.prototype.process=function(t,e){var i;if(this.resetRequest){this.resetRequest=!1;for(var o=0;o<t.length;o++)i=t[o].fSMComponent,i.kill(),i.cleanup();this.time=0,window.TWEEN&&window.TWEEN.removeAll(),this.passive=!0}else{if(this.time+=e,this.entered){this.entered=!1;for(var o=0;o<t.length;o++)i=t[o].fSMComponent,i.init(),i.doEnter()}window.TWEEN&&window.TWEEN.update(1e3*this.time);for(var o=0;o<t.length;o++)i=t[o].fSMComponent,i.update(e)}},e.prototype.inserted=function(t){var e=t.fSMComponent;e.entity=t,e.system=this,e.init()},e.prototype.pause=function(){this.passive=!0,this.paused=!0},e.prototype.play=function(){this.passive=!1,this.paused||(this.entered=!0),this.paused=!1},e.prototype.reset=function(){this.passive=!1,this.resetRequest=!0,this.paused=!1},e}),define("goo/statemachine/actions/AddPositionAction",["goo/statemachine/actions/Action","goo/statemachine/FSMUtil"],function(t,e){"use strict";function i(){t.apply(this,arguments)}return i.prototype=Object.create(t.prototype),i.prototype.configure=function(t){this.everyFrame=t.everyFrame!==!1,this.entity=t.entity||null,this.amountX=t.amountX||0,this.amountY=t.amountY||0,this.amountZ=t.amountZ||0,this.speed=t.speed||1},i.external={parameters:[{name:"Entity",key:"entity",type:"entity",description:"Entity to move"},{name:"Amount X",key:"amountX",type:"float",description:"Amount to move on the X axis","default":0},{name:"Amount Y",key:"amountY",type:"float",description:"Amount to move on the Y axis","default":0},{name:"Amount Z",key:"amountZ",type:"float",description:"Amount to move on the Z axis","default":0},{name:"Speed",key:"speed",type:"float",description:"Speed to multiply","default":1},{name:"On every frame",key:"everyFrame",type:"boolean",description:"Repeat this action every frame","default":!0}],transitions:[]},i.prototype._run=function(t){if(null!==this.entity){var i=t.getTpf(),o=e.getValue(this.amountX,t),r=e.getValue(this.amountY,t),n=e.getValue(this.amountZ,t);this.entity.transformComponent.transform.translation.add_d(o*this.speed*i,r*this.speed*i,n*this.speed*i),this.entity.transformComponent.setUpdated()}},i}),define("goo/statemachine/actions/AddVariableAction",["goo/statemachine/actions/Action","goo/statemachine/FSMUtil"],function(t,e){"use strict";function i(){t.apply(this,arguments)}return i.prototype=Object.create(t.prototype),i.prototype.configure=function(t){this.everyFrame=!!t.everyFrame,this.variable=t.variable||null,this.amount=t.amount||1},i.external={parameters:[{name:"Variable",key:"variable",type:"identifier"},{name:"Amount",key:"amount",type:"float"},{name:"On every frame",key:"everyFrame",type:"boolean",description:"Repeat this action every frame","default":!1}],transitions:[]},i.prototype._run=function(t){t.applyOnVariable(this.variable,function(i){return i+e.getValue(this.amount,t)}.bind(this))},i}),define("goo/statemachine/actions/GetPositionAction",["goo/statemachine/actions/Action"],function(t){"use strict";function e(){t.apply(this,arguments)}return e.prototype=Object.create(t.prototype),e.prototype.configure=function(t){this.everyFrame=t.everyFrame!==!1,this.entity=t.entity||null,this.variableX=t.variableX||null,this.variableY=t.variableY||null,this.variableZ=t.variableZ||null},e.external={parameters:[{name:"VariableX",key:"variableX",type:"identifier"},{name:"VariableY",key:"variableY",type:"identifier"},{name:"VariableZ",key:"variableZ",type:"identifier"},{name:"On every frame",key:"everyFrame",type:"boolean",description:"Repeat this action every frame","default":!0}],transitions:[]},e.prototype._run=function(t){var e=this.entity.transformComponent.transform.translation;null!==this.entity&&(this.variableX&&t.applyOnVariable(this.variableX,function(){return e.data[0]}),this.variableY&&t.applyOnVariable(this.variableY,function(){return e.data[1]}),this.variableZ&&t.applyOnVariable(this.variableZ,function(){return e.data[2]}))},e}),define("goo/statemachine/actions/GuiButtonAction",["goo/statemachine/actions/Action"],function(t){"use strict";function e(t){t=t||{},this.everyFrame=t.everyFrame||!0,this.name=t.name||"Button",this.event=t.event||"dummy"}return e.prototype=Object.create(t.prototype),e.external=[{name:"Name",key:"name",type:"string"},{name:"Send Event",key:"event",type:"event"}],e.prototype._setup=function(t){this.button=$("<button/>",{text:this.name,css:{position:"relative","z-index":1e4},click:function(){t.send(this.event)}.bind(this)}).appendTo($("body"))},e.prototype.exit=function(){this.button&&this.button.remove()},e}),define("goo/statemachine/actions/MultiplyVariableAction",["goo/statemachine/actions/Action","goo/statemachine/FSMUtil"],function(t,e){"use strict";function i(){t.apply(this,arguments)}return i.prototype=Object.create(t.prototype),i.prototype.configure=function(t){this.everyFrame=!!t.everyFrame,this.variable=t.variable||null,this.amount=t.amount||1},i.external={parameters:[{name:"Variable",key:"variable",type:"identifier"},{name:"Amount",key:"amount",type:"float"},{name:"On every frame",key:"everyFrame",type:"boolean",description:"Repeat this action every frame","default":!1}],transitions:[]},i.prototype._run=function(t){t.applyOnVariable(this.variable,function(i){return i*e.getValue(this.amount,t)}.bind(this))},i}),define("goo/statemachine/actions/NumberCompareAction",["goo/statemachine/actions/Action","goo/statemachine/FSMUtil"],function(t,e){"use strict";function i(){t.apply(this,arguments)}return i.prototype=Object.create(t.prototype),i.prototype.configure=function(t){this.everyFrame=t.everyFrame!==!1,this.leftHand=t.leftHand||0,this.rightHand=t.rightHand||0,this.tolerance=t.tolerance||1e-4,this.lessThanEvent={channel:t.transitions.less},this.equalEvent={channel:t.transitions.equal},this.greaterThanEvent={channel:t.transitions.greater}},i.external={parameters:[{name:"Left hand value",key:"leftHand",type:"float"},{name:"Right hand value",key:"rightHand",type:"float"},{name:"Tolerance",key:"tolerance",type:"float","default":.001},{name:"On every frame",key:"everyFrame",type:"boolean",description:"Repeat this action every frame","default":!0}],transitions:[{name:"less",description:"Event fired if left hand argument is smaller than right hand argument"},{name:"equal",description:"Event fired if both sides are approximately equal"},{name:"greater",description:"Event fired if left hand argument is greater than right hand argument"}]},i.prototype._run=function(t){var i=e.getValue(this.leftHand,t),o=e.getValue(this.rightHand,t),r=o-i;Math.abs(r)<=this.tolerance?this.equalEvent.channel&&t.send(this.equalEvent.channel):r>0?this.lessThanEvent.channel&&t.send(this.lessThanEvent.channel):this.greaterThanEvent.channel&&t.send(this.greaterThanEvent.channel)},i}),define("goo/statemachine/actions/ResumeFSMAction",["goo/statemachine/actions/Action"],function(t){"use strict";function e(){t.apply(this,arguments)}return e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.external={name:"Resume FSM",description:"Continue running a suspended state machine",parameters:[{name:"Entity",key:"entity",type:"entity",description:"Entity to resume its FSM","default":null}],transitions:[]},e.prototype._run=function(){this.entity&&this.entity.fSMComponent&&this.entity.fSMComponent.resume()},e}),define("goo/statemachine/actions/SetCssPropertyAction",["goo/statemachine/actions/Action"],function(t){"use strict";function e(t){t=t||{},this.everyFrame=t.everyFrame||!1,this.selector=t.selector||"body",this.property=t.property||"background-color",this.value=t.value||"black"}return e.prototype=Object.create(t.prototype),e.external=[{selector:["string","Selector"],property:["string","Property"],value:["string","Value"]}],e.prototype.onCreate=function(){$(this.selector).css(this.property,this.value)},e}),define("goo/statemachine/actions/SetLightRangeAction",["goo/statemachine/actions/Action"],function(t){"use strict";function e(){t.apply(this,arguments)}return e.prototype=Object.create(t.prototype),e.prototype.configure=function(t){this.everyFrame=!!t.everyFrame,this.entity=t.entity||null,this.range=t.range||100},e.external={name:"Set Light Range",description:"Sets the range of a light",parameters:[{name:"Entity",key:"entity",type:"entity",description:"Light entity"},{name:"Range",key:"range",type:"real",description:"Light range","default":100,min:0},{name:"On every frame",key:"everyFrame",type:"boolean",description:"Repeat this action every frame","default":!0}],transitions:[]},e.prototype._run=function(){this.entity&&this.entity.lightComponent&&this.entity.lightComponent.light&&(this.entity.lightComponent.light.range=this.range)},e}),define("goo/statemachine/actions/SetPositionAction",["goo/statemachine/actions/Action","goo/statemachine/FSMUtil"],function(t,e){"use strict";function i(){t.apply(this,arguments)}return i.prototype=Object.create(t.prototype),i.prototype.configure=function(t){this.everyFrame=!!t.everyFrame,this.entity=t.entity||null,this.amountX=t.amountX||0,this.amountY=t.amountY||0,this.amountZ=t.amountZ||0},i.external={parameters:[{name:"Entity",key:"entity",type:"entity",description:"Entity to move"},{name:"Amount X",key:"amountX",type:"float",description:"Position on the X axis","default":0},{name:"Amount Y",key:"amountY",type:"float",description:"Position on the Y axis","default":0},{name:"Amount Z",key:"amountZ",type:"float",description:"Position on the Z axis","default":0},{name:"On every frame",key:"everyFrame",type:"boolean",description:"Repeat this action every frame","default":!0}],transitions:[]},i.prototype._run=function(t){null!==this.entity&&(this.entity.transformComponent.transform.translation.setd(e.getValue(this.amountX,t),e.getValue(this.amountY,t),e.getValue(this.amountZ,t)),this.entity.transformComponent.setUpdated())},i}),define("goo/statemachine/actions/SetRotationAction",["goo/statemachine/actions/Action","goo/statemachine/FSMUtil"],function(t,e){"use strict";function i(){t.apply(this,arguments)}return i.prototype=Object.create(t.prototype),i.prototype.configure=function(t){this.everyFrame=!!t.everyFrame,this.entity=t.entity||null,this.amountX=t.amountX||0,this.amountY=t.amountY||0,this.amountZ=t.amountZ||0},i.external={parameters:[{name:"Entity",key:"entity",type:"entity",description:"Entity to move"},{name:"Amount X",key:"amountX",type:"float",description:"Amount to rotate on the X axis","default":0},{name:"Amount Y",key:"amountY",type:"float",description:"Amount to rotate on the Y axis","default":0},{name:"Amount Z",key:"amountZ",type:"float",description:"Amount to rotate on the Z axis","default":0},{name:"On every frame",key:"everyFrame",type:"boolean",description:"Repeat this action every frame","default":!0}],transitions:[]},i.prototype._run=function(t){null!==this.entity&&(this.entity.transformComponent.transform.setRotationXYZ(e.getValue(this.amountX,t),e.getValue(this.amountY,t),e.getValue(this.amountZ,t)),this.entity.transformComponent.setUpdated())},i}),define("goo/statemachine/actions/SetVariableAction",["goo/statemachine/actions/Action","goo/statemachine/FSMUtil"],function(t,e){"use strict";function i(){t.apply(this,arguments)}return i.prototype=Object.create(t.prototype),i.prototype.configure=function(t){this.everyFrame=t.everyFrame!==!1,this.variable=t.variable||null,this.amount=t.amount||0},i.external={parameters:[{name:"Variable",key:"variable",type:"identifier"},{name:"Amount",key:"amount",type:"float"},{name:"On every frame",key:"everyFrame",type:"boolean",description:"Repeat this action every frame","default":!1}],transitions:[]},i.prototype._run=function(t){this.variable&&t.applyOnVariable(this.variable,function(){return e.getValue(this.amount,t)}.bind(this))},i}),define("goo/statemachine/actions/SnowAction",["goo/statemachine/actions/Action","goo/renderer/Material","goo/renderer/shaders/ShaderLib","goo/renderer/TextureCreator","goo/particles/ParticleLib","goo/util/ParticleSystemUtils"],function(t,e,i,o,r,n){"use strict";function a(){t.apply(this,arguments)}return a.material=null,a.prototype=Object.create(t.prototype),a.prototype.constructor=a,a.external={name:"Snow",description:"Makes the entity emit snow",parameters:[],transitions:[]},a.prototype._run=function(t){var o=t.getOwnerEntity(),s=o._world.gooRunner;if(!a.material){a.material=e.createMaterial(i.particles);var c=n.createFlareTexture();c.generateMipmaps=!0,a.material.setTexture("DIFFUSE_MAP",c),a.material.blendState.blending="AlphaBlending",a.material.cullState.enabled=!1,a.material.depthState.write=!1,a.material.renderQueue=2001}var l=n.createParticleSystemEntity(s,r.getSmoke(),a.material);l.name="_ParticleSystemSnow",o.transformComponent.attachChild(l.transformComponent),l.addToWorld()},a}),define("goo/statemachine/actions/SuspendFSMAction",["goo/statemachine/actions/Action"],function(t){"use strict";function e(){t.apply(this,arguments)}return e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.external={name:"Suspend FSM",description:"Suspends the state machine of another entity",parameters:[{name:"Entity",key:"entity",type:"entity",description:"Entity to suspend its FSM","default":null}],transitions:[]},e.prototype._run=function(){this.entity&&this.entity.fSMComponent&&this.entity.fSMComponent.pause()},e}),define("goo/statemachine/actions/TestAngleAction",["goo/statemachine/actions/Action"],function(t){"use strict";function e(t){t=t||{},this.everyFrame=t.everyFrame||!0,this.entity=t.entity||null,this.rangeMin=t.rangeMin||0,this.rangeMax=t.rangeMax||Math.PI,this.eventInRange=t.eventInRange||"inRange",this.eventOutRange=t.eventOutRange||"outRange"}return e.prototype=Object.create(t.prototype),e.external=[{name:"Entity",key:"entity",type:"entity"},{name:"RangeMin",key:"rangeMin",type:"spinner"},{name:"RangeMax",key:"rangeMax",type:"spinner"},{name:"Event In Range",key:"eventInRange",type:"event"},{name:"Event Out Of Range",key:"eventOutRange",type:"event"}],e.prototype.onUpdate=function(t){if(null!==this.entity&&this.entity.body){var e=this.entity.body.GetAngle()%(2*Math.PI);0>e&&(e=2*Math.PI+e),e>=this.rangeMin&&e<=this.rangeMax?t.handle(this.eventInRange):t.handle(this.eventOutRange)}},e}),define("goo/statemachine/actions/TestSpeedAction",["goo/statemachine/actions/Action"],function(t){"use strict";function e(t){this.type="TestSpeedAction",this.everyFrame=t.everyFrame||!0,t=t||{},this.entity=t.entity||null,this.rangeMin=t.rangeMin||0,this.rangeMax=t.rangeMax||Math.PI,this.eventInRange=t.eventInRange||"inRange",this.eventOutRange=t.eventOutRange||"outRange"}return e.prototype=Object.create(t.prototype),e.external=[{name:"Entity",key:"entity",type:"entity"},{name:"RangeMin",key:"rangeMin",type:"spinner"},{name:"RangeMax",key:"rangeMax",type:"spinner"},{name:"Event In Range",key:"eventInRange",type:"event"},{name:"Event Out Of Range",key:"eventOutRange",type:"event"}],e.prototype.onUpdate=function(t){if(null!==this.entity&&this.entity.body){var e=this.entity.body.GetLinearVelocity().Length();e>=this.rangeMin&&e<=this.rangeMax?t.handle(this.eventInRange):t.handle(this.eventOutRange)}},e}),define("goo/statemachine/actions/TweenAction",["goo/statemachine/actions/Action","goo/statemachine/FSMUtil"],function(Action,FSMUtil){"use strict";function TweenAction(){Action.apply(this,arguments)}return TweenAction.prototype=Object.create(Action.prototype),TweenAction.prototype.constructor=TweenAction,TweenAction.external={name:"Tween",description:"Tween anything",canTransition:!0,parameters:[{name:"To",key:"to",type:"number",description:"Value to tween to","default":0},{name:"Object",key:"objectName",type:"string",description:"Object","default":""},{name:"Property",key:"propertyName",type:"string",description:"Property","default":""},{name:"Time",key:"time",type:"number",description:"Time it takes for this tween to complete","default":1e3},{name:"Easing type",key:"easing1",type:"dropdown",description:"Easing type","default":"Linear",options:["Linear","Quadratic","Exponential","Circular","Elastic","Back","Bounce"]},{name:"Direction",key:"easing2",type:"dropdown",description:"Easing direction","default":"In",options:["In","Out","InOut"]}],transitions:[{key:"complete",name:"On Completion",description:"State to transition to when the tween completes"}]},TweenAction.prototype.configure=function(t){this.to=t.to,this.objectName=t.objectName,this.propertyName=t.propertyName,this.time=t.time,this.easing="Linear"===t.easing1?window.TWEEN.Easing.Linear.None:window.TWEEN.Easing[t.easing1][t.easing2],this.eventToEmit={channel:t.transitions.complete}},TweenAction.prototype._run=function(fsm){var entity=fsm.getOwnerEntity(),object=eval("entity."+this.objectName),from=object[this.propertyName];FSMUtil.createComposableTween(entity,this.propertyName,from,this.to,this.time)},TweenAction}),define("goo/util/CanvasUtils",[],function(){"use strict";function t(){}return t.prototype.loadCanvasFromPath=function(t,e){var i=new Image;i.src=t;var o=document.createElement("canvas"),r=o.getContext("2d");i.onload=function(){o.width=i.width,o.height=i.height,r.drawImage(i,0,0),e(o)}},t.prototype.getMatrixFromCanvas=function(t){for(var e=t.getContext("2d"),i=function(i,o){return 0>i||i>t.width||0>o||o>t.height?0:e.getImageData(i,o,1,1).data[0]/255},o=[],r=0;r<t.width;r++){o.push([]);for(var n=0;n<t.height;n++)o[r].push(i(r,t.height-(n+1)))}return o},t}),define("goo/util/ColorUtil",["goo/math/Vector4"],function(t){"use strict";function e(){}e.arrayToVector4=function(e,i){return i=i||new t,i.seta(e),i},e.hexToArray=function(t,e){return e=e||[],t=Math.floor(t),e[0]=(255&t>>16)/255,e[1]=(255&t>>8)/255,e[2]=(255&t)/255,e},e.arrayToHex=function(t){return 255*t[0]<<16^255*t[1]<<8^255*t[2]<<0},e.arrayToHexString=function(t){return("000000"+e.arrayToHex(t).toString(16)).slice(-6)};var i=/^rgb\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)$/i,o=/^rgb\(\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*\)$/i,r=/^\#([0-9a-f])([0-9a-f])([0-9a-f])$/i,n=/^\#([0-9a-f]{6})$/i,a=/^(\w+)$/i;return e.cssToArray=function(t,s){if(s=s||[],i.test(t)){var c=i.exec(t);return s[0]=Math.min(255,parseInt(c[1],10))/255,s[1]=Math.min(255,parseInt(c[2],10))/255,s[2]=Math.min(255,parseInt(c[3],10))/255,s}if(o.test(t)){var c=o.exec(t);return s[0]=Math.min(100,parseInt(c[1],10))/100,s[1]=Math.min(100,parseInt(c[2],10))/100,s[2]=Math.min(100,parseInt(c[3],10))/100,s}if(n.test(t)){var c=n.exec(t);return this.hexToArray(parseInt(c[1],16),s)}if(r.test(t)){var c=r.exec(t);return this.hexToArray(parseInt(c[1]+c[1]+c[2]+c[2]+c[3]+c[3],16),s)}return a.test(t)?this.hexToArray(e.color[t],s):(console.warn("No matching style found"),s[0]=s[1]=s[2]=0,s)},e.HSLToArray=function(t,e,i,o){if(o=o||[],0===e)o[0]=o[1]=o[2]=i;else{var r=function(t,e,i){return 0>i&&(i+=1),i>1&&(i-=1),1/6>i?t+6*(e-t)*i:.5>i?e:2/3>i?t+6*(e-t)*(2/3-i):t},n=.5>=i?i*(1+e):i+e-i*e,a=2*i-n;o[0]=r(a,n,t+1/3),o[1]=r(a,n,t),o[2]=r(a,n,t-1/3)}return o},e.arrayToHSL=function(t,e){e=e||[];var i,o,r=t[0],n=t[1],a=t[2],s=Math.max(r,n,a),c=Math.min(r,n,a),l=(c+s)/2;if(c===s)i=0,o=0;else{var h=s-c;switch(o=.5>=l?h/(s+c):h/(2-s-c),s){case r:i=(n-a)/h+(a>n?6:0);break;case n:i=(a-r)/h+2;break;case a:i=(r-n)/h+4}i/=6}return e[0]=i,e[1]=o,e[2]=l,e},e.HSBToArray=function(t,e,i,o){o=o||[];var r=0,n=0,a=0;if(0===e)r=n=a=i;else{var s=6*(t-Math.floor(t)),c=s-Math.floor(s),l=i*(1-e),h=i*(1-e*c),u=i*(1-e*(1-c));switch(s){case 0:r=i,n=u,a=l;break;case 1:r=h,n=i,a=l;break;case 2:r=l,n=i,a=u;break;case 3:r=l,n=h,a=i;break;case 4:r=u,n=l,a=i;break;case 5:r=i,n=l,a=h}}return o[0]=r,o[1]=n,o[2]=a,o},e.arrayToHSB=function(t,e){e=e||[];var i,o,r,n=t[0],a=t[1],s=t[2],c=n>a?n:a;s>c&&(c=s);var l=a>n?n:a;if(l>s&&(l=s),r=c/255,o=0!==c?(c-l)/c:0,0===o)i=0;else{var h=(c-n)/(c-l),u=(c-a)/(c-l),d=(c-s)/(c-l);i=n===c?d-u:a===c?2+h-d:4+u-h,i/=6,0>i&&(i+=1)}return e[0]=i,e[1]=o,e[2]=r,e},e.arrayToCSS=function(t){return"rgb("+(0|255*t[0])+","+(0|255*t[1])+","+(0|255*t[2])+")"},e.color={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},e}),define("goo/util/Grid",["goo/entities/EntityUtils","goo/entities/components/MeshDataComponent","goo/entities/components/MeshRendererComponent","goo/renderer/MeshData","goo/renderer/Material","goo/renderer/Shader","goo/shapes/ShapeCreator","goo/renderer/shaders/ShaderLib","goo/renderer/Util"],function(t,e,i,o,r,n,a,s,c){"use strict";
function l(o,n){if(n=n||{},this.topEntity=o.createEntity(this.name),n.floor&&this.topEntity.transformComponent.transform.rotation.rotateX(-Math.PI/2),n.surface){var l=a.createQuad(n.width,n.height),u=t.createTypicalEntity(o,l),d=r.createMaterial(s.simpleLit);d.uniforms.materialDiffuse=n.surfaceColor||[1,1,1,1],d.depthState={writable:!1,enabled:!1},d.renderQueue=9,u.meshRendererComponent.materials.push(d),this.topEntity.transformComponent.attachChild(u.transformComponent)}this.gridShader=this._buildGridShader(n),n.grids||(n.grids=[]),0===n.grids.length&&n.grids.push(c.clone(h)),this.grids=n.grids;for(var p,f,m,g=0;g<n.grids.length;g++)f=n.grids[g],this._fillDefaults(f,h),f._width=n.width||1,f._height=n.height||1,p=o.createEntity("grid_"+g),p.setComponent(new e(this._buildGrid(f))),m=new i,m.materials.push(this._buildGridMaterial(f,g)),p.setComponent(m),this.topEntity.transformComponent.attachChild(p.transformComponent)}var h={stepX:1,stepY:1,color:[0,0,0,1],width:1};return l.prototype.addToWorld=function(){t.traverse(this.topEntity,function(t){t.addToWorld()})},l.prototype._collides=function(t,e,i){for(var o="step"+i,r=0;r<this.grids.length;r++){if(t===this.grids[r])return!1;if(0===e%this.grids[r][o])return!0}return!1},l.prototype._buildGrid=function(t){var e=Math.ceil(t._width/t.stepX),i=Math.ceil(t._height/t.stepY),r=t._width/2,n=t._height/2,a=[],s=[];t===this.grids[0]&&(a.push(-r,-n,0,-r,n,0,r,n,0,r,-n,0),s.push(0,1,1,2,2,3,3,0));for(var c,l=1;e>l;l++)c=t.stepX*l,this._collides(t,c,"X")||(c-=r,a.push(c,-n,0,c,n,0));for(var h,l=1;i>l;l++)h=t.stepY*l,this._collides(t,h,"Y")||(h-=n,a.push(-r,h,0,r,h,0));for(var l=s.length/2;l<a.length/3;l+=2)s.push(l,l+1);var u=new o(o.defaultMap([o.POSITION]),a.length,s.length);return u.getAttributeBuffer(o.POSITION).set(a),u.getIndexBuffer().set(s),u.indexModes[0]="Lines",u},l.prototype._buildGridMaterial=function(t,e){var i=new r("GridMaterial_"+e);return this.gridShader&&(i.shader=this.gridShader),i.uniforms.color=t.color,i.lineWidth=t.width,i.depthState={enabled:!1,write:!1},i.renderQueue=10+e,i},l.prototype._fillDefaults=function(t,e){for(var i in e)void 0===t[i]&&(t[i]="array"==typeof e[i]||e[i]instanceof Object?c.clone(e[i]):e[i])},l.prototype._buildGridShader=function(t){var e={attributes:{vertexPosition:o.POSITION},uniforms:{viewMatrix:n.VIEW_MATRIX,projectionMatrix:n.PROJECTION_MATRIX,worldMatrix:n.WORLD_MATRIX,color:[0,0,0,1],fogOn:t.fogOn||!1,fogColor:t.fogColor||[0,0,0,1],fogNear:n.MAIN_NEAR_PLANE,fogFar:t.fogFar||n.MAIN_FAR_PLANE},vshader:["attribute vec3 vertexPosition;","uniform mat4 worldMatrix;","uniform mat4 viewMatrix;","uniform mat4 projectionMatrix;","varying float depth;","void main(void)","{","vec4 viewPosition = viewMatrix * worldMatrix * vec4(vertexPosition, 1.0);","depth = viewPosition.z;","gl_Position = projectionMatrix * viewPosition;","}"].join("\n"),fshader:["precision mediump float;","uniform vec4 fogColor;","uniform vec4 color;","uniform float fogNear;","uniform float fogFar;","uniform bool fogOn;","varying float depth;","void main(void)","{","if (fogOn) {","float lerpVal = clamp(depth / (-fogFar - fogNear), 0.0, 1.0);","lerpVal = pow(lerpVal, 0.4);","gl_FragColor = mix(color, fogColor, lerpVal);","} else {","gl_FragColor = color;","}","}"].join("\n")};return r.createShader(e,"Grid Shader")},l}),define("goo/util/NoWebGL",["goo/util/Logo"],function(t){"use strict";function e(t){this.template=e.templates[t]?e.templates[t]:e.templates.standard}return e.prototype.upgradeLocation="http://goodemos.com/recommended.html",e.prototype.gooLocation="http://gooengine.com",e.templates={},e.templates.standard={},e.templates.standard.css="#unsupportedBrowser {z-index: 10000;position: absolute;top: 0;left: 0;width: 100%;background: #1c1c1c;border-top: 1px solid #2a3276;font-family: Helvetica Neue, Helvetica, sans-serif;font-size: 90%;line-height: 145%;}#unsupportedBrowser a.button {-webkit-border-radius: 18px;-moz-border-radius: 18px;-o-border-radius: 18px;border-radius: 18px;margin: 5px 20px 0 0;text-align: left;padding: 10px 25px;color: #1d1d1d;font-weight: 600;font-style: italic;display: inline-block;text-shadow: 0px 1px 1px #8372da;filter: dropshadow(color=#02c2df, offx=0, offy=1);-moz-box-shadow: inset 1px 1px 2px 0 #a9b1fd;-o-box-shadow: inset 1px 1px 2px 0 #a9b1fd;-webkit-box-shadow: inset 1px 1px 2px 0 #a9b1fd;box-shadow: inset 1px 1px 2px 0 #a9b1fd;background: #2a3276;background-image: -ms-linear-gradient(top, #2a3276 0%, #6b7aff 100%);background-image: -moz-linear-gradient(top, #2a3276 0%, #6b7aff 100%);background-image: -o-linear-gradient(top, #2a3276 0%, #6b7aff 100%);background-image: -webkit-gradient(linear, left top, left bottom, color-stop(0, #2a3276), color-stop(1, #6b7aff));background-image: -webkit-linear-gradient(top, #2a3276 0%, #6b7aff 100%);background-image: linear-gradient(top, #2a3276 0%, #6b7aff 100%);filter: progid:DXImageTransform.Microsoft.gradient(startColorstr=\"#2a3276\", endColorstr=\"#6b7aff\");}#unsupportedBrowser a.button:hover {-moz-box-shadow: inset 3px 3px 5px 0 #a9b1fd;-o-box-shadow: inset 3px 3px 5px 0 #a9b1fd;-webkit-box-shadow: inset 3px 3px 5px 0 #a9b1fd;box-shadow: inset 3px 3px 5px 0 #a9b1fd;background: #6b7aff;background-image: -ms-linear-gradient(top, #6b7aff 0%, #2a3276 100%);background-image: -moz-linear-gradient(top, #6b7aff 0%, #2a3276 100%);background-image: -o-linear-gradient(top, #6b7aff 0%, #2a3276 100%);background-image: -webkit-gradient(linear, left top, left bottom, color-stop(0, #6b7aff), color-stop(1, #2a3276));background-image: -webkit-linear-gradient(top, #6b7aff 0%, #2a3276 100%);background-image: linear-gradient(top, #6b7aff 0%, #2a3276 100%);filter: progid:DXImageTransform.Microsoft.gradient(startColorstr='#6b7aff', endColorstr='#2a3276'); }#unsupportedBrowser > svg {margin-top: 5px;}#unsupportedBrowser > .logo {background-image: -moz-radial-gradient(50% 250px, circle farthest-corner, #6b7aff, #2a3276 100%);background-image: -webkit-radial-gradient(50% 250px, circle farthest-corner, #6b7aff, #2a3276 100%);background-image: -o-radial-gradient(50% 250px, circle farthest-corner, #6b7aff, #2a3276 100%);background-image: -ms-radial-gradient(50% 250px, circle farthest-corner, #6b7aff, #2a3276 100%);background-image: radial-gradient(50% 250px, circle farthest-corner, #6b7aff, #2a3276 100%);}#unsupportedBrowser > .content {color: #9f9f9f;max-width: 700px;margin-left: 120px;margin-right: 20px;padding-top: 1em;}#unsupportedBrowser p {margin: 0 0 25px 0;}#unsupportedBrowser h1 {display: inline-block;max-width: 600px;margin: 13px 0 25px 20px;color: #f1eee5;vertical-align: top;font-weight: normal}",e.templates.standard.html='<div class="logo"><a href="http://gooengine.com">'+t.getLogo({color:t.white,shadow:!0,width:"100px",height:"70px"})+"</a>"+"<h1>Whoopsie daisy!</h1>"+"</div>"+'<div class="content">'+"<p>Your browser doesn't seem to support HTML5 and WebGL. The best thing to do is upgrade to a modern browser that supports all the awesome things the web has to offer.</p>"+'<p><a data-upgrade class="button" href="">Upgrade my browser!</a>'+'<a data-close class="button" href="">Not now</a></p>'+"</div>",e.prototype.show=function(){var t=document.createElement("div");t.innerHTML=this.template.html,t.setAttribute("id","unsupportedBrowser");var e=document.createElement("style");e.type="text/css",e.setAttribute("id","unsupportedBrowserStyles"),e.stylesheet?e.stylesheet.cssText=this.template.css:e.appendChild(document.createTextNode(this.template.css)),document.head.appendChild(e),document.body.appendChild(t);var i=t.querySelector("[data-close]"),o=function(t){t.preventDefault(),t.stopPropagation(),document.location.href=this.gooLocation,document.body.removeChild(document.querySelector("div#unsupportedBrowser")),document.head.removeChild(document.querySelector("#unsupportedBrowserStyles"))}.bind(this);i.addEventListener("click",o);var r=t.querySelector("[data-upgrade]"),n=function(t){t.preventDefault(),t.stopPropagation(),document.location.href=this.upgradeLocation}.bind(this);r.addEventListener("click",n)},e.prototype.addTemplate=function(t,i){e.templates[t]?console.error("Template "+t+" already exists"):e.templates[t]=i},e}),define("goo/util/Rc4Random",[],function(){"use strict";function t(t){function e(t){for(var e=0;256>e;e++)o[e]=e;for(var i=0,e=0;256>e;e++){i=(i+o[e]+t.charCodeAt(e%t.length))%256;var r=o[e];o[e]=o[i],o[i]=r}}function i(){r=(r+1)%256,n=(n+o[r])%256;var t=o[r];return o[r]=o[n],o[n]=t,o[(o[r]+o[n])%256]}var o=[],r=0,n=0;e(t),this.getRandomNumber=function(){for(var t=0,e=1,o=0;8>o;o++)t+=i()*e,e*=256;return t/0x10000000000000000}}return t}),define("goo",["goo/addons/ammo/AmmoComponent","goo/addons/ammo/AmmoSystem","goo/addons/ammo/calculateTriangleMeshShape","goo/addons/box2d/components/Box2DComponent","goo/addons/box2d/systems/Box2DSystem","goo/addons/cannon/CannonComponent","goo/addons/cannon/CannonSystem","goo/addons/howler/components/HowlerComponent","goo/addons/howler/systems/HowlerSystem","goo/addons/scripts/PolyBoundingScript","goo/addons/soundmanager2/components/SoundManager2Component","goo/addons/soundmanager2/systems/SoundManager2System","goo/addons/terrain/Terrain","goo/addons/water/FlatWaterRenderer","goo/addons/water/ProjectedGridWaterRenderer","goo/animation/Joint","goo/animation/Skeleton","goo/animation/SkeletonPose","goo/animation/blendtree/BinaryLERPSource","goo/animation/blendtree/ClipSource","goo/animation/blendtree/ExclusiveClipSource","goo/animation/blendtree/FrozenClipSource","goo/animation/blendtree/InclusiveClipSource","goo/animation/blendtree/ManagedTransformSource","goo/animation/clip/AbstractAnimationChannel","goo/animation/clip/AnimationClip","goo/animation/clip/AnimationClipInstance","goo/animation/clip/InterpolatedFloatChannel","goo/animation/clip/JointChannel","goo/animation/clip/JointData","goo/animation/clip/TransformChannel","goo/animation/clip/TransformData","goo/animation/clip/TriggerChannel","goo/animation/clip/TriggerData","goo/animation/layer/AnimationLayer","goo/animation/layer/LayerLERPBlender","goo/animation/state/AbstractState","goo/animation/state/AbstractTransitionState","goo/animation/state/FadeTransitionState","goo/animation/state/FrozenTransitionState","goo/animation/state/SteadyState","goo/animation/state/SyncFadeTransitionState","goo/debug/BoundingVolumeMeshBuilder","goo/debug/DebugDrawHelper","goo/debug/Debugger","goo/debug/EntityCounter","goo/debug/FrustumViewer","goo/debug/LightPointer","goo/debug/components/MarkerComponent","goo/debug/systems/MarkerSystem","goo/entities/Bus","goo/entities/Entity","goo/entities/EntityUtils","goo/entities/GooRunner","goo/entities/SystemBus","goo/entities/World","goo/entities/components/AnimationComponent","goo/entities/components/CSSTransformComponent","goo/entities/components/CameraComponent","goo/entities/components/CameraDebugComponent","goo/entities/components/Component","goo/entities/components/LightComponent","goo/entities/components/LightDebugComponent","goo/entities/components/LogicComponent","goo/entities/components/MeshDataComponent","goo/entities/components/MeshRendererComponent","goo/entities/components/MovementComponent","goo/entities/components/OccludeeComponent","goo/entities/components/OccluderComponent","goo/entities/components/ParticleComponent","goo/entities/components/PortalComponent","goo/entities/components/ProximityComponent","goo/entities/components/ScriptComponent","goo/entities/components/TextComponent","goo/entities/components/TransformComponent","goo/entities/managers/EntityManager","goo/entities/managers/Manager","goo/entities/systems/AnimationSystem","goo/entities/systems/BoundingUpdateSystem","goo/entities/systems/CSSTransformSystem","goo/entities/systems/CameraDebugSystem","goo/entities/systems/CameraSystem","goo/entities/systems/DebugRenderSystem","goo/entities/systems/GizmoRenderSystem","goo/entities/systems/GridRenderSystem","goo/entities/systems/LightDebugSystem","goo/entities/systems/LightingSystem","goo/entities/systems/LogicSystem","goo/entities/systems/MovementSystem","goo/entities/systems/ParticlesSystem","goo/entities/systems/PickingSystem","goo/entities/systems/PortalSystem","goo/entities/systems/ProximitySystem","goo/entities/systems/RenderSystem","goo/entities/systems/ScriptSystem","goo/entities/systems/System","goo/entities/systems/TextSystem","goo/entities/systems/TransformSystem","goo/loaders/DynamicLoader","goo/loaders/JsonUtils","goo/loaders/Loader","goo/loaders/crunch/CrunchLoader","goo/loaders/dds/DdsLoader","goo/loaders/dds/DdsUtils","goo/loaders/handlers/AnimationClipHandler","goo/loaders/handlers/AnimationComponentHandler","goo/loaders/handlers/AnimationLayersHandler","goo/loaders/handlers/AnimationStateHandler","goo/loaders/handlers/CameraComponentHandler","goo/loaders/handlers/ComponentHandler","goo/loaders/handlers/ConfigHandler","goo/loaders/handlers/EntityHandler","goo/loaders/handlers/FSMComponentHandler","goo/loaders/handlers/LightComponentHandler","goo/loaders/handlers/LogicComponentHandler","goo/loaders/handlers/MachineHandler","goo/loaders/handlers/MaterialHandler","goo/loaders/handlers/MeshDataComponentHandler","goo/loaders/handlers/MeshDataHandler","goo/loaders/handlers/MeshRendererComponentHandler","goo/loaders/handlers/PosteffectHandler","goo/loaders/handlers/ProjectHandler","goo/loaders/handlers/SceneHandler","goo/loaders/handlers/ScriptComponentHandler","goo/loaders/handlers/ScriptHandler","goo/loaders/handlers/ShaderHandler","goo/loaders/handlers/SkeletonHandler","goo/loaders/handlers/SoundComponentHandler","goo/loaders/handlers/SoundHandler","goo/loaders/handlers/TextureHandler","goo/loaders/handlers/TransformComponentHandler","goo/loaders/tga/TgaLoader","goo/logic/LogicInterface","goo/logic/LogicLayer","goo/logic/LogicNode","goo/logic/LogicNodeAdd","goo/logic/LogicNodeApplyMatrix","goo/logic/LogicNodeConstVec3","goo/logic/LogicNodeDebug","goo/logic/LogicNodeEntityProxy","goo/logic/LogicNodeFloat","goo/logic/LogicNodeInput","goo/logic/LogicNodeInt","goo/logic/LogicNodeLightComponent","goo/logic/LogicNodeMax","goo/logic/LogicNodeMeshRendererComponent","goo/logic/LogicNodeMouse","goo/logic/LogicNodeMultiply","goo/logic/LogicNodeMultiplyFloat","goo/logic/LogicNodeOutput","goo/logic/LogicNodeRandom","goo/logic/LogicNodeRotationMatrix","goo/logic/LogicNodeSine","goo/logic/LogicNodeSub","goo/logic/LogicNodeTime","goo/logic/LogicNodeTransformComponent","goo/logic/LogicNodeVec3","goo/logic/LogicNodeVec3Add","goo/logic/LogicNodeWASD","goo/logic/LogicNodeWASD2","goo/logic/LogicNodes","goo/math/MathUtils","goo/math/Matrix","goo/math/Matrix2x2","goo/math/Matrix3x3","goo/math/Matrix4x4","goo/math/Plane","goo/math/Quaternion","goo/math/Ray","goo/math/Transform","goo/math/Vector","goo/math/Vector2","goo/math/Vector3","goo/math/Vector4","goo/noise/Noise","goo/noise/ValueNoise","goo/particles/Particle","goo/particles/ParticleEmitter","goo/particles/ParticleInfluence","goo/particles/ParticleLib","goo/particles/ParticleUtils","goo/picking/BoundingTree","goo/picking/PrimitivePickLogic","goo/renderer/BufferData","goo/renderer/BufferUtils","goo/renderer/Camera","goo/renderer/Material","goo/renderer/MeshData","goo/renderer/OcclusionPartitioner","goo/renderer/RenderQueue","goo/renderer/Renderer","goo/renderer/RendererRecord","goo/renderer/Shader","goo/renderer/ShaderCall","goo/renderer/SimplePartitioner","goo/renderer/Texture","goo/renderer/TextureCreator","goo/renderer/Util","goo/renderer/bounds/BoundingBox","goo/renderer/bounds/BoundingSphere","goo/renderer/bounds/BoundingVolume","goo/renderer/light/DirectionalLight","goo/renderer/light/Light","goo/renderer/light/PointLight","goo/renderer/light/SpotLight","goo/renderer/pass/BloomPass","goo/renderer/pass/BlurPass","goo/renderer/pass/Composer","goo/renderer/pass/DOFPass","goo/renderer/pass/DepthPass","goo/renderer/pass/DoGPass","goo/renderer/pass/FullscreenPass","goo/renderer/pass/FullscreenUtil","goo/renderer/pass/NesPass","goo/renderer/pass/PassLib","goo/renderer/pass/RenderPass","goo/renderer/pass/RenderTarget","goo/renderer/pass/SSAOPass","goo/renderer/scanline/BoundingBoxOcclusionChecker","goo/renderer/scanline/BoundingSphereOcclusionChecker","goo/renderer/scanline/Edge","goo/renderer/scanline/EdgeData","goo/renderer/scanline/EdgeMap","goo/renderer/scanline/OccludeeTriangleData","goo/renderer/scanline/OccluderTriangleData","goo/renderer/scanline/SoftwareRenderer","goo/renderer/shaders/ShaderBuilder","goo/renderer/shaders/ShaderFragment","goo/renderer/shaders/ShaderLib","goo/renderer/shadow/ShadowHandler","goo/scripts/BasicControlScript","goo/scripts/FPCamControlScript","goo/scripts/FlyControlScript","goo/scripts/GroundBoundMovementScript","goo/scripts/HeightMapBoundingScript","goo/scripts/MouseLookControlScript","goo/scripts/OrbitCamControlScript","goo/scripts/OrbitNPanControlScript","goo/scripts/RotationControlScript","goo/scripts/SparseHeightMapBoundingScript","goo/scripts/SplineInterpolator","goo/scripts/WASDControlScript","goo/scripts/WorldFittedTerrainScript","goo/shapes/Box","goo/shapes/Cone","goo/shapes/Cylinder","goo/shapes/Disk","goo/shapes/FilledPolygon","goo/shapes/Grid","goo/shapes/PolyLine","goo/shapes/ProjectedGrid","goo/shapes/Quad","goo/shapes/RegularPolygon","goo/shapes/ShapeCreator","goo/shapes/SimpleBox","goo/shapes/Sphere","goo/shapes/Surface","goo/shapes/TerrainSurface","goo/shapes/TextureGrid","goo/shapes/Torus","goo/shapes/Triangle","goo/shapes/debug/CameraDebug","goo/shapes/debug/LightDebug","goo/shapes/debug/MeshRendererDebug","goo/shapes/debug/SkeletonDebug","goo/statemachine/FSMComponent","goo/statemachine/FSMSystem","goo/statemachine/FSMUtil","goo/statemachine/Machine","goo/statemachine/State","goo/statemachine/actions/Action","goo/statemachine/actions/Actions","goo/statemachine/actions/AddLightAction","goo/statemachine/actions/AddPositionAction","goo/statemachine/actions/AddVariableAction","goo/statemachine/actions/ArrowsAction","goo/statemachine/actions/CollidesAction","goo/statemachine/actions/CompareDistanceAction","goo/statemachine/actions/DollyZoomAction","goo/statemachine/actions/EmitAction","goo/statemachine/actions/EvalAction","goo/statemachine/actions/FireAction","goo/statemachine/actions/GetPositionAction","goo/statemachine/actions/GuiButtonAction","goo/statemachine/actions/HideAction","goo/statemachine/actions/InBoxAction","goo/statemachine/actions/InFrustumAction","goo/statemachine/actions/KeyDownAction","goo/statemachine/actions/KeyPressedAction","goo/statemachine/actions/KeyUpAction","goo/statemachine/actions/LogMessageAction","goo/statemachine/actions/LookAtAction","goo/statemachine/actions/MouseDownAction","goo/statemachine/actions/MouseMoveAction","goo/statemachine/actions/MouseUpAction","goo/statemachine/actions/MoveAction","goo/statemachine/actions/MultiplyVariableAction","goo/statemachine/actions/NumberCompareAction","goo/statemachine/actions/PauseAnimationAction","goo/statemachine/actions/PickAction","goo/statemachine/actions/RandomTransitionAction","goo/statemachine/actions/RemoveAction","goo/statemachine/actions/RemoveLightAction","goo/statemachine/actions/RemoveParticlesAction","goo/statemachine/actions/ResumeAnimationAction","goo/statemachine/actions/ResumeFSMAction","goo/statemachine/actions/RotateAction","goo/statemachine/actions/ScaleAction","goo/statemachine/actions/SetAnimationAction","goo/statemachine/actions/SetClearColorAction","goo/statemachine/actions/SetCssPropertyAction","goo/statemachine/actions/SetLightRangeAction","goo/statemachine/actions/SetPositionAction","goo/statemachine/actions/SetRenderTargetAction","goo/statemachine/actions/SetRotationAction","goo/statemachine/actions/SetVariableAction","goo/statemachine/actions/ShakeAction","goo/statemachine/actions/ShowAction","goo/statemachine/actions/SmokeAction","goo/statemachine/actions/SnowAction","goo/statemachine/actions/SoundFadeInAction","goo/statemachine/actions/SoundFadeOutAction","goo/statemachine/actions/SuspendFSMAction","goo/statemachine/actions/SwitchCameraAction","goo/statemachine/actions/TagAction","goo/statemachine/actions/TestAngleAction","goo/statemachine/actions/TestSpeedAction","goo/statemachine/actions/TransitionAction","goo/statemachine/actions/TransitionOnMessageAction","goo/statemachine/actions/TweenAction","goo/statemachine/actions/TweenLightColorAction","goo/statemachine/actions/TweenLookAtAction","goo/statemachine/actions/TweenMoveAction","goo/statemachine/actions/TweenRotationAction","goo/statemachine/actions/TweenScaleAction","goo/statemachine/actions/TweenTextureOffsetAction","goo/statemachine/actions/WASDAction","goo/statemachine/actions/WaitAction","goo/util/Ajax","goo/util/ArrayUtil","goo/util/CanvasUtils","goo/util/ColorUtil","goo/util/Enum","goo/util/GameUtils","goo/util/Grid","goo/util/Handy","goo/util/Latch","goo/util/Logo","goo/util/MeshBuilder","goo/util/NoWebGL","goo/util/ObjectUtil","goo/util/ParticleSystemUtils","goo/util/PromiseUtil","goo/util/Rc4Random","goo/util/ShapeCreatorMemoized","goo/util/Skybox","goo/util/Snow","goo/util/Stats","goo/util/StringUtil","goo/util/TangentGenerator","goo/util/gizmos/Gizmo","goo/util/gizmos/RotationGizmo","goo/util/gizmos/ScaleGizmo","goo/util/gizmos/TranslationGizmo","goo/util/rsvp"],function(){});
window.requirejs=requirejs;window.require=require;window.define=define;})(window,undefined)